const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(v){let A=0;const E=[],R=[],M={baseUrl:""},O={};function c(v,E,R){let M=null,V={},z=null;"function"==typeof v?V=v:"string"==typeof v?(M=v,"function"==typeof E?V=E:E instanceof Array&&(z=E,V=R)):v instanceof Array&&(z=v,"function"==typeof E&&(V=E)),z=z||["require","exports","module"],null===M&&(M="unnamed-module-"+A++),M=g(M),z=(z||[]).map((v=>function(v,A){return v?b(A,v):A}(M,v))),O[M]||(O[M]={name:M,parent:null,dclamd:1,dependencies:z,handlers:[],exports:{},dependants:new Set}),O[M].dependencies=z,p(z,(function(v){const A=O[M];if(!A)throw new Error("Could not access registered module "+M);let E=A.exports;E="function"==typeof V?V.apply(globalObject,v)||E:V,A.exports=E,d(M)}),(v=>{if("function"!=typeof onerror)throw v;onerror(v)}),M)}function d(v){const A=O[v];if(!A)throw new Error("Could not access registered module "+v);A.dclamd=2;const E=A.handlers;if(E&&E.length)for(let A=0;A<E.length;A++)E[A](O[v])}function u(v,A,E){if(!O[v])return null;if(v===A||50===E)return[v];const R=O[v].dependencies;for(let M=0,O=R.length;M<O;M++){const O=u(R[M],A,E+1);if(null!==O)return O.push(v),O}return null}function a(v,A){const E=O[v];if(!E)return!1;const R={};for(const v in O)R[v]=!1;const M=[];for(M.push(E),R[v]=!0;M.length>0;){const v=M.shift().dependencies;if(v)for(let E=0,V=v.length;E<V;E++){const V=v[E];if(V===A)return!0;const z=O[V];z&&!R[V]&&(R[V]=!0,M.push(z))}}return!1}function p(v,A,E,M){const V=new Array(v.length).fill(null);let z=0,W=!1;if("string"==typeof v){if(O[v]){if(1===O[v].dclamd)throw new Error(`Trying to load ${v} from ${M}. The first module is still loading.`);return O[v]}throw new Error(v+" has not been defined. Please include it as a dependency in "+M+"'s define()")}const H=v.length;for(let X=0;X<H;X++)switch(v[X]){case"require":const h=function(v,A,E){return p(v,A,E,M)};h.toUrl=function(v){return b(v,M)},V[X]=h,z++;break;case"exports":if(!O[M])throw new Error("Parent module "+M+" not registered yet");V[X]=O[M].exports,z++;break;case"module":V[X]={id:M,uri:b(M)},z++;break;default:{const K=v[X],m=()=>{V[X]=O[K].exports,z++,z===H&&A&&(W=!0,A(V))};if(a(K,M)){const v=u(K,M,0);v&&(v.reverse(),v.push(K),R.push(v)),w(K,(()=>{}),E,M),m()}else w(K,m,E,M);break}}!W&&z===H&&A&&A(V)}function h(v,A){return function(){return dcl.callRpc(v,A.name,E.slice.call(arguments,0))}}function w(v,A,E,R){if(O[v])return O[v].dependants.add(R),void(1===O[v].dclamd?A&&O[v].handlers.push(A):A&&A(O[v]));if(O[v]={name:v,parent:R,dclamd:1,handlers:[A],dependencies:[],dependants:new Set([R]),exports:{}},0===v.indexOf("@")){const A=O[v].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(v,A).then((E=>{for(const v in E.methods){const R=E.methods[v];A[R.name]=h(E.rpcHandle,R)}d(v)})).catch((v=>{E(v)}))}}function g(v){let A,E=v;for(A=/\/\.\//;A.test(E);)E=E.replace(A,"/");for(E=E.replace(/^\.\//g,""),A=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;A.test(E);)E=E.replace(A,"/");return E=E.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),E=E.replace(/^\//g,""),E}function b(v,A){switch(v){case"require":case"exports":case"module":return v}return A?function(v,A){let E=v;if(!E.startsWith("@")&&(E.startsWith("./")||E.startsWith("../"))){const v=A.split("/");v.pop(),E=g(v.join("/")+"/"+E)}return E}(v,A):g(v)}v.config=function(v){if("object"==typeof v)for(const A in v)v.hasOwnProperty(A)&&(M[A]=v[A])},v.define=c,function(v){v.amd={},v.modules=O}(c=v.define||(v.define={})),v.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const v=new Set,A=[];for(const E in O)O[E]&&(1===O[E].dclamd&&A.push(O[E]),O[E].dependencies.forEach((A=>{"require"!==A&&"exports"!==A&&"module"!==A&&(O[A]||v.add(A))})));const E=[];if(R.length&&E.push(`\n> Cyclic dependencies: ${R.map((v=>"\n  - "+v.join(" -> "))).join("")}`),v.size&&E.push(`\n> Undeclared/unknown modules: ${Array.from(v).map((v=>"\n  - "+v)).join("")}`),A.length&&E.push(`\n> These modules didn't load: ${A.map((v=>"\n  - "+v.name)).join("")}.\n`),E.length)throw new Error(E.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(v){var A=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(v){return v.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(v){return v.firstPersonCameraEntity}},t}(),n=function(v,A){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])})(v,A)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function i(v,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function i(){this.constructor=v}n(v,A),v.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}var o=function(){return(o=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var M in A=arguments[E])Object.prototype.hasOwnProperty.call(A,M)&&(v[M]=A[M]);return v}).apply(this,arguments)};function r(v,A,E,R){var M,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(v,A,E,R);else for(var z=v.length-1;z>=0;z--)(M=v[z])&&(V=(O<3?M(V):O>3?M(A,E,V):M(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V}function s(v,A){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(v,A)}function h(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(v,A){var E="function"==typeof Symbol&&v[Symbol.iterator];if(!E)return v;var R,M,O=E.call(v),V=[];try{for(;(void 0===A||A-- >0)&&!(R=O.next()).done;)V.push(R.value)}catch(v){M={error:v}}finally{try{R&&!R.done&&(E=O.return)&&E.call(O)}finally{if(M)throw M.error}}return V}function p(v,A){for(var E=0,R=A.length,M=v.length;E<R;E++,M++)v[M]=A[E];return v}var E=0;function c(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];"undefined"!=typeof dcl?dcl.log.apply(dcl,p([],l(v))):console.log.apply(console,p(["DEBUG:"],l(v)))}function y(v,A){"undefined"!=typeof dcl?dcl.error(v,A):console.error("ERROR:",v,A)}function f(v){if(E++,0===v.length)throw new Error("newId(type: string): type cannot be empty");return v+E.toString(36)}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(v){var A=16*Math.random()|0;return("x"===v?A:3&A|8).toString(16)}))}var R=[];function _(v){if(!("__event_name__"in v)||"string"!=typeof v.__event_name__)throw new Error("The EventConstructor is not registered");return v.__event_name__}var M=function(){function t(){this.listeners={}}return t.prototype.addListener=function(v,A,E){if(!v||"function"!=typeof v)throw new Error("Invalid EventConstructor");var R=_(v),M=this.listeners[R];M||(M=this.listeners[R]=[]);for(var O=0;O<M.length;O++)if(M[O].listener===A)throw new Error("The provided listener is already registered");return M.push({listener:A,fn:E}),this},t.prototype.removeListener=function(v,A){if(!A||"function"!=typeof A)throw new Error("Invalid EventConstructor");var E=_(A),R=this.listeners[E];if(!R)return!1;for(var M=0;M<R.length;M++)if(R[M].listener===v)return R.splice(M,1),!0;return!1},t.prototype.fireEvent=function(v){var A=_(v.constructor),E=this.listeners[A];if(E)for(var R=0;R<E.length;R++)try{var M=E[R];M.fn.call(M.listener,v)}catch(v){y(v)}return this},t}();function x(){var v=f("EV");if(-1!==R.indexOf(v))throw new Error("The event name "+v+" is already taken");return R.push(v),function(A){return A.__event_name__=v,A}}var O,V=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,A,E){this.entity=v,this.componentName=A,this.component=E})),z=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,A,E){this.entity=v,this.componentName=A,this.classId=E})),W=r([x(),s("design:paramtypes",[Object,Object])],(function(v,A){this.entity=v,this.parent=A}));v.UIValueType=void 0,(O=v.UIValueType||(v.UIValueType={}))[O.PERCENT=0]="PERCENT",O[O.PIXELS=1]="PIXELS";var H=function(){function e(A){if(this.type=v.UIValueType.PIXELS,"string"==typeof A){var E=A;E.indexOf("px")>-1?this.type=v.UIValueType.PIXELS:E.indexOf("%")>-1&&(this.type=v.UIValueType.PERCENT),this.value=parseFloat(E)}else this.value=A}return e.prototype.toString=function(){var A=this.value.toString();return this.type===v.UIValueType.PERCENT?A+="%":A+="px",A},e}(),X="__name__symbol_",K="__classId__symbol_",Z="__component__id_",J=r([x(),s("design:paramtypes",[String,String,Number])],(function(v,A,E){this.componentId=v,this.componentName=A,this.classId=E})),$=r([x(),s("design:paramtypes",[String])],(function(v){this.componentId=v})),ee=r([x(),s("design:paramtypes",[String,Object])],(function(v,A){this.componentId=v,this.component=A}));function P(v,A){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+v);var R=E,o=function(){var E=Array.prototype.slice.call(arguments),M=new(R.bind.apply(R,p([void 0],l(E))));return Object.defineProperty(M,X,{enumerable:!1,writable:!1,configurable:!1,value:v}),void 0!==A&&Object.defineProperty(M,K,{enumerable:!1,writable:!1,configurable:!1,value:A}),M};return void 0!==A&&(o.__classId__symbol_=A),o.__name__symbol_=v,o.isComponent=!0,o.originalClassName=v,(o.prototype=E.prototype).constructor=E,o}}function N(v,A){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+v);if("number"!=typeof A||isNaN(A))throw new Error("classId: "+A+" is an invalid integer");var R=E,o=function(){if(!N.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var E=Array.prototype.slice.call(arguments),M=new(R.bind.apply(R,p([void 0],l(E)))),O=f("C");return Object.defineProperty(M,X,{enumerable:!1,writable:!1,configurable:!1,value:v}),Object.defineProperty(M,Z,{enumerable:!1,writable:!1,configurable:!1,value:O}),void 0!==A&&Object.defineProperty(M,K,{enumerable:!1,writable:!1,configurable:!1,value:A}),N.engine&&N.engine.registerComponent(M),M};return void 0!==A&&(o.__classId__symbol_=A),o.__name__symbol_=v,o.isComponent=!0,o.isDisposableComponent=!0,o.originalClassName=v,(o.prototype=E.prototype).constructor=E,o}}function F(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__name__symbol_)return v.__name__symbol_;throw new TypeError(v+" is not a registered component.")}function L(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__classId__symbol_)return v.__classId__symbol_;if(!v.__name__symbol_)throw new TypeError(v+" is not a registered component.");return null}function D(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__component__id_)return v.__component__id_;throw new TypeError(v+" is not a registered disposable component.")}!function(v){v.engine=null}(N||(N={}));var ne=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(v,A){if(delete v[A]){var E=A+"_"+Math.random();v[E]=void 0,Object.defineProperty(v,E,o(o({},Object.getOwnPropertyDescriptor(v,E)),{enumerable:!1})),Object.defineProperty(v,A.toString(),{get:function(){return this[E]},set:function(v){var R=this[E];if(this.data[A]=v?D(v):null,this[E]=v,v!==R){this.dirty=!0;for(var M=0;M<this.subscriptions.length;M++)this.subscriptions[M](A,v,R)}},enumerable:!0})}},t.field=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){return this.data[A]},set:function(v){var E=this.data[A];if(this.data[A]=v,v!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](A,v,E)}},enumerable:!0})},t.uiValue=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){return this.data[A].toString()},set:function(v){var E=this.data[A],R=new H(v);if(this.data[A]=R,R!==E){this.dirty=!0;for(var M=0;M<this.subscriptions.length;M++)this.subscriptions[M](A,R,E)}},enumerable:!0})},t.readonly=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){if(A in this.data==0)throw new Error("The field "+A+" is uninitialized");return this.data[A]},set:function(v){if(A in this.data)throw new Error("The field "+A+" is readonly");this.data[A]=v,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(v){return this.subscriptions.push(v),this},t.prototype.toJSON=function(){return this.data},t}();function U(v){return Z in v}var oe=function(){function t(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];if(this.entities=[],this.active=!1,this._requiresNames=[],!v)throw new Error("ComponentGroup: Could not load the requires list");if(!(v instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return v.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(A){var R=v[A],M=null;if(!R)throw new Error("ComponentGroup: the required component at location "+A+" is invalid");try{M=F(R)}catch(v){throw new Error("ComponentGroup: the required component at location "+A+" is not registered as a @Component. Remember to provide the class of the component, not the name")}if(E._requiresNames.some((function(v){return v===M})))throw new Error("ComponentGroup: the required component list has a repeated name "+M);E._requiresNames.push(M)},E=this,R=0;R<v.length;R++)n(R)}return t.prototype.hasEntity=function(v){return!!v.isAddedToEngine()&&-1!==this.entities.indexOf(v)},t.prototype.addEntity=function(v){if(!v.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(v)&&this.entities.push(v)},t.prototype.removeEntity=function(v){var A=this.entities.indexOf(v);-1!==A&&this.entities.splice(A,1)},t.prototype.componentRemoved=function(v,A){-1!==this._requiresNames.indexOf(A)&&this.removeEntity(v)},t.prototype.meetsRequirements=function(v){for(var A=0;A<this._requiresNames.length;A++)if(!(this._requiresNames[A]in v.components))return!1;return!0},t}(),ie=function(){function t(v){this.name=v,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(v){if("function"==typeof v)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof v)throw new Error("You passed a "+typeof v+", an instance of component is expected");var A=F(v);if(this.components[A]){if(this.components[A]===v)return v;this.removeComponent(this.components[A],!1)}return this.addComponent(v)},t.prototype.hasComponent=function(v){var A=typeof v;if("string"!==A&&"object"!==A&&"function"!==A)throw new Error("Entity#has(component): component is not a class, name or instance");if(null===v)return!1;var E="string"===A?v:F(v),R=this.components[E];return!!R&&("object"===A?R===v:"function"!==A||R instanceof v)},t.prototype.getComponent=function(v){var A=typeof v;if("string"!==A&&"function"!==A)throw new Error("Entity#get(component): component is not a class or name");var E="string"===A?v:F(v),R=this.components[E];if(!R)throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'"');if("function"===A){if(R instanceof v)return R;throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'" (by instance)')}return R},t.prototype.getComponentOrNull=function(v){var A=typeof v;if("string"!==A&&"function"!==A)throw new Error("Entity#getOrNull(component): component is not a class or name");var E="string"===A?v:F(v),R=this.components[E];return R?"function"===A?R instanceof v?R:null:R:null},t.prototype.getComponentOrCreate=function(v){if("function"!=typeof v)throw new Error("Entity#getOrCreate(component): component is not a class");var A=this.getComponentOrNull(v);return A||(F(A=new v),this.addComponentOrReplace(A)),A},t.prototype.addComponent=function(v){if("object"!=typeof v)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var A=F(v),E=L(v);if(this.components[A])throw new Error('A component of type "'+A+'" is already present in entity "'+this.identifier+'"');this.components[A]=v,this.eventManager&&this.eventManager.fireEvent(new z(this,A,E));var R=v;return"function"==typeof R.addedToEntity&&R.addedToEntity(this),v},t.prototype.removeComponent=function(v,A){void 0===A&&(A=!0);var E=typeof v;if("string"!==E&&"function"!==E&&"object"!==E)throw new Error("Entity#remove(component): component is not a class, class or name");var R="string"===E?v:F(v),M=this.components[R];if(M){if("function"===E)return M instanceof v?(delete this.components[R],void(M&&(A&&this.eventManager&&this.eventManager.fireEvent(new V(this,R,M)),"function"==typeof M.removedFromEntity&&M.removedFromEntity(this)))):void c('Entity Warning: Trying to remove wrong (by constructor) component "'+R+'" from entity "'+this.identifier+'"');delete this.components[R],M&&(A&&this.eventManager&&this.eventManager.fireEvent(new V(this,R,M)),"function"==typeof M.removedFromEntity&&M.removedFromEntity(this))}else c('Entity Warning: Trying to remove inexisting component "'+R+'" from entity "'+this.identifier+'"')},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(v){var A;if(v&&"getEntityRepresentation"in v){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");A=v.getEntityRepresentation(this.engine)}else A=!v&&this.engine?this.engine.rootEntity:v;var E=this.getParent();if(A===this)throw new Error('Failed to set parent for entity "'+this.identifier+"\": An entity can't set itself as a its own parent");if(A===E)return this;var R=this.getCircularAncestor(A);if(R)throw new Error('Failed to set parent for entity "'+this.identifier+'": Circular parent references are not allowed (See entity "'+R+'")');return E&&delete E.children[this.uuid],null!==A&&"0"!==A.uuid&&(!A.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),A.isAddedToEngine()&&!this.isAddedToEngine()&&A.engine.addEntity(this)),this._parent=A||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new W(this,A)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(v){for(var A=this.engine?this.engine.rootEntity:null,E=v;E&&E!==A;){var R=E.getParent();if(R===this)return E.uuid;E=R}return null},t.prototype.registerAsChild=function(){var v=this.getParent();this.uuid&&v&&(v.children[this.uuid]=this)},t}(),ae=function(){function t(v){this.eventManager=new M,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(z,this,this.componentAddedHandler),this.eventManager.addListener(V,this,this.componentRemovedHandler),this.rootEntity=v,this.firstPersonCameraEntity=new ie,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new ie,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(v){var A=v.getParent();if(v.isAddedToEngine())return v;for(var E in v.eventManager=this.eventManager,v.engine=this,this._entities[v.uuid]=v,this.checkRequirementsAndAdd(v),A?A.isAddedToEngine()||A===this.rootEntity||c("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+A.uuid):v.setParent(this.rootEntity),v.alive=!0,v.children){var R=v.children[E];R&&(R.isAddedToEngine()||this.addEntity(R))}return v},t.prototype.removeEntity=function(v){var A=v.uuid;if(v.isAddedToEngine()){for(var E in v.components){var R=this._componentGroups[E];if(R)for(var M in R)R[M].removeEntity(v);delete this.entityLists[E][A]}for(var O=0;O<this.simpleSystems.length;O++){var V=this.simpleSystems[O];V.onRemoveEntity&&V.onRemoveEntity(v)}for(var O in v.children){var z=v.children[O];z&&this.removeEntity(z)}return v.alive=!1,v.eventManager=null,delete this._entities[A],!0}for(var E in c("Engine: Trying to remove non existent entity from engine."),v.isAddedToEngine()?c("Engine: Entity id: "+A):c('Engine: Entity "'+v.uuid+'" has not been added to any engine yet.'),c("Engine: Entity's components:"),v.components)c(E);return!1},t.prototype.addSystem=function(v,A){if(void 0===A&&(A=0),-1!==this.addedSystems.indexOf(v))return c("Engine: Trying to add a system that is already added. Aborting"),v;if(this.systems.length>0)for(var E=0;E<this.systems.length;E++){var R=this.systems[E],M=E===this.systems.length-1;if(R.priority>A){this.addedSystems.push(v),this.systems.splice(E,0,{system:v,priority:A});break}if(M){this.addedSystems.push(v),this.systems.splice(E+1,0,{system:v,priority:A});break}}else this.addedSystems.push(v),this.systems.splice(1,0,{system:v,priority:A});return this.registerSystem(v),v},t.prototype.removeSystem=function(v){var A=this.addedSystems.indexOf(v);if(-1!==A){v.active=!1,v.deactivate&&v.deactivate(),this.addedSystems.splice(A,1);for(var E=0;E<this.systems.length;E++)this.systems[E].system===v&&this.systems.splice(E,1);return!0}return!1},t.prototype.update=function(v){for(var A in this.systems){var E=this.systems[A].system;if(E.active&&E.update)try{E.update(v)}catch(v){y(v)}}return this},t.prototype.getEntitiesWithComponent=function(v){var A="string"==typeof v?v:F(v);return A in this.entityLists?this.entityLists[A]:this.entityLists[A]={}},t.prototype.registerComponent=function(v){var A=D(v),E=F(v),R=L(v);this._disposableComponents[A]=v,null!==R&&(this.eventManager.fireEvent(new J(A,E,R)),this.eventManager.fireEvent(new ee(A,v)))},t.prototype.disposeComponent=function(v){var A=D(v);return delete this._disposableComponents[A]&&(this.eventManager.fireEvent(new $(A)),v.onDispose&&v.onDispose(),!0)},t.prototype.updateComponent=function(v){this.eventManager.fireEvent(new ee(D(v),v))},t.prototype.getComponentGroup=function(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];var E=void 0;if(v.length>0&&(W=this._componentGroups[F(v[0])]))for(var R=v.slice(),M=0;M<W.length;M++){var O=W[M];if(R.length===O.requires.length){for(var V=0;V<R.length&&-1!==O.requires.indexOf(R[V]);V++)V===R.length-1&&(E=O);if(E)break}}if(E)return E;(E=new(oe.bind.apply(oe,p([void 0],l(v))))).active=!0;var z=E.requiresNames;for(M=0;M<z.length;M++){var W,H=z[M];(W=this._componentGroups[H])||(this._componentGroups[H]=W=[]),-1===W.indexOf(E)&&W.push(E)}for(var X in this._entities)this.checkRequirements(this._entities[X],E);return E},t.prototype.removeComponentGroup=function(v){if(v.active){v.active=!1;for(var A=v.requiresNames,E=0;E<A.length;E++){var R=A[E],M=this._componentGroups[R];if(M){var O=M.indexOf(v);-1!==O&&M.splice(O,1)}}return!0}return!1},t.prototype.registerSystem=function(v){v.active=!0,v.activate&&v.activate(this),this.simpleSystems.push(v)},t.prototype.checkRequirementsAndAdd=function(v){if(v.isAddedToEngine()){for(var A in v.components){A in this.entityLists||(this.entityLists[A]={}),this.entityLists[A][v.uuid]=v;var E=this._componentGroups[A];if(E)for(var R in E)this.checkRequirements(v,E[R])}for(var M=0;M<this.simpleSystems.length;M++){var O=this.simpleSystems[M];O.onAddEntity&&O.onAddEntity(v)}}},t.prototype.checkRequirements=function(v,A){A.meetsRequirements(v)?A.hasEntity(v)||A.addEntity(v):A.hasEntity(v)&&A.removeEntity(v)},t.prototype.componentAddedHandler=function(v){var A,E=v.entity,R=v.componentName;if(E.isAddedToEngine()){this.entityLists[R]?this.entityLists[R][E.uuid]=E:this.entityLists[R]=((A={})[E.uuid]=E,A);var M=this._componentGroups[R];if(M)for(var O in M)this.checkRequirements(E,M[O])}},t.prototype.componentRemovedHandler=function(v){var A=v.entity,E=v.componentName;if(A.isAddedToEngine()){delete this.entityLists[E][A.uuid];var R=this._componentGroups[E];if(R)for(var M in R)this.checkRequirements(A,R[M])}},t}(),se=Promise.resolve().then.bind(Promise.resolve());function G(v){var A=se(v);return A.isComplete=!1,A.then((function(v){A.isComplete=!0,A.result=v,A.didFail=!1})).catch((function(v){A.isComplete=!0,A.error=v,A.didFail=!0,y("executeTask: FAILED "+v.toString(),v)})),A}var le,ce,ue=function(){function t(v,A,E,R){void 0===A&&(A=!1),this.initalize(v,A,E,R)}return t.prototype.initalize=function(v,A,E,R){return void 0===A&&(A=!1),this.mask=v,this.skipNextObservers=A,this.target=E,this.currentTarget=R,this},t}(),Y=function(v,A,E){void 0===E&&(E=null),this.callback=v,this.mask=A,this.scope=E,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},de=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(v,A,E,R){var M,O;void 0===E&&(E=-1),void 0===R&&(R=null);var V=new t;V._observers=new Array,V._observables=v;try{for(var z=h(v),W=z.next();!W.done;W=z.next()){var H=W.value.add(A,E,!1,R);H&&V._observers.push(H)}}catch(v){M={error:v}}finally{try{W&&!W.done&&(O=z.return)&&O.call(z)}finally{if(M)throw M.error}}return V},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var v=0;v<this._observers.length;v++)this._observables[v].remove(this._observers[v]);this._observers=null,this._observables=null},t}(),he=function(){function t(v){this._observers=new Array,this._onObserverAdded=null,this._eventState=new ue(0),v&&(this._onObserverAdded=v)}return t.prototype.add=function(v,A,E,R,M){if(void 0===A&&(A=-1),void 0===E&&(E=!1),void 0===R&&(R=null),void 0===M&&(M=!1),!v)return null;var O=new Y(v,A,R);return O.unregisterOnNextCall=M,E?this._observers.unshift(O):this._observers.push(O),this._onObserverAdded&&this._onObserverAdded(O),O},t.prototype.addOnce=function(v){return this.add(v,void 0,void 0,void 0,!0)},t.prototype.remove=function(v){return!!v&&-1!==this._observers.indexOf(v)&&(this._deferUnregister(v),!0)},t.prototype.removeCallback=function(v,A){for(var E=0;E<this._observers.length;E++)if(this._observers[E].callback===v&&(!A||A===this._observers[E].scope))return this._deferUnregister(this._observers[E]),!0;return!1},t.prototype.notifyObservers=function(v,A,E,R){var M,O;if(void 0===A&&(A=-1),!this._observers.length)return!0;var V=this._eventState;V.mask=A,V.target=E,V.currentTarget=R,V.skipNextObservers=!1,V.lastReturnValue=v;try{for(var z=h(this._observers),W=z.next();!W.done;W=z.next()){var H=W.value;if(!H._willBeUnregistered&&(H.mask&A&&(H.scope?V.lastReturnValue=H.callback.apply(H.scope,[v,V]):V.lastReturnValue=H.callback(v,V),H.unregisterOnNextCall&&this._deferUnregister(H)),V.skipNextObservers))return!1}}catch(v){M={error:v}}finally{try{W&&!W.done&&(O=z.return)&&O.call(z)}finally{if(M)throw M.error}}return!0},t.prototype.notifyObserversWithPromise=function(v,A,E,R){var M=this;void 0===A&&(A=-1);var O=Promise.resolve(v);if(!this._observers.length)return O;var V=this._eventState;return V.mask=A,V.target=E,V.currentTarget=R,V.skipNextObservers=!1,this._observers.forEach((function(E){V.skipNextObservers||E._willBeUnregistered||E.mask&A&&(O=E.scope?O.then((function(A){return V.lastReturnValue=A,E.callback.apply(E.scope,[v,V])})):O.then((function(A){return V.lastReturnValue=A,E.callback(v,V)})),E.unregisterOnNextCall&&M._deferUnregister(E))})),O.then((function(){return v}))},t.prototype.notifyObserver=function(v,A,E){void 0===E&&(E=-1);var R=this._eventState;R.mask=E,R.skipNextObservers=!1,v.callback(A,R)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var v=new t;return v._observers=this._observers.slice(0),v},t.prototype.hasSpecificMask=function(v){var A,E;void 0===v&&(v=-1);try{for(var R=h(this._observers),M=R.next();!M.done;M=R.next()){var O=M.value;if(O.mask&v||O.mask===v)return!0}}catch(v){A={error:v}}finally{try{M&&!M.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}return!1},t.prototype._deferUnregister=function(v){var A=this;v.unregisterOnNextCall=!1,v._willBeUnregistered=!0,G((function(){return function(v,A,E,R){return new(E||(E=Promise))((function(A,M){function s(v){try{d(R.next(v))}catch(v){M(v)}}function a(v){try{d(R.throw(v))}catch(v){M(v)}}function d(v){var R;v.done?A(v.value):(R=v.value,R instanceof E?R:new E((function(v){v(R)}))).then(s,a)}d((R=R.apply(v,[])).next())}))}(A,0,void 0,(function(){return function(v,A){var E,R,M,O,V={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(z){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(M=2&O[0]?R.return:O[0]?R.throw||((M=R.return)&&M.call(R),0):R.next)&&!(M=M.call(R,O[1])).done)return M;switch(R=0,M&&(O=[2&O[0],M.value]),O[0]){case 0:case 1:M=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((M=(M=V.trys).length>0&&M[M.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!M||O[1]>M[0]&&O[1]<M[3])){V.label=O[1];break}if(6===O[0]&&V.label<M[1]){V.label=M[1],M=O;break}if(M&&V.label<M[2]){V.label=M[2],V.ops.push(O);break}M[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(v,V)}catch(v){O=[6,v],R=0}finally{E=M=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,z])}}}(this,(function(A){return[2,this._remove(v)]}))}))}))},t.prototype._remove=function(v){if(!v)return!1;var A=this._observers.indexOf(v);return-1!==A&&(this._observers.splice(A,1),!0)},t}(),me=r([x(),s("design:paramtypes",[String,Object])],(function(v,A){this.uuid=v,this.payload=A})),fe=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v})),ye=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v}));function tt(v){return function(){ce&&ce.subscribe(v)}}var we=new he(tt("cameraModeChanged")),ve=new he(tt("idleStateChanged")),be=new he(tt("onEnterScene")),Te=be,Se=new he(tt("onLeaveScene")),Ce=Se,Ee=new he(tt("sceneStart")),_e=new he(tt("playerExpression")),Ie=new he(tt("onPointerLock")),Pe=new he(tt("videoEvent")),Be=new he(tt("profileChanged")),ke=new he(tt("playerConnected")),Re=new he(tt("playerDisconnected")),Oe=new he(tt("onRealmChanged")),Le=new he(tt("playerClicked"));function mt(v){(ce=v)&&ce.onEvent((function(v){switch(v.type){case"onEnterScene":return void be.notifyObservers(v.data);case"onLeaveScene":return void Se.notifyObservers(v.data);case"cameraModeChanged":return void we.notifyObservers(v.data);case"idleStateChanged":return void ve.notifyObservers(v.data);case"sceneStart":return void Ee.notifyObservers(v.data);case"playerExpression":return void _e.notifyObservers(v.data);case"videoEvent":var A=v.data,E=N.engine.disposableComponents[A.componentId];return E&&E.update(A),void Pe.notifyObservers(A);case"profileChanged":return void Be.notifyObservers(v.data);case"onPointerLock":return void Ie.notifyObservers(v.data);case"playerConnected":return void ke.notifyObservers(v.data);case"playerDisconnected":return void Re.notifyObservers(v.data);case"onRealmChanged":return void Oe.notifyObservers(v.data);case"playerClicked":return void Le.notifyObservers(v.data)}}))}var Ve=function(){function t(v){this.dcl=v,this.cachedComponents={}}return t.prototype.activate=function(v){var A=this;this.engine=v,v.eventManager.addListener(z,this,this.componentAdded),v.eventManager.addListener(V,this,this.componentRemoved),v.eventManager.addListener(J,this,this.disposableComponentCreated),v.eventManager.addListener($,this,this.disposableComponentRemoved),v.eventManager.addListener(ee,this,this.disposableComponentUpdated),v.eventManager.addListener(W,this,this.parentChanged);var E=v.rootEntity.uuid;this.dcl.addEntity(E),this.dcl.onUpdate((function(E){v.update(E),A.presentEntities()})),this.dcl.onEvent((function(A){var E=A.data;switch(A.type){case"uuidEvent":v.eventManager.fireEvent(new me(E.uuid,E.payload));break;case"raycastResponse":("HitFirst"===E.queryType||"HitAll"===E.queryType)&&v.eventManager.fireEvent(new fe(E));break;case"actionButtonEvent":v.eventManager.fireEvent(new ye(E.payload))}}))},t.prototype.onAddEntity=function(v){if(v&&v.isAddedToEngine()){var A=v.uuid,E=v.getParent();for(var R in this.dcl.addEntity(A),E&&this.dcl.setParent(A,E.uuid),this.cachedComponents[A]={},v.components){var M=v.components[R],O=L(M);if(null!==O)if(U(M))this.dcl.attachEntityComponent(v.uuid,R,D(M));else{var V=JSON.stringify(M);this.dcl.updateEntityComponent(A,R,O,V),this.cachedComponents[A][R]=V}}}},t.prototype.onRemoveEntity=function(v){if(v.isAddedToEngine()){var A=v.uuid;this.dcl.removeEntity(A),delete this.cachedComponents[A]}},t.prototype.presentEntities=function(){for(var v in this.engine.entities){var A=this.engine.entities[v];for(var E in A.components){var R=L(V=A.components[E]);if(null!==R&&!U(V)){var M=this.getJsonIfDirty(A.uuid,E,V);M&&(this.dcl.updateEntityComponent(A.uuid,E,R,M),this.clearDirty(A.uuid,E,V,M))}}}for(var O in this.engine.disposableComponents){var V;(V=this.engine.disposableComponents[O])instanceof ne&&V.dirty&&(this.dcl.componentUpdated(O,JSON.stringify(V)),V.dirty=!1)}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var A=v.entity.components[v.componentName];if(U(A))this.dcl.attachEntityComponent(v.entity.uuid,v.componentName,D(A));else if(null!==v.classId){var E=JSON.stringify(A);this.dcl.updateEntityComponent(v.entity.uuid,v.componentName,v.classId,E),this.cachedComponents[v.entity.uuid][v.componentName]=E}}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(v.entity.uuid,v.componentName),delete this.cachedComponents[v.entity.uuid][v.componentName])},t.prototype.disposableComponentCreated=function(v){this.dcl.componentCreated(v.componentId,v.componentName,v.classId)},t.prototype.disposableComponentRemoved=function(v){this.dcl.componentDisposed(v.componentId)},t.prototype.disposableComponentUpdated=function(v){this.dcl.componentUpdated(v.componentId,JSON.stringify(v.component))},t.prototype.parentChanged=function(v){this.dcl.setParent(v.entity.uuid,v.parent?v.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(v,A,E){var R=JSON.stringify(E);return R!==this.cachedComponents[v][A]&&R},t.prototype.clearDirty=function(v,A,E,R){this.cachedComponents[v][A]=R},t}(),Ne="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Fe={},Ue={};!function(v){var A,E;Object.defineProperty(v,"__esModule",{value:!0}),v.RAD2DEG=v.DEG2RAD=v.Epsilon=v.ToLinearSpace=v.ToGammaSpace=v.Space=v.Orientation=void 0,(A=v.Orientation||(v.Orientation={}))[A.CW=0]="CW",A[A.CCW=1]="CCW",(E=v.Space||(v.Space={}))[E.LOCAL=0]="LOCAL",E[E.WORLD=1]="WORLD",E[E.BONE=2]="BONE",v.ToGammaSpace=1/2.2,v.ToLinearSpace=2.2,v.Epsilon=1e-6,v.DEG2RAD=Math.PI/180,v.RAD2DEG=360/(2*Math.PI)}(Ue);var We={},Ge={};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.buildArray=void 0,Ge.buildArray=function(v,A){const E=[];for(let R=0;R<v;++R)E.push(A());return E};var qe={},He={},Ye={},Qe={},Xe={};Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.Scalar=void 0;class Et{static WithinEpsilon(v,A,E=1401298e-51){const R=v-A;return-E<=R&&R<=E}static ToHex(v){const A=v.toString(16);return v<=15?("0"+A).toUpperCase():A.toUpperCase()}static Sign(v){const A=+v;return 0===A||isNaN(A)?A:A>0?1:-1}static Clamp(v,A=0,E=1){return Math.min(E,Math.max(A,v))}static Log2(v){return Math.log(v)*Math.LOG2E}static Repeat(v,A){return v-Math.floor(v/A)*A}static Normalize(v,A,E){return(v-A)/(E-A)}static Denormalize(v,A,E){return v*(E-A)+A}static DeltaAngle(v,A){let E=Et.Repeat(A-v,360);return E>180&&(E-=360),E}static PingPong(v,A){const E=Et.Repeat(v,2*A);return A-Math.abs(E-A)}static SmoothStep(v,A,E){let R=Et.Clamp(E);return R=-2*R*R*R+3*R*R,A*R+v*(1-R)}static MoveTowards(v,A,E){let R=0;return R=Math.abs(A-v)<=E?A:v+Et.Sign(A-v)*E,R}static MoveTowardsAngle(v,A,E){const R=Et.DeltaAngle(v,A);let M=0;return M=-E<R&&R<E?A:Et.MoveTowards(v,v+R,E),M}static Lerp(v,A,E){return v+(A-v)*E}static LerpAngle(v,A,E){let R=Et.Repeat(A-v,360);return R>180&&(R-=360),v+R*Et.Clamp(E)}static InverseLerp(v,A,E){let R=0;return R=v!==A?Et.Clamp((E-v)/(A-v)):0,R}static Hermite(v,A,E,R,M){const O=M*M,V=M*O;return v*(2*V-3*O+1)+E*(-2*V+3*O)+A*(V-2*O+M)+R*(V-O)}static RandomRange(v,A){return v===A?v:Math.random()*(A-v)+v}static RangeToPercent(v,A,E){return(v-A)/(E-A)}static PercentToRange(v,A,E){return(E-A)*v+A}static NormalizeRadians(v){return v-Et.TwoPi*Math.floor((v+Math.PI)/Et.TwoPi)}}Xe.Scalar=Et,Et.TwoPi=2*Math.PI,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.Vector4=void 0;const Ze=Ue,Je=Xe,$e=qe;class Mt{constructor(v,A,E,R){this.x=v,this.y=A,this.z=E,this.w=R}static Add(v,A){return new Mt(v.x,v.y,v.z,v.w).addInPlace(A)}static FromArray(v,A=0){return new Mt(v[A],v[A+1],v[A+2],v[A+3])}static FromArrayToRef(v,A,E){E.x=v[A],E.y=v[A+1],E.z=v[A+2],E.w=v[A+3]}static FromFloatArrayToRef(v,A,E){Mt.FromArrayToRef(v,A,E)}static FromFloatsToRef(v,A,E,R,M){M.x=v,M.y=A,M.z=E,M.w=R}static Zero(){return new Mt(0,0,0,0)}static One(){return new Mt(1,1,1,1)}static Normalize(v){const A=Mt.Zero();return Mt.NormalizeToRef(v,A),A}static NormalizeToRef(v,A){A.copyFrom(v),A.normalize()}static Minimize(v,A){const E=new Mt(v.x,v.y,v.z,v.w);return E.minimizeInPlace(A),E}static Maximize(v,A){const E=new Mt(v.x,v.y,v.z,v.w);return E.maximizeInPlace(A),E}static Distance(v,A){return Math.sqrt(Mt.DistanceSquared(v,A))}static DistanceSquared(v,A){const E=v.x-A.x,R=v.y-A.y,M=v.z-A.z,O=v.w-A.w;return E*E+R*R+M*M+O*O}static Center(v,A){const E=Mt.Add(v,A);return E.scaleInPlace(.5),E}static TransformNormal(v,A){const E=Mt.Zero();return Mt.TransformNormalToRef(v,A,E),E}static TransformNormalToRef(v,A,E){const R=A.m,M=v.x*R[0]+v.y*R[4]+v.z*R[8],O=v.x*R[1]+v.y*R[5]+v.z*R[9],V=v.x*R[2]+v.y*R[6]+v.z*R[10];E.x=M,E.y=O,E.z=V,E.w=v.w}static TransformNormalFromFloatsToRef(v,A,E,R,M,O){const V=M.m;O.x=v*V[0]+A*V[4]+E*V[8],O.y=v*V[1]+A*V[5]+E*V[9],O.z=v*V[2]+A*V[6]+E*V[10],O.w=R}toString(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"}getClassName(){return"Vector4"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,v[A+2]=this.z,v[A+3]=this.w,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}add(v){return new Mt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addToRef(v,A){return A.x=this.x+v.x,A.y=this.y+v.y,A.z=this.z+v.z,A.w=this.w+v.w,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this}subtract(v){return new Mt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}subtractToRef(v,A){return A.x=this.x-v.x,A.y=this.y-v.y,A.z=this.z-v.z,A.w=this.w-v.w,this}subtractFromFloats(v,A,E,R){return new Mt(this.x-v,this.y-A,this.z-E,this.w-R)}subtractFromFloatsToRef(v,A,E,R,M){return M.x=this.x-v,M.y=this.y-A,M.z=this.z-E,M.w=this.w-R,this}negate(){return new Mt(-this.x,-this.y,-this.z,-this.w)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scale(v){return new Mt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,A.z=this.z*v,A.w=this.w*v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,A.z+=this.z*v,A.w+=this.w*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}equalsWithEpsilon(v,A=Ze.Epsilon){return v&&Je.Scalar.WithinEpsilon(this.x,v.x,A)&&Je.Scalar.WithinEpsilon(this.y,v.y,A)&&Je.Scalar.WithinEpsilon(this.z,v.z,A)&&Je.Scalar.WithinEpsilon(this.w,v.w,A)}equalsToFloats(v,A,E,R){return this.x===v&&this.y===A&&this.z===E&&this.w===R}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this.w*=v.w,this}multiply(v){return new Mt(this.x*v.x,this.y*v.y,this.z*v.z,this.w*v.w)}multiplyToRef(v,A){return A.x=this.x*v.x,A.y=this.y*v.y,A.z=this.z*v.z,A.w=this.w*v.w,this}multiplyByFloats(v,A,E,R){return new Mt(this.x*v,this.y*A,this.z*E,this.w*R)}divide(v){return new Mt(this.x/v.x,this.y/v.y,this.z/v.z,this.w/v.w)}divideToRef(v,A){return A.x=this.x/v.x,A.y=this.y/v.y,A.z=this.z/v.z,A.w=this.w/v.w,this}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return v.x<this.x&&(this.x=v.x),v.y<this.y&&(this.y=v.y),v.z<this.z&&(this.z=v.z),v.w<this.w&&(this.w=v.w),this}maximizeInPlace(v){return v.x>this.x&&(this.x=v.x),v.y>this.y&&(this.y=v.y),v.z>this.z&&(this.z=v.z),v.w>this.w&&(this.w=v.w),this}floor(){return new Mt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return new Mt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){const v=this.length();return 0===v?this:this.scaleInPlace(1/v)}toVector3(){return new $e.Vector3(this.x,this.y,this.z)}clone(){return new Mt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,A,E,R){return this.x=v,this.y=A,this.z=E,this.w=R,this}set(v,A,E,R){return this.copyFromFloats(v,A,E,R)}setAll(v){return this.x=this.y=this.z=this.w=v,this}}Qe.Vector4=Mt,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Matrix=void 0;const et=qe,nt=He,ot=We,it=Qe;class Dt{constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}get m(){return this._m}static get IdentityReadOnly(){return Dt._identityReadOnly}static FromArray(v,A=0){const E=new Dt;return Dt.FromArrayToRef(v,A,E),E}static FromArrayToRef(v,A,E){for(let R=0;R<16;R++)E._m[R]=v[R+A];E._markAsUpdated()}static FromFloatArrayToRefScaled(v,A,E,R){for(let M=0;M<16;M++)R._m[M]=v[M+A]*E;R._markAsUpdated()}static FromValuesToRef(v,A,E,R,M,O,V,z,W,H,X,K,Z,J,$,ee,ne){const oe=ne._m;oe[0]=v,oe[1]=A,oe[2]=E,oe[3]=R,oe[4]=M,oe[5]=O,oe[6]=V,oe[7]=z,oe[8]=W,oe[9]=H,oe[10]=X,oe[11]=K,oe[12]=Z,oe[13]=J,oe[14]=$,oe[15]=ee,ne._markAsUpdated()}static FromValues(v,A,E,R,M,O,V,z,W,H,X,K,Z,J,$,ee){const ne=new Dt,oe=ne._m;return oe[0]=v,oe[1]=A,oe[2]=E,oe[3]=R,oe[4]=M,oe[5]=O,oe[6]=V,oe[7]=z,oe[8]=W,oe[9]=H,oe[10]=X,oe[11]=K,oe[12]=Z,oe[13]=J,oe[14]=$,oe[15]=ee,ne._markAsUpdated(),ne}static Compose(v,A,E){const R=new Dt;return Dt.ComposeToRef(v,A,E,R),R}static ComposeToRef(v,A,E,R){Dt.ScalingToRef(v.x,v.y,v.z,ot.MathTmp.Matrix[1]),A.toRotationMatrix(ot.MathTmp.Matrix[0]),ot.MathTmp.Matrix[1].multiplyToRef(ot.MathTmp.Matrix[0],R),R.setTranslation(E)}static Identity(){const v=Dt.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return v._updateIdentityStatus(!0),v}static IdentityToRef(v){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(!0)}static Zero(){const v=Dt.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return v._updateIdentityStatus(!1),v}static RotationX(v){const A=new Dt;return Dt.RotationXToRef(v,A),A}static Invert(v){const A=new Dt;return v.invertToRef(A),A}static RotationXToRef(v,A){const E=Math.sin(v),R=Math.cos(v);Dt.FromValuesToRef(1,0,0,0,0,R,E,0,0,-E,R,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)}static RotationY(v){const A=new Dt;return Dt.RotationYToRef(v,A),A}static RotationYToRef(v,A){const E=Math.sin(v),R=Math.cos(v);Dt.FromValuesToRef(R,0,-E,0,0,1,0,0,E,0,R,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)}static RotationZ(v){const A=new Dt;return Dt.RotationZToRef(v,A),A}static RotationZToRef(v,A){const E=Math.sin(v),R=Math.cos(v);Dt.FromValuesToRef(R,E,0,0,-E,R,0,0,0,0,1,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)}static RotationAxis(v,A){const E=new Dt;return Dt.RotationAxisToRef(v,A,E),E}static RotationAxisToRef(v,A,E){const R=Math.sin(-A),M=Math.cos(-A),O=1-M;v.normalize();const V=E._m;V[0]=v.x*v.x*O+M,V[1]=v.x*v.y*O-v.z*R,V[2]=v.x*v.z*O+v.y*R,V[3]=0,V[4]=v.y*v.x*O+v.z*R,V[5]=v.y*v.y*O+M,V[6]=v.y*v.z*O-v.x*R,V[7]=0,V[8]=v.z*v.x*O-v.y*R,V[9]=v.z*v.y*O+v.x*R,V[10]=v.z*v.z*O+M,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,E._markAsUpdated()}static RotationYawPitchRoll(v,A,E){const R=new Dt;return Dt.RotationYawPitchRollToRef(v,A,E,R),R}static RotationYawPitchRollToRef(v,A,E,R){nt.Quaternion.RotationYawPitchRollToRef(v,A,E,ot.MathTmp.Quaternion[0]),ot.MathTmp.Quaternion[0].toRotationMatrix(R)}static Scaling(v,A,E){const R=new Dt;return Dt.ScalingToRef(v,A,E,R),R}static ScalingToRef(v,A,E,R){Dt.FromValuesToRef(v,0,0,0,0,A,0,0,0,0,E,0,0,0,0,1,R),R._updateIdentityStatus(1===v&&1===A&&1===E)}static Translation(v,A,E){const R=new Dt;return Dt.TranslationToRef(v,A,E,R),R}static TranslationToRef(v,A,E,R){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v,A,E,1,R),R._updateIdentityStatus(0===v&&0===A&&0===E)}static Lerp(v,A,E){const R=new Dt;return Dt.LerpToRef(v,A,E,R),R}static LerpToRef(v,A,E,R){for(let M=0;M<16;M++)R._m[M]=v._m[M]*(1-E)+A._m[M]*E;R._markAsUpdated()}static DecomposeLerp(v,A,E){const R=new Dt;return Dt.DecomposeLerpToRef(v,A,E,R),R}static DecomposeLerpToRef(v,A,E,R){const M=ot.MathTmp.Vector3[0],O=ot.MathTmp.Quaternion[0],V=ot.MathTmp.Vector3[1];v.decompose(M,O,V);const z=ot.MathTmp.Vector3[2],W=ot.MathTmp.Quaternion[1],H=ot.MathTmp.Vector3[3];A.decompose(z,W,H);const X=ot.MathTmp.Vector3[4];et.Vector3.LerpToRef(M,z,E,X);const K=ot.MathTmp.Quaternion[2];nt.Quaternion.SlerpToRef(O,W,E,K);const Z=ot.MathTmp.Vector3[5];et.Vector3.LerpToRef(V,H,E,Z),Dt.ComposeToRef(X,K,Z,R)}static LookAtLH(v,A,E){const R=new Dt;return Dt.LookAtLHToRef(v,A,E,R),R}static LookAtLHToRef(v,A,E,R){const M=ot.MathTmp.Vector3[0],O=ot.MathTmp.Vector3[1],V=ot.MathTmp.Vector3[2];A.subtractToRef(v,V),V.normalize(),et.Vector3.CrossToRef(E,V,M);const z=M.lengthSquared();0===z?M.x=1:M.normalizeFromLength(Math.sqrt(z)),et.Vector3.CrossToRef(V,M,O),O.normalize();const W=-et.Vector3.Dot(M,v),H=-et.Vector3.Dot(O,v),X=-et.Vector3.Dot(V,v);Dt.FromValuesToRef(M.x,O.x,V.x,0,M.y,O.y,V.y,0,M.z,O.z,V.z,0,W,H,X,1,R)}static LookAtRH(v,A,E){const R=new Dt;return Dt.LookAtRHToRef(v,A,E,R),R}static LookAtRHToRef(v,A,E,R){const M=ot.MathTmp.Vector3[0],O=ot.MathTmp.Vector3[1],V=ot.MathTmp.Vector3[2];v.subtractToRef(A,V),V.normalize(),et.Vector3.CrossToRef(E,V,M);const z=M.lengthSquared();0===z?M.x=1:M.normalizeFromLength(Math.sqrt(z)),et.Vector3.CrossToRef(V,M,O),O.normalize();const W=-et.Vector3.Dot(M,v),H=-et.Vector3.Dot(O,v),X=-et.Vector3.Dot(V,v);Dt.FromValuesToRef(M.x,O.x,V.x,0,M.y,O.y,V.y,0,M.z,O.z,V.z,0,W,H,X,1,R)}static OrthoLH(v,A,E,R){const M=new Dt;return Dt.OrthoLHToRef(v,A,E,R,M),M}static OrthoLHToRef(v,A,E,R,M){const O=2/v,V=2/A,z=2/(R-E),W=-(R+E)/(R-E);Dt.FromValuesToRef(O,0,0,0,0,V,0,0,0,0,z,0,0,0,W,1,M),M._updateIdentityStatus(1===O&&1===V&&1===z&&0===W)}static OrthoOffCenterLH(v,A,E,R,M,O){const V=new Dt;return Dt.OrthoOffCenterLHToRef(v,A,E,R,M,O,V),V}static OrthoOffCenterLHToRef(v,A,E,R,M,O,V){const z=2/(A-v),W=2/(R-E),H=2/(O-M),X=-(O+M)/(O-M),K=(v+A)/(v-A),Z=(R+E)/(E-R);Dt.FromValuesToRef(z,0,0,0,0,W,0,0,0,0,H,0,K,Z,X,1,V),V._markAsUpdated()}static OrthoOffCenterRH(v,A,E,R,M,O){const V=new Dt;return Dt.OrthoOffCenterRHToRef(v,A,E,R,M,O,V),V}static OrthoOffCenterRHToRef(v,A,E,R,M,O,V){Dt.OrthoOffCenterLHToRef(v,A,E,R,M,O,V),V._m[10]*=-1}static PerspectiveLH(v,A,E,R){const M=new Dt,O=2*E/v,V=2*E/A,z=(R+E)/(R-E),W=-2*R*E/(R-E);return Dt.FromValuesToRef(O,0,0,0,0,V,0,0,0,0,z,1,0,0,W,0,M),M._updateIdentityStatus(!1),M}static PerspectiveFovLH(v,A,E,R){const M=new Dt;return Dt.PerspectiveFovLHToRef(v,A,E,R,M),M}static PerspectiveFovLHToRef(v,A,E,R,M,O=!0){const V=E,z=R,W=1/Math.tan(.5*v),H=O?W/A:W,X=O?W:W*A,K=(z+V)/(z-V),Z=-2*z*V/(z-V);Dt.FromValuesToRef(H,0,0,0,0,X,0,0,0,0,K,1,0,0,Z,0,M),M._updateIdentityStatus(!1)}static PerspectiveFovRH(v,A,E,R){const M=new Dt;return Dt.PerspectiveFovRHToRef(v,A,E,R,M),M}static PerspectiveFovRHToRef(v,A,E,R,M,O=!0){const V=E,z=R,W=1/Math.tan(.5*v),H=O?W/A:W,X=O?W:W*A,K=-(z+V)/(z-V),Z=-2*z*V/(z-V);Dt.FromValuesToRef(H,0,0,0,0,X,0,0,0,0,K,-1,0,0,Z,0,M),M._updateIdentityStatus(!1)}static PerspectiveFovWebVRToRef(v,A,E,R,M=!1){const O=M?-1:1,V=Math.tan(v.upDegrees*Math.PI/180),z=Math.tan(v.downDegrees*Math.PI/180),W=Math.tan(v.leftDegrees*Math.PI/180),H=Math.tan(v.rightDegrees*Math.PI/180),X=2/(W+H),K=2/(V+z),Z=R._m;Z[0]=X,Z[1]=Z[2]=Z[3]=Z[4]=0,Z[5]=K,Z[6]=Z[7]=0,Z[8]=(W-H)*X*.5,Z[9]=-(V-z)*K*.5,Z[10]=-E/(A-E),Z[11]=1*O,Z[12]=Z[13]=Z[15]=0,Z[14]=-2*E*A/(E-A),R._markAsUpdated()}static GetAsMatrix2x2(v){return[v._m[0],v._m[1],v._m[4],v._m[5]]}static GetAsMatrix3x3(v){return[v._m[0],v._m[1],v._m[2],v._m[4],v._m[5],v._m[6],v._m[8],v._m[9],v._m[10]]}static Transpose(v){const A=new Dt;return Dt.TransposeToRef(v,A),A}static TransposeToRef(v,A){const E=A._m,R=v._m;E[0]=R[0],E[1]=R[4],E[2]=R[8],E[3]=R[12],E[4]=R[1],E[5]=R[5],E[6]=R[9],E[7]=R[13],E[8]=R[2],E[9]=R[6],E[10]=R[10],E[11]=R[14],E[12]=R[3],E[13]=R[7],E[14]=R[11],E[15]=R[15],A._updateIdentityStatus(v._isIdentity,v._isIdentityDirty)}static Reflection(v){const A=new Dt;return Dt.ReflectionToRef(v,A),A}static ReflectionToRef(v,A){v.normalize();const E=v.normal.x,R=v.normal.y,M=v.normal.z,O=-2*E,V=-2*R,z=-2*M;Dt.FromValuesToRef(O*E+1,V*E,z*E,0,O*R,V*R+1,z*R,0,O*M,V*M,z*M+1,0,O*v.d,V*v.d,z*v.d,1,A)}static FromXYZAxesToRef(v,A,E,R){Dt.FromValuesToRef(v.x,v.y,v.z,0,A.x,A.y,A.z,0,E.x,E.y,E.z,0,0,0,0,1,R)}static FromQuaternionToRef(v,A){const E=v.x*v.x,R=v.y*v.y,M=v.z*v.z,O=v.x*v.y,V=v.z*v.w,z=v.z*v.x,W=v.y*v.w,H=v.y*v.z,X=v.x*v.w;A._m[0]=1-2*(R+M),A._m[1]=2*(O+V),A._m[2]=2*(z-W),A._m[3]=0,A._m[4]=2*(O-V),A._m[5]=1-2*(M+E),A._m[6]=2*(H+X),A._m[7]=0,A._m[8]=2*(z+W),A._m[9]=2*(H-X),A._m[10]=1-2*(R+E),A._m[11]=0,A._m[12]=0,A._m[13]=0,A._m[14]=0,A._m[15]=1,A._markAsUpdated()}_markAsUpdated(){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const v=this._m;this._isIdentity=1===v[0]&&0===v[1]&&0===v[2]&&0===v[3]&&0===v[4]&&1===v[5]&&0===v[6]&&0===v[7]&&0===v[8]&&0===v[9]&&1===v[10]&&0===v[11]&&0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const v=this._m,A=v[0],E=v[1],R=v[2],M=v[3],O=v[4],V=v[5],z=v[6],W=v[7],H=v[8],X=v[9],K=v[10],Z=v[11],J=v[12],$=v[13],ee=v[14],ne=v[15],oe=K*ne-ee*Z,ie=X*ne-$*Z,ae=X*ee-$*K,se=H*ne-J*Z,le=H*ee-K*J,ce=H*$-J*X;return A*+(V*oe-z*ie+W*ae)+E*-(O*oe-z*se+W*le)+R*+(O*ie-V*se+W*ce)+M*-(O*ae-V*le+z*ce)}toArray(){return this._m}asArray(){return this._m}invert(){return this.invertToRef(this),this}reset(){return Dt.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(v){const A=new Dt;return this.addToRef(v,A),A}addToRef(v,A){for(let E=0;E<16;E++)A._m[E]=this._m[E]+v._m[E];return A._markAsUpdated(),this}addToSelf(v){for(let A=0;A<16;A++)this._m[A]+=v._m[A];return this._markAsUpdated(),this}invertToRef(v){if(!0===this._isIdentity)return Dt.IdentityToRef(v),this;const A=this._m,E=A[0],R=A[1],M=A[2],O=A[3],V=A[4],z=A[5],W=A[6],H=A[7],X=A[8],K=A[9],Z=A[10],J=A[11],$=A[12],ee=A[13],ne=A[14],oe=A[15],ie=Z*oe-ne*J,ae=K*oe-ee*J,se=K*ne-ee*Z,le=X*oe-$*J,ce=X*ne-Z*$,ue=X*ee-$*K,de=+(z*ie-W*ae+H*se),he=-(V*ie-W*le+H*ce),me=+(V*ae-z*le+H*ue),fe=-(V*se-z*ce+W*ue),ye=E*de+R*he+M*me+O*fe;if(0===ye)return v.copyFrom(this),this;const we=1/ye,ve=W*oe-ne*H,be=z*oe-ee*H,Te=z*ne-ee*W,Se=V*oe-$*H,Ce=V*ne-$*W,Ee=V*ee-$*z,_e=W*J-Z*H,Ie=z*J-K*H,Pe=z*Z-K*W,Be=V*J-X*H,ke=V*Z-X*W,Re=V*K-X*z,Oe=-(R*ie-M*ae+O*se),Le=+(E*ie-M*le+O*ce),Ve=-(E*ae-R*le+O*ue),Ne=+(E*se-R*ce+M*ue),Fe=+(R*ve-M*be+O*Te),Ue=-(E*ve-M*Se+O*Ce),We=+(E*be-R*Se+O*Ee),Ge=-(E*Te-R*Ce+M*Ee),qe=-(R*_e-M*Ie+O*Pe),He=+(E*_e-M*Be+O*ke),Ye=-(E*Ie-R*Be+O*Re),Qe=+(E*Pe-R*ke+M*Re);return Dt.FromValuesToRef(de*we,Oe*we,Fe*we,qe*we,he*we,Le*we,Ue*we,He*we,me*we,Ve*we,We*we,Ye*we,fe*we,Ne*we,Ge*we,Qe*we,v),this}addAtIndex(v,A){return this._m[v]+=A,this._markAsUpdated(),this}multiplyAtIndex(v,A){return this._m[v]*=A,this._markAsUpdated(),this}setTranslationFromFloats(v,A,E){return this._m[12]=v,this._m[13]=A,this._m[14]=E,this._markAsUpdated(),this}setTranslation(v){return this.setTranslationFromFloats(v.x,v.y,v.z)}getTranslation(){return new et.Vector3(this._m[12],this._m[13],this._m[14])}getTranslationToRef(v){return v.x=this._m[12],v.y=this._m[13],v.z=this._m[14],this}removeRotationAndScaling(){const v=this.m;return Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v[12],v[13],v[14],v[15],this),this._updateIdentityStatus(0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]),this}multiply(v){const A=new Dt;return this.multiplyToRef(v,A),A}copyFrom(v){v.copyToArray(this._m);const A=v;return this._updateIdentityStatus(A._isIdentity,A._isIdentityDirty,A._isIdentity3x2,A._isIdentity3x2Dirty),this}copyToArray(v,A=0){for(let E=0;E<16;E++)v[A+E]=this._m[E];return this}multiplyToRef(v,A){return this._isIdentity?(A.copyFrom(v),this):v._isIdentity?(A.copyFrom(this),this):(this.multiplyToArray(v,A._m,0),A._markAsUpdated(),this)}multiplyToArray(v,A,E){const R=this._m,M=v.m,O=R[0],V=R[1],z=R[2],W=R[3],H=R[4],X=R[5],K=R[6],Z=R[7],J=R[8],$=R[9],ee=R[10],ne=R[11],oe=R[12],ie=R[13],ae=R[14],se=R[15],le=M[0],ce=M[1],ue=M[2],de=M[3],he=M[4],me=M[5],fe=M[6],ye=M[7],we=M[8],ve=M[9],be=M[10],Te=M[11],Se=M[12],Ce=M[13],Ee=M[14],_e=M[15];return A[E]=O*le+V*he+z*we+W*Se,A[E+1]=O*ce+V*me+z*ve+W*Ce,A[E+2]=O*ue+V*fe+z*be+W*Ee,A[E+3]=O*de+V*ye+z*Te+W*_e,A[E+4]=H*le+X*he+K*we+Z*Se,A[E+5]=H*ce+X*me+K*ve+Z*Ce,A[E+6]=H*ue+X*fe+K*be+Z*Ee,A[E+7]=H*de+X*ye+K*Te+Z*_e,A[E+8]=J*le+$*he+ee*we+ne*Se,A[E+9]=J*ce+$*me+ee*ve+ne*Ce,A[E+10]=J*ue+$*fe+ee*be+ne*Ee,A[E+11]=J*de+$*ye+ee*Te+ne*_e,A[E+12]=oe*le+ie*he+ae*we+se*Se,A[E+13]=oe*ce+ie*me+ae*ve+se*Ce,A[E+14]=oe*ue+ie*fe+ae*be+se*Ee,A[E+15]=oe*de+ie*ye+ae*Te+se*_e,this}equals(v){const A=v;if(!A)return!1;if((this._isIdentity||A._isIdentity)&&!this._isIdentityDirty&&!A._isIdentityDirty)return this._isIdentity&&A._isIdentity;const E=this.m,R=A.m;return E[0]===R[0]&&E[1]===R[1]&&E[2]===R[2]&&E[3]===R[3]&&E[4]===R[4]&&E[5]===R[5]&&E[6]===R[6]&&E[7]===R[7]&&E[8]===R[8]&&E[9]===R[9]&&E[10]===R[10]&&E[11]===R[11]&&E[12]===R[12]&&E[13]===R[13]&&E[14]===R[14]&&E[15]===R[15]}clone(){const v=new Dt;return v.copyFrom(this),v}getClassName(){return"Matrix"}getHashCode(){let v=this._m[0]||0;for(let A=1;A<16;A++)v=397*v^(this._m[A]||0);return v}decompose(v,A,E){if(this._isIdentity)return E&&E.setAll(0),v&&v.setAll(1),A&&A.copyFromFloats(0,0,0,1),!0;const R=this._m;E&&E.copyFromFloats(R[12],R[13],R[14]);const M=v||ot.MathTmp.Vector3[0];if(M.x=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]),M.y=Math.sqrt(R[4]*R[4]+R[5]*R[5]+R[6]*R[6]),M.z=Math.sqrt(R[8]*R[8]+R[9]*R[9]+R[10]*R[10]),this.determinant()<=0&&(M.y*=-1),0===M.x||0===M.y||0===M.z)return A&&A.copyFromFloats(0,0,0,1),!1;if(A){const v=1/M.x,E=1/M.y,O=1/M.z;Dt.FromValuesToRef(R[0]*v,R[1]*v,R[2]*v,0,R[4]*E,R[5]*E,R[6]*E,0,R[8]*O,R[9]*O,R[10]*O,0,0,0,0,1,ot.MathTmp.Matrix[0]),nt.Quaternion.FromRotationMatrixToRef(ot.MathTmp.Matrix[0],A)}return!0}getRow(v){if(v<0||v>3)return null;const A=4*v;return new it.Vector4(this._m[A+0],this._m[A+1],this._m[A+2],this._m[A+3])}setRow(v,A){return this.setRowFromFloats(v,A.x,A.y,A.z,A.w)}transpose(){return Dt.Transpose(this)}transposeToRef(v){return Dt.TransposeToRef(this,v),this}setRowFromFloats(v,A,E,R,M){if(v<0||v>3)return this;const O=4*v;return this._m[O+0]=A,this._m[O+1]=E,this._m[O+2]=R,this._m[O+3]=M,this._markAsUpdated(),this}scale(v){const A=new Dt;return this.scaleToRef(v,A),A}scaleToRef(v,A){for(let E=0;E<16;E++)A._m[E]=this._m[E]*v;return A._markAsUpdated(),this}scaleAndAddToRef(v,A){for(let E=0;E<16;E++)A._m[E]+=this._m[E]*v;return A._markAsUpdated(),this}toNormalMatrix(v){const A=ot.MathTmp.Matrix[0];this.invertToRef(A),A.transposeToRef(v);const E=v._m;Dt.FromValuesToRef(E[0],E[1],E[2],0,E[4],E[5],E[6],0,E[8],E[9],E[10],0,0,0,0,1,v)}getRotationMatrix(){const v=new Dt;return this.getRotationMatrixToRef(v),v}getRotationMatrixToRef(v){const A=ot.MathTmp.Vector3[0];if(!this.decompose(A))return Dt.IdentityToRef(v),this;const E=this._m,R=1/A.x,M=1/A.y,O=1/A.z;return Dt.FromValuesToRef(E[0]*R,E[1]*R,E[2]*R,0,E[4]*M,E[5]*M,E[6]*M,0,E[8]*O,E[9]*O,E[10]*O,0,0,0,0,1,v),this}toggleModelMatrixHandInPlace(){const v=this._m;v[2]*=-1,v[6]*=-1,v[8]*=-1,v[9]*=-1,v[14]*=-1,this._markAsUpdated()}toggleProjectionMatrixHandInPlace(){const v=this._m;v[8]*=-1,v[9]*=-1,v[10]*=-1,v[11]*=-1,this._markAsUpdated()}_updateIdentityStatus(v,A=!1,E=!1,R=!0){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=v,this._isIdentity3x2=v||E,this._isIdentityDirty=!this._isIdentity&&A,this._isIdentity3x2Dirty=!this._isIdentity3x2&&R}}Ye.Matrix=Dt,Dt._updateFlagSeed=0,Dt._identityReadOnly=Dt.Identity(),Object.defineProperty(He,"__esModule",{value:!0}),He.Quaternion=void 0;const rt=Ye,at=qe,st=We,lt=Ue,ct=Xe;class jt{constructor(v=0,A=0,E=0,R=1){this.x=v,this.y=A,this.z=E,this.w=R}static FromRotationMatrix(v){const A=new jt;return jt.FromRotationMatrixToRef(v,A),A}static FromRotationMatrixToRef(v,A){const E=v.m,R=E[0],M=E[4],O=E[8],V=E[1],z=E[5],W=E[9],H=E[2],X=E[6],K=E[10],Z=R+z+K;let J;Z>0?(J=.5/Math.sqrt(Z+1),A.w=.25/J,A.x=(X-W)*J,A.y=(O-H)*J,A.z=(V-M)*J):R>z&&R>K?(J=2*Math.sqrt(1+R-z-K),A.w=(X-W)/J,A.x=.25*J,A.y=(M+V)/J,A.z=(O+H)/J):z>K?(J=2*Math.sqrt(1+z-R-K),A.w=(O-H)/J,A.x=(M+V)/J,A.y=.25*J,A.z=(W+X)/J):(J=2*Math.sqrt(1+K-R-z),A.w=(V-M)/J,A.x=(O+H)/J,A.y=(W+X)/J,A.z=.25*J)}static Dot(v,A){return v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w}static AreClose(v,A){return jt.Dot(v,A)>=0}static Zero(){return new jt(0,0,0,0)}static Inverse(v){return new jt(-v.x,-v.y,-v.z,v.w)}static IsIdentity(v){return v&&0===v.x&&0===v.y&&0===v.z&&1===v.w}static RotationAxis(v,A){const E=A*lt.DEG2RAD;return jt.RotationAxisToRef(v,E,new jt)}static RotationAxisToRef(v,A,E){const R=A*lt.DEG2RAD,M=Math.sin(R/2);return v.normalize(),E.w=Math.cos(R/2),E.x=v.x*M,E.y=v.y*M,E.z=v.z*M,E}static FromArray(v,A=0){return new jt(v[A],v[A+1],v[A+2],v[A+3])}static FromEulerAnglesRef(v,A,E,R){return jt.RotationYawPitchRollToRef(A*lt.DEG2RAD,v*lt.DEG2RAD,E*lt.DEG2RAD,R)}static RotationYawPitchRoll(v,A,E){const R=new jt;return jt.RotationYawPitchRollToRef(v,A,E,R),R}static RotationYawPitchRollToRef(v,A,E,R){const M=.5*A,O=.5*v,V=.5*E,z=Math.cos(M),W=Math.cos(O),H=Math.cos(V),X=Math.sin(M),K=Math.sin(O),Z=Math.sin(V);R.x=W*X*H+K*z*Z,R.y=K*z*H-W*X*Z,R.z=W*z*Z-K*X*H,R.w=W*z*H+K*X*Z}static RotationAlphaBetaGamma(v,A,E){const R=new jt;return jt.RotationAlphaBetaGammaToRef(v,A,E,R),R}static RotationAlphaBetaGammaToRef(v,A,E,R){const M=.5*(E+v),O=.5*(E-v),V=.5*A;R.x=Math.cos(O)*Math.sin(V),R.y=Math.sin(O)*Math.sin(V),R.z=Math.sin(M)*Math.cos(V),R.w=Math.cos(M)*Math.cos(V)}static RotationQuaternionFromAxis(v,A,E){const R=new jt(0,0,0,0);return jt.RotationQuaternionFromAxisToRef(v,A,E,R),R}static RotationQuaternionFromAxisToRef(v,A,E,R){const M=st.MathTmp.Matrix[0];rt.Matrix.FromXYZAxesToRef(v.normalize(),A.normalize(),E.normalize(),M),jt.FromRotationMatrixToRef(M,R)}static Slerp(v,A,E){const R=jt.Identity;return jt.SlerpToRef(v,A,E,R),R}static SlerpToRef(v,A,E,R){let M,O,V=v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w,z=!1;if(V<0&&(z=!0,V=-V),V>.999999)O=1-E,M=z?-E:E;else{const v=Math.acos(V),A=1/Math.sin(v);O=Math.sin((1-E)*v)*A,M=z?-Math.sin(E*v)*A:Math.sin(E*v)*A}R.x=O*v.x+M*A.x,R.y=O*v.y+M*A.y,R.z=O*v.z+M*A.z,R.w=O*v.w+M*A.w}static Hermite(v,A,E,R,M){const O=M*M,V=M*O,z=2*V-3*O+1,W=-2*V+3*O,H=V-2*O+M,X=V-O,K=v.x*z+E.x*W+A.x*H+R.x*X,Z=v.y*z+E.y*W+A.y*H+R.y*X,J=v.z*z+E.z*W+A.z*H+R.z*X,$=v.w*z+E.w*W+A.w*H+R.w*X;return new jt(K,Z,J,$)}static get Identity(){return new jt(0,0,0,1)}static Angle(v,A){const E=jt.Dot(v,A);return 2*Math.acos(Math.min(Math.abs(E),1))*lt.RAD2DEG}static Euler(v,A,E){return jt.RotationYawPitchRoll(A*lt.DEG2RAD,v*lt.DEG2RAD,E*lt.DEG2RAD)}static LookRotation(v,A=st.MathTmp.staticUp){const E=at.Vector3.Normalize(v),R=at.Vector3.Normalize(at.Vector3.Cross(A,E)),M=at.Vector3.Cross(E,R),O=R.x,V=R.y,z=R.z,W=M.x,H=M.y,X=M.z,K=E.x,Z=E.y,J=E.z,$=O+H+J,ee=new jt;if($>0){let v=Math.sqrt($+1);return ee.w=.5*v,v=.5/v,ee.x=(X-Z)*v,ee.y=(K-z)*v,ee.z=(V-W)*v,ee}if(O>=H&&O>=J){const v=Math.sqrt(1+O-H-J),A=.5/v;return ee.x=.5*v,ee.y=(V+W)*A,ee.z=(z+K)*A,ee.w=(X-Z)*A,ee}if(H>J){const v=Math.sqrt(1+H-O-J),A=.5/v;return ee.x=(W+V)*A,ee.y=.5*v,ee.z=(Z+X)*A,ee.w=(K-z)*A,ee}const ne=Math.sqrt(1+J-O-H),oe=.5/ne;return ee.x=(K+z)*oe,ee.y=(Z+X)*oe,ee.z=.5*ne,ee.w=(V-W)*oe,ee}static RotateTowards(v,A,E){const R=jt.Angle(v,A);if(0===R)return A;const M=Math.min(1,E/R);return jt.Slerp(v,A,M)}static FromToRotation(v,A,E=st.MathTmp.staticUp){const R=v.normalize(),M=A.normalize(),O=at.Vector3.Cross(R,M),V=Math.sqrt(R.lengthSquared()*M.lengthSquared())+at.Vector3.Dot(R,M);return O.lengthSquared()<1e-4?Math.abs(V)<1e-4?new jt(E.x,E.y,E.z,0).normalized:jt.Identity:new jt(O.x,O.y,O.z,V).normalized}get normalized(){return this.normalize()}setFromToRotation(v,A,E=st.MathTmp.staticUp){const R=jt.FromToRotation(v,A,E);this.x=R.x,this.y=R.y,this.z=R.z,this.w=R.w}set eulerAngles(v){this.setEuler(v.x,v.y,v.z)}get eulerAngles(){const v=new at.Vector3,A=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,E=this.x*this.w-this.y*this.z;return E>.4995*A?(v.x=Math.PI/2,v.y=2*Math.atan2(this.y,this.x),v.z=0):E<-.4995*A?(v.x=-Math.PI/2,v.y=-2*Math.atan2(this.y,this.x),v.z=0):(v.x=Math.asin(2*(this.w*this.x-this.y*this.z)),v.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),v.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),v.x*=lt.RAD2DEG,v.y*=lt.RAD2DEG,v.z*=lt.RAD2DEG,v.x=ct.Scalar.Repeat(v.x,360),v.y=ct.Scalar.Repeat(v.y,360),v.z=ct.Scalar.Repeat(v.z,360),v}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}get length(){return Math.sqrt(this.lengthSquared)}get lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}getClassName(){return"Quaternion"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){return[this.x,this.y,this.z,this.w]}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}clone(){return new jt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,A,E,R){return this.x=v,this.y=A,this.z=E,this.w=R,this}set(v,A,E,R){return this.copyFromFloats(v,A,E,R)}setEuler(v,A,E){return jt.RotationYawPitchRollToRef(A*lt.DEG2RAD,v*lt.DEG2RAD,E*lt.DEG2RAD,this),this}add(v){return new jt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}subtract(v){return new jt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}scale(v){return new jt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,A.z=this.z*v,A.w=this.w*v,this}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,A.z+=this.z*v,A.w+=this.w*v,this}multiply(v){const A=new jt(0,0,0,1);return this.multiplyToRef(v,A),A}multiplyToRef(v,A){const E=this.x*v.w+this.y*v.z-this.z*v.y+this.w*v.x,R=-this.x*v.z+this.y*v.w+this.z*v.x+this.w*v.y,M=this.x*v.y-this.y*v.x+this.z*v.w+this.w*v.z,O=-this.x*v.x-this.y*v.y-this.z*v.z+this.w*v.w;return A.copyFromFloats(E,R,M,O),this}multiplyInPlace(v){return this.multiplyToRef(v,this),this}conjugateToRef(v){return v.copyFromFloats(-this.x,-this.y,-this.z,this.w),this}conjugateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this}conjugate(){return new jt(-this.x,-this.y,-this.z,this.w)}normalize(){const v=1/this.length;return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}angleAxis(v,A){if(0===A.lengthSquared())return jt.Identity;const E=jt.Identity;let R=v*lt.DEG2RAD;R*=.5;let M=A.normalize();return M=A.scaleInPlace(Math.sin(R)),E.x=M.x,E.y=M.y,E.z=M.z,E.w=Math.cos(R),E.normalize()}toRotationMatrix(v){return rt.Matrix.FromQuaternionToRef(this,v),this}fromRotationMatrix(v){return jt.FromRotationMatrixToRef(v,this),this}}He.Quaternion=jt,Object.defineProperty(qe,"__esModule",{value:!0}),qe.Vector3=void 0;const ut=We,dt=Ue,pt=He,ht=Xe;class Xt{constructor(v=0,A=0,E=0){this.x=v,this.y=A,this.z=E}get isNonUniform(){const v=Math.abs(this.x),A=Math.abs(this.y);if(v!==A)return!0;const E=Math.abs(this.z);return v!==E||A!==E}static Add(v,A){return new Xt(v.x,v.y,v.z).addInPlace(A)}static GetClipFactor(v,A,E,R){const M=Xt.Dot(v,E)-R;return M/(M-(Xt.Dot(A,E)-R))}static GetAngleBetweenVectors(v,A,E){const R=v.normalizeToRef(ut.MathTmp.Vector3[1]),M=A.normalizeToRef(ut.MathTmp.Vector3[2]),O=Xt.Dot(R,M),V=ut.MathTmp.Vector3[3];return Xt.CrossToRef(R,M,V),Xt.Dot(V,E)>0?Math.acos(O):-Math.acos(O)}static FromArray(v,A=0){return new Xt(v[A],v[A+1],v[A+2])}static FromFloatArray(v,A){return Xt.FromArray(v,A)}static FromArrayToRef(v,A,E){E.x=v[A],E.y=v[A+1],E.z=v[A+2]}static FromFloatArrayToRef(v,A,E){return Xt.FromArrayToRef(v,A,E)}static FromFloatsToRef(v,A,E,R){R.copyFromFloats(v,A,E)}static Zero(){return new Xt(0,0,0)}static One(){return new Xt(1,1,1)}static Up(){return new Xt(0,1,0)}static Down(){return new Xt(0,-1,0)}static Forward(){return new Xt(0,0,1)}static Backward(){return new Xt(0,0,-1)}static Right(){return new Xt(1,0,0)}static Left(){return new Xt(-1,0,0)}static TransformCoordinates(v,A){const E=Xt.Zero();return Xt.TransformCoordinatesToRef(v,A,E),E}static TransformCoordinatesToRef(v,A,E){return Xt.TransformCoordinatesFromFloatsToRef(v.x,v.y,v.z,A,E)}static TransformCoordinatesFromFloatsToRef(v,A,E,R,M){const O=R.m,V=v*O[0]+A*O[4]+E*O[8]+O[12],z=v*O[1]+A*O[5]+E*O[9]+O[13],W=v*O[2]+A*O[6]+E*O[10]+O[14],H=1/(v*O[3]+A*O[7]+E*O[11]+O[15]);M.x=V*H,M.y=z*H,M.z=W*H}static TransformNormal(v,A){const E=Xt.Zero();return Xt.TransformNormalToRef(v,A,E),E}static TransformNormalToRef(v,A,E){this.TransformNormalFromFloatsToRef(v.x,v.y,v.z,A,E)}static TransformNormalFromFloatsToRef(v,A,E,R,M){const O=R.m;M.x=v*O[0]+A*O[4]+E*O[8],M.y=v*O[1]+A*O[5]+E*O[9],M.z=v*O[2]+A*O[6]+E*O[10]}static CatmullRom(v,A,E,R,M){const O=M*M,V=M*O,z=.5*(2*A.x+(-v.x+E.x)*M+(2*v.x-5*A.x+4*E.x-R.x)*O+(-v.x+3*A.x-3*E.x+R.x)*V),W=.5*(2*A.y+(-v.y+E.y)*M+(2*v.y-5*A.y+4*E.y-R.y)*O+(-v.y+3*A.y-3*E.y+R.y)*V),H=.5*(2*A.z+(-v.z+E.z)*M+(2*v.z-5*A.z+4*E.z-R.z)*O+(-v.z+3*A.z-3*E.z+R.z)*V);return new Xt(z,W,H)}static Clamp(v,A,E){const R=new Xt;return Xt.ClampToRef(v,A,E,R),R}static ClampToRef(v,A,E,R){let M=v.x;M=M>E.x?E.x:M,M=M<A.x?A.x:M;let O=v.y;O=O>E.y?E.y:O,O=O<A.y?A.y:O;let V=v.z;V=V>E.z?E.z:V,V=V<A.z?A.z:V,R.copyFromFloats(M,O,V)}static Hermite(v,A,E,R,M){const O=M*M,V=M*O,z=2*V-3*O+1,W=-2*V+3*O,H=V-2*O+M,X=V-O,K=v.x*z+E.x*W+A.x*H+R.x*X,Z=v.y*z+E.y*W+A.y*H+R.y*X,J=v.z*z+E.z*W+A.z*H+R.z*X;return new Xt(K,Z,J)}static Lerp(v,A,E){const R=new Xt(0,0,0);return Xt.LerpToRef(v,A,E,R),R}static LerpToRef(v,A,E,R){R.x=v.x+(A.x-v.x)*E,R.y=v.y+(A.y-v.y)*E,R.z=v.z+(A.z-v.z)*E}static Dot(v,A){return v.x*A.x+v.y*A.y+v.z*A.z}static Cross(v,A){const E=Xt.Zero();return Xt.CrossToRef(v,A,E),E}static CrossToRef(v,A,E){const R=v.y*A.z-v.z*A.y,M=v.z*A.x-v.x*A.z,O=v.x*A.y-v.y*A.x;E.copyFromFloats(R,M,O)}static Normalize(v){const A=Xt.Zero();return Xt.NormalizeToRef(v,A),A}static NormalizeToRef(v,A){v.normalizeToRef(A)}static Minimize(v,A){const E=new Xt(v.x,v.y,v.z);return E.minimizeInPlace(A),E}static Maximize(v,A){const E=new Xt(v.x,v.y,v.z);return E.maximizeInPlace(A),E}static Distance(v,A){return Math.sqrt(Xt.DistanceSquared(v,A))}static DistanceSquared(v,A){const E=v.x-A.x,R=v.y-A.y,M=v.z-A.z;return E*E+R*R+M*M}static Center(v,A){const E=Xt.Add(v,A);return E.scaleInPlace(.5),E}static RotationFromAxis(v,A,E){const R=Xt.Zero();return Xt.RotationFromAxisToRef(v,A,E,R),R}static RotationFromAxisToRef(v,A,E,R){const M=ut.MathTmp.Quaternion[0];pt.Quaternion.RotationQuaternionFromAxisToRef(v,A,E,M),R.copyFrom(M.eulerAngles)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}getClassName(){return"Vector3"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v}asArray(){const v=[];return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,v[A+2]=this.z,this}toQuaternion(){return pt.Quaternion.Identity.setEuler(this.y,this.x,this.z)}addInPlace(v){return this.addInPlaceFromFloats(v.x,v.y,v.z)}addInPlaceFromFloats(v,A,E){return this.x+=v,this.y+=A,this.z+=E,this}add(v){return new Xt(this.x+v.x,this.y+v.y,this.z+v.z)}addToRef(v,A){return A.copyFromFloats(this.x+v.x,this.y+v.y,this.z+v.z)}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}subtract(v){return new Xt(this.x-v.x,this.y-v.y,this.z-v.z)}subtractToRef(v,A){return this.subtractFromFloatsToRef(v.x,v.y,v.z,A)}subtractFromFloats(v,A,E){return new Xt(this.x-v,this.y-A,this.z-E)}subtractFromFloatsToRef(v,A,E,R){return R.copyFromFloats(this.x-v,this.y-A,this.z-E)}applyMatrix4(v){this.applyMatrix4ToRef(v,this)}applyMatrix4ToRef(v,A){const{x:E,y:R,z:M}=this,{m:O}=v,V=1/(O[3]*E+O[7]*R+O[11]*M+O[15]);return A.x=(O[0]*E+O[4]*R+O[8]*M+O[12])*V,A.y=(O[1]*E+O[5]*R+O[9]*M+O[13])*V,A.z=(O[2]*E+O[6]*R+O[10]*M+O[14])*V,A}rotate(v){return this.rotateToRef(v,this)}rotateToRef(v,A){const{x:E,y:R,z:M}=this,{x:O,y:V,z:z,w:W}=v,H=W*E+V*M-z*R,X=W*R+z*E-O*M,K=W*M+O*R-V*E,Z=-O*E-V*R-z*M;return A.x=H*W+Z*-O+X*-z-K*-V,A.y=X*W+Z*-V+K*-O-H*-z,A.z=K*W+Z*-z+H*-V-X*-O,A}negate(){return new Xt(-this.x,-this.y,-this.z)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this}scale(v){return new Xt(this.x*v,this.y*v,this.z*v)}scaleToRef(v,A){return A.copyFromFloats(this.x*v,this.y*v,this.z*v)}scaleAndAddToRef(v,A){return A.addInPlaceFromFloats(this.x*v,this.y*v,this.z*v)}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z}equalsWithEpsilon(v,A=dt.Epsilon){return v&&ht.Scalar.WithinEpsilon(this.x,v.x,A)&&ht.Scalar.WithinEpsilon(this.y,v.y,A)&&ht.Scalar.WithinEpsilon(this.z,v.z,A)}equalsToFloats(v,A,E){return this.x===v&&this.y===A&&this.z===E}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this}multiply(v){return this.multiplyByFloats(v.x,v.y,v.z)}multiplyToRef(v,A){return A.copyFromFloats(this.x*v.x,this.y*v.y,this.z*v.z)}multiplyByFloats(v,A,E){return new Xt(this.x*v,this.y*A,this.z*E)}divide(v){return new Xt(this.x/v.x,this.y/v.y,this.z/v.z)}divideToRef(v,A){return A.copyFromFloats(this.x/v.x,this.y/v.y,this.z/v.z)}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v.x,v.y,v.z)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v.x,v.y,v.z)}minimizeInPlaceFromFloats(v,A,E){return v<this.x&&(this.x=v),A<this.y&&(this.y=A),E<this.z&&(this.z=E),this}maximizeInPlaceFromFloats(v,A,E){return v>this.x&&(this.x=v),A>this.y&&(this.y=A),E>this.z&&(this.z=E),this}floor(){return new Xt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return new Xt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){const v=new Xt(0,0,0);return this.normalizeToRef(v),v}normalizeToRef(v){const A=this.length();return 0===A||1===A?v.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/A,v)}clone(){return new Xt(this.x,this.y,this.z)}copyFrom(v){return this.copyFromFloats(v.x,v.y,v.z)}copyFromFloats(v,A,E){return this.x=v,this.y=A,this.z=E,this}set(v,A,E){return this.copyFromFloats(v,A,E)}setAll(v){return this.x=this.y=this.z=v,this}}qe.Vector3=Xt,Object.defineProperty(We,"__esModule",{value:!0}),We.MathTmp=void 0;const ft=Ge,gt=qe,yt=He,wt=Ye;We.MathTmp={Vector3:(0,ft.buildArray)(6,gt.Vector3.Zero),Matrix:(0,ft.buildArray)(2,wt.Matrix.Identity),Quaternion:(0,ft.buildArray)(3,yt.Quaternion.Zero),staticUp:gt.Vector3.Up(),tmpMatrix:wt.Matrix.Zero()};var vt={};Object.defineProperty(vt,"__esModule",{value:!0}),vt.Angle=void 0;class te{constructor(v){this._radians=v,this._radians<0&&(this._radians+=2*Math.PI)}static BetweenTwoPoints(v,A){const E=A.subtract(v),R=Math.atan2(E.y,E.x);return new te(R)}static FromRadians(v){return new te(v)}static FromDegrees(v){return new te(v*Math.PI/180)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}}vt.Angle=te;var bt={},Tt={};Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.Vector2=void 0;const xt=Ue,St=Xe;class re{constructor(v=0,A=0){this.x=v,this.y=A}static Zero(){return new re(0,0)}static One(){return new re(1,1)}static Add(v,A){return new re(v.x,v.y).addInPlace(A)}static FromArray(v,A=0){return new re(v[A],v[A+1])}static FromArrayToRef(v,A,E){E.x=v[A],E.y=v[A+1]}static CatmullRom(v,A,E,R,M){const O=M*M,V=M*O,z=.5*(2*A.x+(-v.x+E.x)*M+(2*v.x-5*A.x+4*E.x-R.x)*O+(-v.x+3*A.x-3*E.x+R.x)*V),W=.5*(2*A.y+(-v.y+E.y)*M+(2*v.y-5*A.y+4*E.y-R.y)*O+(-v.y+3*A.y-3*E.y+R.y)*V);return new re(z,W)}static Clamp(v,A,E){let R=v.x;R=R>E.x?E.x:R,R=R<A.x?A.x:R;let M=v.y;return M=M>E.y?E.y:M,M=M<A.y?A.y:M,new re(R,M)}static Hermite(v,A,E,R,M){const O=M*M,V=M*O,z=2*V-3*O+1,W=-2*V+3*O,H=V-2*O+M,X=V-O,K=v.x*z+E.x*W+A.x*H+R.x*X,Z=v.y*z+E.y*W+A.y*H+R.y*X;return new re(K,Z)}static Lerp(v,A,E){const R=v.x+(A.x-v.x)*E,M=v.y+(A.y-v.y)*E;return new re(R,M)}static Dot(v,A){return v.x*A.x+v.y*A.y}static Normalize(v){const A=new re(v.x,v.y);return A.normalize(),A}static Minimize(v,A){const E=v.x<A.x?v.x:A.x,R=v.y<A.y?v.y:A.y;return new re(E,R)}static Maximize(v,A){const E=v.x>A.x?v.x:A.x,R=v.y>A.y?v.y:A.y;return new re(E,R)}static Transform(v,A){const E=re.Zero();return re.TransformToRef(v,A,E),E}static TransformToRef(v,A,E){const R=A.m,M=v.x*R[0]+v.y*R[4]+R[12],O=v.x*R[1]+v.y*R[5]+R[13];E.x=M,E.y=O}static PointInTriangle(v,A,E,R){const M=.5*(-E.y*R.x+A.y*(-E.x+R.x)+A.x*(E.y-R.y)+E.x*R.y),O=M<0?-1:1,V=(A.y*R.x-A.x*R.y+(R.y-A.y)*v.x+(A.x-R.x)*v.y)*O,z=(A.x*E.y-A.y*E.x+(A.y-E.y)*v.x+(E.x-A.x)*v.y)*O;return V>0&&z>0&&V+z<2*M*O}static Distance(v,A){return Math.sqrt(re.DistanceSquared(v,A))}static DistanceSquared(v,A){const E=v.x-A.x,R=v.y-A.y;return E*E+R*R}static Center(v,A){const E=re.Add(v,A);return E.scaleInPlace(.5),E}static DistanceOfPointFromSegment(v,A,E){const R=re.DistanceSquared(A,E);if(0===R)return re.Distance(v,A);const M=E.subtract(A),O=Math.max(0,Math.min(1,re.Dot(v.subtract(A),M)/R)),V=A.add(M.multiplyByFloats(O,O));return re.Distance(v,V)}toString(){return"{X: "+this.x+" Y:"+this.y+"}"}getClassName(){return"Vector2"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,this}asArray(){const v=new Array;return this.toArray(v,0),v}copyFrom(v){return this.x=v.x,this.y=v.y,this}copyFromFloats(v,A){return this.x=v,this.y=A,this}set(v,A){return this.copyFromFloats(v,A)}add(v){return new re(this.x+v.x,this.y+v.y)}addToRef(v,A){return A.x=this.x+v.x,A.y=this.y+v.y,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this}addVector3(v){return new re(this.x+v.x,this.y+v.y)}subtract(v){return new re(this.x-v.x,this.y-v.y)}subtractToRef(v,A){return A.x=this.x-v.x,A.y=this.y-v.y,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this}multiply(v){return new re(this.x*v.x,this.y*v.y)}multiplyToRef(v,A){return A.x=this.x*v.x,A.y=this.y*v.y,this}multiplyByFloats(v,A){return new re(this.x*v,this.y*A)}divide(v){return new re(this.x/v.x,this.y/v.y)}divideToRef(v,A){return A.x=this.x/v.x,A.y=this.y/v.y,this}divideInPlace(v){return this.divideToRef(v,this)}negate(){return new re(-this.x,-this.y)}scaleInPlace(v){return this.x*=v,this.y*=v,this}scale(v){const A=new re(0,0);return this.scaleToRef(v,A),A}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y}equalsWithEpsilon(v,A=xt.Epsilon){return v&&St.Scalar.WithinEpsilon(this.x,v.x,A)&&St.Scalar.WithinEpsilon(this.y,v.y,A)}floor(){return new re(Math.floor(this.x),Math.floor(this.y))}fract(){return new re(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){const v=this.length();if(0===v)return this;const A=1/v;return this.x*=A,this.y*=A,this}clone(){return new re(this.x,this.y)}}Tt.Vector2=re,Object.defineProperty(bt,"__esModule",{value:!0}),bt.Arc2=void 0;const Ct=vt,At=Tt,_t=Ue;bt.Arc2=class{constructor(v,A,E){this.startPoint=v,this.midPoint=A,this.endPoint=E;const R=Math.pow(A.x,2)+Math.pow(A.y,2),M=(Math.pow(v.x,2)+Math.pow(v.y,2)-R)/2,O=(R-Math.pow(E.x,2)-Math.pow(E.y,2))/2,V=(v.x-A.x)*(A.y-E.y)-(A.x-E.x)*(v.y-A.y);this.centerPoint=new At.Vector2((M*(A.y-E.y)-O*(v.y-A.y))/V,((v.x-A.x)*O-(A.x-E.x)*M)/V),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Ct.Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);const z=this.startAngle.degrees();let W=Ct.Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),H=Ct.Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();W-z>180&&(W-=360),W-z<-180&&(W+=360),H-W>180&&(H-=360),H-W<-180&&(H+=360),this.orientation=W-z<0?_t.Orientation.CW:_t.Orientation.CCW,this.angle=Ct.Angle.FromDegrees(this.orientation===_t.Orientation.CW?z-H:H-z)}};var It={};Object.defineProperty(It,"__esModule",{value:!0}),It.Axis=void 0;const Pt=qe;class pe{}It.Axis=pe,pe.X=new Pt.Vector3(1,0,0),pe.Y=new Pt.Vector3(0,1,0),pe.Z=new Pt.Vector3(0,0,1);var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.BezierCurve=void 0,Bt.BezierCurve=class{static Interpolate(v,A,E,R,M){const O=1-3*R+3*A,V=3*R-6*A,z=3*A;let W=v;for(let A=0;A<5;A++){const A=W*W;W-=1/(3*O*A+2*V*W+z)*(O*(A*W)+V*A+z*W-v),W=Math.min(1,Math.max(0,W))}return 3*Math.pow(1-W,2)*W*E+3*(1-W)*Math.pow(W,2)*M+Math.pow(W,3)}};var kt={},Rt={};Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.Color4=void 0;const Ot=Xe,Lt=Ue;class ge{constructor(v=0,A=0,E=0,R=1){this.r=v,this.g=A,this.b=E,this.a=R}static FromHexString(v){if("#"!==v.substring(0,1)||9!==v.length)return new ge(0,0,0,0);const A=parseInt(v.substring(1,3),16),E=parseInt(v.substring(3,5),16),R=parseInt(v.substring(5,7),16),M=parseInt(v.substring(7,9),16);return ge.FromInts(A,E,R,M)}static Lerp(v,A,E){const R=new ge(0,0,0,0);return ge.LerpToRef(v,A,E,R),R}static LerpToRef(v,A,E,R){R.r=v.r+(A.r-v.r)*E,R.g=v.g+(A.g-v.g)*E,R.b=v.b+(A.b-v.b)*E,R.a=v.a+(A.a-v.a)*E}static Red(){return new ge(1,0,0,1)}static Green(){return new ge(0,1,0,1)}static Blue(){return new ge(0,0,1,1)}static Black(){return new ge(0,0,0,1)}static White(){return new ge(1,1,1,1)}static Purple(){return new ge(.5,0,.5,1)}static Magenta(){return new ge(1,0,1,1)}static Yellow(){return new ge(1,1,0,1)}static Gray(){return new ge(.5,.5,.5,1)}static Teal(){return new ge(0,1,1,1)}static Clear(){return new ge(0,0,0,0)}static FromColor3(v,A=1){return new ge(v.r,v.g,v.b,A)}static FromArray(v,A=0){return new ge(v[A],v[A+1],v[A+2],v[A+3])}static FromInts(v,A,E,R){return new ge(v/255,A/255,E/255,R/255)}static CheckColors4(v,A){if(v.length===3*A){const A=[];for(let E=0;E<v.length;E+=3){const R=E/3*4;A[R]=v[E],A[R+1]=v[E+1],A[R+2]=v[E+2],A[R+3]=1}return A}return v}addInPlace(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this.a+=v.a,this}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.r,v[A+1]=this.g,v[A+2]=this.b,v[A+3]=this.a,this}add(v){return new ge(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)}subtract(v){return new ge(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)}subtractToRef(v,A){return A.r=this.r-v.r,A.g=this.g-v.g,A.b=this.b-v.b,A.a=this.a-v.a,this}scale(v){return new ge(this.r*v,this.g*v,this.b*v,this.a*v)}scaleToRef(v,A){return A.r=this.r*v,A.g=this.g*v,A.b=this.b*v,A.a=this.a*v,this}scaleAndAddToRef(v,A){return A.r+=this.r*v,A.g+=this.g*v,A.b+=this.b*v,A.a+=this.a*v,this}clampToRef(v=0,A=1,E){return E.r=Ot.Scalar.Clamp(this.r,v,A),E.g=Ot.Scalar.Clamp(this.g,v,A),E.b=Ot.Scalar.Clamp(this.b,v,A),E.a=Ot.Scalar.Clamp(this.a,v,A),this}multiply(v){return new ge(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)}multiplyToRef(v,A){return A.r=this.r*v.r,A.g=this.g*v.g,A.b=this.b*v.b,A.a=this.a*v.a,A}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v=397*v^(this.a||0),v}clone(){return new ge(this.r,this.g,this.b,this.a)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this.a=v.a,this}copyFromFloats(v,A,E,R){return this.r=v,this.g=A,this.b=E,this.a=R,this}set(v,A,E,R){return this.copyFromFloats(v,A,E,R)}toHexString(){const v=255*this.r|0,A=255*this.g|0,E=255*this.b|0,R=255*this.a|0;return"#"+Ot.Scalar.ToHex(v)+Ot.Scalar.ToHex(A)+Ot.Scalar.ToHex(E)+Ot.Scalar.ToHex(R)}toLinearSpace(){const v=new ge;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Lt.ToLinearSpace),v.g=Math.pow(this.g,Lt.ToLinearSpace),v.b=Math.pow(this.b,Lt.ToLinearSpace),v.a=this.a,this}toGammaSpace(){const v=new ge;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Lt.ToGammaSpace),v.g=Math.pow(this.g,Lt.ToGammaSpace),v.b=Math.pow(this.b,Lt.ToGammaSpace),v.a=this.a,this}}Rt.Color4=ge,Object.defineProperty(kt,"__esModule",{value:!0}),kt.Color3=void 0;const Vt=Ue,Nt=Rt,Ft=Xe;class xe{constructor(v=0,A=0,E=0){this.r=v,this.g=A,this.b=E}static FromHexString(v){if("#"!==v.substring(0,1)||7!==v.length)return new xe(0,0,0);const A=parseInt(v.substring(1,3),16),E=parseInt(v.substring(3,5),16),R=parseInt(v.substring(5,7),16);return xe.FromInts(A,E,R)}static FromArray(v,A=0){return new xe(v[A],v[A+1],v[A+2])}static FromInts(v,A,E){return new xe(v/255,A/255,E/255)}static Lerp(v,A,E){const R=new xe(0,0,0);return xe.LerpToRef(v,A,E,R),R}static LerpToRef(v,A,E,R){R.r=v.r+(A.r-v.r)*E,R.g=v.g+(A.g-v.g)*E,R.b=v.b+(A.b-v.b)*E}static Red(){return new xe(1,0,0)}static Green(){return new xe(0,1,0)}static Blue(){return new xe(0,0,1)}static Black(){return new xe(0,0,0)}static White(){return new xe(1,1,1)}static Purple(){return new xe(.5,0,.5)}static Magenta(){return new xe(1,0,1)}static Yellow(){return new xe(1,1,0)}static Gray(){return new xe(.5,.5,.5)}static Teal(){return new xe(0,1,1)}static Random(){return new xe(Math.random(),Math.random(),Math.random())}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v}toArray(v,A=0){return v[A]=this.r,v[A+1]=this.g,v[A+2]=this.b,this}toColor4(v=1){return new Nt.Color4(this.r,this.g,this.b,v)}asArray(){const v=new Array;return this.toArray(v,0),v}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(v){return new xe(this.r*v.r,this.g*v.g,this.b*v.b)}multiplyToRef(v,A){return A.r=this.r*v.r,A.g=this.g*v.g,A.b=this.b*v.b,this}equals(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b}equalsFloats(v,A,E){return this.r===v&&this.g===A&&this.b===E}scale(v){return new xe(this.r*v,this.g*v,this.b*v)}scaleToRef(v,A){return A.r=this.r*v,A.g=this.g*v,A.b=this.b*v,this}scaleAndAddToRef(v,A){return A.r+=this.r*v,A.g+=this.g*v,A.b+=this.b*v,this}clampToRef(v=0,A=1,E){return E.r=Ft.Scalar.Clamp(this.r,v,A),E.g=Ft.Scalar.Clamp(this.g,v,A),E.b=Ft.Scalar.Clamp(this.b,v,A),this}add(v){return new xe(this.r+v.r,this.g+v.g,this.b+v.b)}addToRef(v,A){return A.r=this.r+v.r,A.g=this.g+v.g,A.b=this.b+v.b,this}subtract(v){return new xe(this.r-v.r,this.g-v.g,this.b-v.b)}subtractToRef(v,A){return A.r=this.r-v.r,A.g=this.g-v.g,A.b=this.b-v.b,this}clone(){return new xe(this.r,this.g,this.b)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this}copyFromFloats(v,A,E){return this.r=v,this.g=A,this.b=E,this}set(v,A,E){return this.copyFromFloats(v,A,E)}toHexString(){const v=255*this.r|0,A=255*this.g|0,E=255*this.b|0;return"#"+Ft.Scalar.ToHex(v)+Ft.Scalar.ToHex(A)+Ft.Scalar.ToHex(E)}toLinearSpace(){const v=new xe;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Vt.ToLinearSpace),v.g=Math.pow(this.g,Vt.ToLinearSpace),v.b=Math.pow(this.b,Vt.ToLinearSpace),this}toGammaSpace(){const v=new xe;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Vt.ToGammaSpace),v.g=Math.pow(this.g,Vt.ToGammaSpace),v.b=Math.pow(this.b,Vt.ToGammaSpace),this}toJSON(){return{r:this.r,g:this.g,b:this.b}}}kt.Color3=xe;var zt={};Object.defineProperty(zt,"__esModule",{value:!0}),zt.Curve3=void 0;const Ut=qe;class Ae{constructor(v){this._length=0,this._points=v,this._length=this._computeLength(v)}static CreateQuadraticBezier(v,A,E,R){R=R>2?R:3;const M=new Array,r=(v,A,E,R)=>(1-v)*(1-v)*A+2*v*(1-v)*E+v*v*R;for(let O=0;O<=R;O++)M.push(new Ut.Vector3(r(O/R,v.x,A.x,E.x),r(O/R,v.y,A.y,E.y),r(O/R,v.z,A.z,E.z)));return new Ae(M)}static CreateCubicBezier(v,A,E,R,M){M=M>3?M:4;const O=new Array,s=(v,A,E,R,M)=>(1-v)*(1-v)*(1-v)*A+3*v*(1-v)*(1-v)*E+3*v*v*(1-v)*R+v*v*v*M;for(let V=0;V<=M;V++)O.push(new Ut.Vector3(s(V/M,v.x,A.x,E.x,R.x),s(V/M,v.y,A.y,E.y,R.y),s(V/M,v.z,A.z,E.z,R.z)));return new Ae(O)}static CreateHermiteSpline(v,A,E,R,M){const O=new Array,V=1/M;for(let z=0;z<=M;z++)O.push(Ut.Vector3.Hermite(v,A,E,R,z*V));return new Ae(O)}static CreateCatmullRomSpline(v,A,E){const R=new Array,M=1/A;let O=0;if(E){const E=v.length;for(let V=0;V<E;V++){O=0;for(let z=0;z<A;z++)R.push(Ut.Vector3.CatmullRom(v[V%E],v[(V+1)%E],v[(V+2)%E],v[(V+3)%E],O)),O+=M}R.push(R[0])}else{const E=new Array;E.push(v[0].clone()),Array.prototype.push.apply(E,v),E.push(v[v.length-1].clone());let V=0;for(V=0;V<E.length-3;V++){O=0;for(let v=0;v<A;v++)R.push(Ut.Vector3.CatmullRom(E[V],E[V+1],E[V+2],E[V+3],O)),O+=M}V--,R.push(Ut.Vector3.CatmullRom(E[V],E[V+1],E[V+2],E[V+3],O))}return new Ae(R)}getPoints(){return this._points}length(){return this._length}continue(v){const A=this._points[this._points.length-1],E=this._points.slice(),R=v.getPoints();for(let v=1;v<R.length;v++)E.push(R[v].subtract(R[0]).add(A));return new Ae(E)}_computeLength(v){let A=0;for(let E=1;E<v.length;E++)A+=v[E].subtract(v[E-1]).length();return A}}zt.Curve3=Ae;var Wt={},Gt={};Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.Plane=void 0;const qt=qe,Ht=Ye,Yt=We;class ze{constructor(v,A,E,R){this.normal=new qt.Vector3(v,A,E),this.d=R}static FromArray(v){return new ze(v[0],v[1],v[2],v[3])}static FromPoints(v,A,E){const R=new ze(0,0,0,0);return R.copyFromPoints(v,A,E),R}static FromPositionAndNormal(v,A){const E=new ze(0,0,0,0);return A.normalize(),E.normal=A,E.d=-(A.x*v.x+A.y*v.y+A.z*v.z),E}static SignedDistanceToPlaneFromPositionAndNormal(v,A,E){const R=-(A.x*v.x+A.y*v.y+A.z*v.z);return qt.Vector3.Dot(E,A)+R}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new ze(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let v=this.normal.getHashCode();return v=397*v^(this.d||0),v}normalize(){const v=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let A=0;return 0!==v&&(A=1/v),this.normal.x*=A,this.normal.y*=A,this.normal.z*=A,this.d*=A,this}transform(v){const A=Yt.MathTmp.Matrix[0];Ht.Matrix.TransposeToRef(v,A);const E=A.m,R=this.normal.x,M=this.normal.y,O=this.normal.z,V=this.d,z=R*E[0]+M*E[1]+O*E[2]+V*E[3],W=R*E[4]+M*E[5]+O*E[6]+V*E[7],H=R*E[8]+M*E[9]+O*E[10]+V*E[11],X=R*E[12]+M*E[13]+O*E[14]+V*E[15];return new ze(z,W,H,X)}dotCoordinate(v){return this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z+this.d}copyFromPoints(v,A,E){const R=A.x-v.x,M=A.y-v.y,O=A.z-v.z,V=E.x-v.x,z=E.y-v.y,W=E.z-v.z,H=M*W-O*z,X=O*V-R*W,K=R*z-M*V,Z=Math.sqrt(H*H+X*X+K*K);let J;return J=0!==Z?1/Z:0,this.normal.x=H*J,this.normal.y=X*J,this.normal.z=K*J,this.d=-(this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z),this}isFrontFacingTo(v,A){return qt.Vector3.Dot(this.normal,v)<=A}signedDistanceTo(v){return qt.Vector3.Dot(v,this.normal)+this.d}}Gt.Plane=ze,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.Frustum=void 0;const Qt=Gt;class Me{static GetPlanes(v){const A=[];for(let v=0;v<6;v++)A.push(new Qt.Plane(0,0,0,0));return Me.GetPlanesToRef(v,A),A}static GetNearPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]+E[2],A.normal.y=E[7]+E[6],A.normal.z=E[11]+E[10],A.d=E[15]+E[14],A.normalize()}static GetFarPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]-E[2],A.normal.y=E[7]-E[6],A.normal.z=E[11]-E[10],A.d=E[15]-E[14],A.normalize()}static GetLeftPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]+E[0],A.normal.y=E[7]+E[4],A.normal.z=E[11]+E[8],A.d=E[15]+E[12],A.normalize()}static GetRightPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]-E[0],A.normal.y=E[7]-E[4],A.normal.z=E[11]-E[8],A.d=E[15]-E[12],A.normalize()}static GetTopPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]-E[1],A.normal.y=E[7]-E[5],A.normal.z=E[11]-E[9],A.d=E[15]-E[13],A.normalize()}static GetBottomPlaneToRef(v,A){const E=v.m;A.normal.x=E[3]+E[1],A.normal.y=E[7]+E[5],A.normal.z=E[11]+E[9],A.d=E[15]+E[13],A.normalize()}static GetPlanesToRef(v,A){Me.GetNearPlaneToRef(v,A[0]),Me.GetFarPlaneToRef(v,A[1]),Me.GetLeftPlaneToRef(v,A[2]),Me.GetRightPlaneToRef(v,A[3]),Me.GetTopPlaneToRef(v,A[4]),Me.GetBottomPlaneToRef(v,A[5])}}Wt.Frustum=Me;var Kt={};Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.Path2=void 0;const Zt=Tt,Jt=bt,$t=Ue;class De{constructor(v,A){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Zt.Vector2(v,A))}static StartingAt(v,A){return new De(v,A)}addLineTo(v,A){if(this.closed)return this;const E=new Zt.Vector2(v,A),R=this._points[this._points.length-1];return this._points.push(E),this._length+=E.subtract(R).length(),this}addArcTo(v,A,E,R,M=36){if(this.closed)return this;const O=this._points[this._points.length-1],V=new Zt.Vector2(v,A),z=new Zt.Vector2(E,R),W=new Jt.Arc2(O,V,z);let H=W.angle.radians()/M;W.orientation===$t.Orientation.CW&&(H*=-1);let X=W.startAngle.radians()+H;for(let v=0;v<M;v++){const v=Math.cos(X)*W.radius+W.centerPoint.x,A=Math.sin(X)*W.radius+W.centerPoint.y;this.addLineTo(v,A),X+=H}return this}close(){return this.closed=!0,this}length(){let v=this._length;if(!this.closed){const A=this._points[this._points.length-1];v+=this._points[0].subtract(A).length()}return v}getPoints(){return this._points}getPointAtLengthPosition(v){if(v<0||v>1)return Zt.Vector2.Zero();const A=v*this.length();let E=0;for(let v=0;v<this._points.length;v++){const R=(v+1)%this._points.length,M=this._points[v],O=this._points[R].subtract(M),V=O.length()+E;if(A>=E&&A<=V){const v=O.normalize(),R=A-E;return new Zt.Vector2(M.x+v.x*R,M.y+v.y*R)}E=V}return Zt.Vector2.Zero()}}Kt.Path2=De;var tn={};Object.defineProperty(tn,"__esModule",{value:!0}),tn.Path3D=void 0;const nn=qe,on=Ue,rn=Xe;tn.Path3D=class{constructor(v,A=null,E){this.path=v,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(let A=0;A<v.length;A++)this._curve[A]=v[A].clone();this._raw=E||!1,this._compute(A)}getCurve(){return this._curve}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}update(v,A=null){for(let A=0;A<v.length;A++)this._curve[A].x=v[A].x,this._curve[A].y=v[A].y,this._curve[A].z=v[A].z;return this._compute(A),this}_compute(v){const A=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[A-1]=this._curve[A-1].subtract(this._curve[A-2]),this._raw||this._tangents[A-1].normalize();const E=this._tangents[0],R=this._normalVector(this._curve[0],E,v);let M,O,V,z;this._normals[0]=R,this._raw||this._normals[0].normalize(),this._binormals[0]=nn.Vector3.Cross(E,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let v=1;v<A;v++)M=this._getLastNonNullVector(v),v<A-1&&(O=this._getFirstNonNullVector(v),this._tangents[v]=M.add(O),this._tangents[v].normalize()),this._distances[v]=this._distances[v-1]+M.length(),V=this._tangents[v],z=this._binormals[v-1],this._normals[v]=nn.Vector3.Cross(z,V),this._raw||this._normals[v].normalize(),this._binormals[v]=nn.Vector3.Cross(V,this._normals[v]),this._raw||this._binormals[v].normalize()}_getFirstNonNullVector(v){let A=1,E=this._curve[v+A].subtract(this._curve[v]);for(;0===E.length()&&v+A+1<this._curve.length;)A++,E=this._curve[v+A].subtract(this._curve[v]);return E}_getLastNonNullVector(v){let A=1,E=this._curve[v].subtract(this._curve[v-A]);for(;0===E.length()&&v>A+1;)A++,E=this._curve[v].subtract(this._curve[v-A]);return E}_normalVector(v,A,E){let R,M=A.length();if(0===M&&(M=1),null==E){let v;v=rn.Scalar.WithinEpsilon(Math.abs(A.y)/M,1,on.Epsilon)?rn.Scalar.WithinEpsilon(Math.abs(A.x)/M,1,on.Epsilon)?rn.Scalar.WithinEpsilon(Math.abs(A.z)/M,1,on.Epsilon)?nn.Vector3.Zero():new nn.Vector3(0,0,1):new nn.Vector3(1,0,0):new nn.Vector3(0,-1,0),R=nn.Vector3.Cross(A,v)}else R=nn.Vector3.Cross(A,E),nn.Vector3.CrossToRef(R,A,R);return R.normalize(),R}};var an={};Object.defineProperty(an,"__esModule",{value:!0}),an.Size=void 0;class je{constructor(v,A){this.width=v,this.height=A}get surface(){return this.width*this.height}static Zero(){return new je(0,0)}static Lerp(v,A,E){const R=v.width+(A.width-v.width)*E,M=v.height+(A.height-v.height)*E;return new je(R,M)}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let v=this.width||0;return v=397*v^(this.height||0),v}copyFrom(v){this.width=v.width,this.height=v.height}copyFromFloats(v,A){return this.width=v,this.height=A,this}set(v,A){return this.copyFromFloats(v,A)}multiplyByFloats(v,A){return new je(this.width*v,this.height*A)}clone(){return new je(this.width,this.height)}equals(v){return!!v&&this.width===v.width&&this.height===v.height}add(v){return new je(this.width+v.width,this.height+v.height)}subtract(v){return new je(this.width-v.width,this.height-v.height)}}an.Size=je,function(v){var A=Ne&&Ne.__createBinding||(Object.create?function(v,A,E,R){void 0===R&&(R=E),Object.defineProperty(v,R,{enumerable:!0,get:function(){return A[E]}})}:function(v,A,E,R){void 0===R&&(R=E),v[R]=A[E]}),E=Ne&&Ne.__exportStar||function(v,E){for(var R in v)"default"===R||Object.prototype.hasOwnProperty.call(E,R)||A(E,v,R)};Object.defineProperty(v,"__esModule",{value:!0}),E(Ue,v),E(We,v),E(vt,v),E(bt,v),E(It,v),E(Bt,v),E(kt,v),E(Rt,v),E(zt,v),E(Wt,v),E(Ye,v),E(Kt,v),E(tn,v),E(Gt,v),E(He,v),E(Xe,v),E(an,v),E(Tt,v),E(qe,v),E(Qe,v),E(Fe,v)}(Fe);var sn,ln,cn,un,dn={looping:!0,speed:1,weight:1,layer:0},pn=function(v){function e(A,E){void 0===E&&(E=dn);var R=v.call(this)||this;return R.isAnimationClip=!0,R.looping=dn.looping,R.weight=dn.weight,R.playing=!1,R.shouldReset=!1,R.speed=dn.speed,R.name=f("AnimClip"),R.layer=dn.layer,R.clip=A,R.setParams(o({},E)),R}return i(e,v),e.prototype.setParams=function(v){return this.looping=void 0!==v.looping?v.looping:this.looping,this.speed=v.speed||this.speed,this.weight=v.weight||this.weight,this.layer=v.layer||this.layer,this},e.prototype.toJSON=function(){var A=JSON.parse(JSON.stringify(v.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),A},e.prototype.play=function(v){var A;void 0===v&&(v=!1),null===(A=this.owner)||void 0===A||A.play(this,v)},e.prototype.pause=function(){var v;null===(v=this.owner)||void 0===v||v.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var v;null===(v=this.owner)||void 0===v||v.stop(this)},r([ne.readonly,s("design:type",String)],e.prototype,"clip",void 0),r([ne.field,s("design:type",Boolean)],e.prototype,"looping",void 0),r([ne.field,s("design:type",Number)],e.prototype,"weight",void 0),r([ne.field,s("design:type",Boolean)],e.prototype,"playing",void 0),r([ne.field,s("design:type",Boolean)],e.prototype,"shouldReset",void 0),r([ne.field,s("design:type",Number)],e.prototype,"speed",void 0),r([ne.readonly,s("design:type",String)],e.prototype,"name",void 0),e}(ne);v.InputEventType=void 0,(sn=v.InputEventType||(v.InputEventType={}))[sn.DOWN=0]="DOWN",sn[sn.UP=1]="UP",v.CameraMode=void 0,(ln=v.CameraMode||(v.CameraMode={}))[ln.FirstPerson=0]="FirstPerson",ln[ln.ThirdPerson=1]="ThirdPerson",ln[ln.BuildingToolGodMode=2]="BuildingToolGodMode",v.LandRole=void 0,(cn=v.LandRole||(v.LandRole={})).OWNER="owner",cn.OPERATOR="operator",v.ActionButton=void 0,(un=v.ActionButton||(v.ActionButton={})).POINTER="POINTER",un.PRIMARY="PRIMARY",un.SECONDARY="SECONDARY",un.ANY="ANY",un.FORWARD="FORWARD",un.BACKWARD="BACKWARD",un.RIGHT="RIGHT",un.LEFT="LEFT",un.JUMP="JUMP",un.WALK="WALK",un.ACTION_3="ACTION_3",un.ACTION_4="ACTION_4",un.ACTION_5="ACTION_5",un.ACTION_6="ACTION_6";var hn,mn,Ke=function(v){if(this.callback=v,!v||!("apply"in v)||!("call"in v))throw new Error("Callback is not a function");yn.ensureInstance()},fn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerDown")],e)}(Ke),gn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerUp")],e)}(Ke),en=function(v,A){this.fn=v,this.useRaycast=A},yn=function(){function e(){this.buttonIdMapping=[v.ActionButton.POINTER,v.ActionButton.PRIMARY,v.ActionButton.SECONDARY,v.ActionButton.ANY,v.ActionButton.FORWARD,v.ActionButton.BACKWARD,v.ActionButton.RIGHT,v.ActionButton.LEFT,v.ActionButton.JUMP,v.ActionButton.WALK,v.ActionButton.ACTION_3,v.ActionButton.ACTION_4,v.ActionButton.ACTION_5,v.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(v,A){var E;return o(o({},v),((E={})[A]={BUTTON_DOWN:[],BUTTON_UP:[]},E))}),{}),this.internalState=this.buttonIdMapping.reduce((function(v,A){var E;return o(o({},v),((E={})[A]={BUTTON_DOWN:!1},E))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(v){return this.internalState[v]},e.prototype.subscribe=function(v,A,E,R){var M=this;return this.subscriptions[A][v].push(new en(R,E)),function(){M.unsubscribe(v,A,R)}},e.prototype.unsubscribe=function(v,A,E){var R=this.getSubscriptionId(v,A,E);return R>-1&&this.subscriptions[A][v].splice(R,1)},e.prototype.handlePointerEvent=function(A){var E=this.getPointerById(A.buttonId);if(E){var R=o(o({},A),{button:E,direction:(new Fe.Vector3).copyFrom(A.direction),origin:(new Fe.Vector3).copyFrom(A.origin),hit:void 0}),M=A.hit?o(o({},A.hit),{hitPoint:(new Fe.Vector3).copyFrom(A.hit.hitPoint),normal:(new Fe.Vector3).copyFrom(A.hit.normal),worldNormal:(new Fe.Vector3).copyFrom(A.hit.worldNormal)}):void 0;if(A.type===v.InputEventType.DOWN){this.internalState[E].BUTTON_DOWN=!0;for(var O=0;O<this.subscriptions[E].BUTTON_DOWN.length;O++)(V=this.subscriptions[E].BUTTON_DOWN[O]).useRaycast?R.hit=M:R.hit=void 0,V.fn(R);M&&M.entityId&&N.engine&&(W=(z=N.engine.entities[M.entityId])&&z.getComponentOrNull(fn))&&(R.hit=M,W.callback(R))}else{for(this.internalState[E].BUTTON_DOWN=!1,O=0;O<this.subscriptions[E].BUTTON_UP.length;O++){var V;(V=this.subscriptions[E].BUTTON_UP[O]).useRaycast?R.hit=M:R.hit=void 0,V.fn(R)}var z,W;M&&M.entityId&&N.engine&&(W=(z=N.engine.entities[M.entityId])&&z.getComponentOrNull(gn))&&(R.hit=M,W.callback(R))}}},e.prototype.getSubscriptionId=function(v,A,E){for(var R=0;R<this.subscriptions[A][v].length;R++)if(this.subscriptions[A][v][R].fn===E)return R;return-1},e.prototype.getPointerById=function(A){if(A<0||A>=this.buttonIdMapping.length)return null;var E=this.buttonIdMapping[A];return E===v.ActionButton.ANY?null:E},e}();v.CLASS_ID=void 0,(hn=v.CLASS_ID||(v.CLASS_ID={}))[hn.TRANSFORM=1]="TRANSFORM",hn[hn.UUID_CALLBACK=8]="UUID_CALLBACK",hn[hn.BOX_SHAPE=16]="BOX_SHAPE",hn[hn.SPHERE_SHAPE=17]="SPHERE_SHAPE",hn[hn.PLANE_SHAPE=18]="PLANE_SHAPE",hn[hn.CONE_SHAPE=19]="CONE_SHAPE",hn[hn.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",hn[hn.TEXT_SHAPE=21]="TEXT_SHAPE",hn[hn.NFT_SHAPE=22]="NFT_SHAPE",hn[hn.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",hn[hn.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",hn[hn.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",hn[hn.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",hn[hn.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",hn[hn.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",hn[hn.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",hn[hn.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",hn[hn.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",hn[hn.BILLBOARD=32]="BILLBOARD",hn[hn.ANIMATION=33]="ANIMATION",hn[hn.FONT=34]="FONT",hn[hn.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",hn[hn.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",hn[hn.GLTF_SHAPE=54]="GLTF_SHAPE",hn[hn.OBJ_SHAPE=55]="OBJ_SHAPE",hn[hn.AVATAR_SHAPE=56]="AVATAR_SHAPE",hn[hn.BASIC_MATERIAL=64]="BASIC_MATERIAL",hn[hn.PBR_MATERIAL=65]="PBR_MATERIAL",hn[hn.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",hn[hn.SOUND=67]="SOUND",hn[hn.TEXTURE=68]="TEXTURE",hn[hn.VIDEO_CLIP=70]="VIDEO_CLIP",hn[hn.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",hn[hn.AVATAR_TEXTURE=72]="AVATAR_TEXTURE",hn[hn.AUDIO_CLIP=200]="AUDIO_CLIP",hn[hn.AUDIO_SOURCE=201]="AUDIO_SOURCE",hn[hn.AUDIO_STREAM=202]="AUDIO_STREAM",hn[hn.GIZMOS=203]="GIZMOS",hn[hn.SMART_ITEM=204]="SMART_ITEM",hn[hn.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",hn[hn.AVATAR_ATTACH=206]="AVATAR_ATTACH",hn[hn.CAMERA_MODE_AREA=207]="CAMERA_MODE_AREA",hn[hn.NAME=300]="NAME",hn[hn.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",hn[hn.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",v.AvatarModifiers=void 0,(mn=v.AvatarModifiers||(v.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",mn.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var wn,vn=function(A){function n(v){var E=A.call(this)||this;return E.area=v.area,E.modifiers=v.modifiers,E.excludeIds=v.excludeIds,E}return i(n,A),r([ne.field,s("design:type",Object)],n.prototype,"area",void 0),r([ne.field,s("design:type",Array)],n.prototype,"modifiers",void 0),r([ne.field,s("design:type",Array)],n.prototype,"excludeIds",void 0),r([P("engine.avatarModifierArea",v.CLASS_ID.AVATAR_MODIFIER_AREA),s("design:paramtypes",[Object])],n)}(ne),bn=function(A){function n(v){void 0===v&&(v={});var E=A.call(this)||this;return E.position=v.position||Fe.Vector3.Zero(),E.rotation=v.rotation||Fe.Quaternion.Identity,E.scale=v.scale||new Fe.Vector3(1,1,1),E}return i(n,A),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(v,A){void 0===A&&(A=Fe.MathTmp.staticUp);var E=new Fe.Matrix;return Fe.Matrix.LookAtLHToRef(this.position,v,A,E),E.invert(),Fe.Quaternion.FromRotationMatrixToRef(E,this.rotation),this},n.prototype.rotate=function(v,A){return this.rotation.multiplyInPlace(this.rotation.angleAxis(A,v)),this},n.prototype.translate=function(v){return this.position.addInPlace(v),this},r([ne.field,s("design:type",Fe.Vector3)],n.prototype,"position",void 0),r([ne.field,s("design:type",Fe.Quaternion)],n.prototype,"rotation",void 0),r([ne.field,s("design:type",Fe.Vector3)],n.prototype,"scale",void 0),r([P("engine.transform",v.CLASS_ID.TRANSFORM),s("design:paramtypes",[Object])],n)}(ne);v.AttachToAvatarAnchorPointId=void 0,(wn=v.AttachToAvatarAnchorPointId||(v.AttachToAvatarAnchorPointId={}))[wn.Position=0]="Position",wn[wn.NameTag=1]="NameTag",wn[wn.LeftHand=2]="LeftHand",wn[wn.RightHand=3]="RightHand";var Tn,xn=function(A){function n(E){void 0===E&&(E={});var R=A.call(this)||this;return R.avatarId=E.avatarId||"",R.anchorPointId=E.anchorPointId||v.AttachToAvatarAnchorPointId.Position,R}return i(n,A),r([ne.field,s("design:type",String)],n.prototype,"avatarId",void 0),r([ne.field,s("design:type",Number)],n.prototype,"anchorPointId",void 0),r([ne.field,s("design:type",String)],n.prototype,"avatarSceneId",void 0),r([P("engine.transform",v.CLASS_ID.AVATAR_ATTACH),s("design:paramtypes",[Object])],n)}(ne),Sn=function(A){function n(v,E,R){void 0===v&&(v=!0),void 0===E&&(E=!0),void 0===R&&(R=!0);var M=A.call(this)||this;return M.x=!0,M.y=!0,M.z=!0,M.x=v,M.y=E,M.z=R,M}return i(n,A),r([ne.field,s("design:type",Boolean)],n.prototype,"x",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"y",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"z",void 0),r([P("engine.billboard",v.CLASS_ID.BILLBOARD),s("design:paramtypes",[Boolean,Boolean,Boolean])],n)}(ne),Cn=function(v){function e(){var A=null!==v&&v.apply(this,arguments)||this;return A.withCollisions=!0,A.isPointerBlocker=!0,A.visible=!0,A}return i(e,v),r([ne.field,s("design:type",Boolean)],e.prototype,"withCollisions",void 0),r([ne.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),r([ne.field,s("design:type",Boolean)],e.prototype,"visible",void 0),e}(ne),An=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([ne.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.BOX_SHAPE)],n)}(Cn),En=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.SPHERE_SHAPE)],n)}(Cn),_n=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"segments",void 0),r([ne.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CIRCLE_SHAPE)],n)}(Cn),In=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.width=1,v.height=1,v}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"width",void 0),r([ne.field,s("design:type",Number)],n.prototype,"height",void 0),r([ne.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.PLANE_SHAPE)],n)}(Cn),Pn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.radiusTop=0,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([ne.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([ne.field,s("design:type",Object)],n.prototype,"radius",void 0),r([ne.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CONE_SHAPE)],n)}(Cn),Bn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.radiusTop=1,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([ne.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([ne.field,s("design:type",Object)],n.prototype,"radius",void 0),r([ne.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CYLINDER_SHAPE)],n)}(Cn),kn=function(A){function n(v){var E=A.call(this)||this;return E.src=v,E}return i(n,A),r([Cn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.GLTF_SHAPE),s("design:paramtypes",[String])],n)}(Cn);v.PictureFrameStyle=void 0,(Tn=v.PictureFrameStyle||(v.PictureFrameStyle={}))[Tn.Classic=0]="Classic",Tn[Tn.Baroque_Ornament=1]="Baroque_Ornament",Tn[Tn.Diamond_Ornament=2]="Diamond_Ornament",Tn[Tn.Minimal_Wide=3]="Minimal_Wide",Tn[Tn.Minimal_Grey=4]="Minimal_Grey",Tn[Tn.Blocky=5]="Blocky",Tn[Tn.Gold_Edges=6]="Gold_Edges",Tn[Tn.Gold_Carved=7]="Gold_Carved",Tn[Tn.Gold_Wide=8]="Gold_Wide",Tn[Tn.Gold_Rounded=9]="Gold_Rounded",Tn[Tn.Metal_Medium=10]="Metal_Medium",Tn[Tn.Metal_Wide=11]="Metal_Wide",Tn[Tn.Metal_Slim=12]="Metal_Slim",Tn[Tn.Metal_Rounded=13]="Metal_Rounded",Tn[Tn.Pins=14]="Pins",Tn[Tn.Minimal_Black=15]="Minimal_Black",Tn[Tn.Minimal_White=16]="Minimal_White",Tn[Tn.Tape=17]="Tape",Tn[Tn.Wood_Slim=18]="Wood_Slim",Tn[Tn.Wood_Wide=19]="Wood_Wide",Tn[Tn.Wood_Twigs=20]="Wood_Twigs",Tn[Tn.Canvas=21]="Canvas",Tn[Tn.None=22]="None";var Rn,Mn=function(A){function n(E,R){void 0===R&&(R={});var M=A.call(this)||this;M.src=E;var O=new Fe.Color3(.6404918,.611472,.8584906),V=v.PictureFrameStyle.Classic;return"r"in R?O=R:null!==R&&(R.color&&(O=R.color),R.style&&(V=R.style)),M.color=O,M.style=V,M}return i(n,A),r([Cn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([Cn.readonly,s("design:type",Number)],n.prototype,"style",void 0),r([ne.field,s("design:type",Fe.Color3)],n.prototype,"color",void 0),r([N("engine.shape",v.CLASS_ID.NFT_SHAPE),s("design:paramtypes",[String,Object])],n)}(Cn),On=function(A){function n(v,E){var R=A.call(this)||this,M=new RegExp("data:[a-z-]+/[a-z-]+;base64");if((v.length>2048||M.test(v))&&c("⚠️🚨 Base64 textures will be deprecated in version 7 of decentraland-ecs"),R.src=v,E)for(var O in E)R[O]=E[O];return R}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"src",void 0),r([ne.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([ne.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([ne.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.TEXTURE),s("design:paramtypes",[String,Object])],n)}(ne),Ln=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.states=[],v}return i(n,A),n.prototype.addClip=function(v){var A=this;return this.states.push(v),v.onChange((function(){A.dirty=!0})),v.owner=this,this},n.prototype.getClip=function(v){for(var A=0;A<this.states.length;A++){var E=this.states[A];if(E.clip===v)return E}var R=new pn(v);return this.addClip(R),R},n.prototype.stop=function(v){if(v)v.playing=!1,v.shouldReset=!0;else for(var A=0;A<this.states.length;A++){var E=this.states[A];this.stop(E)}},n.prototype.play=function(v,A){void 0===A&&(A=!1);for(var E=0;E<this.states.length;E++){var R=this.states[E];R.layer===v.layer&&v!==R&&this.pause(R)}A&&(v.shouldReset=!0),v.playing=!0,v.dirty=!0,v.data.nonce=Math.random()},n.prototype.pause=function(v){if(v)v.playing=!1;else for(var A=0;A<this.states.length;A++){var E=this.states[A];this.pause(E)}},r([ne.readonly,s("design:type",Array)],n.prototype,"states",void 0),r([P("engine.animator",v.CLASS_ID.ANIMATION)],n)}(Cn),Dn=function(A){function n(v){var E=A.call(this)||this;return E.src=v,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.OBJ_SHAPE),s("design:paramtypes",[String])],n)}(Cn),Vn=function(A){function n(v){void 0===v&&(v="");var E=A.call(this)||this;return E.src=v,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.font",v.CLASS_ID.FONT),s("design:paramtypes",[String])],n)}(ne);v.Fonts=void 0,(Rn=v.Fonts||(v.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",Rn.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",Rn.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",Rn.LiberationSans="builtin:LiberationSans SDF",Rn.SansSerif="SansSerif",Rn.SansSerif_Heavy="SansSerif_Heavy",Rn.SansSerif_Bold="SansSerif_Bold",Rn.SansSerif_SemiBold="SansSerif_SemiBold";var Nn,Fn=function(A){function n(v){var E=A.call(this)||this;return E.outlineWidth=0,E.outlineColor=new Fe.Color3(1,1,1),E.color=new Fe.Color3(1,1,1),E.fontSize=10,E.opacity=1,E.value="",E.lineSpacing="0px",E.lineCount=0,E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=new Fe.Color3(1,1,1),E.hTextAlign="center",E.vTextAlign="center",E.width=1,E.height=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.billboard=!1,E.visible=!0,v&&(E.value=v),E}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([ne.field,s("design:type",Fe.Color3)],n.prototype,"outlineColor",void 0),r([ne.field,s("design:type",Fe.Color3)],n.prototype,"color",void 0),r([ne.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([ne.component,s("design:type",Vn)],n.prototype,"font",void 0),r([ne.field,s("design:type",Number)],n.prototype,"opacity",void 0),r([ne.field,s("design:type",String)],n.prototype,"value",void 0),r([ne.field,s("design:type",String)],n.prototype,"lineSpacing",void 0),r([ne.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([ne.field,s("design:type",Fe.Color3)],n.prototype,"shadowColor",void 0),r([ne.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([ne.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([ne.field,s("design:type",Number)],n.prototype,"width",void 0),r([ne.field,s("design:type",Number)],n.prototype,"height",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"billboard",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"visible",void 0),r([P("engine.text",v.CLASS_ID.TEXT_SHAPE),s("design:paramtypes",[String])],n)}(ne);v.TransparencyMode=void 0,(Nn=v.TransparencyMode||(v.TransparencyMode={}))[Nn.OPAQUE=0]="OPAQUE",Nn[Nn.ALPHA_TEST=1]="ALPHA_TEST",Nn[Nn.ALPHA_BLEND=2]="ALPHA_BLEND",Nn[Nn.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Nn[Nn.AUTO=4]="AUTO";var zn,Un=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.alphaTest=.5,E.castShadows=!0,E.transparencyMode=v.TransparencyMode.AUTO,E}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([ne.field,s("design:type",Object)],n.prototype,"albedoColor",void 0),r([ne.field,s("design:type",Fe.Color3)],n.prototype,"emissiveColor",void 0),r([ne.field,s("design:type",Number)],n.prototype,"metallic",void 0),r([ne.field,s("design:type",Number)],n.prototype,"roughness",void 0),r([ne.field,s("design:type",Fe.Color3)],n.prototype,"reflectivityColor",void 0),r([ne.field,s("design:type",Number)],n.prototype,"directIntensity",void 0),r([ne.field,s("design:type",Number)],n.prototype,"microSurface",void 0),r([ne.field,s("design:type",Number)],n.prototype,"emissiveIntensity",void 0),r([ne.field,s("design:type",Number)],n.prototype,"specularIntensity",void 0),r([ne.component,s("design:type",Object)],n.prototype,"albedoTexture",void 0),r([ne.component,s("design:type",Object)],n.prototype,"alphaTexture",void 0),r([ne.component,s("design:type",Object)],n.prototype,"emissiveTexture",void 0),r([ne.component,s("design:type",Object)],n.prototype,"bumpTexture",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([ne.field,s("design:type",Number)],n.prototype,"transparencyMode",void 0),r([N("engine.material",v.CLASS_ID.PBR_MATERIAL)],n)}(ne),Wn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.alphaTest=.5,v.castShadows=!0,v}return i(n,A),r([ne.component,s("design:type",Object)],n.prototype,"texture",void 0),r([ne.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([N("engine.material",v.CLASS_ID.BASIC_MATERIAL)],n)}(ne),Gn=function(v){function e(A){var E=v.call(this)||this;if(E.uuid=f("UUID"),!A||!("apply"in A)||!("call"in A))throw new Error("Callback is not a function");return E.callback=A,E}return i(e,v),e.uuidEvent=function(v,A){if(delete v[A]){var E=A+"_"+Math.random();v[E]=void 0,Object.defineProperty(v,E,o(o({},Object.getOwnPropertyDescriptor(v,E)),{enumerable:!1})),Object.defineProperty(v,A.toString(),{get:function(){return this[E]},set:function(v){var R=this[E];if(v){if(!(v instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[A]=v.uuid}else this.data[A]=null;if(this[E]=v,v!==R){this.dirty=!0;for(var M=0;M<this.subscriptions.length;M++)this.subscriptions[M](A,v,R)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([ne.field,s("design:type",Function)],e.prototype,"callback",void 0),e}(ne),qn=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.button=v.ActionButton.ANY,E.hoverText="Interact",E.distance=10,E.showFeedback=!0,E}return i(n,A),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([ne.field,s("design:type",String)],n.prototype,"button",void 0),r([ne.field,s("design:type",String)],n.prototype,"hoverText",void 0),r([ne.field,s("design:type",Number)],n.prototype,"distance",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"showFeedback",void 0),n}(Gn),Hn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="onPointerLock",v}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onPointerLock",v.CLASS_ID.UUID_CALLBACK)],n)}(Gn),jn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="onAnimationEnd",v}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onAnimationEnd",v.CLASS_ID.UUID_CALLBACK)],n)}(Gn),Yn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([P("engine.smartItem",v.CLASS_ID.SMART_ITEM)],n)}(ne),Qn=function(A){function n(v){var E=A.call(this)||this;return E.url=v,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"url",void 0),r([N("engine.VideoClip",v.CLASS_ID.VIDEO_CLIP),s("design:paramtypes",[String])],n)}(ne);v.VideoStatus=void 0,(zn=v.VideoStatus||(v.VideoStatus={}))[zn.NONE=0]="NONE",zn[zn.ERROR=1]="ERROR",zn[zn.LOADING=2]="LOADING",zn[zn.READY=3]="READY",zn[zn.PLAYING=4]="PLAYING",zn[zn.BUFFERING=5]="BUFFERING";var Xn,Kn=function(A){function n(E,R){var M=A.call(this)||this;if(M.volume=1,M.playbackRate=1,M.loop=!1,M.seek=-1,M._position=-1,M._videoLength=-1,M._status=v.VideoStatus.NONE,M.playing=!1,!(E instanceof Qn))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(M.videoClipId=D(E),R)for(var O in R)M[O]=R[O];return M}return i(n,A),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(v){this.seek=v,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var v=JSON.parse(JSON.stringify(A.prototype.toJSON.call(this)));return this.seek=-1,v}return A.prototype.toJSON.call(this)},n.prototype.update=function(A){A.videoClipId===this.videoClipId&&(this._status=A.videoStatus||v.VideoStatus.NONE,this._videoLength=A.totalVideoLength,this._position=A.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([ne.readonly,s("design:type",String)],n.prototype,"videoClipId",void 0),r([ne.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([ne.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([ne.field,s("design:type",Number)],n.prototype,"volume",void 0),r([ne.field,s("design:type",Number)],n.prototype,"playbackRate",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"seek",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([N("engine.VideoTexture",v.CLASS_ID.VIDEO_TEXTURE),s("design:paramtypes",[Qn,Object])],n)}(ne),Zn=function(A){function n(v){var E=A.call(this)||this;return E.area=v.area,E.cameraMode=v.cameraMode,E}return i(n,A),r([ne.field,s("design:type",Object)],n.prototype,"area",void 0),r([ne.field,s("design:type",Number)],n.prototype,"cameraMode",void 0),r([P("engine.cameraModeArea",v.CLASS_ID.CAMERA_MODE_AREA),s("design:paramtypes",[Object])],n)}(ne),Jn=function(A){function n(v,E){var R=A.call(this)||this;if(R.userId=v,E)for(var M in E)R[M]=E[M];return R}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"userId",void 0),r([ne.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([ne.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([ne.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.AVATAR_TEXTURE),s("design:paramtypes",[String,Object])],n)}(ne),$n=function(){function e(){var A=this;this.position=new Fe.Vector3,this.rotation=new Fe.Quaternion,this.feetPosition=new Fe.Vector3,this.worldPosition=new Fe.Vector3,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=v.CameraMode.ThirdPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(v){switch(v.type){case"positionChanged":A.positionChanged(v.data);break;case"rotationChanged":A.rotationChanged(v.data);break;case"cameraModeChanged":A.cameraModeChanged(v.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return A.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return A.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return A.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return A.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return A.lastEventPosition.y-A.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return A.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return A.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return A.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return A.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(v){this.lastEventPosition=v.position,this.lastEventWorldPosition=v.cameraPosition,this._playerHeight=v.playerHeight},e.prototype.rotationChanged=function(v){this.lastEventRotation=v.quaternion},e.prototype.cameraModeChanged=function(v){this._cameraMode=v.cameraMode},e}();!function(v){v.HitFirst="rqhf",v.HitAll="rqha"}(Xn||(Xn={}));var eo,to=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(v){var A=$n.instance.rotation,E=Fe.Matrix.Identity();A.toRotationMatrix(E);var R=Fe.Vector3.TransformCoordinates(Fe.Vector3.Forward(),E);return{origin:$n.instance.position,direction:R,distance:v}},t.prototype.getRayFromPositions=function(v,A){var E=A.subtract(v),R=E.length();return{origin:v,direction:E.normalize(),distance:R}},t.prototype.hitFirst=function(v,A,E){var R="number"==typeof E?Xn.HitFirst+E:m();this.queries[R]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitFirst",ray:v})},t.prototype.hitAll=function(v,A,E){var R="number"==typeof E?Xn.HitAll+E:m();this.queries[R]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitAll",ray:v})},t.prototype.hitFirstAvatar=function(v,A){c("not implemented yet")},t.prototype.hitAllAvatars=function(v,A){c("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t}(),no=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(fe,this,(function(v){"HitFirst"===v.payload.queryType?to.instance.handleRaycastHitFirstResponse(v):"HitAll"===v.payload.queryType&&to.instance.handleRaycastHitAllResponse(v)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),oo=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(ye,this,(function(v){yn.instance.handlePointerEvent(v.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),io=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(v){v.eventManager.addListener(me,this,this.handleEvent),v.eventManager.addListener(z,this,this.componentAdded),v.eventManager.addListener(V,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(v){for(var A in v.components){var E=v.components[A];E instanceof Gn&&(this.handlerMap[E.uuid]=E)}},t.prototype.onRemoveEntity=function(v){for(var A in v.components){var E=v.components[A];E instanceof Gn&&delete this.handlerMap[E.uuid]}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var A=v.entity.components[v.componentName];A instanceof Gn&&(this.handlerMap[A.uuid]=A)}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&v.component instanceof Gn&&delete this.handlerMap[v.component.uuid]},t.prototype.handleEvent=function(v){if(v.uuid in this.handlerMap){var A=this.handlerMap[v.uuid];A&&A.callback&&"call"in A.callback&&A.callback(v.payload)}},t}(),ro=new no,ao=new oo,so=new io,lo=function(A){function n(v){var E=A.call(this)||this;return E.loop=!1,E.volume=1,E.url=v,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"url",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([ne.field,s("design:type",String)],n.prototype,"loadingCompleteEventId",void 0),r([ne.field,s("design:type",Number)],n.prototype,"volume",void 0),r([N("engine.AudioClip",v.CLASS_ID.AUDIO_CLIP),s("design:paramtypes",[String])],n)}(ne),co=function(A){function n(v){var E=A.call(this)||this;if(E.audioClip=v,E.loop=!1,E.volume=1,E.playing=!1,E.pitch=1,E.playedAtTimestamp=Date.now(),!(v instanceof lo))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return E.audioClipId=D(v),E}return i(n,A),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([ne.readonly,s("design:type",String)],n.prototype,"audioClipId",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"volume",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([ne.field,s("design:type",Number)],n.prototype,"pitch",void 0),r([ne.field,s("design:type",Number)],n.prototype,"playedAtTimestamp",void 0),r([P("engine.AudioSource",v.CLASS_ID.AUDIO_SOURCE),s("design:paramtypes",[lo])],n)}(ne),uo=function(A){function n(v){var E=A.call(this)||this;return E.playing=!1,E.volume=1,E.url=v,E.playing=!0,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"url",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([ne.field,s("design:type",Number)],n.prototype,"volume",void 0),r([P("engine.AudioStream",v.CLASS_ID.AUDIO_STREAM),s("design:paramtypes",[String])],n)}(ne);v.Gizmo=void 0,(eo=v.Gizmo||(v.Gizmo={})).MOVE="MOVE",eo.ROTATE="ROTATE",eo.SCALE="SCALE",eo.NONE="NONE";var po,ho=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="gizmoEvent",v}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.gizmoEvent",v.CLASS_ID.UUID_CALLBACK)],n)}(Gn),mo=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.position=!0,v.rotation=!0,v.scale=!0,v.cycle=!0,v.localReference=!1,v}return i(n,A),r([ne.field,s("design:type",Boolean)],n.prototype,"position",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"rotation",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"scale",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"cycle",void 0),r([ne.field,s("design:type",String)],n.prototype,"selectedGizmo",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"localReference",void 0),r([P("engine.gizmos",v.CLASS_ID.GIZMOS)],n)}(ne),fo=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onFocus",so.handlerMap[E.uuid]=E,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onFocus",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Gn),go=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onTextSubmit",so.handlerMap[E.uuid]=E,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onTextSubmit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Gn),yo=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onBlur",so.handlerMap[E.uuid]=E,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onBlur",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Gn),wo=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onEnter",so.handlerMap[E.uuid]=E,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Gn),vo=function(A){function n(v){var E=A.call(this,v)||this;return E.type="onChange",so.handlerMap[E.uuid]=E,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onChange",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Gn),bo=function(A){function n(v,E){var R=A.call(this,v)||this;return R.type="onClick",so.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onClick",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(qn),To=function(A){function n(v,E){var R=A.call(this,v)||this;return R.type="pointerDown",so.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerDown",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(qn),xo=function(A){function n(v,E){var R=A.call(this,v)||this;return R.type="pointerUp",so.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerUp",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(qn),So=function(A){function n(v,E){var R=A.call(this,v)||this;return R.type="pointerHoverEnter",so.handlerMap[R.uuid]=R,E&&E.distance&&(R.distance=E.distance),R}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(qn),Co=function(A){function n(v){var E=A.call(this,v)||this;return E.type="pointerHoverExit",so.handlerMap[E.uuid]=E,E.distance=160,E}return i(n,A),r([ne.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverExit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(qn),Ao=function(v){function e(A){var E=v.call(this)||this;return E.name=null,E.visible=!0,E.opacity=1,E.hAlign="center",E.vAlign="center",E.width="100px",E.height="50px",E.positionX="0px",E.positionY="0px",E.isPointerBlocker=!0,A&&(E._parent=A,E.data.parentComponent=D(A)),E}return i(e,v),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([ne.field,s("design:type",Object)],e.prototype,"name",void 0),r([ne.field,s("design:type",Boolean)],e.prototype,"visible",void 0),r([ne.field,s("design:type",Number)],e.prototype,"opacity",void 0),r([ne.field,s("design:type",String)],e.prototype,"hAlign",void 0),r([ne.field,s("design:type",String)],e.prototype,"vAlign",void 0),r([ne.uiValue,s("design:type",Object)],e.prototype,"width",void 0),r([ne.uiValue,s("design:type",Object)],e.prototype,"height",void 0),r([ne.uiValue,s("design:type",Object)],e.prototype,"positionX",void 0),r([ne.uiValue,s("design:type",Object)],e.prototype,"positionY",void 0),r([ne.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),e}(ne),Eo=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_FULLSCREEN_SHAPE),s("design:paramtypes",[])],n)}(Ao),_o=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_WORLD_SPACE_SHAPE),s("design:paramtypes",[])],n)}(Ao),Io=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_SCREEN_SPACE_SHAPE),s("design:paramtypes",[])],n)}(Ao),Po=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.thickness=0,v.color=Fe.Color4.Clear(),v.alignmentUsesSize=!0,v}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"color",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"alignmentUsesSize",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_RECT)],n)}(Ao);v.UIStackOrientation=void 0,(po=v.UIStackOrientation||(v.UIStackOrientation={}))[po.VERTICAL=0]="VERTICAL",po[po.HORIZONTAL=1]="HORIZONTAL";var Bo=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.adaptWidth=!0,E.adaptHeight=!0,E.color=Fe.Color4.Clear(),E.stackOrientation=v.UIStackOrientation.VERTICAL,E.spacing=0,E}return i(n,A),r([ne.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"color",void 0),r([ne.field,s("design:type",Number)],n.prototype,"stackOrientation",void 0),r([ne.field,s("design:type",Number)],n.prototype,"spacing",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_STACK)],n)}(Ao),ko=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.fontSize=10,v.fontWeight="normal",v.thickness=0,v.cornerRadius=0,v.color=Fe.Color4.White(),v.background=Fe.Color4.White(),v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Fe.Color4.Black(),v.text="button",v}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([ne.field,s("design:type",String)],n.prototype,"fontWeight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([ne.field,s("design:type",Number)],n.prototype,"cornerRadius",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"color",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"background",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"shadowColor",void 0),r([ne.field,s("design:type",String)],n.prototype,"text",void 0),r([N("engine.shape",v.CLASS_ID.UI_BUTTON_SHAPE)],n)}(Ao),Ro=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.outlineWidth=0,v.outlineColor=Fe.Color4.White(),v.color=Fe.Color4.White(),v.fontSize=10,v.fontAutoSize=!1,v.value="",v.lineSpacing=0,v.lineCount=0,v.adaptWidth=!1,v.adaptHeight=!1,v.textWrapping=!1,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Fe.Color4.Black(),v.hTextAlign="left",v.vTextAlign="bottom",v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"outlineColor",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"color",void 0),r([ne.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"fontAutoSize",void 0),r([ne.component,s("design:type",Vn)],n.prototype,"font",void 0),r([ne.field,s("design:type",String)],n.prototype,"value",void 0),r([ne.field,s("design:type",Number)],n.prototype,"lineSpacing",void 0),r([ne.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"shadowColor",void 0),r([ne.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([ne.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([N("engine.shape",v.CLASS_ID.UI_TEXT_SHAPE)],n)}(Ao),Mo=function(A){function n(v){var E=A.call(this,v)||this;return E.outlineWidth=0,E.outlineColor=Fe.Color4.Black(),E.color=Fe.Color4.Clear(),E.fontSize=10,E.value="",E.placeholder="",E.margin=10,E.hTextAlign="left",E.vTextAlign="bottom",E.focusedBackground=Fe.Color4.Black(),E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=Fe.Color4.White(),E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.onTextSubmit=null,E.onChanged=null,E.onFocus=null,E.onBlur=null,E.onTextChanged=new vo((function(v){var A=v.value,R=A.value,M=A.isSubmit,O=E.dirty;if(E.value=R,E.dirty=O,M&&E.onTextSubmit){var V={text:R};E.onTextSubmit.callback(V)}else if(!M&&E.onChanged){var z={value:R,pointerId:v.pointerId};E.onChanged.callback(z)}})),E}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"outlineColor",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"color",void 0),r([ne.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([ne.component,s("design:type",Vn)],n.prototype,"font",void 0),r([ne.field,s("design:type",String)],n.prototype,"value",void 0),r([ne.field,s("design:type",String)],n.prototype,"placeholder",void 0),r([ne.field,s("design:type",Number)],n.prototype,"margin",void 0),r([ne.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([ne.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"focusedBackground",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([ne.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"shadowColor",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Gn.uuidEvent,s("design:type",vo)],n.prototype,"onTextChanged",void 0),r([Gn.uuidEvent,s("design:type",Object)],n.prototype,"onFocus",void 0),r([Gn.uuidEvent,s("design:type",Object)],n.prototype,"onBlur",void 0),r([N("engine.shape",v.CLASS_ID.UI_INPUT_TEXT_SHAPE),s("design:paramtypes",[Object])],n)}(Ao),Oo=function(A){function n(v,E){var R=A.call(this,v)||this;return R.sourceLeft=0,R.sourceTop=0,R.sourceWidth=1,R.sourceHeight=1,R.paddingTop=0,R.paddingRight=0,R.paddingBottom=0,R.paddingLeft=0,R.sizeInPixels=!0,R.onClick=null,R.source=E,R}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"sourceLeft",void 0),r([ne.field,s("design:type",Number)],n.prototype,"sourceTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"sourceWidth",void 0),r([ne.field,s("design:type",Number)],n.prototype,"sourceHeight",void 0),r([ne.component,s("design:type",Object)],n.prototype,"source",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"sizeInPixels",void 0),r([Gn.uuidEvent,s("design:type",Object)],n.prototype,"onClick",void 0),r([N("engine.shape",v.CLASS_ID.UI_IMAGE_SHAPE),s("design:paramtypes",[Ao,Object])],n)}(Ao),Lo=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.valueX=0,v.valueY=0,v.backgroundColor=Fe.Color4.Clear(),v.isHorizontal=!1,v.isVertical=!1,v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.onChanged=null,v}return i(n,A),r([ne.field,s("design:type",Number)],n.prototype,"valueX",void 0),r([ne.field,s("design:type",Number)],n.prototype,"valueY",void 0),r([ne.field,s("design:type",Fe.Color4)],n.prototype,"backgroundColor",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"isHorizontal",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"isVertical",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([ne.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Gn.uuidEvent,s("design:type",Object)],n.prototype,"onChanged",void 0),r([N("engine.shape",v.CLASS_ID.UI_SLIDER_SHAPE)],n)}(Ao),Do=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.useDummyModel=!1,v.talking=!1,v}var E;return i(n,A),E=n,n.Dummy=function(){var v=new E;return v.useDummyModel=!0,v},r([ne.field,s("design:type",String)],n.prototype,"id",void 0),r([ne.field,s("design:type",String)],n.prototype,"name",void 0),r([ne.field,s("design:type",String)],n.prototype,"expressionTriggerId",void 0),r([ne.field,s("design:type",Number)],n.prototype,"expressionTriggerTimestamp",void 0),r([ne.field,s("design:type",String)],n.prototype,"bodyShape",void 0),r([ne.field,s("design:type",Array)],n.prototype,"wearables",void 0),r([ne.field,s("design:type",Object)],n.prototype,"skinColor",void 0),r([ne.field,s("design:type",Object)],n.prototype,"hairColor",void 0),r([ne.field,s("design:type",Object)],n.prototype,"eyeColor",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"useDummyModel",void 0),r([ne.field,s("design:type",Boolean)],n.prototype,"talking",void 0),E=r([P("engine.avatarShape",v.CLASS_ID.AVATAR_SHAPE)],n)}(ne),Vo=null,No=null,Fo=null;function Ri(){return Fo||(Fo=new he),Fo}var zo=function(){function t(){var v=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!No){(No=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(v){Vo=v}));var v=Ri();dcl.subscribe("comms"),dcl.onEvent((function(A){"comms"===A.type&&v.notifyObservers(A.data)}))}return No}().then((function(){v.connected=!0,v.flush()}))}return t.prototype.on=function(v,A){return Ri().add((function(E){try{var R=JSON.parse(E.message);R.message===v&&A(R.payload,E.sender)}catch(E){dcl.error("Error parsing comms message "+(E.message||""),E)}}))},t.prototype.sendRaw=function(v){this.messageQueue.push(v),this.connected&&this.flush()},t.prototype.emit=function(v,A){var E=JSON.stringify({message:v,payload:A});this.sendRaw(E),Ri().notifyObservers({message:E,sender:"self"})},t.prototype.flush=function(){var v=this;if(0!==this.messageQueue.length&&this.connected&&Vo&&!this.flushing){var A=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(Vo.rpcHandle,"send",[A]).then((function(A){v.flushing=!1,v.flush()}),(function(A){v.flushing=!1,y("Error flushing MessageBus",A)}))}},t}(),Uo=new ie("scene");Uo.uuid="0";var Wo=new ae(Uo);N.engine=Wo,"undefined"!=typeof dcl&&(Wo.addSystem(new Ve(dcl),1/0),mt(dcl)),Wo.addSystem(so),Wo.addSystem(ao),Wo.addSystem(ro),v.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",v.Angle=Fe.Angle,v.AnimationState=pn,v.Animator=Ln,v.Arc2=Fe.Arc2,v.AttachToAvatar=xn,v.Attachable=A,v.AudioClip=lo,v.AudioSource=co,v.AudioStream=uo,v.AvatarModifierArea=vn,v.AvatarShape=Do,v.AvatarTexture=Jn,v.Axis=Fe.Axis,v.BasicMaterial=Wn,v.BezierCurve=Fe.BezierCurve,v.Billboard=Sn,v.BoxShape=An,v.Camera=$n,v.CameraModeArea=Zn,v.CircleShape=_n,v.Color3=Fe.Color3,v.Color4=Fe.Color4,v.Component=P,v.ComponentAdded=z,v.ComponentGroup=oe,v.ComponentRemoved=V,v.ConeShape=Pn,v.Curve3=Fe.Curve3,v.CylinderShape=Bn,v.DEG2RAD=Fe.DEG2RAD,v.DisposableComponent=N,v.DisposableComponentCreated=J,v.DisposableComponentRemoved=$,v.DisposableComponentUpdated=ee,v.Engine=ae,v.Entity=ie,v.Epsilon=Fe.Epsilon,v.EventConstructor=x,v.EventManager=M,v.Font=Vn,v.Frustum=Fe.Frustum,v.GLTFShape=kn,v.Gizmos=mo,v.GlobalPointerDown=fn,v.GlobalPointerUp=gn,v.Input=yn,v.Material=Un,v.Matrix=Fe.Matrix,v.MessageBus=zo,v.MultiObserver=de,v.NFTShape=Mn,v.OBJShape=Dn,v.Observable=he,v.ObservableComponent=ne,v.Observer=Y,v.ObserverEventState=ue,v.OnAnimationEnd=jn,v.OnBlur=yo,v.OnChanged=vo,v.OnClick=bo,v.OnEnter=wo,v.OnFocus=fo,v.OnGizmoEvent=ho,v.OnPointerDown=To,v.OnPointerHoverEnter=So,v.OnPointerHoverExit=Co,v.OnPointerLock=Hn,v.OnPointerUUIDEvent=qn,v.OnPointerUp=xo,v.OnTextSubmit=go,v.OnUUIDEvent=Gn,v.Orientation=Fe.Orientation,v.ParentChanged=W,v.Path2=Fe.Path2,v.Path3D=Fe.Path3D,v.PhysicsCast=to,v.Plane=Fe.Plane,v.PlaneShape=In,v.PointerEvent=ye,v.PointerEventComponent=Ke,v.PointerEventSystem=oo,v.Quaternion=Fe.Quaternion,v.RAD2DEG=Fe.RAD2DEG,v.RaycastEventSystem=no,v.RaycastResponse=fe,v.Scalar=Fe.Scalar,v.Shape=Cn,v.Size=Fe.Size,v.SmartItem=Yn,v.Space=Fe.Space,v.SphereShape=En,v.Subscription=en,v.TextShape=Fn,v.Texture=On,v.ToGammaSpace=Fe.ToGammaSpace,v.ToLinearSpace=Fe.ToLinearSpace,v.Transform=bn,v.UIButton=ko,v.UICanvas=Io,v.UIContainerRect=Po,v.UIContainerStack=Bo,v.UIFullScreen=Eo,v.UIImage=Oo,v.UIInputText=Mo,v.UIScrollRect=Lo,v.UIShape=Ao,v.UIText=Ro,v.UIValue=H,v.UIWorldSpace=_o,v.UUIDEvent=me,v.UUIDEventSystem=io,v.Vector2=Fe.Vector2,v.Vector3=Fe.Vector3,v.Vector4=Fe.Vector4,v.VideoClip=Qn,v.VideoTexture=Kn,v._initEventObservables=mt,v.buildArray=function(v,A){for(var E=[],R=0;R<v;++R)E.push(A());return E},v.engine=Wo,v.error=y,v.executeTask=G,v.getComponentClassId=L,v.getComponentId=D,v.getComponentName=F,v.getMessageObserver=Ri,v.isDisposableComponent=U,v.log=c,v.newId=f,v.onCameraModeChangedObservable=we,v.onEnterScene=Te,v.onEnterSceneObservable=be,v.onIdleStateChangedObservable=ve,v.onLeaveScene=Ce,v.onLeaveSceneObservable=Se,v.onPlayerClickedObservable=Le,v.onPlayerConnectedObservable=ke,v.onPlayerDisconnectedObservable=Re,v.onPlayerExpressionObservable=_e,v.onPointerLockedStateChange=Ie,v.onProfileChanged=Be,v.onRealmChangedObservable=Oe,v.onSceneReadyObservable=Ee,v.onVideoEvent=Pe,v.openExternalURL=function(v){"undefined"!=typeof dcl?dcl.openExternalUrl(v):y("ERROR: openExternalURL dcl is undefined")},v.openNFTDialog=function(v,A){if(void 0===A&&(A=null),"undefined"!=typeof dcl){var E=v.match(/ethereum:\/\/(.+)\/(.+)/);if(!E||E.length<3)return;dcl.openNFTDialog(E[1],E[2],A)}else y("ERROR: openNFTDialog dcl is undefined")},v.pointerEventSystem=ao,v.raycastEventSystem=ro,v.teleportTo=function(v){var A;A=[v],void 0===le&&"undefined"!=typeof dcl&&(le=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==le&&"undefined"!=typeof dcl&&le.then((function(v){dcl.callRpc(v.rpcHandle,"requestTeleport",A)}))},v.uuid=m,v.uuidEventSystem=so,Object.defineProperty(v,"__esModule",{value:!0})}(this.self=this.self||{});var __decorate=this&&this.__decorate||function(v,A,E,R){var M,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(v,A,E,R);else for(var z=v.length-1;z>=0;z--)(M=v[z])&&(V=(O<3?M(V):O>3?M(A,E,V):M(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V},__values=this&&this.__values||function(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var M in A=arguments[E])Object.prototype.hasOwnProperty.call(A,M)&&(v[M]=A[M]);return v}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(M,O){function fulfilled(v){try{step(R.next(v))}catch(v){O(v)}}function rejected(v){try{step(R.throw(v))}catch(v){O(v)}}function step(v){var A;v.done?M(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(fulfilled,rejected)}step((R=R.apply(v,A||[])).next())}))},__generator=this&&this.__generator||function(v,A){var E,R,M,O,V={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return O={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function verb(O){return function(z){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(M=2&O[0]?R.return:O[0]?R.throw||((M=R.return)&&M.call(R),0):R.next)&&!(M=M.call(R,O[1])).done)return M;switch(R=0,M&&(O=[2&O[0],M.value]),O[0]){case 0:case 1:M=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((M=(M=V.trys).length>0&&M[M.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!M||O[1]>M[0]&&O[1]<M[3])){V.label=O[1];break}if(6===O[0]&&V.label<M[1]){V.label=M[1],M=O;break}if(M&&V.label<M[2]){V.label=M[2],V.ops.push(O);break}M[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(v,V)}catch(v){O=[6,v],R=0}finally{E=M=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,z])}}},__createBinding=this&&this.__createBinding||(Object.create?function(v,A,E,R){void 0===R&&(R=E),Object.defineProperty(v,R,{enumerable:!0,get:function(){return A[E]}})}:function(v,A,E,R){void 0===R&&(R=E),v[R]=A[E]}),__exportStar=this&&this.__exportStar||function(v,A){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(A,E)||__createBinding(A,v,E)},__read=this&&this.__read||function(v,A){var E="function"==typeof Symbol&&v[Symbol.iterator];if(!E)return v;var R,M,O=E.call(v),V=[];try{for(;(void 0===A||A-- >0)&&!(R=O.next()).done;)V.push(R.value)}catch(v){M={error:v}}finally{try{R&&!R.done&&(E=O.return)&&E.call(O)}finally{if(M)throw M.error}}return V},__spreadArray=this&&this.__spreadArray||function(v,A){for(var E=0,R=A.length,M=v.length;E<R;E++,M++)v[M]=A[E];return v};define("dcl-quests-client/quests-client-amd",(function(){var v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(v){var A={exports:{}};return v(A,A.exports),A.exports}var A=n((function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.fromBase64=A.toBase64=void 0;var E="function"==typeof btoa?btoa:function(v){return Buffer.from(v).toString("base64")},R="function"==typeof atob?atob:function(v){return Buffer.from(v,"base64").toString("utf-8")};A.toBase64=function(v){return E(v)},A.fromBase64=function(v){return R(v)}})),E=n((function(v,E){function n(v){return v.split("").reverse().join("")}Object.defineProperty(E,"__esModule",{value:!0}),E.DefObf=void 0,E.DefObf=new(function(){function t(){}return t.prototype.obf=function(v){return n(A.toBase64(v)).replace(/=/g,"_")},t.prototype.deobf=function(v){return A.fromBase64(n(v.replace(/_/g,"=")))},t}())})),R=n((function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.AUTH_METADATA_HEADER=A.AUTH_TIMESTAMP_HEADER=A.AUTH_CHAIN_HEADER_PREFIX=void 0,A.AUTH_CHAIN_HEADER_PREFIX="x-identity-auth-chain-",A.AUTH_TIMESTAMP_HEADER="x-identity-timestamp",A.AUTH_METADATA_HEADER="x-identity-metadata"})),M=n((function(v,A){var E,R,M;Object.defineProperty(A,"__esModule",{value:!0}),A.GivenRewardStatus=A.Visibility=A.ProgressStatus=void 0,(E=A.ProgressStatus||(A.ProgressStatus={})).BLOCKED="blocked",E.NOT_STARTED="not_started",E.ON_GOING="on_going",E.COMPLETED="completed",E.FAILED="failed",E.REVERTED="reverted",(R=A.Visibility||(A.Visibility={})).VISIBLE="visible",R.VISIBLE_IF_CAN_START="visible_if_can_start",R.SECRET="secret",(M=A.GivenRewardStatus||(A.GivenRewardStatus={})).OK="ok",M.ALREADY_GIVEN="already_given",M.TASK_ALREADY_COMPLETED="task_already_completed",M.FAILED="failed"})),O=n((function(A,O){var V=v&&v.__createBinding||(Object.create?function(v,A,E,R){void 0===R&&(R=E),Object.defineProperty(v,R,{enumerable:!0,get:function(){return A[E]}})}:function(v,A,E,R){void 0===R&&(R=E),v[R]=A[E]}),z=v&&v.__exportStar||function(v,A){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(A,E)||V(A,v,E)};Object.defineProperty(O,"__esModule",{value:!0}),z(E,O),z(R,O),z(M,O)})),V=n((function(A,E){var R=v&&v.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(M,O){function u(v){try{c(R.next(v))}catch(v){O(v)}}function a(v){try{c(R.throw(v))}catch(v){O(v)}}function c(v){var A;v.done?M(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(u,a)}c((R=R.apply(v,A||[])).next())}))},M=v&&v.__generator||function(v,A){var E,R,M,O,V={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(z){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(M=2&O[0]?R.return:O[0]?R.throw||((M=R.return)&&M.call(R),0):R.next)&&!(M=M.call(R,O[1])).done)return M;switch(R=0,M&&(O=[2&O[0],M.value]),O[0]){case 0:case 1:M=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((M=(M=V.trys).length>0&&M[M.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!M||O[1]>M[0]&&O[1]<M[3])){V.label=O[1];break}if(6===O[0]&&V.label<M[1]){V.label=M[1],M=O;break}if(M&&V.label<M[2]){V.label=M[2],V.ops.push(O);break}M[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(v,V)}catch(v){O=[6,v],R=0}finally{E=M=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,z])}}};Object.defineProperty(E,"__esModule",{value:!0}),E.flatFetch=void 0,E.flatFetch=function(v,A){return R(this,void 0,void 0,(function(){var E,R,O,V,z,W;return M(this,(function(M){switch(M.label){case 0:return[4,fetch(v,A)];case 1:switch(E=M.sent(),R=(null==A?void 0:A.responseBodyType)||"text",O={},E.headers.forEach((function(v,A){return O[A]=v})),V={ok:E.ok,status:E.status,statusText:E.statusText,headers:O},R){case"json":return[3,2];case"text":return[3,4]}return[3,6];case 2:return z=V,[4,E.json()];case 3:return z.json=M.sent(),[3,6];case 4:return W=V,[4,E.text()];case 5:return W.text=M.sent(),[3,6];case 6:return[2,V]}}))}))}})),z=n((function(A,E){var R=v&&v.__assign||function(){return(R=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var M in A=arguments[E])Object.prototype.hasOwnProperty.call(A,M)&&(v[M]=A[M]);return v}).apply(this,arguments)},M=v&&v.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(M,O){function u(v){try{c(R.next(v))}catch(v){O(v)}}function a(v){try{c(R.throw(v))}catch(v){O(v)}}function c(v){var A;v.done?M(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(u,a)}c((R=R.apply(v,A||[])).next())}))},z=v&&v.__generator||function(v,A){var E,R,M,O,V={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(z){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(M=2&O[0]?R.return:O[0]?R.throw||((M=R.return)&&M.call(R),0):R.next)&&!(M=M.call(R,O[1])).done)return M;switch(R=0,M&&(O=[2&O[0],M.value]),O[0]){case 0:case 1:M=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((M=(M=V.trys).length>0&&M[M.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!M||O[1]>M[0]&&O[1]<M[3])){V.label=O[1];break}if(6===O[0]&&V.label<M[1]){V.label=M[1],M=O;break}if(M&&V.label<M[2]){V.label=M[2],V.ops.push(O);break}M[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(v,V)}catch(v){O=[6,v],R=0}finally{E=M=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,z])}}};function u(v,A,E,R){var M={},V=Date.now(),z=JSON.stringify(E);return R([v.toLowerCase(),A.toLowerCase(),V.toString(),z].join(":").toLowerCase()).forEach((function(v,A){M[""+O.AUTH_CHAIN_HEADER_PREFIX+A]=JSON.stringify(v)})),M[O.AUTH_TIMESTAMP_HEADER]=V.toString(),M[O.AUTH_METADATA_HEADER]=z,M}Object.defineProperty(E,"__esModule",{value:!0}),E.authFetch=void 0,E.authFetch=function(v){return function(A,E){var O,W;return M(this,void 0,void 0,(function(){var M,H;return z(this,(function(z){return M=new URL(A).pathname,H=R(R({},E),{headers:R(R({},u(null!==(O=null==E?void 0:E.method)&&void 0!==O?O:"get",M,null!==(W=null==E?void 0:E.metadata)&&void 0!==W?W:{},v)),null==E?void 0:E.headers)}),[2,V.flatFetch(A,H)]}))}))}}})),W=n((function(A,E){var R=v&&v.__assign||function(){return(R=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var M in A=arguments[E])Object.prototype.hasOwnProperty.call(A,M)&&(v[M]=A[M]);return v}).apply(this,arguments)},M=v&&v.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(M,O){function u(v){try{c(R.next(v))}catch(v){O(v)}}function a(v){try{c(R.throw(v))}catch(v){O(v)}}function c(v){var A;v.done?M(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(u,a)}c((R=R.apply(v,A||[])).next())}))},W=v&&v.__generator||function(v,A){var E,R,M,O,V={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(z){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(M=2&O[0]?R.return:O[0]?R.throw||((M=R.return)&&M.call(R),0):R.next)&&!(M=M.call(R,O[1])).done)return M;switch(R=0,M&&(O=[2&O[0],M.value]),O[0]){case 0:case 1:M=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((M=(M=V.trys).length>0&&M[M.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!M||O[1]>M[0]&&O[1]<M[3])){V.label=O[1];break}if(6===O[0]&&V.label<M[1]){V.label=M[1],M=O;break}if(M&&V.label<M[2]){V.label=M[2],V.ops.push(O);break}M[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(v,V)}catch(v){O=[6,v],R=0}finally{E=M=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,z])}}};Object.defineProperty(E,"__esModule",{value:!0}),E.QuestsClient=void 0;var H=function(){function t(v){var A;this.options=v,this.obf=O.DefObf,v.authChainProvider?this.fetchFn=z.authFetch(v.authChainProvider):this.fetchFn=null!==(A=v.fetchFn)&&void 0!==A?A:V.flatFetch}return t.prototype.urlFor=function(v){return""+this.options.baseUrl+v},t.prototype.fetch=function(v,A){return M(this,void 0,void 0,(function(){var E,O=this;return W(this,(function(V){return(null==A?void 0:A.bodyObject)&&(A.body=JSON.stringify(A.bodyObject),A.obf?(A.body=this.obf.obf(A.body),A.headers=R(R({},A.headers),{"Content-Type":"application/quests"})):A.headers=R(R({},A.headers),{"Content-Type":"application/json"})),E=R(R({},A),{metadata:this.options.metadata,responseBodyType:"text"}),[2,this.fetchFn(this.urlFor(v),E).then((function(v){return M(O,void 0,void 0,(function(){var E,R;return W(this,(function(M){return E=v.text||"",(null==A?void 0:A.deobf)&&v.ok&&(E=this.obf.deobf(E)),R=function(v){try{return JSON.parse(v)}catch(A){return v}}(E),[2,{ok:v.ok,status:v.status,body:R}]}))}))}))]}))}))},t.prototype.getQuests=function(){return M(this,void 0,void 0,(function(){return W(this,(function(v){return[2,this.fetch("/quests")]}))}))},t.prototype.getQuestDetails=function(v){return M(this,void 0,void 0,(function(){return W(this,(function(A){return[2,this.fetch("/quests/"+v)]}))}))},t.prototype.startQuest=function(v){return M(this,void 0,void 0,(function(){return W(this,(function(A){return[2,this.fetch("/s/"+this.obf.obf(v),{method:"post",deobf:!0})]}))}))},t.prototype.updateArbitraryState=function(v,A){return M(this,void 0,void 0,(function(){return W(this,(function(E){return[2,this.fetch("/kv/"+this.obf.obf(v),{method:"put",deobf:!0,obf:!0,bodyObject:A})]}))}))},t.prototype.makeProgress=function(v,A,E){return M(this,void 0,void 0,(function(){return W(this,(function(R){return[2,this.fetch("/p/"+this.obf.obf(v)+"/"+this.obf.obf(A),{method:"post",deobf:!0,obf:!0,bodyObject:E})]}))}))},t}();E.QuestsClient=H}));return function(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}(n((function(A,E){var R=v&&v.__createBinding||(Object.create?function(v,A,E,R){void 0===R&&(R=E),Object.defineProperty(v,R,{enumerable:!0,get:function(){return A[E]}})}:function(v,A,E,R){void 0===R&&(R=E),v[R]=A[E]}),O=v&&v.__exportStar||function(v,A){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(A,E)||R(A,v,E)};Object.defineProperty(E,"__esModule",{value:!0}),O(W,E),O(M,E)})))})),define("@dcl/types",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0})})),define("@dcl/component",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.QuestTrackingInfo=void 0;var E=function(){function QuestTrackingInfo(v){this.questData=v}return QuestTrackingInfo.prototype.toJSON=function(){return this.questData},__decorate([Component("engine.questTrackingComponent",1417815519)],QuestTrackingInfo)}();A.QuestTrackingInfo=E})),define("@dcl/mappings",["require","exports"],(function(v,A){function toRendererSections(v){var A=v.reduce((function(v,A){var E,R,M=null!==(E=A.section)&&void 0!==E?E:"",O=null!==(R=v[M])&&void 0!==R?R:{id:M,name:M,progress:0,tasks:[]};return O.tasks.push(function(v){return{id:v.id,progress:v.progressPercentage,name:v.description,coordinates:v.coordinates,payload:JSON.stringify(getProgressPayload(v)),status:v.progressStatus,type:v.progressMode.type}}(A)),v[M]=O,v}),{}),E=[];for(var R in A){var M=A[R];M.progress=M.tasks.length>0?M.tasks.reduce((function(v,A){return v+A.progress}),0)/M.tasks.length:0,E.push(M)}return E}function getProgressPayload(v){return"single"===v.progressMode.type?{isDone:"completed"===v.progressStatus}:{type:"numeric",start:v.progressSummary.start,end:v.progressSummary.end,current:v.progressSummary.current}}function gatherRewards(v){var A,E,R,M,O,V,z,W,H,X,K,Z,J,$,ee,ne,oe,ie,ae=[],_loop_1=function(A){ae.push({id:null!==(z=A.id)&&void 0!==z?z:"",name:null!==(W=A.name)&&void 0!==W?W:"",type:null!==(H=A.type)&&void 0!==H?H:"",imageUrl:null!==(X=A.imageUrl)&&void 0!==X?X:"",status:null!==(Z=null===(K=v.givenRewards.filter((function(v){return v.reward.id===A.id}))[0])||void 0===K?void 0:K.status)&&void 0!==Z?Z:"not_given"})};try{for(var se=__values(v.rewards),le=se.next();!le.done;le=se.next())_loop_1(le.value)}catch(v){A={error:v}}finally{try{le&&!le.done&&(E=se.return)&&E.call(se)}finally{if(A)throw A.error}}try{for(var ce=__values(v.tasks),ue=ce.next();!ue.done;ue=ce.next()){var de=ue.value,_loop_2=function(v){ae.push({id:null!==(J=v.id)&&void 0!==J?J:"",name:null!==($=v.name)&&void 0!==$?$:"",type:null!==(ee=v.type)&&void 0!==ee?ee:"",imageUrl:null!==(ne=v.imageUrl)&&void 0!==ne?ne:"",status:null!==(ie=null===(oe=de.givenRewards.filter((function(A){return A.reward.id===v.id}))[0])||void 0===oe?void 0:oe.status)&&void 0!==ie?ie:"not_given"})};try{for(var he=(O=void 0,__values(de.rewards)),me=he.next();!me.done;me=he.next())_loop_2(me.value)}catch(v){O={error:v}}finally{try{me&&!me.done&&(V=he.return)&&V.call(he)}finally{if(O)throw O.error}}}}catch(v){R={error:v}}finally{try{ue&&!ue.done&&(M=ce.return)&&M.call(ce)}finally{if(R)throw R.error}}return ae}Object.defineProperty(A,"__esModule",{value:!0}),A.toRendererQuest=void 0,A.toRendererQuest=function(v){return{id:v.id,name:v.name,description:v.description,icon:v.icon,thumbnail_banner:v.thumbnailBanner,thumbnail_entry:v.thumbnailEntry,status:v.progressStatus,sections:toRendererSections(v.tasks),rewards:gatherRewards(v),visibility:v.visibility}}})),define("@dcl/RemoteQuestTracker",["require","exports","dcl-quests-client/quests-client-amd","@decentraland/SignedFetch","@dcl/component","@dcl/mappings","@decentraland/EnvironmentAPI"],(function(v,A,E,R,M,O,V){Object.defineProperty(A,"__esModule",{value:!0}),A.RemoteQuestTracker=void 0;var z={clientFactory:function(v){return new E.QuestsClient({baseUrl:v,fetchFn:R.signedFetch})},logErrors:!0,addToEngine:!0},W=function(){function RemoteQuestTracker(v,A){var E=this;if(this.questId=v,this.readyListeners=[],this._ready=!1,this.options=__assign(__assign({},z),null!=A?A:{}),this.options.baseUrl)this.setReady(this.options.clientFactory(this.options.baseUrl));else{if(!V.getExplorerConfiguration)throw new Error("Unsupported configuration for this explorer version! You need to provide baseUrl");V.getExplorerConfiguration().then((function(v){"string"==typeof v.configurations.questsServerUrl&&(E.options.baseUrl=v.configurations.questsServerUrl,E.setReady(E.options.clientFactory(E.options.baseUrl)))})).catch((function(v){E.readyListeners.forEach((function(A){return A.reject("Couldn't get configuration from explorer: "+v)}))}))}this.entity=new Entity,this.options.addToEngine&&engine.addEntity(this.entity),this.refresh()}return RemoteQuestTracker.prototype.setReady=function(v){this.client=v,this._ready=!0,this.readyListeners.forEach((function(A){return A.resolve(v)})),this.readyListeners=[]},RemoteQuestTracker.prototype.ready=function(){return __awaiter(this,void 0,void 0,(function(){var v=this;return __generator(this,(function(A){return this._ready?[2,this.client]:[2,new Promise((function(A,E){return v.readyListeners.push({resolve:A,reject:E})}))]}))}))},RemoteQuestTracker.prototype.getClient=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return this.client?[2,this.client]:[4,this.ready()];case 1:return[2,v.sent()]}}))}))},RemoteQuestTracker.prototype.refresh=function(){return __awaiter(this,void 0,void 0,(function(){var v=this;return __generator(this,(function(A){return[2,this.updateQuest(this.makeRequest((function(){return __awaiter(v,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return[4,this.getClient()];case 1:return[2,v.sent().getQuestDetails(this.questId)]}}))}))})))]}))}))},RemoteQuestTracker.prototype.startQuest=function(){return __awaiter(this,void 0,void 0,(function(){var v=this;return __generator(this,(function(A){return[2,this.updateQuest(this.makeRequest((function(){return __awaiter(v,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return[4,this.getClient()];case 1:return[2,v.sent().startQuest(this.questId)]}}))}))})))]}))}))},RemoteQuestTracker.prototype.makeProgress=function(v,A){return __awaiter(this,void 0,void 0,(function(){var E=this;return __generator(this,(function(R){return[2,this.updateQuest(this.makeRequest((function(){return __awaiter(E,void 0,void 0,(function(){return __generator(this,(function(E){switch(E.label){case 0:return[4,this.getClient()];case 1:return[2,E.sent().makeProgress(this.questId,v,A)]}}))}))})))]}))}))},RemoteQuestTracker.prototype.updateArbitraryState=function(v){return __awaiter(this,void 0,void 0,(function(){var A=this;return __generator(this,(function(E){return[2,this.updateQuest(this.makeRequest((function(){return __awaiter(A,void 0,void 0,(function(){return __generator(this,(function(A){switch(A.label){case 0:return[4,this.getClient()];case 1:return[2,A.sent().updateArbitraryState(this.questId,v)]}}))}))})))]}))}))},RemoteQuestTracker.prototype.getCurrentStatePromise=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return this.currentStatePromise?[2,this.currentStatePromise]:[2]}))}))},RemoteQuestTracker.prototype.getCurrentState=function(){return this.currentState},RemoteQuestTracker.prototype.makeRequest=function(v){return __awaiter(this,void 0,void 0,(function(){var A;return __generator(this,(function(E){switch(E.label){case 0:return[4,v()];case 1:return(A=E.sent()).ok||this.options.logErrors&&log("Error performing request on quest with id: "+this.questId+". Status: "+A.status,{body:A.body}),[2,A]}}))}))},RemoteQuestTracker.prototype.updateQuest=function(v){return __awaiter(this,void 0,void 0,(function(){var A,E;return __generator(this,(function(R){switch(R.label){case 0:return this.currentStatePromise=v.then((function(v){if(v.ok)return v.body;throw new Error("Could not get quest state. Status: "+v.status+". Body: "+v.body)})),[4,v];case 1:return(A=R.sent()).ok&&(this.currentState=A.body,(E=this.entity.getComponentOrNull(M.QuestTrackingInfo))?E.questData=O.toRendererQuest(this.currentState):this.entity.addComponent(new M.QuestTrackingInfo(O.toRendererQuest(this.currentState)))),[2,A]}}))}))},RemoteQuestTracker}();A.RemoteQuestTracker=W})),define("@dcl/ecs-quests",["require","exports","@dcl/component","@dcl/mappings","@dcl/types","@dcl/RemoteQuestTracker"],(function(v,A,E,R,M,O){Object.defineProperty(A,"__esModule",{value:!0}),__exportStar(E,A),__exportStar(R,A),__exportStar(M,A),__exportStar(O,A)})),define("@dcl/quests-query",["require","exports","dcl-quests-client/quests-client-amd"],(function(v,A,E){function find(v,A){var E,R;try{for(var M=__values(v),O=M.next();!O.done;O=M.next()){var V=O.value;if(A(V))return V}}catch(v){E={error:v}}finally{try{O&&!O.done&&(R=M.return)&&R.call(M)}finally{if(E)throw E.error}}}function flatMap(v,A){return v.map(A).reduce((function(v,A){return v.concat(A)}),[])}Object.defineProperty(A,"__esModule",{value:!0}),A.query=void 0,A.query=function(v){return new(function(){function class_1(){}return class_1.prototype.getTaskStatus=function(A){var E;return null===(E=find(v.tasks,(function(v){return v.id===A})))||void 0===E?void 0:E.progressStatus},class_1.prototype.getStepStatus=function(A){var E;return null===(E=find(flatMap(v.tasks,(function(v){return v.steps})),(function(v){return v.id===A})))||void 0===E?void 0:E.progressStatus},class_1.prototype.isTaskCompleted=function(v){return this.getTaskStatus(v)===E.ProgressStatus.COMPLETED},class_1.prototype.isStepCompleted=function(v){return this.getStepStatus(v)===E.ProgressStatus.COMPLETED},class_1.prototype.getTaskProgress=function(A){var E;return null===(E=find(v.tasks,(function(v){return v.id===A})))||void 0===E?void 0:E.progressSummary},class_1.prototype.getAllGivenRewards=function(){return __spreadArray(__spreadArray([],__read(v.givenRewards)),__read(flatMap(v.tasks,(function(v){return v.givenRewards}))))},class_1}())}})),define("@dcl/ecs-scene-utils",["exports","@decentraland/EnvironmentAPI"],(function(v,A){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(v,A){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])})(v,A)};function i(v,A){function i(){this.constructor=v}n(v,A),v.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}function r(v,A,E,R){var M,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(v,A,E,R);else for(var z=v.length-1;z>=0;z--)(M=v[z])&&(V=(O<3?M(V):O>3?M(A,E,V):M(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V}function o(v,A,E,R){return new(E||(E=Promise))((function(M,O){function a(v){try{u(R.next(v))}catch(v){O(v)}}function s(v){try{u(R.throw(v))}catch(v){O(v)}}function u(v){var A;v.done?M(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(a,s)}u((R=R.apply(v,A||[])).next())}))}function a(v,A){var E,R,M,O,V={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return O={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function s(O){return function(z){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(M=2&O[0]?R.return:O[0]?R.throw||((M=R.return)&&M.call(R),0):R.next)&&!(M=M.call(R,O[1])).done)return M;switch(R=0,M&&(O=[2&O[0],M.value]),O[0]){case 0:case 1:M=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((M=(M=V.trys).length>0&&M[M.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!M||O[1]>M[0]&&O[1]<M[3])){V.label=O[1];break}if(6===O[0]&&V.label<M[1]){V.label=M[1],M=O;break}if(M&&V.label<M[2]){V.label=M[2],V.ops.push(O);break}M[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(v,V)}catch(v){O=[6,v],R=0}finally{E=M=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,z])}}}function s(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var E,R=function(){function e(){this._components=[],this._componentGroups=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var A,E;try{for(var R=s(this._components),M=R.next();!M.done;M=R.next())if(v==M.value)return}catch(v){A={error:v}}finally{try{M&&!M.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this._components.push(v),this._componentGroups.push(engine.getComponentGroup(v,Transform))},e.prototype.update=function(v){for(var A=0;A<this._components.length;A++)this.updateComponent(v,this._components[A],this._componentGroups[A])},e.prototype.updateComponent=function(v,A,E){E.entities.forEach((function(E){var R=E.getComponent(Transform),M=E.getComponent(A);M.update(v),M.assignValueToTransform(R),M.hasFinished()&&(E.removeComponent(M),null!=M.onFinishCallback&&M.onFinishCallback())}))},e._instance=null,e}();function h(A,E){switch(A){case v.InterpolationType.LINEAR:return E;case v.InterpolationType.EASEINQUAD:return function(v){return v*v}(E);case v.InterpolationType.EASEOUTQUAD:return function(v){return v*(2-v)}(E);case v.InterpolationType.EASEQUAD:return function(v){return v*v/(2*(v*v-v)+1)}(E);case v.InterpolationType.EASEINSINE:return function(v){return 1-Math.cos(v*Math.PI/2)}(E);case v.InterpolationType.EASEOUTSINE:return function(v){return Math.sin(v*Math.PI/2)}(E);case v.InterpolationType.EASESINE:return function(v){return-(Math.cos(Math.PI*v)-1)/2}(E);case v.InterpolationType.EASEINEXPO:return function(v){return 0===v?0:Math.pow(2,10*v-10)}(E);case v.InterpolationType.EASEOUTEXPO:return function(v){return 1===v?1:1-Math.pow(2,-10*v)}(E);case v.InterpolationType.EASEEXPO:return function(v){return 0===v?0:1===v?1:v<.5?Math.pow(2,20*v-10)/2:(2-Math.pow(2,-20*v+10))/2}(E);case v.InterpolationType.EASEINELASTIC:return function(v){var A=2*Math.PI/3;return 0===v?0:1===v?1:-Math.pow(2,10*v-10)*Math.sin((10*v-10.75)*A)}(E);case v.InterpolationType.EASEOUTELASTIC:return function(v){var A=2*Math.PI/3;return 0===v?0:1===v?1:Math.pow(2,-10*v)*Math.sin((10*v-.75)*A)+1}(E);case v.InterpolationType.EASEELASTIC:return function(v){var A=2*Math.PI/4.5;return 0===v?0:1===v?1:v<.5?-Math.pow(2,20*v-10)*Math.sin((20*v-11.125)*A)/2:Math.pow(2,-20*v+10)*Math.sin((20*v-11.125)*A)/2+1}(E);case v.InterpolationType.EASEINBOUNCE:return function(v){return 1-l(1-v)}(E);case v.InterpolationType.EASEOUTEBOUNCE:return function(v){return l(v)}(E);case v.InterpolationType.EASEBOUNCE:return function(v){return v<.5?(1-l(1-2*v))/2:(1+l(2*v-1))/2}(E);default:return E}}function l(v){var A=7.5625,E=2.75;return v<1/E?A*v*v:v<2/E?A*(v-=1.5/E)*v+.75:v<2.5/E?A*(v-=2.25/E)*v+.9375:A*(v-=2.625/E)*v+.984375}v.InterpolationType=void 0,(E=v.InterpolationType||(v.InterpolationType={}))[E.LINEAR=0]="LINEAR",E[E.EASEINQUAD=1]="EASEINQUAD",E[E.EASEOUTQUAD=2]="EASEOUTQUAD",E[E.EASEQUAD=3]="EASEQUAD",E.EASEINSINE="easeinsine",E.EASEOUTSINE="easeoutsine",E.EASESINE="easeinoutsine",E.EASEINEXPO="easeinexpo",E.EASEOUTEXPO="easeoutexpo",E.EASEEXPO="easeinoutexpo",E.EASEINELASTIC="easeinelastic",E.EASEOUTELASTIC="easeoutelastic",E.EASEELASTIC="easeinoutelastic",E.EASEINBOUNCE="easeinbounce",E.EASEOUTEBOUNCE="easeoutbounce",E.EASEBOUNCE="easeinoutbounce";var M,O=function(){function t(E,M,O,V,z){void 0===z&&(z=v.InterpolationType.LINEAR),this.start=E,this.end=M,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=z,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.start,this.end,this.lerpTime)},A=r([Component("moveTransformComponent")],t)}(),V=function(){function t(E,M,O,V,z){void 0===z&&(z=v.InterpolationType.LINEAR),this.start=E,this.end=M,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=z,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)},A=r([Component("rotateTransformComponent")],t)}(),z=function(){function t(E,M,O,V,z){void 0===z&&(z=v.InterpolationType.LINEAR),this.start=E,this.end=M,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=z,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)},A=r([Component("scaleTransformComponent")],t)}(),W=function(){function e(A,E,M,O){if(this.speed=[],this.normalizedTime=0,this.currentIndex=0,this.points=A,this.onFinishCallback=M,this.onPointReachedCallback=O,A.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(E>0){for(var V=0,z=[],W=0;W<A.length-1;W++){var H=Vector3.Distance(A[W],A[W+1]);V+=H,z.push(H)}for(W=0;W<z.length;W++)this.speed.push(1/(z[W]/V*E))}else this.normalizedTime=1,this.currentIndex=A.length-2;R.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1]))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)},v=r([Component("followPathComponent")],e)}(),H=function(){function e(A,E,M,O,V,z){if(this.speed=[],this.turnToFaceNext=!1,this.facingNext=!1,this.normalizedTime=0,this.currentIndex=0,this.points=Curve3.CreateCatmullRomSpline(A,M,!!V).getPoints(),this.onFinishCallback=z,this.turnToFaceNext=O||!1,this.points.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(E>0){for(var W=0,H=[],X=0;X<this.points.length-1;X++){var K=Vector3.Distance(this.points[X],this.points[X+1]);W+=K,H.push(K)}for(X=0;X<H.length;X++)this.speed.push(1/(H[X]/W*E))}else this.normalizedTime=1,this.currentIndex=A.length-2;R.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,1==this.turnToFaceNext&&(this.facingNext=!1))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime),this.facingNext||(this.facingNext=!0,this.currentIndex<this.points.length-1?v.lookAt(this.points[this.currentIndex+1]):v.lookAt(this.points[0]))},v=r([Component("followCurvedPathComponent")],e)}(),X=function(){function e(A,E){this.rotationVelocity=A,this.onFinishCallback=E,this.rotation=Quaternion.Identity,this.finished=!1,R.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,v)},e.prototype.hasFinished=function(){return this.finished},e.prototype.assignValueToTransform=function(v){v.rotation=v.rotation.multiply(this.rotation)},e.prototype.stop=function(){this.finished=!0},v=r([Component("keepRotatingComponent")],e)}();v.ToggleState=void 0,(M=v.ToggleState||(v.ToggleState={}))[M.Off=0]="Off",M[M.On=1]="On";var K=function(){function t(A,E){void 0===A&&(A=v.ToggleState.On),this.enabled=!0,this.state=v.ToggleState.Off,this.set(A),E&&this.setCallback(E)}return t.prototype.set=function(v){this.state=v,this.onValueChangedCallback&&this.onValueChangedCallback(v)},t.prototype.toggle=function(){this.enabled&&this.set(1-this.state)},t.prototype.isOn=function(){return this.state==v.ToggleState.On},t.prototype.setCallback=function(v){this.onValueChangedCallback=v},r([Component("toggle")],t)}(),Z=function(){function e(){this._components=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var A,E;try{for(var R=s(this._components),M=R.next();!M.done;M=R.next())if(v==M.value)return}catch(v){A={error:v}}finally{try{M&&!M.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this._components.push(v)},e.prototype.update=function(v){var A=this;this._components.forEach((function(E){A.updateComponent(v,E)}))},e.prototype.updateComponent=function(v,A){var E=engine.getEntitiesWithComponent(A);for(var R in E)if(E.hasOwnProperty(R)){var M=E[R],O=M.getComponent(A);O.elapsedTime+=v,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(M)}},e._instance=null,e}(),J=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(v){R.onTimeReachedCallback&&R.onTimeReachedCallback(),v.removeComponent(R)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerDelay")],e)}(),$=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(v){R.onTimeReachedCallback&&R.onTimeReachedCallback(),v.removeComponent(R),engine.removeEntity(v)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerExpireIn")],e)}(),ee=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(){R.elapsedTime=0,R.onTimeReachedCallback&&R.onTimeReachedCallback()}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerInterval")],e)}();function I(v,A,E,R,M,O){var V=new Entity;V.addComponent(new Transform(O||{position:new Vector3(0,1.5,0)})),V.setParent(A);var z=new TextShape(v);return z.fontSize=M||3,z.color=R||Color3.Black(),V.addComponent(z),E&&V.addComponent(new Billboard),engine.addEntity(V),V}var ne,oe,ie=function(){function e(){this._triggers={},e._instance=this,this._cameraTriggerWrapper=new se(new P(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(le)}return Object.defineProperty(e,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},e.prototype.update=function(){var v=this,A=this._componentGroup.entities;for(var E in A.forEach((function(A){v.shouldWrapTriggerEntity(A)&&v.wrapTriggerEntity(A)})),this._triggers)if(this._triggers.hasOwnProperty(E)){var R=this._triggers[E];R.isDebugging()&&R.updateDebugEntity(),R.isInEngine()?null!=R.trigger&&R.trigger.enabled?(R.wasEnabled||R.isDebugging()&&R.addDebugEntity(),R.wasEnabled=!0,(R.trigger.onCameraEnter||R.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(R),(R.trigger.onTriggerEnter||R.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(R)):R.wasEnabled&&(R.wasEnabled=!1,R.isDebugging()&&R.removeDebugEntity(),e.removeTriggerFromSystem(R)):(R.isDebugging()&&R.removeDebugEntity(),e.removeTriggerFromSystem(R),delete this._triggers[E])}},e.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},e.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new ae(v)},e.removeTriggerFromSystem=function(v){for(var A,E=v.getActiveCollisions(),R=0;R<E.length;R++)!(E[R]===(null===(A=e._instance)||void 0===A?void 0:A._cameraTriggerWrapper)||null==E[R].trigger)&&E[R].trigger.onTriggerExit&&v.entity&&E[R].trigger.onTriggerExit(v.entity),E[R].disengageActiveCollision(v),v.disengageActiveCollision(E[R])},e.disengageCollision=function(v,A){v.disengageActiveCollision(A),A.disengageActiveCollision(v),v.trigger.onTriggerExit&&A.entity&&v.trigger.onTriggerExit(A.entity),A.trigger.onTriggerExit&&v.entity&&A.trigger.onTriggerExit(v.entity)},e.engageCollision=function(v,A){v.engageCollision(A),A.engageCollision(v),v.trigger.onTriggerEnter&&A.entity&&v.trigger.onTriggerEnter(A.entity),A.trigger.onTriggerEnter&&v.entity&&A.trigger.onTriggerEnter(v.entity)},e.prototype.checkCollisionAgainstCamera=function(v){var A=v.hasActiveCollision(this._cameraTriggerWrapper),E=e.areColliding(v,this._cameraTriggerWrapper);A&&!E?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!A&&E&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},e.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var A in this._triggers)if(this._triggers.hasOwnProperty(A)&&A!=v.uuid&&this._triggers[A].trigger.enabled&&e.canTriggersCollide(v,this._triggers[A])){var E=v.hasActiveCollision(this._triggers[A]),R=e.areColliding(v,this._triggers[A]);E&&!R?e.disengageCollision(v,this._triggers[A]):!E&&R&&e.engageCollision(v,this._triggers[A])}},e.canTriggersCollide=function(v,A){return 0==v.trigger.triggeredByLayer||0!=(A.trigger.layer&v.trigger.triggeredByLayer)},e.areColliding=function(v,A){return v.getShape()instanceof P&&A.getShape()instanceof P?e.areCollidingAABB(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof k&&A.getShape()instanceof k?e.areCollidingSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof P&&A.getShape()instanceof k?e.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof k&&A.getShape()instanceof P&&e.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),v.getGlobalPosition(),v.getShape())},e.areCollidingAABB=function(v,A,E,R){var M=e.getBoxShapeValues(v,A),O=e.getBoxShapeValues(E,R);return M.min.x<=O.max.x&&M.max.x>=O.min.x&&M.min.y<=O.max.y&&M.max.y>=O.min.y&&M.min.z<=O.max.z&&M.max.z>=O.min.z},e.areCollidingSphere=function(v,A,E,R){return Vector3.DistanceSquared(v.add(A.position),E.add(R.position))<A.radius*A.radius+R.radius*R.radius},e.areCollidingAABBSphere=function(v,A,E,R){var M=e.getBoxShapeValues(v,A),O=E.add(R.position),V=R.radius,z=0;return O.x<M.min.x&&(z+=(M.min.x-O.x)*(M.min.x-O.x)),O.x>M.max.x&&(z+=(O.x-M.max.x)*(O.x-M.max.x)),O.y<M.min.y&&(z+=(M.min.y-O.y)*(M.min.y-O.y)),O.y>M.max.y&&(z+=(O.y-M.max.y)*(O.y-M.max.y)),O.z<M.min.z&&(z+=(M.min.z-O.z)*(M.min.z-O.z)),O.z>M.max.z&&(z+=(O.z-M.max.z)*(O.z-M.max.z)),z<V*V},e.getBoxShapeValues=function(v,A){var E=v.add(A.position);return{center:E,min:E.subtract(A.size.scale(.5)),max:E.add(A.size.scale(.5))}},e._instance=null,e}(),ae=function(){function e(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(le),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),e.prototype.getGlobalPosition=function(){return this._entity?e.getEntityWorldPosition(this._entity):Vector3.Zero()},e.prototype.getShape=function(){return this._trigger.shape},e.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},e.prototype.getActiveCollisions=function(){var v=[];for(var A in this._collidingWith)this._collidingWith.hasOwnProperty(A)&&v.push(this._collidingWith[A]);return v},e.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},e.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},e.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},e.prototype.isDebugging=function(){return this._isDebug},e.prototype.addDebugEntity=function(){return o(this,void 0,void 0,(function(){var v,E,R;return a(this,(function(M){switch(M.label){case 0:return[4,!A.isPreviewMode()];case 1:return M.sent()||(e._debugMaterial||(e._debugMaterial=new Material,e._debugMaterial.alphaTest=.5),null==this._debugEntity&&(this._debugEntity=new Entity,v=new Transform,this._debugEntity.addComponent(v),this._debugEntity.addComponent(e._debugMaterial),this.getShape()instanceof P&&((E=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(E),v.scale=this.getShape().size),this.getShape()instanceof k&&((E=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(E),R=this.getShape().radius,v.scale=new Vector3(R,R,R))),engine.addEntity(this._debugEntity)),[2]}}))}))},e.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},e.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},e.getEntityWorldPosition=function(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),E=v.getParent();if(null!=E){var R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(E).add(A.rotate(R))}return A},e._debugMaterial=null,e}(),se=function(v){function t(A){var E=v.call(this)||this;return E._shape=A,E._uuid="cameraTrigger",E}return i(t,v),t.prototype.getGlobalPosition=function(){return Camera.instance.position},t.prototype.getShape=function(){return this._shape},t.prototype.setShape=function(v){this._shape=v},t.prototype.isInEngine=function(){return!1},t.prototype.hasActiveCollision=function(v){return!1},t.prototype.disengageActiveCollision=function(v){},t.prototype.engageCollision=function(v){},t.prototype.isDebugging=function(){return!1},t}(ae),le=function(){function e(v,A){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,this._debugEnabled=!1,ie.createAndAddToEngine(),this.shape=v,A&&(A.layer&&(this.layer=A.layer),A.triggeredByLayer&&(this.triggeredByLayer=A.triggeredByLayer),A.onTriggerEnter&&(this.onTriggerEnter=A.onTriggerEnter),A.onTriggerExit&&(this.onTriggerExit=A.onTriggerExit),A.onCameraEnter&&(this.onCameraEnter=A.onCameraEnter),A.onCameraExit&&(this.onCameraExit=A.onCameraExit),A.enableDebug&&(this._debugEnabled=A.enableDebug))}return Object.defineProperty(e.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),r([Component("triggerComponent")],e)}(),P=function(v,A){void 0===v&&(v=Vector3.One().scale(2)),void 0===A&&(A=Vector3.Zero()),this.size=v,this.position=A},k=function(v,A){void 0===v&&(v=2),void 0===A&&(A=Vector3.Zero()),this.radius=v,this.position=A};v.ActionsSequenceSystem=function(){function e(v){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,v&&this.startSequence(v)}return e.prototype.startSequence=function(v){this.beginSequenceNode=v.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.setOnFinishCallback=function(v){this.onFinishCallback=v},e.prototype.isRunning=function(){return this.running},e.prototype.stop=function(){this.running=!1},e.prototype.resume=function(){null!=this.beginSequenceNode&&(this.running=!0)},e.prototype.reset=function(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.getRunningAction=function(){var v=this.currentSequenceNode;if(this.currentSequenceNode instanceof ue)do{v=v.currentInnerSequence}while(v instanceof ue);return v.action},e.prototype.update=function(v){this.running&&(this.started?this.currentSequenceNode.hasFinish()?(this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())):this.currentSequenceNode.update(v):(this.currentSequenceNode.onStart(),this.started=!0))},e}(),ne=v.ActionsSequenceSystem||(v.ActionsSequenceSystem={}),oe=function(){function e(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}return e.prototype.then=function(v){if(null==this.currentSequenceNode)this.currentSequenceNode=new ce,this.currentSequenceNode.action=v,this.beginSequenceNode=this.currentSequenceNode;else{var A=new ce;A.action=v,this.currentSequenceNode=this.currentSequenceNode.then(A)}return this},e.prototype.if=function(v){var A=new de(v);return null==this.currentSequenceNode?(this.currentSequenceNode=A,this.beginSequenceNode=A):this.currentSequenceNode=this.currentSequenceNode.then(A),this},e.prototype.else=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof de))throw new Error("IF statement is needed to be called before ELSE statement.");v.closed=!0;var A=new he(v);return this.currentSequenceNode=this.currentSequenceNode.then(A),this},e.prototype.endIf=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof de||v instanceof he))throw new Error("IF statement is needed to be called before ENDIF statement.");return v.closed=!0,this},e.prototype.while=function(v){var A=new me(v);return null==this.currentSequenceNode?(this.currentSequenceNode=A,this.beginSequenceNode=A):this.currentSequenceNode=this.currentSequenceNode.then(A),this.whileNodeStack.push(A),this},e.prototype.endWhile=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof me))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return v.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1),this},e.prototype.breakWhile=function(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this.currentSequenceNode=this.currentSequenceNode.then(new fe(this.whileNodeStack[this.whileNodeStack.length-1])),this},e}(),ne.SequenceBuilder=oe;var ce=function(){function e(){this.action=null,this.next=null}return e.prototype.then=function(v){return this.next=v,v},e.prototype.onStart=function(){this.action&&this.action.onStart()},e.prototype.update=function(v){this.action&&this.action.update(v)},e.prototype.onFinish=function(){this.action&&this.action.onFinish()},e.prototype.hasFinish=function(){return!this.action||this.action.hasFinished},e.prototype.getSequence=function(){return this},e}(),ue=function(v){function t(){var A=null!==v&&v.apply(this,arguments)||this;return A.currentInnerSequence=null,A.startingInnerSequence=null,A.closed=!1,A}return i(t,v),t.prototype.then=function(v){if(null==this.currentInnerSequence)this.currentInnerSequence=v,this.startingInnerSequence=v;else{if(this.closed)return this.next=v,v;this.currentInnerSequence=this.currentInnerSequence.then(v)}return this},t.prototype.onStart=function(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.onFinish=function(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()},t.prototype.hasFinish=function(){return null==this.currentInnerSequence},t.prototype.getSequence=function(){if(this.currentInnerSequence){var v=this.currentInnerSequence.getSequence();if(v instanceof t&&!v.closed)return v}return this},t}(ce),de=function(v){function t(A){var E=v.call(this)||this;return E.result=!1,E.condition=A,E}return i(t,v),t.prototype.onStart=function(){this.result=this.condition(),this.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(ue),he=function(v){function t(A){var E=v.call(this)||this;return E.ifSequence=null,E.ifSequence=A,E}return i(t,v),t.prototype.onStart=function(){this.ifSequence&&!this.ifSequence.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(ue),me=function(v){function t(A){var E=v.call(this)||this;return E.breakWhile=!1,E.condition=A,E}return i(t,v),t.prototype.onStart=function(){this.breakWhile=!1,this.condition()?v.prototype.onStart.call(this):this.currentInnerSequence=null},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.hasFinish=function(){return this.breakWhile||!this.condition()},t}(ue),fe=function(v){function t(A){var E=v.call(this)||this;return E.whileNode=A,E}return i(t,v),t.prototype.onStart=function(){this.whileNode.breakWhile=!0},t}(ce);v.Delay=J,v.ExpireIn=$,v.FollowCurvedPathComponent=H,v.FollowPathComponent=W,v.Interpolate=h,v.Interval=ee,v.KeepRotatingComponent=X,v.MoveTransformComponent=O,v.RotateTransformComponent=V,v.ScaleTransformComponent=z,v.SequenceNode=ce,v.ToggleComponent=K,v.TransformSystem=R,v.TriggerBoxShape=P,v.TriggerComponent=le,v.TriggerSphereShape=k,v.TriggerSystem=ie,v.addLabel=I,v.addOneTimeTrigger=function(v,A,E){var R=!1,M=!1,O=new Entity;O.addComponent(new Transform({}));var V={};return A.layer&&(V.layer=A.layer),A.triggeredByLayer&&(V.triggeredByLayer=A.triggeredByLayer),A.onCameraEnter&&(V.onCameraEnter=function(){R||(R=!0,A.onCameraEnter()),!R&&A.onCameraEnter||!M&&A.onCameraExit||engine.removeEntity(O)}),A.onCameraExit&&(V.onCameraExit=function(){M||(M=!0,A.onCameraExit()),!R&&A.onCameraEnter||!M&&A.onCameraExit||engine.removeEntity(O)}),A.enableDebug&&(V.enableDebug=A.enableDebug),O.addComponent(new le(v,V)),E&&O.setParent(E),engine.addEntity(O),O},v.addTestCube=function(v,E,R,M,O,V,z){return o(this,void 0,void 0,(function(){var W,H,X;return a(this,(function(K){switch(K.label){case 0:return(W=!z)?[4,!A.isPreviewMode()]:[3,2];case 1:W=K.sent(),K.label=2;case 2:return W?[2]:((H=new Entity).addComponent(new Transform(v)),O?(H.addComponent(new SphereShape),H.getComponent(Transform).scale.setAll(.5)):H.addComponent(new BoxShape),engine.addEntity(H),H.addComponent(new OnPointerDown(E,{hoverText:R||"click",button:ActionButton.POINTER})),M&&((X=new Material).albedoColor=M,H.addComponent(X)),V&&(H.getComponent(BoxShape).withCollisions=!1),R&&I(R,H,!0),[2,H])}}))}))},v.clamp=function(v,A,E){var R=v;return v>E?R=E:v<A&&(R=A),R},v.getEntityWorldPosition=function e(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),E=v.getParent();if(null!=E&&"0"!=E.uuid){if("FirstPersonCameraEntityReference"==E.uuid){var R=Camera.instance.rotation.clone();return Camera.instance.position.clone().add(A.rotate(R))}if("AvatarEntityReference"==E.uuid){var M=Camera.instance.rotation;return R=Quaternion.Euler(0,M.eulerAngles.y,0),Camera.instance.position.clone().add(A.rotate(R)).add(new Vector3(0,-.875,0))}return R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity,e(E).add(A.rotate(R))}return A},v.getEntityWorldRotation=function e(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).rotation.clone():Quaternion.Zero(),E=v.getParent();if(null!=E&&"0"!=E.uuid){if("FirstPersonCameraEntityReference"==E.uuid){var R=Camera.instance.rotation.clone();return A.multiply(R)}return"AvatarEntityReference"==E.uuid?(R=Quaternion.Euler(0,Camera.instance.rotation.eulerAngles.y,0),A.multiply(R)):(R=e(E),A.multiply(R))}return A},v.map=function(v,A,E,R,M){return(v-A)/(E-A)*(M-R)+R},v.sendRequest=function(v,A,E,R){return o(this,void 0,void 0,(function(){var M,O,V;return a(this,(function(z){switch(z.label){case 0:return z.trys.push([0,6,,7]),M={method:A||"GET"},E&&(M.headers=E),R&&(M.body=JSON.stringify(R)),[4,fetch(v,M)];case 1:O=z.sent(),z.label=2;case 2:return z.trys.push([2,4,,5]),[4,O.json()];case 3:return[2,z.sent()];case 4:return z.sent(),[2,O];case 5:return[3,7];case 6:return V=z.sent(),log("error fetching from ",v," : ",V),[3,7];case 7:return[2]}}))}))},v.setTimeout=function(v,A){var E=new Entity;return E.addComponent(new J(v,(function(){A(),engine.removeEntity(E)}))),engine.addEntity(E),E},Object.defineProperty(v,"__esModule",{value:!0})})),function(v,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define("@dcl/npc-scene-utils",["exports"],A):A((v="undefined"!=typeof globalThis?globalThis:v||self)["@dcl/npc-scene-utils"]={})}(this,(function(v){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(v,A){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])})(v,A)};function i(v,A){function o(){this.constructor=v}e(v,A),v.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}function o(v,A,E,R){var M,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(v,A,E,R);else for(var z=v.length-1;z>=0;z--)(M=v[z])&&(V=(O<3?M(V):O>3?M(A,E,V):M(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V}function n(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var A=o([Component("trackUserFlag")],(function(v,A,R){this.lockXZRotation=!1,this.active=!1,E||(E=!0,engine.addSystem(new M)),this.lockXZRotation=v||!1,this.rotSpeed=A||2,R&&(this.active=!0)})),E=!1,R=Camera.instance,M=function(){function t(){this.followingNPCs=engine.getComponentGroup(A)}return t.prototype.update=function(v){var E,M;try{for(var O=n(this.followingNPCs.entities),V=O.next();!V.done;V=O.next()){var z=V.value,W=z.getComponent(Transform),H=z.getComponent(A);if(H.active){var X=new Vector3(R.position.x,R.position.y,R.position.z).subtract(W.position);W.rotation=Quaternion.Slerp(W.rotation,Quaternion.LookRotation(X),v*H.rotSpeed),H.lockXZRotation&&(W.rotation.x=0,W.rotation.z=0)}}}catch(v){E={error:v}}finally{try{V&&!V.done&&(M=O.return)&&M.call(O)}finally{if(E)throw E.error}}},t}(),O=new UICanvas;O.visible=!0;var V,z,W=new Font(Fonts.SanFrancisco),H=new Font(Fonts.SanFrancisco_Heavy),X=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),K=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),Z=new Texture("https://decentraland.org/images/ui/dialog-bubbles.png");function b(v,A,E,R){void 0===E&&(E=512),void 0===R&&(R=512),function(v,A,E,R,M){v.uvs=[A.x,A.y,E.x,E.y,R.x,R.y,M.x,M.y,A.x,A.y,E.x,E.y,R.x,R.y,M.x,M.y]}(v,new Vector2(A.sourceLeft/E,(R-A.sourceTop-A.sourceHeight)/R),new Vector2((A.sourceLeft+A.sourceWidth)/E,(R-A.sourceTop-A.sourceHeight)/R),new Vector2((A.sourceLeft+A.sourceWidth)/E,(R-A.sourceTop)/R),new Vector2(A.sourceLeft/E,(R-A.sourceTop)/R))}function T(v,A){v.sourceWidth=A.sourceWidth,v.sourceHeight=A.sourceHeight,v.sourceLeft=A.sourceLeft?A.sourceLeft:0,v.sourceTop=A.sourceTop?A.sourceTop:0}function C(v){var A=-10-4*v;return A>-65?A:-65}(V=v.ButtonStyles||(v.ButtonStyles={})).E="e",V.F="f",V.DARK="dark",V.RED="red",V.ROUNDBLACK="roundblack",V.ROUNDWHITE="roundwhite",V.ROUNDSILVER="roundsilver",V.ROUNDGOLD="roundgold",V.SQUAREBLACK="squareblack",V.SQUAREWHITE="squarewhite",V.SQUARESILVER="squaresilver",V.SQUAREGOLD="squaregold",V.WHITE="white",(z=v.NPCState||(v.NPCState={})).STANDING="standing",z.TALKING="talking",z.FOLLOWPATH="followPath";var J,$={buttons:{buttonE:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonF:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},white:{sourceWidth:174,sourceHeight:46,sourceLeft:698,sourceTop:662},buttonRed:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonDark:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},roundBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},squareBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},roundWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},squareWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},roundSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},squareSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},roundGold:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},squareGold:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567}},buttonLabels:{E:{sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},F:{sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},EBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:766,sourceTop:611},FBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:802,sourceTop:611}},backgrounds:{promptBackground:{sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},promptLargeBackground:{sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},promptSlantedBackground:{sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},NPCDialog:{sourceWidth:766,sourceHeight:248,sourceLeft:22,sourceTop:756}},icons:{closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},checkboxes:{wOff:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},wOn:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},dOff:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},dOn:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},wLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},wLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},dLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},dLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168}},switches:{roundOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},roundRed:{sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},roundGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},squareOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},squareRed:{sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},squareGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501}},bubbles:{short:{sourceWidth:232,sourceHeight:168,sourceLeft:610,sourceTop:834},normal:{sourceWidth:572,sourceHeight:168,sourceLeft:16,sourceTop:834},long:{sourceWidth:994,sourceHeight:306,sourceLeft:12,sourceTop:508},huge:{sourceWidth:994,sourceHeight:478,sourceLeft:12,sourceTop:14}}},ee=function(){function t(A,E){var R=this;oe.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=A,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(A){R.onTimeReachedCallback(),A.removeComponent(v)}}var v;return v=t,t.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=o([Component("npcTimerDelay")],t)}(),ne=engine.getComponentGroup(ee),oe=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){var A,E;try{for(var R=n(ne.entities),M=R.next();!M.done;M=R.next()){var O=M.value,V=O.getComponent(ee);V.elapsedTime+=v,V.elapsedTime>=V.targetTime&&V.onTargetTimeReached(O)}}catch(v){A={error:v}}finally{try{M&&!M.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},t._instance=null,t}();!function(v){v[v.Confirm=0]="Confirm",v[v.Cancel=1]="Cancel",v[v.Next=2]="Next",v[v.Button3=3]="Button3",v[v.Button4=4]="Button4"}(J||(J={}));var ie=.75,ae=-262.5,se=262.5,le=37.5,ce=192,ue=192,de=7.5,he=112.5,me=112.5,fe=-48.75,ye=-48.75,we=19.5,ve=19.5,be=function(){function e(A,E,R,M){var V=this;this.NPCScript=[],this.isDialogOpen=!1,this.isQuestionPanel=!1,this.isFixedScreen=!1,this.activeTextId=0,this.UIOpenTime=0,this.defaultSound=null,this.canvas=O,this.ClickAction=null,this.EButtonAction=null,this.FButtonAction=null,this.defaultPortrait=A||null,this.uiTheme=M||(E?K:X),this.container=new UIContainerRect(O),this.container.adaptWidth=!0,this.container.width="100%",this.container.vAlign="bottom",this.container.positionY=105,this.container.visible=!1,this.panel=new UIImage(this.container,this.uiTheme),T(this.panel,$.backgrounds.NPCDialog),this.panel.width=574.5,this.panel.height=186,this.panel.onClick=new OnClick((function(){V.confirmText(J.Next)})),this.defaultPortraitTexture=new Texture(A?A.path:this.uiTheme.src),this.portrait=new UIImage(this.container,this.defaultPortraitTexture),this.portrait.sourceWidth=A&&A.section?A.section.sourceWidth:256,this.portrait.sourceHeight=A&&A.section?A.section.sourceHeight:256,this.portrait.width=A&&A.width?A.width*ie:ce,this.portrait.height=A&&A.height?A.height*ie:ce,this.portrait.positionX=A&&A.offsetX?A.offsetX*ie+ae:ae,this.portrait.positionY=A&&A.offsetY?A.offsetY*ie+0:0,this.portrait.onClick=new OnClick((function(){V.confirmText(J.Next)})),this.image=new UIImage(this.container,new Texture(this.uiTheme.src)),this.image.sourceWidth=256,this.image.sourceHeight=256,this.image.sourceTop=0,this.image.sourceLeft=0,this.image.width=ue,this.image.height=ue,this.image.positionX=se,this.image.positionY=le,this.image.onClick=new OnClick((function(){V.confirmText(J.Next)})),this.text=new UIText(this.container),this.text.adaptWidth=!1,this.text.textWrapping=!0,this.text.width=345,this.text.positionX=30,this.text.hAlign="center",this.text.vAlign="center",this.text.font=H,this.text.fontSize=18,this.text.hTextAlign="left",this.text.vTextAlign="center",this.text.positionY=de,this.text.fontWeight="normal",this.text.color=E?Color4.White():Color4.Black(),this.text.isPointerBlocker=!1,this.soundEnt=new Entity,this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(Attachable.AVATAR),R&&(this.soundEnt.addComponent(new AudioSource(new AudioClip(R))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=R),this.button1=new Se(this.container,this.uiTheme,"yes",he,fe,(function(){V.confirmText(J.Confirm)}),!1,v.ButtonStyles.E),this.button1.hide(),this.button2=new Se(this.container,this.uiTheme,"no",-60,ye,(function(){V.confirmText(J.Cancel)}),!1,v.ButtonStyles.F),this.button2.hide(),this.button3=new Se(this.container,this.uiTheme,"maybe",-60,-60,(function(){V.confirmText(J.Button3)}),!1,v.ButtonStyles.DARK),this.button3.hide(),this.button4=new Se(this.container,this.uiTheme,"maybe",me,-60,(function(){V.confirmText(J.Button4)}),!1,v.ButtonStyles.DARK),this.button4.hide(),this.skipButton=new Se(this.container,this.uiTheme,"Skip",-225,-75,(function(){V.skipDialogs()}),!1,K?v.ButtonStyles.WHITE:v.ButtonStyles.F),this.skipButton.image.width=60,this.skipButton.image.height=22.5,this.skipButton.label.hTextAlign="left",this.skipButton.label.fontSize=9,this.skipButton.label.positionX=30,this.skipButton.label.font=H,this.skipButton.icon.height=15,this.skipButton.icon.width=15,this.skipButton.icon.positionX=-15,this.skipButton.hide(),this.leftClickIcon=new UIImage(this.container,this.uiTheme),this.leftClickIcon.width=24,this.leftClickIcon.height=36,this.leftClickIcon.positionX=255,this.leftClickIcon.positionY=-60,this.leftClickIcon.visible=!1,T(this.leftClickIcon,E?$.icons.ClickDark:$.icons.ClickWhite),Te.createAndAddToEngine()}return e.prototype.openDialogWindow=function(v,A){var E=this;this.UIOpenTime=+Date.now(),this.NPCScript=v,this.activeTextId=A?"number"==typeof A?A:F(v,A):0;var R=v[this.activeTextId]?v[this.activeTextId]:{text:""};if(R.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(R.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),R.portrait?(this.portrait.source=new Texture(R.portrait.path),this.portrait.positionX=R.portrait.offsetX?R.portrait.offsetX*ie+ae:ae,this.portrait.positionY=R.portrait.offsetY?R.portrait.offsetY*ie+0:0,this.portrait.width=R.portrait.width?R.portrait.width*ie:ce,this.portrait.height=R.portrait.height?R.portrait.height*ie:ce,R.portrait.section&&T(this.portrait,R.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=this.defaultPortraitTexture,this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*ie+ae:ae,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*ie+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*ie:ce,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*ie:ce,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),R.image){var M=R.image;log("setting image to ",M.path),this.image.source=new Texture(M.path),this.image.positionX=M.offsetX?M.offsetX*ie+se:se,this.image.positionY=M.offsetY?M.offsetY*ie+le:le,this.image.width=M.width?M.width*ie:ue,this.portrait.height=M.height?M.height*ie:ue,M.section&&T(this.image,M.section),this.image.visible=!0}else this.image.visible=!1;this.text.fontSize=R.fontSize?R.fontSize*ie:18,this.text.positionY=R.offsetY?R.offsetY*ie+de:de,this.text.positionX=R.offsetX?R.offsetX*ie:0,this.text.visible=!0,this.container.visible=!0,Te._instance.newText(this,R.text,this.activeTextId,R.typeSpeed?R.typeSpeed:void 0),this.ClickAction||(this.ClickAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,!1,(function(v){!E.isDialogOpen||+Date.now()-E.UIOpenTime<100||(Te._instance.done?E.isQuestionPanel||E.isFixedScreen||E.confirmText(J.Next):Te._instance.rush())})),this.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){E.isDialogOpen&&E.isQuestionPanel&&Te._instance.done&&+Date.now()-E.UIOpenTime>100&&E.confirmText(J.Confirm)})),this.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){E.isDialogOpen&&E.isQuestionPanel&&Te._instance.done&&+Date.now()-E.UIOpenTime>100?E.confirmText(J.Cancel):E.isDialogOpen&&R.skipable&&+Date.now()-E.UIOpenTime>100&&E.skipDialogs()}))),this.layoutDialogWindow(this.activeTextId),this.isDialogOpen=!0},e.prototype.confirmText=function(v){var A=this.NPCScript[this.activeTextId];if(v==J.Next&&!A.isQuestion){if(A.triggeredByNext&&A.triggeredByNext(),A.isEndOfDialog)return void this.closeDialogWindow();this.activeTextId++}v==J.Confirm&&A.buttons&&A.buttons.length>=1&&("number"==typeof A.buttons[0].goToDialog?this.activeTextId=A.buttons[0].goToDialog:this.activeTextId=F(this.NPCScript,A.buttons[0].goToDialog),A.buttons[0].triggeredActions&&A.buttons[0].triggeredActions()),v==J.Cancel&&A.buttons&&A.buttons.length>=2&&("number"==typeof A.buttons[1].goToDialog?this.activeTextId=A.buttons[1].goToDialog:this.activeTextId=F(this.NPCScript,A.buttons[1].goToDialog),A.buttons[1].triggeredActions&&A.buttons[1].triggeredActions()),v==J.Button3&&A.buttons&&A.buttons.length>=3&&("number"==typeof A.buttons[2].goToDialog?this.activeTextId=A.buttons[2].goToDialog:this.activeTextId=F(this.NPCScript,A.buttons[2].goToDialog),A.buttons[2].triggeredActions&&A.buttons[2].triggeredActions()),v==J.Button4&&A.buttons&&A.buttons.length>=4&&("number"==typeof A.buttons[3].goToDialog?this.activeTextId=A.buttons[3].goToDialog:this.activeTextId=F(this.NPCScript,A.buttons[3].goToDialog),A.buttons[3].triggeredActions&&A.buttons[3].triggeredActions()),A=this.NPCScript[this.activeTextId],Te._instance.newText(this,A.text,this.activeTextId,A.typeSpeed?A.typeSpeed:void 0)},e.prototype.layoutDialogWindow=function(v){var A=this,E=this.NPCScript[v]?this.NPCScript[v]:{text:""},R=E.offsetY?E.offsetY*ie+de:de;if(E.buttons&&E.buttons.length>=3?R+=37.5:E.buttons&&E.buttons.length>=1&&(R+=18),this.text.fontSize=E.fontSize?E.fontSize*ie:18,this.text.positionY=R,E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),E.portrait?(this.portrait.source=new Texture(E.portrait.path),this.portrait.positionX=E.portrait.offsetX?E.portrait.offsetX*ie+ae:ae,this.portrait.positionY=E.portrait.offsetY?E.portrait.offsetY*ie+0:0,this.portrait.width=E.portrait.width?E.portrait.width*ie:ce,this.portrait.height=E.portrait.height?E.portrait.height*ie:ce,E.portrait.section&&T(this.portrait,E.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=new Texture(this.defaultPortrait.path),this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*ie+ae:ae,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*ie+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*ie:ce,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*ie:ce,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),this.image.visible=!1,E.image){var M=E.image;log("setting image to ",M.path),this.image.source=new Texture(M.path),this.image.positionX=M.offsetX?M.offsetX*ie+se:se,this.image.positionY=M.offsetY?M.offsetY*ie+le:le,this.image.width=E.image.width?E.image.width*ie:ue,this.image.height=E.image.height?E.image.height*ie:ue,M.section&&T(this.image,M.section),this.image.visible=!0}else this.image.visible=!1;this.isQuestionPanel=!!E.isQuestion&&E.isQuestion,this.isFixedScreen=!!E.isFixedScreen&&E.isFixedScreen,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.leftClickIcon.visible=!1,E.isQuestion?(this.skipButton.hide(),E.buttons&&E.buttons.length>=1&&this.button1.update(E.buttons[0].label,E.buttons[0].offsetX?E.buttons[0].offsetX*ie+he:he,E.buttons.length>=3?E.buttons[0].offsetY?E.buttons[0].offsetY*ie-15:-15:E.buttons[0].offsetY?E.buttons[0].offsetY*ie+fe:fe),E.buttons&&E.buttons.length>=2&&this.button2.update(E.buttons[1].label,E.buttons[1].offsetX*ie?E.buttons[1].offsetX*ie-60:-60,E.buttons.length>=3?E.buttons[1].offsetY*ie?E.buttons[1].offsetY*ie-15:-15:E.buttons[1].offsetY*ie?E.buttons[1].offsetY*ie+ye:ye),E.buttons&&E.buttons.length>=3&&this.button3.update(E.buttons[2].label,E.buttons[2].offsetX*ie?E.buttons[2].offsetX*ie-60:-60,E.buttons[2].offsetY*ie?E.buttons[2].offsetY*ie-60:-60),E.buttons&&E.buttons.length>=4&&this.button4.update(E.buttons[3].label,E.buttons[3].offsetX*ie?E.buttons[3].offsetX*ie+me:me,E.buttons[3].offsetY*ie?E.buttons[3].offsetY*ie-60:-60),Ce.addComponentOrReplace(new ee(.7,(function(){E.buttons&&E.buttons.length>=1&&A.button1.show(),E.buttons&&E.buttons.length>=2&&A.button2.show(),E.buttons&&E.buttons.length>=3&&A.button3.show(),E.buttons&&E.buttons.length>=4&&A.button4.show()})))):this.isFixedScreen||(this.leftClickIcon.visible=!0,E.skipable?this.skipButton.show():this.skipButton.hide())},e.prototype.closeDialogWindow=function(){this.isDialogOpen&&(this.isDialogOpen=!1,this.portrait.visible=!1,this.text.value="",this.text.visible=!1,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.skipButton.hide(),this.leftClickIcon.visible=!1,this.container.visible=!1)},e.prototype.skipDialogs=function(){if(this.isDialogOpen&&!(+Date.now()-this.UIOpenTime<100)){for(;this.NPCScript[this.activeTextId]&&this.NPCScript[this.activeTextId].skipable&&!this.NPCScript[this.activeTextId].isQuestion;){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].skipable&&this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}this.confirmText(J.Next)}},e}(),Te=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.UIText=null,this.done=!0,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done&&(this.timer+=v,this.timer>=2/this.speed)){var A=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=A,this.closeTag(A),this.visibleChars>=this.fullText.length&&(this.done=!0,this.visibleChars=this.fullText.length),this.UIText&&(this.UIText.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,A,E,R){this.timer=0,this.done=!1,this.UIText=v.text,this.fullText=A,this.visibleChars=0,R&&R<=0?this.rush():this.speed=R||45,v.layoutDialogWindow(E)},t.prototype.rush=function(){this.done=!0,this.timer=0,this.visibleChars=this.fullText.length,this.UIText&&(this.UIText.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var A=!1,E=!1,R=this.visibleChars-v;R<this.visibleChars;R++)A?">"==this.fullText.substr(R,1)&&(E=!0):"<"==this.fullText.substr(R,1)&&(A=!0);if(A&&!E)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),Se=function(A){function o(E,R,M,O,V,z,H,Z){var J=A.call(this)||this;if(J.icon=null,J.image=new UIImage(E,R),J.image.positionX=O,J.image.positionY=V,J.image.width=130.5,J.image.height=34.5,J.label=new UIText(J.image),J.style=Z||null,J.onClick=z,J.style)switch(J.style){case v.ButtonStyles.E:T(J.image,$.buttons.buttonE),J.label.positionX=18.75,J.icon=new UIImage(J.image,1==H?K:X),J.icon.width=we,J.icon.height=ve,J.icon.hAlign="center",J.icon.vAlign="center",J.icon.isPointerBlocker=!1,T(J.icon,$.buttonLabels.E),J.icon.positionX=C(M.length);break;case v.ButtonStyles.F:T(J.image,$.buttons.buttonF),J.label.positionX=18.75,J.icon=new UIImage(J.image,1==H?K:X),J.icon.width=we,J.icon.height=ve,J.icon.hAlign="center",J.icon.vAlign="center",J.icon.isPointerBlocker=!1,T(J.icon,$.buttonLabels.F),J.icon.positionX=C(M.length);break;case v.ButtonStyles.WHITE:T(J.image,$.buttons.white),J.label.positionX=18.75,J.icon=new UIImage(J.image,1==H?K:X),J.icon.width=we,J.icon.height=ve,J.icon.hAlign="center",J.icon.vAlign="center",J.icon.isPointerBlocker=!1,T(J.icon,$.buttonLabels.FBlack),J.icon.positionX=C(M.length);break;case v.ButtonStyles.RED:T(J.image,$.buttons.buttonRed);break;case v.ButtonStyles.DARK:T(J.image,$.buttons.buttonDark);break;case v.ButtonStyles.ROUNDBLACK:T(J.image,$.buttons.roundBlack);break;case v.ButtonStyles.ROUNDWHITE:T(J.image,$.buttons.roundWhite);break;case v.ButtonStyles.ROUNDSILVER:T(J.image,$.buttons.roundSilver);break;case v.ButtonStyles.ROUNDGOLD:T(J.image,$.buttons.roundGold);break;case v.ButtonStyles.SQUAREBLACK:T(J.image,$.buttons.squareBlack);break;case v.ButtonStyles.SQUAREWHITE:T(J.image,$.buttons.squareWhite);break;case v.ButtonStyles.SQUARESILVER:T(J.image,$.buttons.squareSilver);break;case v.ButtonStyles.SQUAREGOLD:T(J.image,$.buttons.squareGold)}else T(J.image,$.buttons.roundSilver);return J.label.value=M,J.label.hTextAlign="center",J.label.vTextAlign="center",J.label.fontSize=15,J.label.font=W,J.label.color=Z==v.ButtonStyles.ROUNDWHITE||Z==v.ButtonStyles.SQUAREWHITE||Z==v.ButtonStyles.WHITE?Color4.Black():Color4.White(),J.label.isPointerBlocker=!1,J.image.onClick=new OnClick((function(){J.onClick()})),Z==v.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){J.image.visible&&J.onClick()})):Z==v.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){J.image.visible&&J.onClick()})),J}return i(o,A),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0},o.prototype.update=function(A,E,R){this.label.value=A,this.image.positionX=E,this.image.positionY=R,!this.icon||this.style!=v.ButtonStyles.E&&this.style!=v.ButtonStyles.F||(this.icon.positionX=C(A.length))},o}(Entity),Ce=new Entity;function F(v,A){for(var E=0;E<v.length;E++)if(v[E].name&&v[E].name==A)return E;return 0}engine.addEntity(Ce);var Ee=function(){function t(){this._triggers={},t._instance=this,this._cameraTriggerWrapper=new Ie(new j(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(Pe)}return Object.defineProperty(t,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},t.prototype.update=function(){var v=this,A=this._componentGroup.entities;for(var E in A.forEach((function(A){v.shouldWrapTriggerEntity(A)&&v.wrapTriggerEntity(A)})),this._triggers)if(this._triggers.hasOwnProperty(E)){var R=this._triggers[E];R.isDebugging()&&R.updateDebugEntity(),R.isInEngine()?null!=R.trigger&&R.trigger.enabled?(R.wasEnabled||R.isDebugging()&&R.addDebugEntity(),R.wasEnabled=!0,(R.trigger.onCameraEnter||R.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(R),(R.trigger.onTriggerEnter||R.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(R)):R.wasEnabled&&(R.wasEnabled=!1,R.isDebugging()&&R.removeDebugEntity(),t.removeTriggerFromSystem(R)):(R.isDebugging()&&R.removeDebugEntity(),t.removeTriggerFromSystem(R),delete this._triggers[E])}},t.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},t.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new _e(v)},t.removeTriggerFromSystem=function(v){for(var A,E=v.getActiveCollisions(),R=0;R<E.length;R++)!(E[R]===(null===(A=t._instance)||void 0===A?void 0:A._cameraTriggerWrapper)||null==E[R].trigger)&&E[R].trigger.onTriggerExit&&v.entity&&E[R].trigger.onTriggerExit(v.entity),E[R].disengageActiveCollision(v),v.disengageActiveCollision(E[R])},t.disengageCollision=function(v,A){v.disengageActiveCollision(A),A.disengageActiveCollision(v),v.trigger.onTriggerExit&&A.entity&&v.trigger.onTriggerExit(A.entity),A.trigger.onTriggerExit&&v.entity&&A.trigger.onTriggerExit(v.entity)},t.engageCollision=function(v,A){v.engageCollision(A),A.engageCollision(v),v.trigger.onTriggerEnter&&A.entity&&v.trigger.onTriggerEnter(A.entity),A.trigger.onTriggerEnter&&v.entity&&A.trigger.onTriggerEnter(v.entity)},t.prototype.checkCollisionAgainstCamera=function(v){var A=v.hasActiveCollision(this._cameraTriggerWrapper),E=t.areColliding(v,this._cameraTriggerWrapper);A&&!E?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!A&&E&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},t.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var A in this._triggers)if(this._triggers.hasOwnProperty(A)&&A!=v.uuid&&this._triggers[A].trigger.enabled&&t.canTriggersCollide(v,this._triggers[A])){var E=v.hasActiveCollision(this._triggers[A]),R=t.areColliding(v,this._triggers[A]);E&&!R?t.disengageCollision(v,this._triggers[A]):!E&&R&&t.engageCollision(v,this._triggers[A])}},t.canTriggersCollide=function(v,A){return 0==v.trigger.triggeredByLayer||0!=(A.trigger.layer&v.trigger.triggeredByLayer)},t.areColliding=function(v,A){return v.getShape()instanceof j&&A.getShape()instanceof j?t.areCollidingAABB(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof q&&A.getShape()instanceof q?t.areCollidingSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof j&&A.getShape()instanceof q?t.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof q&&A.getShape()instanceof j&&t.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),v.getGlobalPosition(),v.getShape())},t.areCollidingAABB=function(v,A,E,R){var M=t.getBoxShapeValues(v,A),O=t.getBoxShapeValues(E,R);return M.min.x<=O.max.x&&M.max.x>=O.min.x&&M.min.y<=O.max.y&&M.max.y>=O.min.y&&M.min.z<=O.max.z&&M.max.z>=O.min.z},t.areCollidingSphere=function(v,A,E,R){return Vector3.DistanceSquared(v.add(A.position),E.add(R.position))<A.radius*A.radius+R.radius*R.radius},t.areCollidingAABBSphere=function(v,A,E,R){var M=t.getBoxShapeValues(v,A),O=E.add(R.position),V=R.radius,z=0;return O.x<M.min.x&&(z+=(M.min.x-O.x)*(M.min.x-O.x)),O.x>M.max.x&&(z+=(O.x-M.max.x)*(O.x-M.max.x)),O.y<M.min.y&&(z+=(M.min.y-O.y)*(M.min.y-O.y)),O.y>M.max.y&&(z+=(O.y-M.max.y)*(O.y-M.max.y)),O.z<M.min.z&&(z+=(M.min.z-O.z)*(M.min.z-O.z)),O.z>M.max.z&&(z+=(O.z-M.max.z)*(O.z-M.max.z)),z<V*V},t.getBoxShapeValues=function(v,A){var E=v.add(A.position);return{center:E,min:E.subtract(A.size.scale(.5)),max:E.add(A.size.scale(.5))}},t._instance=null,t}(),_e=function(){function t(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(Pe),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),t.prototype.getGlobalPosition=function(){return this._entity?t.getEntityWorldPosition(this._entity):Vector3.Zero()},t.prototype.getShape=function(){return this._trigger.shape},t.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},t.prototype.getActiveCollisions=function(){var v=[];for(var A in this._collidingWith)this._collidingWith.hasOwnProperty(A)&&v.push(this._collidingWith[A]);return v},t.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},t.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},t.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},t.prototype.isDebugging=function(){return this._isDebug},t.prototype.addDebugEntity=function(){if(t._debugMaterial||(t._debugMaterial=new Material,t._debugMaterial.alphaTest=.5),null==this._debugEntity){this._debugEntity=new Entity;var v=new Transform;if(this._debugEntity.addComponent(v),this._debugEntity.addComponent(t._debugMaterial),this.getShape()instanceof j&&((A=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(A),v.scale=this.getShape().size),this.getShape()instanceof q){var A;(A=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(A);var E=this.getShape().radius;v.scale=new Vector3(E,E,E)}}engine.addEntity(this._debugEntity)},t.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},t.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},t.getEntityWorldPosition=function(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),E=v.getParent();if(null!=E){var R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(E).add(A.rotate(R))}return A},t._debugMaterial=null,t}(),Ie=function(v){function e(A){var E=v.call(this)||this;return E._shape=A,E._uuid="cameraTrigger",E}return i(e,v),e.prototype.getGlobalPosition=function(){return Camera.instance.position},e.prototype.getShape=function(){return this._shape},e.prototype.setShape=function(v){this._shape=v},e.prototype.isInEngine=function(){return!1},e.prototype.hasActiveCollision=function(v){return!1},e.prototype.disengageActiveCollision=function(v){},e.prototype.engageCollision=function(v){},e.prototype.isDebugging=function(){return!1},e}(_e),Pe=function(){function t(v,A){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,Ee.createAndAddToEngine(),this.shape=v,this.layer=A&&A.layer?A.layer:0,this.triggeredByLayer=A&&A.triggeredByLayer?A.triggeredByLayer:0,this.onTriggerEnter=A&&A.onTriggerEnter?A.onTriggerEnter:void 0,this.onTriggerExit=A&&A.onTriggerExit?A.onTriggerExit:void 0,this.onCameraEnter=A&&A.onCameraEnter?A.onCameraEnter:void 0,this.onCameraExit=A&&A.onCameraExit?A.onCameraExit:void 0,this._debugEnabled=!(!A||!A.enableDebug)&&A.enableDebug}return Object.defineProperty(t.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),o([Component("npcTriggerComponent")],t)}(),j=function(v,A){this.size=v,this.position=A},q=function(v,A){this.radius=v,this.position=A},Be=function(){function t(v){this.origin=0,this.target=1,this.fraction=0,this.totalDuration=0,this.speed=[],this.loop=!1,this.path=v,Re.createAndAddToEngine()}return t.prototype.setIndex=function(v){this.fraction=0,this.origin=v,this.target=v+1<this.path.length?v+1:0},o([Component("npclerpData")],t)}(),ke=[],Re=function(){function e(){e._instance=this}return e.prototype.update=function(A){var E,R;try{for(var M=n(ke),O=M.next();!O.done;O=M.next()){var V=O.value;if(V.state==v.NPCState.FOLLOWPATH){var z=V.getComponent(Transform),W=V.getComponent(Be);if(W.fraction<1)W.fraction+=A*W.speed[W.origin],z.position=Vector3.Lerp(W.path[W.origin],W.path[W.target],W.fraction);else{if(W.origin=W.target,W.target+=1,W.target>=W.path.length){if(!W.loop)return V.stopWalking(),W.onFinishCallback&&W.onFinishCallback(),void(W.fraction=1);W.target=0}else W.onReachedPointCallback&&W.onReachedPointCallback();W.fraction=0,z.lookAt(W.path[W.target])}}}}catch(v){E={error:v}}finally{try{O&&!O.done&&(R=M.return)&&R.call(M)}finally{if(E)throw E.error}}},e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e._instance=null,e}(),Oe=100,Le=function(){function t(v,A,E){this.NPCScript=[],this.isBubleOpen=!1,this.activeTextId=0,this.defaultSound=null,this.baseYOffset=2.5,this.baseYOffset=A||2.5,this.rootEntity=new Entity,this.rootEntity.addComponent(new Billboard(!1,!0,!1)),this.rootEntity.addComponent(new Transform),this.rootEntity.setParent(v),this.container=new Entity,this.container.addComponent(new Transform({position:new Vector3(-.1,this.baseYOffset,0)})),this.container.setParent(this.rootEntity),this.material=new BasicMaterial,this.material.texture=Z,this.panel=new Entity,this.panel.addComponent(new Transform({scale:new Vector3(2,1,1)})),this.panel.setParent(this.container),this.panel.addComponent(new PlaneShape),this.panel.addComponent(this.material),this.panel.getComponent(PlaneShape).visible=!1,b(this.panel.getComponent(PlaneShape),$.bubbles.normal,1024,1024),this.text=new Entity,this.text.addComponent(new Transform({position:new Vector3(0,0,.05),rotation:Quaternion.Euler(0,180,0)})),this.text.addComponent(new TextShape("")),this.text.setParent(this.container),this.text.getComponent(TextShape).textWrapping=!0,this.text.getComponent(TextShape).font=H,this.text.getComponent(TextShape).hTextAlign="center",this.text.getComponent(TextShape).vTextAlign="center",this.text.getComponent(TextShape).fontSize=1,this.text.getComponent(TextShape).fontWeight="normal",this.text.getComponent(TextShape).color=Color3.Black(),this.text.getComponent(TextShape).visible=!1,this.soundEnt=new Entity,E&&(this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(this.container),this.soundEnt.addComponent(new AudioSource(new AudioClip(E))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=E),Ve.createAndAddToEngine()}return t.prototype.openDialogWindow=function(v,A){this.NPCScript=v,this.activeTextId=A?"number"==typeof A?A:function(v,A){for(var E=0;E<v.length;E++)if(v[E].name&&v[E].name==A)return E;return 0}(v,A):0;var E=v[this.activeTextId]?v[this.activeTextId]:{text:""};E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),this.text.getComponent(TextShape).fontSize=E.fontSize?E.fontSize:1,this.text.getComponent(Transform).position.y=E.offsetY?E.offsetY+0:0,this.text.getComponent(Transform).position.x=E.offsetX?E.offsetX:0,this.text.getComponent(TextShape).visible=!0,this.panel.getComponent(PlaneShape).visible=!0,this.text.getComponent(TextShape).value="",E.text.length<Oe&&E.text.slice(0,Oe),Ve._instance.newText(this,E.text,this.activeTextId,E.timeOn?E.timeOn:void 0,E.typeSpeed?E.typeSpeed:void 0),this.adjustBubble(E.text.length),this.layoutDialogWindow(this.activeTextId),this.isBubleOpen=!0},t.prototype.adjustBubble=function(v){v<8?(b(this.panel.getComponent(PlaneShape),$.bubbles.short,1024,1024),this.panel.getComponent(Transform).scale.x=.58,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.1,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=.7):v<25?(b(this.panel.getComponent(PlaneShape),$.bubbles.normal,1024,1024),this.panel.getComponent(Transform).scale.x=1.43,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.5,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=1.5):v<50?(b(this.panel.getComponent(PlaneShape),$.bubbles.long,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=.765,this.container.getComponent(Transform).position.y=this.baseYOffset+0,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2):(b(this.panel.getComponent(PlaneShape),$.bubbles.huge,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=1.195,this.container.getComponent(Transform).position.y=this.baseYOffset+.2,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2)},t.prototype.next=function(){var v=this.NPCScript[this.activeTextId];v||(v=this.NPCScript[this.activeTextId-1]),v.triggeredByNext&&v.triggeredByNext(),v.isEndOfDialog?this.closeDialogWindow():(this.activeTextId++,(v=this.NPCScript[this.activeTextId]).text.length<Oe&&v.text.slice(0,Oe),this.text.getComponent(TextShape).value="",this.adjustBubble(v.text.length),Ve._instance.newText(this,v.text,this.activeTextId,v.timeOn?v.timeOn:void 0,v.typeSpeed?v.typeSpeed:void 0),this.layoutDialogWindow(this.activeTextId))},t.prototype.layoutDialogWindow=function(v){var A=this.NPCScript[v]?this.NPCScript[v]:{text:""},E=A.offsetY?A.offsetY+0:0;A.buttons&&A.buttons.length>=3?E+=50:A.buttons&&A.buttons.length>=1&&(E+=24),this.text.getComponent(TextShape).fontSize=A.fontSize?A.fontSize:1,this.text.getComponent(Transform).position.y=E,A.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(A.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce())},t.prototype.closeDialogWindow=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1)},t.prototype.closeDialogEndAll=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1,Ve._instance.Dialog==this&&(Ve._instance.done=!0))},t.prototype.skipDialogs=function(){if(this.isBubleOpen)for(;this.NPCScript[this.activeTextId];){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}},t}(),Ve=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.Text=null,this.textId=0,this.done=!0,this.showing=!1,this.timeOn=3,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done)if(this.timer+=v,this.showing)this.timer>this.timeOn&&(this.showing=!1,this.done=!0,this.timer=0,this.window.next());else if(this.timer>=2/this.speed){var A=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=A,this.closeTag(A),this.visibleChars>=this.fullText.length&&(this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length),this.Text&&(this.Text.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,A,E,R,M){if(v!=this.Dialog||E!=this.textId){var O=this.Dialog;this.Dialog=v,this.Text=this.Dialog.text.getComponent(TextShape),this.textId=E,O&&v!=O&&O.skipDialogs(),this.timer=0,this.done=!1,this.showing=!1,this.fullText=A,this.visibleChars=0,this.window=v,M&&M<=0?this.rush():this.speed=M||45,this.timeOn=R||3}},t.prototype.rush=function(){this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length,this.Text&&(this.Text.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var A=!1,E=!1,R=this.visibleChars-v;R<this.visibleChars;R++)A?">"==this.fullText.substr(R,1)&&(E=!0):"<"==this.fullText.substr(R,1)&&(A=!0);if(A&&!E)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),Ne=function(E){function o(R,M,O,V){var z=E.call(this)||this;z.introduced=!1,z.onWalkAway=null,z.inCooldown=!1,z.coolDownDuration=5,z.faceUser=!1,z.walkingAnim=null,z.walkingSpeed=2,z.bubbleHeight=2,z.addComponent(new GLTFShape(M)),z.addComponent(new Transform(R)),engine.addEntity(z),z.state=v.NPCState.STANDING,V&&V.noUI||(V&&V.portrait?z.dialog=new be("string"==typeof V.portrait?{path:V.portrait}:V.portrait,!(!V||!V.darkUI)&&V.darkUI,V.dialogSound?V.dialogSound:void 0):z.dialog=new be(void 0,!(!V||!V.darkUI)&&V.darkUI,V&&V.dialogSound?V.dialogSound:void 0)),V&&V.textBubble&&(V&&V.bubbleHeight&&(z.bubbleHeight=V.bubbleHeight),z.bubble=new Le(z,z.bubbleHeight,V.dialogSound?V.dialogSound:void 0)),z.addComponent(new Animator),z.idleAnim=new AnimationState(V&&V.idleAnim?V.idleAnim:"Idle",{looping:!0}),z.getComponent(Animator).addClip(z.idleAnim),z.lastPlayedAnim=z.idleAnim,z.idleAnim.play(),V&&V.walkingAnim&&(z.walkingAnim=new AnimationState(V.walkingAnim,{looping:!0}),z.getComponent(Animator).addClip(z.walkingAnim)),z.onActivate=O,V&&V.onWalkAway&&(z.onWalkAway=V.onWalkAway),z.endAnimTimer=new Entity,engine.addEntity(z.endAnimTimer),z.closeDialogTimer=new Entity,engine.addEntity(z.closeDialogTimer),z.pauseWalkingTimer=new Entity,engine.addEntity(z.pauseWalkingTimer);var W=V&&V.onlyClickTrigger?ActionButton.POINTER:ActionButton.PRIMARY;z.addComponent(new OnPointerDown((function(v){z.inCooldown||z.dialog&&z.dialog.isDialogOpen||z.activate()}),{button:W,hoverText:V&&V.hoverText?V.hoverText:"Talk",showFeedback:!V||!V.onlyExternalTrigger})),V&&V.onlyExternalTrigger&&z.removeComponent(OnPointerDown);var H={};return(!V||V&&!V.continueOnWalkAway)&&(H.onCameraExit=function(){z.handleWalkAway()}),V&&(!V||V.onlyExternalTrigger||V.onlyClickTrigger||V.onlyETrigger)||(H.onCameraEnter=function(){z.inCooldown?log(z.name," in cooldown"):z.dialog&&z.dialog.isDialogOpen||V&&V.onlyExternalTrigger||V&&V.onlyClickTrigger||z.activate()}),(H.onCameraEnter||H.onCameraExit)&&z.addComponent(new Pe(new q(V&&V.reactDistance?V.reactDistance:6,Vector3.Zero()),H)),V&&V.faceUser&&(z.addComponent(new A(!0,V.turningSpeed?V.turningSpeed:void 0)),z.faceUser=!0),V&&V.walkingSpeed&&(z.walkingSpeed=V.walkingSpeed),V&&V.coolDownDuration&&(z.coolDownDuration=V.coolDownDuration),V&&V.path&&(z.addComponent(new Be(V.path?V.path:[])),z.getComponent(Be).loop=!0,ke.push(z),z.followPath()),z}return i(o,E),o.prototype.activate=function(){var v=this;this.faceUser&&(this.getComponent(A).active=!0),this.inCooldown=!0,this.addComponentOrReplace(new ee(this.coolDownDuration,(function(){v.inCooldown=!1}))),this.onActivate()},o.prototype.endInteraction=function(){this.faceUser&&(this.getComponent(A).active=!1),this.dialog&&this.dialog.isDialogOpen&&this.dialog.closeDialogWindow(),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.state=v.NPCState.STANDING},o.prototype.handleWalkAway=function(){this.state!=v.NPCState.FOLLOWPATH&&(this.endInteraction(),this.onWalkAway&&this.onWalkAway())},o.prototype.talk=function(A,E,R){var M=this;this.introduced=!0,this.state=v.NPCState.TALKING,this.closeDialogTimer.hasComponent(ee)&&this.closeDialogTimer.removeComponent(ee),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.dialog.openDialogWindow(A,E||0),R&&this.closeDialogTimer.addComponentOrReplace(new ee(R,(function(){M.dialog.closeDialogWindow()})))},o.prototype.talkBubble=function(v,A){this.bubble||(this.bubble=new Le(this,this.bubbleHeight)),this.bubble.openDialogWindow(v,A||0)},o.prototype.playAnimation=function(v,A,E){var R=this;this.lastPlayedAnim.stop(),this.endAnimTimer.hasComponent(ee)&&this.endAnimTimer.removeComponent(ee);var M=this.getComponent(Animator).getClip(v);A&&(M.looping=!1,E&&this.endAnimTimer.addComponentOrReplace(new ee(E,(function(){M.stop(),R.idleAnim&&(R.idleAnim.play(),R.lastPlayedAnim=R.idleAnim)})))),M.stop(),M.play(),this.lastPlayedAnim=M},o.prototype.changeIdleAnim=function(v,A){this.idleAnim.stop(),this.idleAnim=new AnimationState(v,{looping:!0}),this.getComponent(Animator).addClip(this.idleAnim),A&&(this.lastPlayedAnim.stop(),this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim)},o.prototype.followPath=function(E){if(!this.hasComponent(Be)){if(!E)return;this.addComponent(new Be(E.path?E.path:[])),ke.push(this)}this.faceUser&&(this.getComponent(A).active=!1);var R=this.getComponent(Be);if(E){if(E.path)if(E.curve){var M=Curve3.CreateCatmullRomSpline(E.path,4*E.path.length,!!E.loop).getPoints();E.loop&&M.pop(),R.path=M}else R.path=E.path;null!=E.loop&&(R.loop=E.loop),null!=E.startingPoint&&R.setIndex(E.startingPoint),E.onFinishCallback&&(R.onFinishCallback=E.onFinishCallback),E.onReachedPointCallback&&(R.onReachedPointCallback=E.onReachedPointCallback)}var O=this.getComponent(Transform).position;(0==R.fraction&&R.path[R.origin].subtract(O).lengthSquared()>.1||R.fraction>0&&O.subtract(R.path[R.origin]).normalize()==R.path[R.target].subtract(R.path[R.origin]).normalize())&&(R.path.splice(R.origin,0,this.getComponent(Transform).position),R.fraction=0),this.getComponent(Transform).lookAt(R.path[R.target]);for(var V=0,z=[],W=0;W<R.path.length-1;W++){var H;V+=H=Vector3.Distance(R.path[W],R.path[W+1]),z.push(H)}for(R.loop&&(V+=H=Vector3.Distance(R.path[R.path.length-1],R.path[0]),z.push(H)),E&&E.totalDuration?R.totalDuration=E.totalDuration:E&&E.speed?R.totalDuration=V/E.speed:R.totalDuration||(R.totalDuration=V/this.walkingSpeed),R.speed=[],W=0;W<z.length;W++)R.speed.push(1/(z[W]/V*R.totalDuration));this.walkingAnim&&(this.endAnimTimer.hasComponent(ee)&&this.endAnimTimer.removeComponent(ee),this.idleAnim.stop(),this.lastPlayedAnim.stop(),this.walkingAnim.play(),this.lastPlayedAnim=this.walkingAnim),this.state=v.NPCState.FOLLOWPATH},o.prototype.stopWalking=function(A){var E=this;this.state=v.NPCState.STANDING,this.walkingAnim&&(this.walkingAnim.stop(),this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim),A&&this.pauseWalkingTimer.addComponentOrReplace(new ee(A,(function(){E.dialog&&E.dialog.isDialogOpen||(E.lastPlayedAnim.stop(),E.walkingAnim&&(E.walkingAnim.play(),E.lastPlayedAnim=E.walkingAnim),E.endAnimTimer.hasComponent(ee)&&E.endAnimTimer.removeComponent(ee),E.state=v.NPCState.FOLLOWPATH)})))},o}(Entity);v.CustomDialogButton=Se,v.DialogTypeInSystem=Te,v.DialogWindow=be,v.NPC=Ne,v.NPCDelay=ee,v.NPCLerpData=Be,v.NPCTriggerComponent=Pe,v.SFFont=W,v.SFHeavyFont=H,v.TrackUserFlag=A,v.TriggerBoxShape=j,v.TriggerSphereShape=q,v.canvas=O,v.darkTheme=K,v.lightTheme=X,Object.defineProperty(v,"__esModule",{value:!0})})),function(v,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define("@dcl/ui-scene-utils",["exports"],A):A((v="undefined"!=typeof globalThis?globalThis:v||self)["ui-utils"]={})}(this,(function(v){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(v,A){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])})(v,A)};function i(v,A){function o(){this.constructor=v}e(v,A),v.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}var o=function(){return(o=Object.assign||function(v){for(var A,E=1,R=arguments.length;E<R;E++)for(var M in A=arguments[E])Object.prototype.hasOwnProperty.call(A,M)&&(v[M]=A[M]);return v}).apply(this,arguments)};function n(v,A){var E={};for(var R in v)Object.prototype.hasOwnProperty.call(v,R)&&A.indexOf(R)<0&&(E[R]=v[R]);if(null!=v&&"function"==typeof Object.getOwnPropertySymbols){var M=0;for(R=Object.getOwnPropertySymbols(v);M<R.length;M++)A.indexOf(R[M])<0&&Object.prototype.propertyIsEnumerable.call(v,R[M])&&(E[R[M]]=v[R[M]])}return E}function r(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var A=function(){function t(A,E){var M=this;R.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=A,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(A){M.onTimeReachedCallback(),A.removeComponent(v)}}var v;return v=t,t.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=function(v,A,E,R){var M,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(v,A,E,R);else for(var z=v.length-1;z>=0;z--)(M=v[z])&&(V=(O<3?M(V):O>3?M(A,E,V):M(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V}([Component("UItimerDelay")],t)}(),E=engine.getComponentGroup(A),R=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){var R,M;try{for(var O=r(E.entities),V=O.next();!V.done;V=O.next()){var z=V.value,W=z.getComponent(A);W.elapsedTime+=v,W.elapsedTime>=W.targetTime&&W.onTargetTimeReached(z)}}catch(v){R={error:v}}finally{try{V&&!V.done&&(M=O.return)&&M.call(O)}finally{if(R)throw R.error}}},t._instance=null,t}(),M=new UICanvas;M.visible=!0;var O=new Font(Fonts.SanFrancisco),V=new Font(Fonts.SanFrancisco_Heavy),z=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),W=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),H=new UIText(M);H.vAlign="center",H.hAlign="center",H.hTextAlign="center",H.vTextAlign="center",H.font=O,H.fontSize=60,H.color=new Color4(0,0,0,1),H.visible=!1,H.positionY=80;var X=new UIImage(M,z);X.hAlign="center",X.vAlign="center",X.width=400,X.height=250,X.visible=!1;var K,Z,J,$,ee=function(v){function e(A,E,R,V,z,W,H){var X=v.call(this)||this;return X.canvas=M,X.valueAsNum=A,X.uiText=new UIText(M),X.fixedDigits=H||null,X.uiText.value=X.toFixedLengthString(A),X.uiText.hAlign="right",X.uiText.vAlign="bottom",X.uiText.positionX=E||0,X.uiText.positionY=R||0,X.uiText.fontSize=z||25,X.uiText.font=O,X.uiText.vTextAlign="center",X.uiText.hTextAlign="center",X.uiText.color=V||Color4.White(),X.uiText.outlineColor=Color4.Black(),X.uiText.outlineWidth=W?0:.1,X}return i(e,v),e.prototype.read=function(){return this.valueAsNum},e.prototype.increase=function(v){this.valueAsNum+=v||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.decrease=function(v){this.valueAsNum-=v||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.set=function(v){this.valueAsNum=v,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.toFixedLengthString=function(v){var A=v.toString();if(!this.fixedDigits)return A;for(var E=A.length-this.fixedDigits;E<0;)A="0".concat(A),E+=1;return E>0&&(A=v.toPrecision(this.fixedDigits)),A},e}(Entity);(K=v.PromptStyles||(v.PromptStyles={})).LIGHT="light",K.DARK="dark",K.LIGHTLARGE="lightlarge",K.DARKLARGE="darklarge",K.LIGHTSLANTED="lightslanted",K.DARKSLANTED="darkslanted",(Z=v.BarStyles||(v.BarStyles={})).ROUNDBLACK="roundblack",Z.ROUNDWHITE="roundwhite",Z.ROUNDSILVER="roundsilver",Z.ROUNDGOLD="roundgold",Z.SQUAREBLACK="squareblack",Z.SQUAREWHITE="squarewhite",Z.SQUARESILVER="squaresilver",Z.SQUAREGOLD="squaregold",(J=v.ButtonStyles||(v.ButtonStyles={})).E="e",J.F="f",J.DARK="dark",J.RED="red",J.ROUNDBLACK="roundblack",J.ROUNDWHITE="roundwhite",J.ROUNDSILVER="roundsilver",J.ROUNDGOLD="roundgold",J.SQUAREBLACK="squareblack",J.SQUAREWHITE="squarewhite",J.SQUARESILVER="squaresilver",J.SQUAREGOLD="squaregold",($=v.SwitchStyles||(v.SwitchStyles={})).ROUNDGREEN="roundgreen",$.ROUNDRED="roundred",$.SQUAREGREEN="squaregreen",$.SQUARERED="squarered";var ne={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},oe={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},ie={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},ae={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},se={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},le={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},ce={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},ue={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},de={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},he={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},me={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},fe={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567},ye={sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},we={sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},ve={sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},be={sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},Te={sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},Se={closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},Ce={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},Ee={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},_e={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},Ie={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},Pe={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},Be={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},ke={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},Re={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168},Oe={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},Le={sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},Ve={sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},Ne={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},Fe={sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},Ue={sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501};function S(v,A){v.sourceWidth=A.sourceWidth,v.sourceHeight=A.sourceHeight,v.sourceLeft=A.sourceLeft?A.sourceLeft:0,v.sourceTop=A.sourceTop?A.sourceTop:0}function B(v){var A=-10-4*v;return A>-65?A:-65}var We=function(A){function o(E,R,O,V,W,H,X){var K=A.call(this)||this;if(K.canvas=M,K.valueAsNum=E>1?1:E,K.fullWidth=H?128*H:128,K.background=new UIImage(M,z),K.background.width=H?128*H:128,K.background.height=H?32*H:32,K.background.hAlign="right",K.background.vAlign="bottom",K.background.positionX=R||0,K.background.positionY=O||0,W)switch(W){case v.BarStyles.ROUNDBLACK:S(K.background,se);break;case v.BarStyles.ROUNDWHITE:S(K.background,ce);break;case v.BarStyles.ROUNDSILVER:S(K.background,de);break;case v.BarStyles.ROUNDGOLD:S(K.background,me);break;case v.BarStyles.SQUAREBLACK:S(K.background,le);break;case v.BarStyles.SQUAREWHITE:S(K.background,ue);break;case v.BarStyles.SQUARESILVER:S(K.background,he);break;case v.BarStyles.SQUAREGOLD:S(K.background,fe)}else S(K.background,de);return K.background.sourceWidth=128,K.background.sourceHeight=32,K.background.visible=!0,K.bar=new UIContainerRect(K.background),K.bar.color=V||Color4.Red(),K.bar.thickness=0,K.bar.hAlign="left",K.bar.vAlign="center",K.bar.positionX=H?2.55*H:2.55,K.bar.positionY=0,K.bar.height=H?32*H-7.5*H:24.5,K.bar.width=H?K.fullWidth*K.valueAsNum-5.1*H:K.fullWidth*K.valueAsNum-5.1,X&&K.hide(),K}return i(o,A),o.prototype.read=function(){return this.valueAsNum},o.prototype.increase=function(v){this.valueAsNum+=v||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.decrease=function(v){this.valueAsNum-=v||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.set=function(v){this.valueAsNum=v,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.hide=function(){this.background.visible=!1,this.bar.visible=!1},o.prototype.show=function(){this.background.visible=!0,this.bar.visible=!0},o}(Entity),Ge=function(v){function e(A,E,R,O,V,z){var W=v.call(this)||this;W.canvas=M;var H=new Texture(A);return W.image=new UIImage(M,H),W.image.hAlign="right",W.image.vAlign="bottom",W.image.positionX=E||0,W.image.positionY=R||0,W.image.width=O||64,W.image.height=V||64,W.image.sourceLeft=z&&z.sourceLeft?z.sourceLeft:0,W.image.sourceTop=z&&z.sourceTop?z.sourceTop:0,W.image.sourceWidth=z&&z.sourceWidth?z.sourceWidth:O||64,W.image.sourceHeight=z&&z.sourceHeight?z.sourceHeight:V||64,W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var E=this;if(this.image.visible=!0,v){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(v,(function(){E.hide()})))}},e}(Entity),qe=function(v){function e(A,E,R,O,V,z){var W=v.call(this)||this;W.canvas=M;var H=new Texture(A);return W.image=new UIImage(M,H),W.image.hAlign="right",W.image.vAlign="bottom",W.image.positionX=E||0,W.image.positionY=R||0,W.image.width=O||32,W.image.height=V||32,W.image.sourceLeft=z&&z.sourceLeft?z.sourceLeft:0,W.image.sourceTop=z&&z.sourceTop?z.sourceTop:0,W.image.sourceWidth=z?z.sourceWidth:O||32,W.image.sourceHeight=z?z.sourceHeight:V||32,W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var E=this;if(this.image.visible=!0,v){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(v,(function(){E.hide()})))}},e}(Entity),He=function(v){function e(A,E,R,O,V,z){var W=v.call(this)||this;W.canvas=M;var H=new Texture(A);return W.image=new UIImage(M,H),W.image.hAlign="right",W.image.vAlign="bottom",W.image.positionX=E||0,W.image.positionY=R||0,W.image.width=O||128,W.image.height=V||128,W.image.sourceLeft=z&&z.sourceLeft?z.sourceLeft:0,W.image.sourceTop=z&&z.sourceTop?z.sourceTop:0,W.image.sourceWidth=z?z.sourceWidth:O||128,W.image.sourceHeight=z?z.sourceHeight:V||128,W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var E=this;if(this.image.visible=!0,v){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(v,(function(){E.hide()})))}},e}(Entity),Ye=function(v){function e(E,R,O,V,z,W,H,X){var K=v.call(this)||this;K.canvas=M;var Z=new Texture(E);if(K.image=new UIImage(M,Z),K.image.hAlign="center",K.image.vAlign="center",K.image.positionX=V||0,K.image.positionY=z||0,K.image.width=W||512,K.image.height=H||512,K.image.sourceLeft=X&&X.sourceLeft?X.sourceLeft:0,K.image.sourceTop=X&&X.sourceTop?X.sourceTop:0,K.image.sourceWidth=X?X.sourceWidth:W||512,K.image.sourceHeight=X?X.sourceHeight:H||512,K.image.visible=!O,-1!=R){var J=new Entity;engine.addEntity(J),J.addComponentOrReplace(new A(R||3,(function(){K.hide()})))}return K}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var E=this;if(this.image.visible=!0,v){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(v,(function(){E.hide()})))}},e}(Entity),Qe=function(v){function e(A,E,R,V){var H=v.call(this)||this;H.canvas=M,H.background=X,H.UIOpenTime=+Date.now(),H.onAccept=E||null;var K=V?W:z;return X.source=K,X.width=400,X.height=250,X.positionY=0,S(X,ve),X.visible=!0,H.closeIcon=new UIImage(X,K),H.closeIcon.positionX=175,H.closeIcon.positionY=100,H.closeIcon.width=32,H.closeIcon.height=32,S(H.closeIcon,V?Se.closeW:Se.closeD),H.closeIcon.onClick=new OnClick((function(){H.close()})),H.text=new UIText(X),H.text.value=A,H.text.adaptWidth=!1,H.text.textWrapping=!0,H.text.width=380,H.text.hAlign="center",H.text.vAlign="top",H.text.positionX=0,H.text.positionY=-65,H.text.fontSize=24,H.text.font=O,H.text.vTextAlign="center",H.text.hTextAlign="center",H.text.color=V?Color4.White():Color4.Black(),H.button=new UIImage(X,K),H.button.positionX=0,H.button.positionY=-60,H.button.width=174,H.button.height=46,S(H.button,ne),H.icon=new UIImage(H.button,1==V?W:z),H.icon.width=26,H.icon.height=26,H.icon.hAlign="center",H.icon.vAlign="center",H.icon.isPointerBlocker=!1,S(H.icon,ye),H.icon.positionX=B(R?R.length:2),H.buttonLabel=new UIText(H.button),H.buttonLabel.value=R||"Ok",H.buttonLabel.hTextAlign="center",H.buttonLabel.vTextAlign="center",H.buttonLabel.positionX=30,H.buttonLabel.fontSize=18,H.buttonLabel.font=O,H.buttonLabel.color=Color4.White(),H.buttonLabel.isPointerBlocker=!1,H.button.onClick=new OnClick((function(){H.accept()})),H.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){H.button.visible&&+Date.now()-H.UIOpenTime>100&&H.accept()})),H}return i(e,v),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.hide()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.EButtonAction)},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0,Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,this.EButtonAction)},e}(Entity),Xe=function(v){function e(A,E,R,H,K,Z,J){var $=v.call(this)||this;$.canvas=M,$.background=X,$.UIOpenTime=+Date.now(),$.onAccept=R,$.onReject=H||null;var ee=J?W:z;return X.source=ee,X.width=480,X.height=384,S(X,be),X.visible=!0,$.closeIcon=new UIImage(X,ee),$.closeIcon.positionX=215,$.closeIcon.positionY=164,$.closeIcon.width=32,$.closeIcon.height=32,S($.closeIcon,J?Se.closeW:Se.closeD),$.closeIcon.onClick=new OnClick((function(){$.close()})),$.title=new UIText(X),$.title.value=A,$.title.adaptWidth=!1,$.title.textWrapping=!0,$.title.width=380,$.title.hAlign="center",$.title.vAlign="top",$.title.positionX=0,$.title.positionY=-20,$.title.font=V,$.title.fontSize=24,$.title.vTextAlign="center",$.title.hTextAlign="center",$.title.color=J?Color4.White():Color4.Black(),$.text=new UIText(X),$.text.value=E,$.text.adaptWidth=!1,$.text.textWrapping=!0,$.text.width=380,$.text.hAlign="center",$.text.vAlign="top",$.text.positionX=0,$.text.positionY=-145,$.text.fontSize=24,$.text.font=O,$.text.vTextAlign="center",$.text.hTextAlign="center",$.text.color=J?Color4.White():Color4.Black(),$.buttonE=new UIImage(X,ee),$.buttonE.positionX=-100,$.buttonE.positionY=-120,$.buttonE.width=174,$.buttonE.height=46,S($.buttonE,ne),$.buttonEIcon=new UIImage($.buttonE,1==J?W:z),$.buttonEIcon.width=26,$.buttonEIcon.height=26,$.buttonEIcon.hAlign="center",$.buttonEIcon.vAlign="center",$.buttonEIcon.isPointerBlocker=!1,S($.buttonEIcon,ye),$.buttonEIcon.positionX=B(K?K.length:2),$.buttonELabel=new UIText($.buttonE),$.buttonELabel.value=K||"Ok",$.buttonELabel.hTextAlign="center",$.buttonELabel.vTextAlign="center",$.buttonELabel.positionX=30,$.buttonELabel.fontSize=18,$.buttonELabel.font=O,$.buttonELabel.color=Color4.White(),$.buttonELabel.isPointerBlocker=!1,$.buttonE.onClick=new OnClick((function(){$.accept()})),$.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){$.buttonE.visible&&+Date.now()-$.UIOpenTime>100&&$.accept()})),$.buttonF=new UIImage(X,ee),$.buttonF.positionX=100,$.buttonF.positionY=-120,$.buttonF.width=174,$.buttonF.height=46,S($.buttonF,oe),$.buttonFIcon=new UIImage($.buttonF,1==J?W:z),$.buttonFIcon.width=26,$.buttonFIcon.height=26,$.buttonFIcon.hAlign="center",$.buttonFIcon.vAlign="center",$.buttonFIcon.isPointerBlocker=!1,S($.buttonFIcon,we),$.buttonFIcon.positionX=B(Z?Z.length:6),$.buttonFLabel=new UIText($.buttonF),$.buttonFLabel.value=Z||"Cancel",$.buttonFLabel.hTextAlign="center",$.buttonFLabel.vTextAlign="center",$.buttonFLabel.positionX=30,$.buttonFLabel.fontSize=18,$.buttonFLabel.font=O,$.buttonFLabel.color=Color4.White(),$.buttonFLabel.isPointerBlocker=!1,$.buttonF.onClick=new OnClick((function(){$.reject()})),$.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){$.buttonF.visible&&+Date.now()-$.UIOpenTime>100&&$.reject()})),$}return i(e,v),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.title.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.hide()},e.prototype.reject=function(){this.onReject&&this.onReject(),this.hide()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.buttonEIcon.visible=!1,this.buttonFIcon.visible=!1,Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.EButtonAction),Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.FButtonAction)},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.buttonE.visible=!0,this.buttonF.visible=!0,this.text.visible=!0,this.buttonELabel.visible=!0,this.buttonFLabel.visible=!0,this.buttonEIcon.visible=!0,this.buttonFIcon.visible=!0,Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,this.EButtonAction),Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,this.FButtonAction)},e}(Entity),Ze=function(v){function e(A,E,R,H,K){var Z=v.call(this)||this;Z.canvas=M,Z.background=X,Z.UIOpenTime=+Date.now(),Z.onAccept=E;var J=K?W:z;X.source=J,X.width=400,X.height=250,S(X,ve),X.visible=!0,Z.text=new UIText(X),Z.text.value=A,Z.text.adaptWidth=!1,Z.text.textWrapping=!0,Z.text.width=320,Z.text.hAlign="center",Z.text.vAlign="top",Z.text.positionX=0,Z.text.positionY=-20,Z.text.fontSize=24,Z.text.font=V,Z.text.vTextAlign="center",Z.text.hTextAlign="center",Z.text.color=K?Color4.White():Color4.Black(),Z.closeIcon=new UIImage(X,J),Z.closeIcon.positionX=175,Z.closeIcon.positionY=100,Z.closeIcon.width=32,Z.closeIcon.height=32,S(Z.closeIcon,K?Se.closeW:Se.closeD),Z.closeIcon.onClick=new OnClick((function(){Z.hide()})),Z.button=new UIImage(X,J),Z.button.positionX=0,Z.button.positionY=-60,Z.button.width=174,Z.button.height=46,S(Z.button,ne),Z.icon=new UIImage(Z.button,1==K?W:z),Z.icon.width=26,Z.icon.height=26,Z.icon.hAlign="center",Z.icon.vAlign="center",Z.icon.isPointerBlocker=!1,S(Z.icon,ye),Z.icon.positionX=B(R?R.length:6),Z.buttonLabel=new UIText(Z.button),Z.buttonLabel.value=R||"Submit",Z.buttonLabel.hTextAlign="center",Z.buttonLabel.vTextAlign="center",Z.buttonLabel.positionX=30,Z.buttonLabel.fontSize=18,Z.buttonLabel.font=O,Z.buttonLabel.color=Color4.White(),Z.buttonLabel.isPointerBlocker=!1,Z.fillInBox=new UIInputText(X),Z.fillInBox.color=Color4.Black(),Z.fillInBox.font=O,Z.fillInBox.width=312,Z.fillInBox.height=46,Z.fillInBox.positionX=0,Z.fillInBox.positionY=15,Z.fillInBox.placeholder=H||"Fill in",Z.fillInBox.hTextAlign="center",Z.fillInBox.vTextAlign="center",Z.fillInBox.fontSize=22;var $="";return Z.fillInBox.onChanged=new OnChanged((function(v){$=v.value})),Z.fillInBox.onTextSubmit=new OnTextSubmit((function(v){Z.accept($)})),Z.button.onClick=new OnClick((function(){Z.accept($)})),Z.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){Z.button.visible&&+Date.now()-Z.UIOpenTime>100&&Z.accept($)})),Z}return i(e,v),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1},e.prototype.accept=function(v){this.onAccept(v),this.hide()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1,Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.EButtonAction)},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0,this.fillInBox.visible=!0,Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,this.EButtonAction)},e}(Entity),Je=function(A){function o(E,R,O,V){var H=A.call(this)||this;switch(H.elements=[],H.texture=z,H.darkTheme=!1,H.UIOpenTime=0,H.canvas=M,H.UIOpenTime=+Date.now(),H.background=new UIImage(M,z),H.background.hAlign="center",H.background.vAlign="center",H.closeIcon=new UIImage(H.background,H.texture),E||(E=v.PromptStyles.LIGHT),E){case v.PromptStyles.LIGHT:H.texture=z,S(H.background,ve),S(H.closeIcon,Se.closeD),H.closeIcon.positionX=R?R/2-25:175,H.closeIcon.positionY=O?O/2-25:145;break;case v.PromptStyles.DARK:H.texture=W,H.darkTheme=!0,S(H.background,ve),S(H.closeIcon,Se.closeW),H.closeIcon.positionX=R?R/2-25:175,H.closeIcon.positionY=O?O/2-25:145;break;case v.PromptStyles.LIGHTLARGE:H.texture=z,S(H.background,be),S(H.closeIcon,Se.closeD),H.closeIcon.positionX=R?R/2-25:215,H.closeIcon.positionY=O?O/2-25:165;break;case v.PromptStyles.DARKLARGE:H.texture=W,H.darkTheme=!0,S(H.background,be),S(H.closeIcon,Se.closeW),H.closeIcon.positionX=R?R/2-25:215,H.closeIcon.positionY=O?O/2-25:165;break;case v.PromptStyles.LIGHTSLANTED:H.texture=z,S(H.background,Te),S(H.closeIcon,Se.closeD),H.closeIcon.positionX=R?R/2-25:215,H.closeIcon.positionY=O?O/2-25:138;break;case v.PromptStyles.DARKSLANTED:H.texture=W,H.darkTheme=!0,S(H.background,Te),S(H.closeIcon,Se.closeW),H.closeIcon.positionX=R?R/2-25:215,H.closeIcon.positionY=O?O/2-25:138;break;default:H.texture=new Texture(E),H.closeIcon.visible=!1}return H.background.source=H.texture,H.background.width=R||H.background.sourceWidth,H.background.height=O||H.background.sourceHeight,H.background.visible=!0,H.closeIcon.width=32,H.closeIcon.height=32,H.closeIcon.source=H.texture,H.closeIcon.onClick=new OnClick((function(){H.hide()})),V&&H.hide(),H}return i(o,A),o.prototype.hide=function(){var v,A;this.background.visible=!1,this.closeIcon.visible=!1;try{for(var E=r(this.elements),R=E.next();!R.done;R=E.next())R.value.hide()}catch(A){v={error:A}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(v)throw v.error}}},o.prototype.show=function(){var v,A;this.background.visible=!0,this.closeIcon.visible=!0;try{for(var E=r(this.elements),R=E.next();!R.done;R=E.next())R.value.show()}catch(A){v={error:A}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(v)throw v.error}}},o.prototype.addText=function(v,A,E,R,M){var O=new it(this,v,A,E,this.darkTheme,R||void 0,M||void 0);return this.elements.push(O),O},o.prototype.addButton=function(v,A,E,R,M){var O=new $e(this,this.texture,this.UIOpenTime,v,A,E,R,M||void 0);return this.elements.push(O),O},o.prototype.addCheckbox=function(v,A,E,R,M,O,V){var z=new et(this,this.texture,this.darkTheme,v,A,E,R||void 0,M||void 0,O||void 0,V||void 0);return this.elements.push(z),z},o.prototype.addSwitch=function(v,A,E,R,M,O,V){var z=new nt(this,this.texture,this.darkTheme,v,A,E,R||void 0,M||void 0,O||void 0,V||void 0);return this.elements.push(z),z},o.prototype.addIcon=function(v,A,E,R,M,O){var V=new Texture(v),z=new ot(this,V,A,E,R||void 0,M||void 0,O||void 0);return this.elements.push(z),z},o.prototype.addTextBox=function(v,A,E,R){var M=new rt(this,v,A,E||void 0,R||void 0);return this.elements.push(M),M},o}(Entity),$e=function(A){function o(E,R,M,V,z,W,H,X){var K=A.call(this)||this;if(K.icon=null,K.image=new UIImage(E.background,R),K.image.positionX=z,K.image.positionY=W,K.image.width=174,K.image.height=46,K.label=new UIText(K.image),X)switch(X){case v.ButtonStyles.E:S(K.image,ne),K.label.positionX=25,K.icon=new UIImage(K.image,R),K.icon.width=26,K.icon.height=26,K.icon.hAlign="center",K.icon.vAlign="center",K.icon.isPointerBlocker=!1,S(K.icon,ye),K.icon.positionX=B(V.length);break;case v.ButtonStyles.F:S(K.image,oe),K.label.positionX=25,K.icon=new UIImage(K.image,R),K.icon.width=26,K.icon.height=26,K.icon.hAlign="center",K.icon.vAlign="center",K.icon.isPointerBlocker=!1,S(K.icon,we),K.icon.positionX=B(V.length);break;case v.ButtonStyles.RED:S(K.image,ie);break;case v.ButtonStyles.DARK:S(K.image,ae);break;case v.ButtonStyles.ROUNDBLACK:S(K.image,se);break;case v.ButtonStyles.ROUNDWHITE:S(K.image,ce);break;case v.ButtonStyles.ROUNDSILVER:S(K.image,de);break;case v.ButtonStyles.ROUNDGOLD:S(K.image,me);break;case v.ButtonStyles.SQUAREBLACK:S(K.image,le);break;case v.ButtonStyles.SQUAREWHITE:S(K.image,ue);break;case v.ButtonStyles.SQUARESILVER:S(K.image,he);break;case v.ButtonStyles.SQUAREGOLD:S(K.image,fe);break;default:S(K.image,de)}else S(K.image,de);return K.label.value=V,K.label.hTextAlign="center",K.label.vTextAlign="center",K.label.fontSize=20,K.label.font=O,K.label.color=X==v.ButtonStyles.ROUNDWHITE||X==v.ButtonStyles.SQUAREWHITE?Color4.Black():Color4.White(),K.label.isPointerBlocker=!1,K.image.onClick=new OnClick((function(){H()})),X==v.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){K.image.visible&&+Date.now()-M>100&&H()})):X==v.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){K.image.visible&&+Date.now()-M>100&&H()})),K}return i(o,A),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1,this.icon&&(this.icon.visible=!1)},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0,this.icon&&(this.icon.visible=!0)},o}(Entity),et=function(v){function e(A,E,R,M,V,z,W,H,X,K){var Z=v.call(this)||this;return Z.checked=!!K,Z.darkTheme=R,Z.large=X||!1,Z.image=new UIImage(A.background,E),Z.image.positionX=V,Z.image.positionY=z,Z.image.width=X?32:24,Z.image.height=X?32:24,0==Z.checked?Z.uncheck():Z.check(),Z.label=new UIText(Z.image),Z.label.positionX=X?40:30,Z.label.color=R?Color4.White():Color4.Black(),Z.label.value=M,Z.label.hTextAlign="left",Z.label.vTextAlign="center",Z.label.fontSize=20,Z.label.font=O,Z.label.isPointerBlocker=!1,Z.image.onClick=new OnClick((function(){0==Z.checked?Z.check():Z.uncheck(),Z.checked?W&&W():H&&H()})),Z}return i(e,v),e.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},e.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},e.prototype.uncheck=function(){this.checked=!1,this.darkTheme?this.large?S(this.image,Pe):S(this.image,Ce):this.large?S(this.image,ke):S(this.image,_e)},e.prototype.check=function(){this.checked=!0,this.darkTheme?this.large?S(this.image,Be):S(this.image,Ee):this.large?S(this.image,Re):S(this.image,Ie)},e}(Entity),nt=function(A){function o(E,R,M,V,z,W,H,X,K,Z){var J=A.call(this)||this;return J.checked=!!Z,J.darkTheme=M,J.style=K||v.SwitchStyles.ROUNDGREEN,J.image=new UIImage(E.background,R),J.image.positionX=z,J.image.positionY=W,J.image.width=64,J.image.height=32,0==J.checked?J.check():J.uncheck(),J.label=new UIText(J.image),J.label.positionX=80,J.label.color=M?Color4.White():Color4.Black(),J.label.value=V,J.label.hTextAlign="left",J.label.vTextAlign="center",J.label.fontSize=20,J.label.font=O,J.label.isPointerBlocker=!1,J.image.onClick=new OnClick((function(){0==J.checked?J.check():J.uncheck(),J.checked?H&&H():X&&X()})),J}return i(o,A),o.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},o.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},o.prototype.check=function(){switch(this.checked=!0,this.style){case v.SwitchStyles.ROUNDGREEN:S(this.image,Ve);break;case v.SwitchStyles.ROUNDRED:S(this.image,Le);break;case v.SwitchStyles.SQUAREGREEN:S(this.image,Ue);break;case v.SwitchStyles.SQUARERED:S(this.image,Fe)}},o.prototype.uncheck=function(){this.checked=!1,this.style==v.SwitchStyles.ROUNDGREEN||this.style==v.SwitchStyles.ROUNDRED?S(this.image,Oe):S(this.image,Ne)},o}(Entity),ot=function(v){function e(A,E,R,M,O,V,z){var W=v.call(this)||this;return W.image=new UIImage(A.background,E),W.image.positionX=R,W.image.positionY=M,W.image.width=O||128,W.image.height=V||128,W.image.sourceLeft=z&&z.sourceLeft?z.sourceLeft:0,W.image.sourceTop=z&&z.sourceTop?z.sourceTop:0,W.image.sourceWidth=z&&z.sourceWidth?z.sourceWidth:O||128,W.image.sourceHeight=z&&z.sourceHeight?z.sourceHeight:V||128,W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity),it=function(v){function e(A,E,R,M,O,V,z){var W=v.call(this)||this;return W.text=new UIText(A.background),W.text.value=E,W.text.positionX=R||0,W.text.positionY=M||0,W.text.hTextAlign="center",W.text.color=V||(O?Color4.White():Color4.Black()),W.text.fontSize=z||15,W}return i(e,v),e.prototype.hide=function(){this.text.visible=!1},e.prototype.show=function(){this.text.visible=!0},e}(Entity),rt=function(v){function e(A,E,R,M,V){var z=v.call(this)||this;return z.currentText="",z.fillInBox=new UIInputText(A.background),z.fillInBox.color=Color4.Black(),z.fillInBox.font=O,z.fillInBox.width=312,z.fillInBox.height=46,z.fillInBox.positionX=E,z.fillInBox.positionY=R,z.fillInBox.placeholder=M||"Fill in",z.fillInBox.hTextAlign="center",z.fillInBox.vTextAlign="center",z.fillInBox.fontSize=22,z.fillInBox.onChanged=new OnChanged((function(v){z.fillInBox&&!z.fillInBox.visible||(z.currentText=v.value,V&&V(z.currentText))})),z.fillInBox.onTextSubmit=new OnTextSubmit((function(v){z.fillInBox&&!z.fillInBox.visible||(z.currentText=v.text,V&&V(z.currentText))})),z}return i(e,v),e.prototype.hide=function(){this.fillInBox.visible=!1},e.prototype.show=function(){this.fillInBox.visible=!0},e}(Entity),at=function(v){function e(A,E,R,V,z,W){var H=v.call(this)||this;return H.canvas=M,H.uiText=new UIText(M),H.uiText.value=A,H.uiText.hAlign="right",H.uiText.vAlign="bottom",H.uiText.positionX=E||0,H.uiText.positionY=R||0,H.uiText.fontSize=z||25,H.uiText.font=O,H.uiText.vTextAlign="center",H.uiText.hTextAlign="center",H.uiText.color=V||Color4.White(),H.uiText.outlineColor=Color4.Black(),H.uiText.outlineWidth=W?0:.1,H}return i(e,v),e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.set=function(v){this.uiText.value=v,this.uiText.visible=!0},e}(Entity),st=function(v){function e(E,R,O,V){var W=v.call(this)||this;if(W.canvas=M,W.image=new UIImage(M,z),W.image.hAlign="center",W.image.vAlign="center",W.image.positionX=R||0,W.image.positionY=O?O+80:80,W.image.width=V?48*V:48,W.image.height=V?64*V:64,S(W.image,Se.TimerLarge),E&&0!=E){var H=new Entity;engine.addEntity(H),H.addComponentOrReplace(new A(E||3,(function(){W.hide()})))}return W}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity);function Q(v){return v&&"object"==typeof v&&!Array.isArray(v)}function q(v,A){var E=o({},v);return Q(v)&&Q(A)&&Object.keys(A).forEach((function(R){var M,O;Q(A[R])?R in v?E[R]=q(v[R],A[R]):E=o(o({},E),((M={})[R]=A[R],M)):E=o(o({},E),((O={})[R]=A[R],O))})),E}var lt=function(){function t(v,A){this.shape=v,A&&this.setProperties(A)}return t.prototype.setProperties=function(v){var A,E;try{for(var R=r(Object.keys(v)),M=R.next();!M.done;M=R.next()){var O=M.value;this.shape[O]=v[O]}}catch(v){A={error:v}}finally{try{M&&!M.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},t.prototype.getProperty=function(v){return this.shape[v]},t}(),ct=function(v){function e(A,E){var R,M,O,V=v.call(this,new UIInputText(A),o(o({},E),{placeholder:null!==(R=null==E?void 0:E.placeholder)&&void 0!==R?R:null==E?void 0:E.value,onFocus:new OnFocus((function(){var v;V.isInputFocused=!0,null===(v=null==E?void 0:E.onFocus)||void 0===v||v.call(E)})),onBlur:new OnBlur((function(){var v,A;V.isInputFocused=!1,""===V.inputValue&&void 0!==V.placeholder?(V.setInputValue(V.placeholder),null===(v=null==E?void 0:E.onBlur)||void 0===v||v.call(E,!0)):null===(A=null==E?void 0:E.onBlur)||void 0===A||A.call(E,!1)})),onChanged:new OnChanged((function(v){var A,R=v.value;if(V.shape.visible&&(V.inputValue=R,R!==V.placeholder&&(""===R&&(V.shape.placeholder=""),V.isInputFocused||""===R))){var M=null!==(A=null==E?void 0:E.waitTime)&&void 0!==A?A:e.DEFAULT_WAIT_TIME;setTimeout((function(){var v;V.inputValue===R&&(null===(v=null==E?void 0:E.onChanged)||void 0===v||v.call(E,R))}),M)}})),onTextSubmit:new OnTextSubmit((function(v){var A=v.text,R=A.substr(0,A.length-1),M=null==E?void 0:E.onTextSubmit;M?M(R):setTimeout((function(){return V.shape.placeholder=R}),0)}))}))||this;return V.inputValue="",V.isInputFocused=!1,V.placeholder=V.shape.placeholder,V.inputValue=null!==(O=null!==(M=null==E?void 0:E.value)&&void 0!==M?M:null==E?void 0:E.placeholder)&&void 0!==O?O:"",V.isInputFocused=!1,V}return i(e,v),e.prototype.getValue=function(){return this.inputValue},e.prototype.isFocused=function(){return this.isInputFocused},e.prototype.setInputValue=function(v){var A=this.isInputFocused;this.isInputFocused=!1,this.shape.placeholder="",this.inputValue=this.shape.placeholder=v,this.isInputFocused=A},e.prototype.reset=function(){this.setInputValue(this.placeholder)},e.prototype.hide=function(){this.setProperties({visible:!1})},e.prototype.show=function(){this.setProperties({visible:!0}),this.setInputValue(this.inputValue)},e.DEFAULT_WAIT_TIME=650,e}(lt),ut=function(v){function e(A,E){var R=v.call(this,new UIContainerRect(A),o({isPointerBlocker:!0},E))||this,M=new UIImage(R.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));return M.width="100%",M.height="100%",M.sourceWidth=1,M.sourceHeight=1,M.isPointerBlocker=!0,R.image=M,(null==E?void 0:E.onClick)&&R.setOnClick(E.onClick),R}return i(e,v),e.prototype.performClick=function(){var v;null===(v=this.image.onClick)||void 0===v||v.callback({})},e.prototype.setOnClick=function(v){this.image.onClick=new OnClick(v)},e.prototype.clearOnClick=function(){this.image.onClick=null},e}(lt),dt=function(v){function e(A,E){var R=v.call(this,new UIContainerRect(A),o({width:"100%",vAlign:"top",visible:!1},E))||this;R.config=o(o({},e.DEFAULTS),E);var M=new ut(R.shape,{width:"100%",height:"100%",color:Color4.Clear()});R.clickableContainer=M;var O=new UIImage(M.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));O.width=O.height=R.config.imageSize,O.hAlign="left",O.positionX=10,O.vAlign="center",R.image=O;var V=new UIText(M.shape);V.vAlign="top",V.hAlign="left",V.vTextAlign="top",V.fontSize=R.config.topFontSize,V.color=R.config.topTextColor,V.positionX=55,V.positionY=-10,V.isPointerBlocker=!1,R.topLeftText=V;var z=new UIText(M.shape);z.vAlign="top",z.hAlign="right",z.vTextAlign="top",z.hTextAlign="right",z.fontSize=V.fontSize,z.color=V.color,z.isPointerBlocker=!1,z.positionX=-10,z.positionY=V.positionY,R.topRightText=z;var W=new UIText(M.shape);W.vAlign="bottom",W.hAlign="left",W.vTextAlign="bottom",W.fontSize=R.config.bottomFontSize,W.color=R.config.bottomTextColor,W.positionX=V.positionX,W.positionY=10,W.isPointerBlocker=!1,R.bottomLeftText=W;var H=new UIText(M.shape);return H.vAlign="bottom",H.hAlign="right",H.vTextAlign="bottom",H.hTextAlign="right",H.fontSize=W.fontSize,H.color=W.color,H.isPointerBlocker=!1,H.positionX=z.positionX,H.positionY=W.positionY,R.bottomRightText=H,R}return i(e,v),e.prototype.setOption=function(v,A){this.image.visible=!1,this.topRightText.visible=!1,this.bottomLeftText.visible=!1,this.bottomRightText.visible=!1,v.image?(this.image.source=new Texture(v.image.src),this.image.sourceWidth=v.image.sourceWidth,this.image.sourceHeight=v.image.sourceHeight,this.image.visible=!0,this.topLeftText.positionX=this.config.imageSize+20):this.topLeftText.positionX=10,"string"==typeof v.visualText?(this.topLeftText.value=v.visualText,this.topLeftText.vAlign=this.topLeftText.vTextAlign="center",this.topLeftText.positionY=0):"text"in v.visualText?(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=v.visualText.text,this.bottomLeftText.value=v.visualText.subText,this.bottomLeftText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX):"bottomLeft"in v.visualText&&(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=v.visualText.topLeft,this.topRightText.value=v.visualText.topRight,this.bottomLeftText.value=v.visualText.bottomLeft,this.bottomRightText.value=v.visualText.bottomRight,this.topRightText.visible=!0,this.bottomLeftText.visible=!0,this.bottomRightText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX),A?this.clickableContainer.setOnClick(A):this.clickableContainer.clearOnClick()},e.prototype.setProperties=function(A){v.prototype.setProperties.call(this,A)},e.prototype.getProperty=function(A){return v.prototype.getProperty.call(this,A)},e.prototype.performClick=function(){this.clickableContainer.performClick()},e.DEFAULTS={topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},e}(lt),pt=function(v){function e(A,E,R,M){var O=v.call(this,new UIContainerRect(A),o({},R))||this;O.onSuccessfulSelection=M,O.uiOptions=[],O.options={},R.visible,R.opacity,R.hAlign,R.vAlign,R.positionX,R.positionY;var V=n(R,["visible","opacity","hAlign","vAlign","positionX","positionY"]);O.config=q(e.DEFAULTS,V),O.setProperties({width:O.config.width,height:O.config.initialHeight,color:O.config.borderColor}),O.setItems(E.items,E.dropdownDefaultItemIds);var W=new UIContainerRect(O.shape);W.color=O.config.backgroundColor,W.width=O.config.width-2*O.config.borderSize,W.height=O.config.initialHeight-2*O.config.borderSize,O.insideContainer=W;var H=new ct(W,{vAlign:"top",hTextAlign:"left",vTextAlign:"center",width:"92%",fontSize:O.config.search.fontSize,placeholder:O.config.search.placeholder.defaultText,color:O.config.search.textColor,focusedBackground:Color4.Clear(),height:.95*O.config.initialHeight,onBlur:function(){return O.close()},onTextSubmit:function(){O.uiOptions[0].getProperty("visible")?O.uiOptions[0].performClick():O.close()},onChanged:function(v){if(O.hideAllOptions(),v===O.config.search.placeholder.defaultText||""===v)O.showDefaultOptions();else{var A=v.toLowerCase(),E=[];for(var R in O.options){var M=O.options[R];if(M.searchBy.toLowerCase().indexOf(A)>=0&&(E.push(M),E.length===O.config.options.maxVisibleOptions))break}E.length>0?O.showOptions(E):O.showErrorMessage("Sorry, we can't find \""+v+'"')}}});O.inputText=H;for(var X=0;X<O.config.options.maxVisibleOptions;X++){var K=new dt(W,o(o({},O.config.options),{height:O.config.initialHeight,positionY:-O.config.initialHeight-O.config.initialHeight*X,color:X%2==0?O.config.options.oddBackgroundColor:W.color}));O.uiOptions.push(K)}var Z=new UIImage(W,z);Z.onClick=new OnClick((function(){return O.close()})),Z.sourceTop=305,Z.sourceLeft=985,Z.sourceWidth=Z.sourceHeight=35,Z.width=Z.height=18,Z.hAlign="right",Z.vAlign="top",Z.positionX=-12,Z.positionY=-12,Z.visible=Z.isPointerBlocker=!0;var J=new UIText(W);return J.height=20,J.visible=!1,J.width="92%",J.hTextAlign="center",J.vAlign="bottom",J.positionY=20,J.fontSize=O.config.errorMessage.fontSize,J.color=O.config.errorMessage.textColor,O.errorMessage=J,O}return i(e,v),e.prototype.open=function(){this.setProperties({visible:!0}),this.showDefaultOptions()},e.prototype.close=function(){this.setProperties({visible:!1}),this.inputText.reset()},e.prototype.setItems=function(v,A){this.options=v.reduce((function(v,A){var E;return A.searchBy=null!==(E=A.searchBy)&&void 0!==E?E:"string"==typeof A.visualText?A.visualText:"text"in A.visualText?A.visualText.text:A.visualText.topLeft,v[A.id]=A,v}),{}),A?this.setDropdownDefaults(A):this.defaultOptions=A,this.hideAllOptions()},e.prototype.setDropdownDefaults=function(v){var A,E;try{for(var R=r(v),M=R.next();!M.done;M=R.next()){var O=M.value;if(!(O in this.options))return void error("Couldn't find an option with id '"+O+"'. Will not set new defaults")}}catch(v){A={error:v}}finally{try{M&&!M.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this.defaultOptions=v},e.prototype.showDefaultOptions=function(){var v,A=this;if(this.defaultOptions)v=this.defaultOptions.map((function(v){return A.options[v]})).slice(0,this.config.options.maxVisibleOptions);else for(var E in v=[],this.options)if(v.push(this.options[E]),v.length===this.config.options.maxVisibleOptions)break;this.showOptions(v)},e.prototype.showOptions=function(v){var A=this;this.resizeHeight(this.config.initialHeight*v.length+2*this.config.borderSize),v.forEach((function(v,E){var R=A.uiOptions[E];R.setOption(v,(function(){A.onSuccessfulSelection(v),A.setProperties({visible:!1})})),R.setProperties({visible:!0})})),this.errorMessage.visible=!1},e.prototype.hideAllOptions=function(){this.uiOptions.forEach((function(v){return v.setProperties({visible:!1})}))},e.prototype.showErrorMessage=function(v){this.errorMessage.visible=!0,this.errorMessage.value=v,this.resizeHeight(60)},e.prototype.resizeHeight=function(v){this.setProperties({height:this.config.initialHeight+v}),this.insideContainer.height=this.config.initialHeight+v-2*this.config.borderSize},e.DEFAULTS={borderColor:Color4.FromInts(232,236,253,255),backgroundColor:Color4.White(),borderSize:2,width:300,initialHeight:60,search:{fontSize:16,textColor:Color4.FromInts(24,26,70,255),placeholder:{defaultText:"Click to search",textColor:Color4.FromInts(118,120,181,200)}},options:{maxVisibleOptions:5,oddBackgroundColor:Color4.FromInts(246,246,255,255),topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},errorMessage:{fontSize:13,textColor:Color4.FromInts(125,127,157,255)}},e}(lt),ht=function(v){function e(A,E,R,M){var O=v.call(this,new UIContainerRect(A),o({},R))||this;O.onSuccessfulSelection=M,R.visible,R.opacity,R.hAlign,R.vAlign,R.positionX,R.positionY;var V=n(R,["visible","opacity","hAlign","vAlign","positionX","positionY"]);O.config=q(pt.DEFAULTS,V),O.setProperties({width:O.config.width,height:O.config.initialHeight,color:O.config.borderColor});var z=new ut(O.shape,{color:O.config.backgroundColor,width:O.config.width-2*O.config.borderSize,height:O.config.initialHeight-2*O.config.borderSize,onClick:function(){return O.uiSearchPrompt.open()}}),W=new dt(z.shape,o(o({},O.config.options),{height:O.config.initialHeight,color:Color4.Clear(),width:O.config.width-2*O.config.borderSize-20,visible:!0,hAlign:"left",isPointerBlocker:!1})),H=new UIText(z.shape);if(H.value="Click to select an option",H.fontSize=O.config.search.fontSize,H.color=O.config.search.placeholder.textColor,H.vTextAlign=H.hTextAlign="center",H.positionX=-O.config.borderSize-10,H.isPointerBlocker=!1,H.opacity=H.color.a,O.initialText=H,null==E?void 0:E.initialItemId){var X=E.items.filter((function(v){return v.id===E.initialItemId}))[0];X&&(W.setOption(X),O.initialText.visible=!1)}var K=new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAN5AAADeQELGyzWAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlQTFRF////AAAAAAAAflGpXQAAAAJ0Uk5TAICbK04YAAAAeklEQVQ4je3PsRXEMAgE0VFCEapG9agaiiDRVXkJxlpq8IYT/AfwTbZ/ssPUEJgGZ2hYDTmgSIAiDoqsdskBRQIUcVBktXdO/jeVuBDPMBpRyEMUEhVMiUKKSOQlEokrmBKJXARsJWAqAaYEjEbAVgJmtGDewmjEt9wfISOqAUzY2sAAAAAASUVORK5CYII="),Z=new UIImage(z.shape,K);return Z.sourceWidth=Z.sourceHeight=64,Z.height=15,Z.width=12,Z.hAlign="right",Z.vAlign="center",Z.positionX=-10,Z.visible=!0,Z.isPointerBlocker=!1,O.uiSearchPrompt=new pt(O.shape,E,o(o({},R),{visible:!1,vAlign:"top",initialHeight:O.config.initialHeight-2*O.config.borderSize}),(function(v){W.setOption(v),O.initialText.visible=!1,O.onSuccessfulSelection(v)})),O}return i(e,v),e.prototype.open=function(){this.setProperties({visible:!0})},e.prototype.close=function(){this.setProperties({visible:!1})},e.prototype.setSearchItems=function(v,A){this.uiSearchPrompt.setItems(v,A)},e.prototype.setSearchDropdownDefaults=function(v){this.uiSearchPrompt.setDropdownDefaults(v)},e}(lt);v.CenterImage=Ye,v.CornerLabel=at,v.CustomPrompt=Je,v.CustomPromptButton=$e,v.CustomPromptCheckBox=et,v.CustomPromptIcon=ot,v.CustomPromptSwitch=nt,v.CustomPromptText=it,v.CustomPromptTextBox=rt,v.FillInPrompt=Ze,v.LargeIcon=He,v.LoadingIcon=st,v.MediumIcon=Ge,v.OkPrompt=Qe,v.OptionPrompt=Xe,v.SFFont=O,v.SFHeavyFont=V,v.SmallIcon=qe,v.UIBar=We,v.UICounter=ee,v.UISearchPrompt=pt,v.UISelectBox=ht,v.canvas=M,v.darkTheme=W,v.displayAnnouncement=function(v,E,R,M,O){H.visible=!0,H.value=v,H.color=R||Color4.Yellow(),H.fontSize=M||50,H.font=V,H.outlineColor=Color4.Black(),H.outlineWidth=O?0:.1,H.adaptWidth=!1,H.textWrapping=!0,H.width=900;var z=new Entity;engine.addEntity(z),-1!=E&&z.addComponentOrReplace(new A(E||3,(function(){H.visible=!1})))},v.hideAnnouncements=function(){H.visible=!1},v.lightTheme=z,Object.defineProperty(v,"__esModule",{value:!0})}));var __extends=this&&this.__extends||function(){var extendStatics=function(v,A){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(v[E]=A[E])},extendStatics(v,A)};return function(v,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function __(){this.constructor=v}extendStatics(v,A),v.prototype=null===A?Object.create(A):(__.prototype=A.prototype,new __)}}();__decorate=this&&this.__decorate||function(v,A,E,R){var M,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(v,A,E,R);else for(var z=v.length-1;z>=0;z--)(M=v[z])&&(V=(O<3?M(V):O>3?M(A,E,V):M(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V},__values=this&&this.__values||function(v){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&v[A],R=0;if(E)return E.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")},__awaiter=this&&this.__awaiter||function(v,A,E,R){return new(E||(E=Promise))((function(M,O){function fulfilled(v){try{step(R.next(v))}catch(v){O(v)}}function rejected(v){try{step(R.throw(v))}catch(v){O(v)}}function step(v){var A;v.done?M(v.value):(A=v.value,A instanceof E?A:new E((function(v){v(A)}))).then(fulfilled,rejected)}step((R=R.apply(v,A||[])).next())}))},__generator=this&&this.__generator||function(v,A){var E,R,M,O,V={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return O={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function verb(O){return function(z){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(M=2&O[0]?R.return:O[0]?R.throw||((M=R.return)&&M.call(R),0):R.next)&&!(M=M.call(R,O[1])).done)return M;switch(R=0,M&&(O=[2&O[0],M.value]),O[0]){case 0:case 1:M=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((M=(M=V.trys).length>0&&M[M.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!M||O[1]>M[0]&&O[1]<M[3])){V.label=O[1];break}if(6===O[0]&&V.label<M[1]){V.label=M[1],M=O;break}if(M&&V.label<M[2]){V.label=M[2],V.ops.push(O);break}M[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(v,V)}catch(v){O=[6,v],R=0}finally{E=M=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,z])}}},__read=this&&this.__read||function(v,A){var E="function"==typeof Symbol&&v[Symbol.iterator];if(!E)return v;var R,M,O=E.call(v),V=[];try{for(;(void 0===A||A-- >0)&&!(R=O.next()).done;)V.push(R.value)}catch(v){M={error:v}}finally{try{R&&!R.done&&(E=O.return)&&E.call(O)}finally{if(M)throw M.error}}return V},function(v){var A;"object"==typeof exports&&"undefined"!=typeof module?module.exports=v():("undefined"!=typeof window?A=window:"undefined"!=typeof global?A=global:"undefined"!=typeof self&&(A=self),A.CANNON=v())}((function(){return function e(v,A,E){function d(M,O){if(!A[M]){if(!v[M]){var V="function"==typeof require&&require;if(!O&&V)return V(M,!0);if(R)return R(M,!0);throw new Error("Cannot find module '"+M+"'")}var z=A[M]={exports:{}};v[M][0].call(z.exports,(function(A){return d(v[M][1][A]||A)}),z,z.exports,e,v,A,E)}return A[M].exports}for(var R="function"==typeof require&&require,M=0;M<E.length;M++)d(E[M]);return d}({1:[function(v,A){A.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(v,A){A.exports={version:v("../package.json").version,AABB:v("./collision/AABB"),ArrayCollisionMatrix:v("./collision/ArrayCollisionMatrix"),Body:v("./objects/Body"),Box:v("./shapes/Box"),Broadphase:v("./collision/Broadphase"),Constraint:v("./constraints/Constraint"),ContactEquation:v("./equations/ContactEquation"),Narrowphase:v("./world/Narrowphase"),ConeTwistConstraint:v("./constraints/ConeTwistConstraint"),ContactMaterial:v("./material/ContactMaterial"),ConvexPolyhedron:v("./shapes/ConvexPolyhedron"),Cylinder:v("./shapes/Cylinder"),DistanceConstraint:v("./constraints/DistanceConstraint"),Equation:v("./equations/Equation"),EventTarget:v("./utils/EventTarget"),FrictionEquation:v("./equations/FrictionEquation"),GSSolver:v("./solver/GSSolver"),GridBroadphase:v("./collision/GridBroadphase"),Heightfield:v("./shapes/Heightfield"),HingeConstraint:v("./constraints/HingeConstraint"),LockConstraint:v("./constraints/LockConstraint"),Mat3:v("./math/Mat3"),Material:v("./material/Material"),NaiveBroadphase:v("./collision/NaiveBroadphase"),ObjectCollisionMatrix:v("./collision/ObjectCollisionMatrix"),Pool:v("./utils/Pool"),Particle:v("./shapes/Particle"),Plane:v("./shapes/Plane"),PointToPointConstraint:v("./constraints/PointToPointConstraint"),Quaternion:v("./math/Quaternion"),Ray:v("./collision/Ray"),RaycastVehicle:v("./objects/RaycastVehicle"),RaycastResult:v("./collision/RaycastResult"),RigidVehicle:v("./objects/RigidVehicle"),RotationalEquation:v("./equations/RotationalEquation"),RotationalMotorEquation:v("./equations/RotationalMotorEquation"),SAPBroadphase:v("./collision/SAPBroadphase"),SPHSystem:v("./objects/SPHSystem"),Shape:v("./shapes/Shape"),Solver:v("./solver/Solver"),Sphere:v("./shapes/Sphere"),SplitSolver:v("./solver/SplitSolver"),Spring:v("./objects/Spring"),Trimesh:v("./shapes/Trimesh"),Vec3:v("./math/Vec3"),Vec3Pool:v("./utils/Vec3Pool"),World:v("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(v,A){function n(v){v=v||{},this.lowerBound=new E,v.lowerBound&&this.lowerBound.copy(v.lowerBound),this.upperBound=new E,v.upperBound&&this.upperBound.copy(v.upperBound)}var E=v("../math/Vec3");v("../utils/Utils"),A.exports=n;var R=new E;n.prototype.setFromPoints=function(v,A,E,M){var O=this.lowerBound,V=this.upperBound,z=E;O.copy(v[0]),z&&z.vmult(O,O),V.copy(O);for(var W=1;W<v.length;W++){var H=v[W];z&&(z.vmult(H,R),H=R),H.x>V.x&&(V.x=H.x),H.x<O.x&&(O.x=H.x),H.y>V.y&&(V.y=H.y),H.y<O.y&&(O.y=H.y),H.z>V.z&&(V.z=H.z),H.z<O.z&&(O.z=H.z)}return A&&(A.vadd(O,O),A.vadd(V,V)),M&&(O.x-=M,O.y-=M,O.z-=M,V.x+=M,V.y+=M,V.z+=M),this},n.prototype.copy=function(v){return this.lowerBound.copy(v.lowerBound),this.upperBound.copy(v.upperBound),this},n.prototype.clone=function(){return(new n).copy(this)},n.prototype.extend=function(v){var A=v.lowerBound.x;this.lowerBound.x>A&&(this.lowerBound.x=A);var E=v.upperBound.x;this.upperBound.x<E&&(this.upperBound.x=E),A=v.lowerBound.y,this.lowerBound.y>A&&(this.lowerBound.y=A),E=v.upperBound.y,this.upperBound.y<E&&(this.upperBound.y=E),A=v.lowerBound.z,this.lowerBound.z>A&&(this.lowerBound.z=A),E=v.upperBound.z,this.upperBound.z<E&&(this.upperBound.z=E)},n.prototype.overlaps=function(v){var A=this.lowerBound,E=this.upperBound,R=v.lowerBound,M=v.upperBound;return(R.x<=E.x&&E.x<=M.x||A.x<=M.x&&M.x<=E.x)&&(R.y<=E.y&&E.y<=M.y||A.y<=M.y&&M.y<=E.y)&&(R.z<=E.z&&E.z<=M.z||A.z<=M.z&&M.z<=E.z)},n.prototype.contains=function(v){var A=this.lowerBound,E=this.upperBound,R=v.lowerBound,M=v.upperBound;return A.x<=R.x&&E.x>=M.x&&A.y<=R.y&&E.y>=M.y&&A.z<=R.z&&E.z>=M.z},n.prototype.getCorners=function(v,A,E,R,M,O,V,z){var W=this.lowerBound,H=this.upperBound;v.copy(W),A.set(H.x,W.y,W.z),E.set(H.x,H.y,W.z),R.set(W.x,H.y,H.z),M.set(H.x,W.y,W.z),O.set(W.x,H.y,W.z),V.set(W.x,W.y,H.z),z.copy(H)};var M=[new E,new E,new E,new E,new E,new E,new E,new E];n.prototype.toLocalFrame=function(v,A){var E=M,R=E[0],O=E[1],V=E[2],z=E[3],W=E[4],H=E[5],X=E[6],K=E[7];this.getCorners(R,O,V,z,W,H,X,K);for(var Z=0;8!==Z;Z++){var J=E[Z];v.pointToLocal(J,J)}return A.setFromPoints(E)},n.prototype.toWorldFrame=function(v,A){var E=M,R=E[0],O=E[1],V=E[2],z=E[3],W=E[4],H=E[5],X=E[6],K=E[7];this.getCorners(R,O,V,z,W,H,X,K);for(var Z=0;8!==Z;Z++){var J=E[Z];v.pointToWorld(J,J)}return A.setFromPoints(E)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(v,A){function n(){this.matrix=[]}A.exports=n,n.prototype.get=function(v,A){if(v=v.index,(A=A.index)>v){var E=A;A=v,v=E}return this.matrix[(v*(v+1)>>1)+A-1]},n.prototype.set=function(v,A,E){if(v=v.index,(A=A.index)>v){var R=A;A=v,v=R}this.matrix[(v*(v+1)>>1)+A-1]=E?1:0},n.prototype.reset=function(){for(var v=0,A=this.matrix.length;v!==A;v++)this.matrix[v]=0},n.prototype.setNumObjects=function(v){this.matrix.length=v*(v-1)>>1}},{}],5:[function(v,A){function n(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var E=v("../objects/Body"),R=v("../math/Vec3"),M=v("../math/Quaternion");v("../shapes/Shape"),v("../shapes/Plane"),A.exports=n,n.prototype.collisionPairs=function(){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var O=E.STATIC|E.KINEMATIC;n.prototype.needBroadphaseCollision=function(v,A){return 0!=(v.collisionFilterGroup&A.collisionFilterMask)&&0!=(A.collisionFilterGroup&v.collisionFilterMask)&&(0==(v.type&O)&&v.sleepState!==E.SLEEPING||0==(A.type&O)&&A.sleepState!==E.SLEEPING)},n.prototype.intersectionTest=function(v,A,E,R){this.useBoundingBoxes?this.doBoundingBoxBroadphase(v,A,E,R):this.doBoundingSphereBroadphase(v,A,E,R)};var V=new R;new R,new M,new R,n.prototype.doBoundingSphereBroadphase=function(v,A,E,R){var M=V;A.position.vsub(v.position,M),Math.pow(v.boundingRadius+A.boundingRadius,2)>M.norm2()&&(E.push(v),R.push(A))},n.prototype.doBoundingBoxBroadphase=function(v,A,E,R){v.aabbNeedsUpdate&&v.computeAABB(),A.aabbNeedsUpdate&&A.computeAABB(),v.aabb.overlaps(A.aabb)&&(E.push(v),R.push(A))};var z={keys:[]},W=[],H=[];n.prototype.makePairsUnique=function(v,A){for(var E=z,R=W,M=H,O=v.length,V=0;V!==O;V++)R[V]=v[V],M[V]=A[V];for(v.length=0,A.length=0,V=0;V!==O;V++){var X=R[V].id,K=M[V].id;E[Z=K>X?X+","+K:K+","+X]=V,E.keys.push(Z)}for(V=0;V!==E.keys.length;V++){var Z=E.keys.pop(),J=E[Z];v.push(R[J]),A.push(M[J]),delete E[Z]}},n.prototype.setWorld=function(){};var X=new R;n.boundingSphereCheck=function(v,A){var E=X;return v.position.vsub(A.position,E),Math.pow(v.shape.boundingSphereRadius+A.shape.boundingSphereRadius,2)>E.norm2()},n.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(v,A){function n(v,A,M,O,V){E.apply(this),this.nx=M||10,this.ny=O||10,this.nz=V||10,this.aabbMin=v||new R(100,100,100),this.aabbMax=A||new R(-100,-100,-100);var z=this.nx*this.ny*this.nz;if(0>=z)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=z,this.binLengths.length=z;for(var W=0;z>W;W++)this.bins[W]=[],this.binLengths[W]=0}A.exports=n;var E=v("./Broadphase"),R=v("../math/Vec3"),M=v("../shapes/Shape");n.prototype=new E,n.prototype.constructor=n;var O=new R;new R,n.prototype.collisionPairs=function(v,A,E){function o(v,A,E,R,M,O,V){var z=(v-ie)*le|0,W=(A-ae)*ce|0,ee=(E-se)*ue|0,ne=Ee((R-ie)*le),oe=Ee((M-ae)*ce),de=Ee((O-se)*ue);0>z?z=0:z>=H&&(z=H-1),0>W?W=0:W>=X&&(W=X-1),0>ee?ee=0:ee>=K&&(ee=K-1),0>ne?ne=0:ne>=H&&(ne=H-1),0>oe?oe=0:oe>=X&&(oe=X-1),0>de?de=0:de>=K&&(de=K-1),W*=J,ee*=$,ne*=Z,oe*=J,de*=$;for(var he=z*=Z;ne>=he;he+=Z)for(var me=W;oe>=me;me+=J)for(var fe=ee;de>=fe;fe+=$){var ye=he+me+fe;be[ye][Te[ye]++]=V}}for(var R=v.numObjects(),V=v.bodies,z=this.aabbMax,W=this.aabbMin,H=this.nx,X=this.ny,K=this.nz,Z=X*K,J=K,$=1,ee=z.x,ne=z.y,oe=z.z,ie=W.x,ae=W.y,se=W.z,le=H/(ee-ie),ce=X/(ne-ae),ue=K/(oe-se),de=(ee-ie)/H,he=(ne-ae)/X,me=(oe-se)/K,fe=.5*Math.sqrt(de*de+he*he+me*me),ye=M.types,we=ye.SPHERE,ve=ye.PLANE,be=(ye.BOX,ye.COMPOUND,ye.CONVEXPOLYHEDRON,this.bins),Te=this.binLengths,Se=this.bins.length,Ce=0;Ce!==Se;Ce++)Te[Ce]=0;var Ee=Math.ceil;for(W=Math.min,z=Math.max,Ce=0;Ce!==R;Ce++){var _e=(Ze=V[Ce]).shape;switch(_e.type){case we:var Ie=Ze.position.x,Pe=Ze.position.y,Be=Ze.position.z,ke=_e.radius;o(Ie-ke,Pe-ke,Be-ke,Ie+ke,Pe+ke,Be+ke,Ze);break;case ve:_e.worldNormalNeedsUpdate&&_e.computeWorldNormal(Ze.quaternion);var Re=_e.worldNormal,Oe=ie+.5*de-Ze.position.x,Le=ae+.5*he-Ze.position.y,Ve=se+.5*me-Ze.position.z,Ne=O;Ne.set(Oe,Le,Ve);for(var Fe=0,Ue=0;Fe!==H;Fe++,Ue+=Z,Ne.y=Le,Ne.x+=de)for(var We=0,Ge=0;We!==X;We++,Ge+=J,Ne.z=Ve,Ne.y+=he)for(var qe=0,He=0;qe!==K;qe++,He+=$,Ne.z+=me)if(Ne.dot(Re)<fe){var Ye=Ue+Ge+He;be[Ye][Te[Ye]++]=Ze}break;default:Ze.aabbNeedsUpdate&&Ze.computeAABB(),o(Ze.aabb.lowerBound.x,Ze.aabb.lowerBound.y,Ze.aabb.lowerBound.z,Ze.aabb.upperBound.x,Ze.aabb.upperBound.y,Ze.aabb.upperBound.z,Ze)}}for(Ce=0;Ce!==Se;Ce++){var Qe=Te[Ce];if(Qe>1){var Xe=be[Ce];for(Fe=0;Fe!==Qe;Fe++){var Ze=Xe[Fe];for(We=0;We!==Fe;We++){var Je=Xe[We];this.needBroadphaseCollision(Ze,Je)&&this.intersectionTest(Ze,Je,A,E)}}}}this.makePairsUnique(A,E)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(v,A){function n(){E.apply(this)}A.exports=n;var E=v("./Broadphase"),R=v("./AABB");n.prototype=new E,n.prototype.constructor=n,n.prototype.collisionPairs=function(v,A,E){var R,M,O,V,z=v.bodies,W=z.length;for(R=0;R!==W;R++)for(M=0;M!==R;M++)O=z[R],V=z[M],this.needBroadphaseCollision(O,V)&&this.intersectionTest(O,V,A,E)},new R,n.prototype.aabbQuery=function(v,A,E){E=E||[];for(var R=0;R<v.bodies.length;R++){var M=v.bodies[R];M.aabbNeedsUpdate&&M.computeAABB(),M.aabb.overlaps(A)&&E.push(M)}return E}},{"./AABB":3,"./Broadphase":5}],8:[function(v,A){function n(){this.matrix={}}A.exports=n,n.prototype.get=function(v,A){if(v=v.id,(A=A.id)>v){var E=A;A=v,v=E}return v+"-"+A in this.matrix},n.prototype.set=function(v,A,E){if(v=v.id,(A=A.id)>v){var R=A;A=v,v=R}E?this.matrix[v+"-"+A]=!0:delete this.matrix[v+"-"+A]},n.prototype.reset=function(){this.matrix={}},n.prototype.setNumObjects=function(){}},{}],9:[function(v,A){function n(v,A){this.from=v?v.clone():new E,this.to=A?A.clone():new E,this._direction=new E,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new O,this.hasHit=!1,this.callback=function(){}}function o(v,A,E,R){R.vsub(A,be),E.vsub(A,X),v.vsub(A,K);var M,O,V=be.dot(be),z=be.dot(X),W=be.dot(K),H=X.dot(X),Z=X.dot(K);return(M=H*W-z*Z)>=0&&(O=V*Z-z*W)>=0&&V*H-z*z>M+O}A.exports=n;var E=v("../math/Vec3"),R=v("../math/Quaternion"),M=v("../math/Transform"),O=(v("../shapes/ConvexPolyhedron"),v("../shapes/Box"),v("../collision/RaycastResult")),V=v("../shapes/Shape"),z=v("../collision/AABB");n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var W=new z,H=[];n.prototype.intersectWorld=function(v,A){return this.mode=A.mode||n.ANY,this.result=A.result||new O,this.skipBackfaces=!!A.skipBackfaces,this.collisionFilterMask=void 0!==A.collisionFilterMask?A.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==A.collisionFilterGroup?A.collisionFilterGroup:-1,A.from&&this.from.copy(A.from),A.to&&this.to.copy(A.to),this.callback=A.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(W),H.length=0,v.broadphase.aabbQuery(v,W,H),this.intersectBodies(H),this.hasHit};var X=new E,K=new E;n.pointInTriangle=o;var Z=new E,J=new R;n.prototype.intersectBody=function(v,A){A&&(this.result=A,this._updateDirection());var E=this.checkCollisionResponse;if((!E||v.collisionResponse)&&0!=(this.collisionFilterGroup&v.collisionFilterMask)&&0!=(v.collisionFilterGroup&this.collisionFilterMask))for(var R=Z,M=J,O=0,V=v.shapes.length;V>O;O++){var z=v.shapes[O];if((!E||z.collisionResponse)&&(v.quaternion.mult(v.shapeOrientations[O],M),v.quaternion.vmult(v.shapeOffsets[O],R),R.vadd(v.position,R),this.intersectShape(z,M,R,v),this.result._shouldStop))break}},n.prototype.intersectBodies=function(v,A){A&&(this.result=A,this._updateDirection());for(var E=0,R=v.length;!this.result._shouldStop&&R>E;E++)this.intersectBody(v[E])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(v,A,E,R){var M=function(v,A,E){E.vsub(v,be);var R=be.dot(A);return A.mult(R,Te),Te.vadd(v,Te),E.distanceTo(Te)}(this.from,this._direction,E);if(!(M>v.boundingSphereRadius)){var O=this[v.type];O&&O.call(this,v,A,E,R)}};var $=(new E,new E,new E),ee=new E,ne=new E,oe=new E;new E,new O,n.prototype.intersectBox=function(v,A,E,R){return this.intersectConvex(v.convexPolyhedronRepresentation,A,E,R)},n.prototype[V.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(v,A,R,M){var O=this.from,V=this.to,z=this._direction,W=new E(0,0,1);A.vmult(W,W);var H=new E;O.vsub(R,H);var X=H.dot(W);if(V.vsub(R,H),!(X*H.dot(W)>0||O.distanceTo(V)<X)){var K=W.dot(z);if(!(Math.abs(K)<this.precision)){var Z=new E,J=new E,$=new E;O.vsub(R,Z);var ee=-W.dot(Z)/K;z.scale(ee,J),O.vadd(J,$),this.reportIntersection(W,$,v,M,-1)}}},n.prototype[V.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(v){var A=this.to,E=this.from;v.lowerBound.x=Math.min(A.x,E.x),v.lowerBound.y=Math.min(A.y,E.y),v.lowerBound.z=Math.min(A.z,E.z),v.upperBound.x=Math.max(A.x,E.x),v.upperBound.y=Math.max(A.y,E.y),v.upperBound.z=Math.max(A.z,E.z)};var ie={faceList:[0]};n.prototype.intersectHeightfield=function(v,A,R,O){var V=(v.data,v.elementSize,new E),z=new n(this.from,this.to);M.pointToLocalFrame(R,A,z.from,z.from),M.pointToLocalFrame(R,A,z.to,z.to);var W=[],H=null,X=null,K=null,Z=null,J=v.getIndexOfPosition(z.from.x,z.from.y,W,!1);if(J&&(H=W[0],X=W[1],K=W[0],Z=W[1]),(J=v.getIndexOfPosition(z.to.x,z.to.y,W,!1))&&((null===H||W[0]<H)&&(H=W[0]),(null===K||W[0]>K)&&(K=W[0]),(null===X||W[1]<X)&&(X=W[1]),(null===Z||W[1]>Z)&&(Z=W[1])),null!==H){v.getRectMinMax(H,X,K,Z,[]);for(var $=H;K>=$;$++)for(var ee=X;Z>=ee;ee++){if(this.result._shouldStop)return;if(v.getConvexTrianglePillar($,ee,!1),M.pointToWorldFrame(R,A,v.pillarOffset,V),this.intersectConvex(v.pillarConvex,A,V,O,ie),this.result._shouldStop)return;v.getConvexTrianglePillar($,ee,!0),M.pointToWorldFrame(R,A,v.pillarOffset,V),this.intersectConvex(v.pillarConvex,A,V,O,ie)}}},n.prototype[V.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var ae=new E,se=new E;n.prototype.intersectSphere=function(v,A,E,R){var M=this.from,O=this.to,V=v.radius,z=Math.pow(O.x-M.x,2)+Math.pow(O.y-M.y,2)+Math.pow(O.z-M.z,2),W=2*((O.x-M.x)*(M.x-E.x)+(O.y-M.y)*(M.y-E.y)+(O.z-M.z)*(M.z-E.z)),H=Math.pow(M.x-E.x,2)+Math.pow(M.y-E.y,2)+Math.pow(M.z-E.z,2)-Math.pow(V,2),X=Math.pow(W,2)-4*z*H,K=ae,Z=se;if(!(0>X))if(0===X)M.lerp(O,X,K),K.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,K,v,R,-1);else{var J=(-W-Math.sqrt(X))/(2*z),$=(-W+Math.sqrt(X))/(2*z);if(J>=0&&1>=J&&(M.lerp(O,J,K),K.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,K,v,R,-1)),this.result._shouldStop)return;$>=0&&1>=$&&(M.lerp(O,$,K),K.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,K,v,R,-1))}},n.prototype[V.types.SPHERE]=n.prototype.intersectSphere;var le=new E,ce=(new E,new E,new E);n.prototype.intersectConvex=function(v,A,E,R,M){for(var O=le,V=ce,z=M&&M.faceList||null,W=v.faces,H=v.vertices,X=v.faceNormals,K=this._direction,Z=this.from,J=this.to,ie=Z.distanceTo(J),ae=z?z.length:W.length,se=this.result,ue=0;!se._shouldStop&&ae>ue;ue++){var de=z?z[ue]:ue,he=W[de],me=X[de],fe=A,ye=E;V.copy(H[he[0]]),fe.vmult(V,V),V.vadd(ye,V),V.vsub(Z,V),fe.vmult(me,O);var we=K.dot(O);if(!(Math.abs(we)<this.precision)){var ve=O.dot(V)/we;if(!(0>ve)){K.mult(ve,$),$.vadd(Z,$),ee.copy(H[he[0]]),fe.vmult(ee,ee),ye.vadd(ee,ee);for(var be=1;!se._shouldStop&&be<he.length-1;be++){ne.copy(H[he[be]]),oe.copy(H[he[be+1]]),fe.vmult(ne,ne),fe.vmult(oe,oe),ye.vadd(ne,ne),ye.vadd(oe,oe);var Te=$.distanceTo(Z);!o($,ee,ne,oe)&&!o($,ne,ee,oe)||Te>ie||this.reportIntersection(O,$,v,R,de)}}}}},n.prototype[V.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var ue=new E,de=new E,he=new E,me=new E,fe=new E,ye=new E,we=(new z,[]),ve=new M;n.prototype.intersectTrimesh=function(v,A,E,R,O){var V=ue,z=we,W=ve,H=ce,X=de,K=he,Z=me,J=ye,ie=fe,ae=(O&&O.faceList,v.indices),se=(v.vertices,v.faceNormals,this.from),le=this.to,be=this._direction;W.position.copy(E),W.quaternion.copy(A),M.vectorToLocalFrame(E,A,be,X),M.pointToLocalFrame(E,A,se,K),M.pointToLocalFrame(E,A,le,Z);var Te=K.distanceSquared(Z);v.tree.rayQuery(this,W,z);for(var Se=0,Ce=z.length;!this.result._shouldStop&&Se!==Ce;Se++){var Ee=z[Se];v.getNormal(Ee,V),v.getVertex(ae[3*Ee],ee),ee.vsub(K,H);var _e=X.dot(V),Ie=V.dot(H)/_e;if(!(0>Ie)){X.scale(Ie,$),$.vadd(K,$),v.getVertex(ae[3*Ee+1],ne),v.getVertex(ae[3*Ee+2],oe);var Pe=$.distanceSquared(K);!o($,ne,ee,oe)&&!o($,ee,ne,oe)||Pe>Te||(M.vectorToWorldFrame(A,V,ie),M.pointToWorldFrame(E,A,$,J),this.reportIntersection(ie,J,v,R,Ee))}}z.length=0},n.prototype[V.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(v,A,E,R,M){var O=this.from,V=this.to,z=O.distanceTo(A),W=this.result;if(!(this.skipBackfaces&&v.dot(this._direction)>0))switch(W.hitFaceIndex=void 0!==M?M:-1,this.mode){case n.ALL:this.hasHit=!0,W.set(O,V,v,A,E,R,z),W.hasHit=!0,this.callback(W);break;case n.CLOSEST:(z<W.distance||!W.hasHit)&&(this.hasHit=!0,W.hasHit=!0,W.set(O,V,v,A,E,R,z));break;case n.ANY:this.hasHit=!0,W.hasHit=!0,W.set(O,V,v,A,E,R,z),W._shouldStop=!0}};var be=new E,Te=new E},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(v,A){function n(){this.rayFromWorld=new E,this.rayToWorld=new E,this.hitNormalWorld=new E,this.hitPointWorld=new E,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var E=v("../math/Vec3");A.exports=n,n.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},n.prototype.abort=function(){this._shouldStop=!0},n.prototype.set=function(v,A,E,R,M,O,V){this.rayFromWorld.copy(v),this.rayToWorld.copy(A),this.hitNormalWorld.copy(E),this.hitPointWorld.copy(R),this.shape=M,this.body=O,this.distance=V}},{"../math/Vec3":30}],11:[function(v,A){function n(v){E.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var A=this.axisList;this._addBodyHandler=function(v){A.push(v.body)},this._removeBodyHandler=function(v){var E=A.indexOf(v.body);-1!==E&&A.splice(E,1)},v&&this.setWorld(v)}var E=(v("../shapes/Shape"),v("../collision/Broadphase"));A.exports=n,n.prototype=new E,n.prototype.setWorld=function(v){this.axisList.length=0;for(var A=0;A<v.bodies.length;A++)this.axisList.push(v.bodies[A]);v.removeEventListener("addBody",this._addBodyHandler),v.removeEventListener("removeBody",this._removeBodyHandler),v.addEventListener("addBody",this._addBodyHandler),v.addEventListener("removeBody",this._removeBodyHandler),this.world=v,this.dirty=!0},n.insertionSortX=function(v){for(var A=1,E=v.length;E>A;A++){for(var R=v[A],M=A-1;M>=0&&!(v[M].aabb.lowerBound.x<=R.aabb.lowerBound.x);M--)v[M+1]=v[M];v[M+1]=R}return v},n.insertionSortY=function(v){for(var A=1,E=v.length;E>A;A++){for(var R=v[A],M=A-1;M>=0&&!(v[M].aabb.lowerBound.y<=R.aabb.lowerBound.y);M--)v[M+1]=v[M];v[M+1]=R}return v},n.insertionSortZ=function(v){for(var A=1,E=v.length;E>A;A++){for(var R=v[A],M=A-1;M>=0&&!(v[M].aabb.lowerBound.z<=R.aabb.lowerBound.z);M--)v[M+1]=v[M];v[M+1]=R}return v},n.prototype.collisionPairs=function(v,A,E){var R,M,O=this.axisList,V=O.length,z=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),R=0;R!==V;R++){var W=O[R];for(M=R+1;V>M;M++){var H=O[M];if(this.needBroadphaseCollision(W,H)){if(!n.checkBounds(W,H,z))break;this.intersectionTest(W,H,A,E)}}}},n.prototype.sortList=function(){for(var v=this.axisList,A=this.axisIndex,E=v.length,R=0;R!==E;R++){var M=v[R];M.aabbNeedsUpdate&&M.computeAABB()}0===A?n.insertionSortX(v):1===A?n.insertionSortY(v):2===A&&n.insertionSortZ(v)},n.checkBounds=function(v,A,E){var R,M;return 0===E?(R=v.position.x,M=A.position.x):1===E?(R=v.position.y,M=A.position.y):2===E&&(R=v.position.z,M=A.position.z),R+v.boundingRadius>M-A.boundingRadius},n.prototype.autoDetectAxis=function(){for(var v=0,A=0,E=0,R=0,M=0,O=0,V=this.axisList,z=V.length,W=1/z,H=0;H!==z;H++){var X=V[H],K=X.position.x;v+=K,A+=K*K;var Z=X.position.y;E+=Z,R+=Z*Z;var J=X.position.z;M+=J,O+=J*J}var $=A-v*v*W,ee=R-E*E*W,ne=O-M*M*W;this.axisIndex=$>ee?$>ne?0:2:ee>ne?1:2},n.prototype.aabbQuery=function(v,A,E){E=E||[],this.dirty&&(this.sortList(),this.dirty=!1);var R=this.axisIndex,M="x";1===R&&(M="y"),2===R&&(M="z");for(var O=this.axisList,V=(A.lowerBound[M],A.upperBound[M],0);V<O.length;V++){var z=O[V];z.aabbNeedsUpdate&&z.computeAABB(),z.aabb.overlaps(A)&&E.push(z)}return E}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(v,A){function n(v,A,V){var z=void 0!==(V=V||{}).maxForce?V.maxForce:1e6,W=V.pivotA?V.pivotA.clone():new O,H=V.pivotB?V.pivotB.clone():new O;this.axisA=V.axisA?V.axisA.clone():new O,this.axisB=V.axisB?V.axisB.clone():new O,E.call(this,v,W,A,H,z),this.collideConnected=!!V.collideConnected,this.angle=void 0!==V.angle?V.angle:0;var X=this.coneEquation=new R(v,A,V),K=this.twistEquation=new M(v,A,V);this.twistAngle=void 0!==V.twistAngle?V.twistAngle:0,X.maxForce=0,X.minForce=-z,K.maxForce=0,K.minForce=-z,this.equations.push(X,K)}A.exports=n;var E=(v("./Constraint"),v("./PointToPointConstraint")),R=v("../equations/ConeEquation"),M=v("../equations/RotationalEquation"),O=(v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new E,n.constructor=n,new O,new O,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,R=this.coneEquation,M=this.twistEquation;E.prototype.update.call(this),v.vectorToWorldFrame(this.axisA,R.axisA),A.vectorToWorldFrame(this.axisB,R.axisB),this.axisA.tangents(M.axisA,M.axisA),v.vectorToWorldFrame(M.axisA,M.axisA),this.axisB.tangents(M.axisB,M.axisB),A.vectorToWorldFrame(M.axisB,M.axisB),R.angle=this.angle,M.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(v,A){function n(v,A,R){R=E.defaults(R,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=v,this.bodyB=A,this.id=n.idCounter++,this.collideConnected=R.collideConnected,R.wakeUpBodies&&(v&&v.wakeUp(),A&&A.wakeUp())}A.exports=n;var E=v("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.prototype.enable=function(){for(var v=this.equations,A=0;A<v.length;A++)v[A].enabled=!0},n.prototype.disable=function(){for(var v=this.equations,A=0;A<v.length;A++)v[A].enabled=!1},n.idCounter=0},{"../utils/Utils":53}],14:[function(v,A){function n(v,A,M,O){E.call(this,v,A),void 0===M&&(M=v.position.distanceTo(A.position)),void 0===O&&(O=1e6),this.distance=M;var V=this.distanceEquation=new R(v,A);this.equations.push(V),V.minForce=-O,V.maxForce=O}A.exports=n;var E=v("./Constraint"),R=v("../equations/ContactEquation");n.prototype=new E,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,E=this.distanceEquation,R=.5*this.distance,M=E.ni;A.position.vsub(v.position,M),M.normalize(),M.mult(R,E.ri),M.mult(-R,E.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(v,A){function n(v,A,V){var z=void 0!==(V=V||{}).maxForce?V.maxForce:1e6,W=V.pivotA?V.pivotA.clone():new O,H=V.pivotB?V.pivotB.clone():new O;E.call(this,v,W,A,H,z),(this.axisA=V.axisA?V.axisA.clone():new O(1,0,0)).normalize(),(this.axisB=V.axisB?V.axisB.clone():new O(1,0,0)).normalize();var X=this.rotationalEquation1=new R(v,A,V),K=this.rotationalEquation2=new R(v,A,V),Z=this.motorEquation=new M(v,A,z);Z.enabled=!1,this.equations.push(X,K,Z)}A.exports=n;var E=(v("./Constraint"),v("./PointToPointConstraint")),R=v("../equations/RotationalEquation"),M=v("../equations/RotationalMotorEquation"),O=(v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new E,n.constructor=n,n.prototype.enableMotor=function(){this.motorEquation.enabled=!0},n.prototype.disableMotor=function(){this.motorEquation.enabled=!1},n.prototype.setMotorSpeed=function(v){this.motorEquation.targetVelocity=v},n.prototype.setMotorMaxForce=function(v){this.motorEquation.maxForce=v,this.motorEquation.minForce=-v};var V=new O,z=new O;n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,R=this.motorEquation,M=this.rotationalEquation1,O=this.rotationalEquation2,W=V,H=z,X=this.axisA,K=this.axisB;E.prototype.update.call(this),v.quaternion.vmult(X,W),A.quaternion.vmult(K,H),W.tangents(M.axisA,O.axisA),M.axisB.copy(H),O.axisB.copy(H),this.motorEquation.enabled&&(v.quaternion.vmult(this.axisA,R.axisA),A.quaternion.vmult(this.axisB,R.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(v,A){function n(v,A,O){var V=void 0!==(O=O||{}).maxForce?O.maxForce:1e6,z=new M,W=new M,H=new M;v.position.vadd(A.position,H),H.scale(.5,H),A.pointToLocalFrame(H,W),v.pointToLocalFrame(H,z),E.call(this,v,z,A,W,V);var X=this.rotationalEquation1=new R(v,A,O),K=this.rotationalEquation2=new R(v,A,O),Z=this.rotationalEquation3=new R(v,A,O);this.equations.push(X,K,Z)}A.exports=n;var E=(v("./Constraint"),v("./PointToPointConstraint")),R=v("../equations/RotationalEquation"),M=(v("../equations/RotationalMotorEquation"),v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new E,n.constructor=n,new M,new M,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,R=(this.motorEquation,this.rotationalEquation1),O=this.rotationalEquation2,V=this.rotationalEquation3;E.prototype.update.call(this),v.vectorToWorldFrame(M.UNIT_X,R.axisA),A.vectorToWorldFrame(M.UNIT_Y,R.axisB),v.vectorToWorldFrame(M.UNIT_Y,O.axisA),A.vectorToWorldFrame(M.UNIT_Z,O.axisB),v.vectorToWorldFrame(M.UNIT_Z,V.axisA),A.vectorToWorldFrame(M.UNIT_X,V.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(v,A){function n(v,A,O,V,z){E.call(this,v,O),z=void 0!==z?z:1e6,this.pivotA=A?A.clone():new M,this.pivotB=V?V.clone():new M;var W=this.equationX=new R(v,O),H=this.equationY=new R(v,O),X=this.equationZ=new R(v,O);this.equations.push(W,H,X),W.minForce=H.minForce=X.minForce=-z,W.maxForce=H.maxForce=X.maxForce=z,W.ni.set(1,0,0),H.ni.set(0,1,0),X.ni.set(0,0,1)}A.exports=n;var E=v("./Constraint"),R=v("../equations/ContactEquation"),M=v("../math/Vec3");n.prototype=new E,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,E=this.equationX,R=this.equationY,M=this.equationZ;v.quaternion.vmult(this.pivotA,E.ri),A.quaternion.vmult(this.pivotB,E.rj),R.ri.copy(E.ri),R.rj.copy(E.rj),M.ri.copy(E.ri),M.rj.copy(E.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(v,A){function n(v,A,M){var O=void 0!==(M=M||{}).maxForce?M.maxForce:1e6;R.call(this,v,A,-O,O),this.axisA=M.axisA?M.axisA.clone():new E(1,0,0),this.axisB=M.axisB?M.axisB.clone():new E(0,1,0),this.angle=void 0!==M.angle?M.angle:0}A.exports=n;var E=v("../math/Vec3"),R=(v("../math/Mat3"),v("./Equation"));n.prototype=new R,n.prototype.constructor=n;var M=new E,O=new E;n.prototype.computeB=function(v){var A=this.a,E=this.b,R=this.axisA,V=this.axisB,z=M,W=O,H=this.jacobianElementA,X=this.jacobianElementB;return R.cross(V,z),V.cross(R,W),H.rotational.copy(W),X.rotational.copy(z),-(Math.cos(this.angle)-R.dot(V))*A-this.computeGW()*E-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(v,A){function n(v,A,M){M=void 0!==M?M:1e6,E.call(this,v,A,0,M),this.restitution=0,this.ri=new R,this.rj=new R,this.ni=new R}A.exports=n;var E=v("./Equation"),R=v("../math/Vec3");v("../math/Mat3"),n.prototype=new E,n.prototype.constructor=n;var M=new R,O=new R,V=new R;n.prototype.computeB=function(v){var A=this.a,E=this.b,R=this.bi,z=this.bj,W=this.ri,H=this.rj,X=M,K=O,Z=R.velocity,J=R.angularVelocity,$=(R.force,R.torque,z.velocity),ee=z.angularVelocity,ne=(z.force,z.torque,V),oe=this.jacobianElementA,ie=this.jacobianElementB,ae=this.ni;W.cross(ae,X),H.cross(ae,K),ae.negate(oe.spatial),X.negate(oe.rotational),ie.spatial.copy(ae),ie.rotational.copy(K),ne.copy(z.position),ne.vadd(H,ne),ne.vsub(R.position,ne),ne.vsub(W,ne);var se=ae.dot(ne),le=this.restitution+1;return-se*A-(le*$.dot(ae)-le*Z.dot(ae)+ee.dot(K)-J.dot(X))*E-v*this.computeGiMf()};var z=new R,W=new R,H=new R,X=new R,K=new R;n.prototype.getImpactVelocityAlongNormal=function(){var v=z,A=W,E=H,R=X,M=K;return this.bi.position.vadd(this.ri,E),this.bj.position.vadd(this.rj,R),this.bi.getVelocityAtWorldPoint(E,v),this.bj.getVelocityAtWorldPoint(R,A),v.vsub(A,M),this.ni.dot(M)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(v,A){function n(v,A,R,M){this.id=n.id++,this.minForce=void 0===R?-1e6:R,this.maxForce=void 0===M?1e6:M,this.bi=v,this.bj=A,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new E,this.jacobianElementB=new E,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}A.exports=n;var E=v("../math/JacobianElement"),R=v("../math/Vec3");n.prototype.constructor=n,n.id=0,n.prototype.setSpookParams=function(v,A,E){var R=A,M=v,O=E;this.a=4/(O*(1+4*R)),this.b=4*R/(1+4*R),this.eps=4/(O*O*M*(1+4*R))},n.prototype.computeB=function(v,A,E){var R=this.computeGW();return-this.computeGq()*v-R*A-this.computeGiMf()*E},n.prototype.computeGq=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,M=E.position,O=R.position;return v.spatial.dot(M)+A.spatial.dot(O)};var M=new R;n.prototype.computeGW=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,O=E.velocity,V=R.velocity,z=E.angularVelocity||M,W=R.angularVelocity||M;return v.multiplyVectors(O,z)+A.multiplyVectors(V,W)},n.prototype.computeGWlambda=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,O=E.vlambda,V=R.vlambda,z=E.wlambda||M,W=R.wlambda||M;return v.multiplyVectors(O,z)+A.multiplyVectors(V,W)};var O=new R,V=new R,z=new R,W=new R;n.prototype.computeGiMf=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,M=E.force,H=E.torque,X=R.force,K=R.torque,Z=E.invMassSolve,J=R.invMassSolve;return E.invInertiaWorldSolve?E.invInertiaWorldSolve.vmult(H,z):z.set(0,0,0),R.invInertiaWorldSolve?R.invInertiaWorldSolve.vmult(K,W):W.set(0,0,0),M.mult(Z,O),X.mult(J,V),v.multiplyVectors(O,z)+A.multiplyVectors(V,W)};var H=new R;n.prototype.computeGiMGt=function(){var v=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,M=E.invMassSolve,O=R.invMassSolve,V=E.invInertiaWorldSolve,z=R.invInertiaWorldSolve,W=M+O;return V&&(V.vmult(v.rotational,H),W+=H.dot(v.rotational)),z&&(z.vmult(A.rotational,H),W+=H.dot(A.rotational)),W};var X=new R;new R,new R,new R,new R,new R,n.prototype.addToWlambda=function(v){var A=this.jacobianElementA,E=this.jacobianElementB,R=this.bi,M=this.bj,O=X;A.spatial.mult(R.invMassSolve*v,O),R.vlambda.vadd(O,R.vlambda),E.spatial.mult(M.invMassSolve*v,O),M.vlambda.vadd(O,M.vlambda),R.invInertiaWorldSolve&&(R.invInertiaWorldSolve.vmult(A.rotational,O),O.mult(v,O),R.wlambda.vadd(O,R.wlambda)),M.invInertiaWorldSolve&&(M.invInertiaWorldSolve.vmult(E.rotational,O),O.mult(v,O),M.wlambda.vadd(O,M.wlambda))},n.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(v,A){function n(v,A,M){E.call(this,v,A,-M,M),this.ri=new R,this.rj=new R,this.t=new R}A.exports=n;var E=v("./Equation"),R=v("../math/Vec3");v("../math/Mat3"),n.prototype=new E,n.prototype.constructor=n;var M=new R,O=new R;n.prototype.computeB=function(v){var A=(this.a,this.b),E=(this.bi,this.bj,this.ri),R=this.rj,V=M,z=O,W=this.t;E.cross(W,V),R.cross(W,z);var H=this.jacobianElementA,X=this.jacobianElementB;return W.negate(H.spatial),V.negate(H.rotational),X.spatial.copy(W),X.rotational.copy(z),-this.computeGW()*A-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(v,A){function n(v,A,M){var O=void 0!==(M=M||{}).maxForce?M.maxForce:1e6;R.call(this,v,A,-O,O),this.axisA=M.axisA?M.axisA.clone():new E(1,0,0),this.axisB=M.axisB?M.axisB.clone():new E(0,1,0),this.maxAngle=Math.PI/2}A.exports=n;var E=v("../math/Vec3"),R=(v("../math/Mat3"),v("./Equation"));n.prototype=new R,n.prototype.constructor=n;var M=new E,O=new E;n.prototype.computeB=function(v){var A=this.a,E=this.b,R=this.axisA,V=this.axisB,z=M,W=O,H=this.jacobianElementA,X=this.jacobianElementB;return R.cross(V,z),V.cross(R,W),H.rotational.copy(W),X.rotational.copy(z),-(Math.cos(this.maxAngle)-R.dot(V))*A-this.computeGW()*E-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(v,A){function n(v,A,M){M=void 0!==M?M:1e6,R.call(this,v,A,-M,M),this.axisA=new E,this.axisB=new E,this.targetVelocity=0}A.exports=n;var E=v("../math/Vec3"),R=(v("../math/Mat3"),v("./Equation"));n.prototype=new R,n.prototype.constructor=n,n.prototype.computeB=function(v){var A=(this.a,this.b),E=(this.bi,this.bj,this.axisA),R=this.axisB,M=this.jacobianElementA,O=this.jacobianElementB;return M.rotational.copy(E),R.negate(O.rotational),-(this.computeGW()-this.targetVelocity)*A-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(v,A){function n(v,A,R){R=E.defaults(R,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n.idCounter++,this.materials=[v,A],this.friction=R.friction,this.restitution=R.restitution,this.contactEquationStiffness=R.contactEquationStiffness,this.contactEquationRelaxation=R.contactEquationRelaxation,this.frictionEquationStiffness=R.frictionEquationStiffness,this.frictionEquationRelaxation=R.frictionEquationRelaxation}var E=v("../utils/Utils");A.exports=n,n.idCounter=0},{"../utils/Utils":53}],25:[function(v,A){function n(v){var A="";"string"==typeof(v=v||{})?(A=v,v={}):"object"==typeof v&&(A=""),this.name=A,this.id=n.idCounter++,this.friction=void 0!==v.friction?v.friction:-1,this.restitution=void 0!==v.restitution?v.restitution:-1}A.exports=n,n.idCounter=0},{}],26:[function(v,A){function n(){this.spatial=new E,this.rotational=new E}A.exports=n;var E=v("./Vec3");n.prototype.multiplyElement=function(v){return v.spatial.dot(this.spatial)+v.rotational.dot(this.rotational)},n.prototype.multiplyVectors=function(v,A){return v.dot(this.spatial)+A.dot(this.rotational)}},{"./Vec3":30}],27:[function(v,A){function n(v){this.elements=v||[0,0,0,0,0,0,0,0,0]}A.exports=n;var E=v("./Vec3");n.prototype.identity=function(){var v=this.elements;v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=1,v[5]=0,v[6]=0,v[7]=0,v[8]=1},n.prototype.setZero=function(){var v=this.elements;v[0]=0,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=0,v[6]=0,v[7]=0,v[8]=0},n.prototype.setTrace=function(v){var A=this.elements;A[0]=v.x,A[4]=v.y,A[8]=v.z},n.prototype.getTrace=function(v){v=v||new E;var A=this.elements;v.x=A[0],v.y=A[4],v.z=A[8]},n.prototype.vmult=function(v,A){A=A||new E;var R=this.elements,M=v.x,O=v.y,V=v.z;return A.x=R[0]*M+R[1]*O+R[2]*V,A.y=R[3]*M+R[4]*O+R[5]*V,A.z=R[6]*M+R[7]*O+R[8]*V,A},n.prototype.smult=function(v){for(var A=0;A<this.elements.length;A++)this.elements[A]*=v},n.prototype.mmult=function(v,A){for(var E=A||new n,R=0;3>R;R++)for(var M=0;3>M;M++){for(var O=0,V=0;3>V;V++)O+=v.elements[R+3*V]*this.elements[V+3*M];E.elements[R+3*M]=O}return E},n.prototype.scale=function(v,A){A=A||new n;for(var E=this.elements,R=A.elements,M=0;3!==M;M++)R[3*M+0]=v.x*E[3*M+0],R[3*M+1]=v.y*E[3*M+1],R[3*M+2]=v.z*E[3*M+2];return A},n.prototype.solve=function(v,A){A=A||new E;for(var R=[],M=0;12>M;M++)R.push(0);var O;for(M=0;3>M;M++)for(O=0;3>O;O++)R[M+4*O]=this.elements[M+3*O];R[3]=v.x,R[7]=v.y,R[11]=v.z;var V,z,W=3,H=W;do{if(0===R[(M=H-W)+4*M])for(O=M+1;H>O;O++)if(0!==R[M+4*O]){V=4;do{R[(z=4-V)+4*M]+=R[z+4*O]}while(--V);break}if(0!==R[M+4*M])for(O=M+1;H>O;O++){var X=R[M+4*O]/R[M+4*M];V=4;do{R[(z=4-V)+4*O]=M>=z?0:R[z+4*O]-R[z+4*M]*X}while(--V)}}while(--W);if(A.z=R[11]/R[10],A.y=(R[7]-R[6]*A.z)/R[5],A.x=(R[3]-R[2]*A.z-R[1]*A.y)/R[0],isNaN(A.x)||isNaN(A.y)||isNaN(A.z)||1/0===A.x||1/0===A.y||1/0===A.z)throw"Could not solve equation! Got x=["+A.toString()+"], b=["+v.toString()+"], A=["+this.toString()+"]";return A},n.prototype.e=function(v,A,E){return void 0===E?this.elements[A+3*v]:void(this.elements[A+3*v]=E)},n.prototype.copy=function(v){for(var A=0;A<v.elements.length;A++)this.elements[A]=v.elements[A];return this},n.prototype.toString=function(){for(var v="",A=0;9>A;A++)v+=this.elements[A]+",";return v},n.prototype.reverse=function(v){v=v||new n;for(var A=[],E=0;18>E;E++)A.push(0);var R;for(E=0;3>E;E++)for(R=0;3>R;R++)A[E+6*R]=this.elements[E+3*R];A[3]=1,A[9]=0,A[15]=0,A[4]=0,A[10]=1,A[16]=0,A[5]=0,A[11]=0,A[17]=1;var M,O,V=3,z=V;do{if(0===A[(E=z-V)+6*E])for(R=E+1;z>R;R++)if(0!==A[E+6*R]){M=6;do{A[(O=6-M)+6*E]+=A[O+6*R]}while(--M);break}if(0!==A[E+6*E])for(R=E+1;z>R;R++){var W=A[E+6*R]/A[E+6*E];M=6;do{A[(O=6-M)+6*R]=E>=O?0:A[O+6*R]-A[O+6*E]*W}while(--M)}}while(--V);E=2;do{R=E-1;do{W=A[E+6*R]/A[E+6*E],M=6;do{A[(O=6-M)+6*R]=A[O+6*R]-A[O+6*E]*W}while(--M)}while(R--)}while(--E);E=2;do{W=1/A[E+6*E],M=6;do{A[(O=6-M)+6*E]=A[O+6*E]*W}while(--M)}while(E--);E=2;do{R=2;do{if(O=A[3+R+6*E],isNaN(O)||1/0===O)throw"Could not reverse! A=["+this.toString()+"]";v.e(E,R,O)}while(R--)}while(E--);return v},n.prototype.setRotationFromQuaternion=function(v){var A=v.x,E=v.y,R=v.z,M=v.w,O=A+A,V=E+E,z=R+R,W=A*O,H=A*V,X=A*z,K=E*V,Z=E*z,J=R*z,$=M*O,ee=M*V,ne=M*z,oe=this.elements;return oe[0]=1-(K+J),oe[1]=H-ne,oe[2]=X+ee,oe[3]=H+ne,oe[4]=1-(W+J),oe[5]=Z-$,oe[6]=X-ee,oe[7]=Z+$,oe[8]=1-(W+K),this},n.prototype.transpose=function(v){for(var A=(v=v||new n).elements,E=this.elements,R=0;3!==R;R++)for(var M=0;3!==M;M++)A[3*R+M]=E[3*M+R];return v}},{"./Vec3":30}],28:[function(v,A){function n(v,A,E,R){this.x=void 0!==v?v:0,this.y=void 0!==A?A:0,this.z=void 0!==E?E:0,this.w=void 0!==R?R:1}A.exports=n;var E=v("./Vec3");n.prototype.set=function(v,A,E,R){this.x=v,this.y=A,this.z=E,this.w=R},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(v,A){var E=Math.sin(.5*A);this.x=v.x*E,this.y=v.y*E,this.z=v.z*E,this.w=Math.cos(.5*A)},n.prototype.toAxisAngle=function(v){v=v||new E,this.normalize();var A=2*Math.acos(this.w),R=Math.sqrt(1-this.w*this.w);return.001>R?(v.x=this.x,v.y=this.y,v.z=this.z):(v.x=this.x/R,v.y=this.y/R,v.z=this.z/R),[v,A]};var R=new E,M=new E;n.prototype.setFromVectors=function(v,A){if(v.isAntiparallelTo(A)){var E=R,O=M;v.tangents(E,O),this.setFromAxisAngle(E,Math.PI)}else{var V=v.cross(A);this.x=V.x,this.y=V.y,this.z=V.z,this.w=Math.sqrt(Math.pow(v.norm(),2)*Math.pow(A.norm(),2))+v.dot(A),this.normalize()}};var O=new E,V=new E,z=new E;n.prototype.mult=function(v,A){A=A||new n;var E=this.w,R=O,M=V,W=z;return R.set(this.x,this.y,this.z),M.set(v.x,v.y,v.z),A.w=E*v.w-R.dot(M),R.cross(M,W),A.x=E*M.x+v.w*R.x+W.x,A.y=E*M.y+v.w*R.y+W.y,A.z=E*M.z+v.w*R.z+W.z,A},n.prototype.inverse=function(v){var A=this.x,E=this.y,R=this.z,M=this.w;v=v||new n,this.conjugate(v);var O=1/(A*A+E*E+R*R+M*M);return v.x*=O,v.y*=O,v.z*=O,v.w*=O,v},n.prototype.conjugate=function(v){return(v=v||new n).x=-this.x,v.y=-this.y,v.z=-this.z,v.w=this.w,v},n.prototype.normalize=function(){var v=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===v?(this.x=0,this.y=0,this.z=0,this.w=0):(v=1/v,this.x*=v,this.y*=v,this.z*=v,this.w*=v)},n.prototype.normalizeFast=function(){var v=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===v?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=v,this.y*=v,this.z*=v,this.w*=v)},n.prototype.vmult=function(v,A){A=A||new E;var R=v.x,M=v.y,O=v.z,V=this.x,z=this.y,W=this.z,H=this.w,X=H*R+z*O-W*M,K=H*M+W*R-V*O,Z=H*O+V*M-z*R,J=-V*R-z*M-W*O;return A.x=X*H+J*-V+K*-W-Z*-z,A.y=K*H+J*-z+Z*-V-X*-W,A.z=Z*H+J*-W+X*-z-K*-V,A},n.prototype.copy=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this},n.prototype.toEuler=function(v,A){A=A||"YZX";var E,R,M,O=this.x,V=this.y,z=this.z,W=this.w;if("YZX"!==A)throw new Error("Euler order "+A+" not supported yet.");var H=O*V+z*W;if(H>.499&&(E=2*Math.atan2(O,W),R=Math.PI/2,M=0),-.499>H&&(E=-2*Math.atan2(O,W),R=-Math.PI/2,M=0),isNaN(E)){var X=O*O,K=V*V,Z=z*z;E=Math.atan2(2*V*W-2*O*z,1-2*K-2*Z),R=Math.asin(2*H),M=Math.atan2(2*O*W-2*V*z,1-2*X-2*Z)}v.y=E,v.z=R,v.x=M},n.prototype.setFromEuler=function(v,A,E,R){R=R||"XYZ";var M=Math.cos(v/2),O=Math.cos(A/2),V=Math.cos(E/2),z=Math.sin(v/2),W=Math.sin(A/2),H=Math.sin(E/2);return"XYZ"===R?(this.x=z*O*V+M*W*H,this.y=M*W*V-z*O*H,this.z=M*O*H+z*W*V,this.w=M*O*V-z*W*H):"YXZ"===R?(this.x=z*O*V+M*W*H,this.y=M*W*V-z*O*H,this.z=M*O*H-z*W*V,this.w=M*O*V+z*W*H):"ZXY"===R?(this.x=z*O*V-M*W*H,this.y=M*W*V+z*O*H,this.z=M*O*H+z*W*V,this.w=M*O*V-z*W*H):"ZYX"===R?(this.x=z*O*V-M*W*H,this.y=M*W*V+z*O*H,this.z=M*O*H-z*W*V,this.w=M*O*V+z*W*H):"YZX"===R?(this.x=z*O*V+M*W*H,this.y=M*W*V+z*O*H,this.z=M*O*H-z*W*V,this.w=M*O*V-z*W*H):"XZY"===R&&(this.x=z*O*V-M*W*H,this.y=M*W*V-z*O*H,this.z=M*O*H+z*W*V,this.w=M*O*V+z*W*H),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(v,A){function n(v){v=v||{},this.position=new E,v.position&&this.position.copy(v.position),this.quaternion=new R,v.quaternion&&this.quaternion.copy(v.quaternion)}var E=v("./Vec3"),R=v("./Quaternion");A.exports=n;var M=new R;n.pointToLocalFrame=function(v,A,R,O){return O=O||new E,R.vsub(v,O),A.conjugate(M),M.vmult(O,O),O},n.prototype.pointToLocal=function(v,A){return n.pointToLocalFrame(this.position,this.quaternion,v,A)},n.pointToWorldFrame=function(v,A,R,M){return M=M||new E,A.vmult(R,M),M.vadd(v,M),M},n.prototype.pointToWorld=function(v,A){return n.pointToWorldFrame(this.position,this.quaternion,v,A)},n.prototype.vectorToWorldFrame=function(v,A){return A=A||new E,this.quaternion.vmult(v,A),A},n.vectorToWorldFrame=function(v,A,E){return v.vmult(A,E),E},n.vectorToLocalFrame=function(v,A,R,M){return M=M||new E,A.w*=-1,A.vmult(R,M),A.w*=-1,M}},{"./Quaternion":28,"./Vec3":30}],30:[function(v,A){function n(v,A,E){this.x=v||0,this.y=A||0,this.z=E||0}A.exports=n;var E=v("./Mat3");n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1),n.prototype.cross=function(v,A){var E=v.x,R=v.y,M=v.z,O=this.x,V=this.y,z=this.z;return(A=A||new n).x=V*M-z*R,A.y=z*E-O*M,A.z=O*R-V*E,A},n.prototype.set=function(v,A,E){return this.x=v,this.y=A,this.z=E,this},n.prototype.setZero=function(){this.x=this.y=this.z=0},n.prototype.vadd=function(v,A){return A?(A.x=v.x+this.x,A.y=v.y+this.y,void(A.z=v.z+this.z)):new n(this.x+v.x,this.y+v.y,this.z+v.z)},n.prototype.vsub=function(v,A){return A?(A.x=this.x-v.x,A.y=this.y-v.y,void(A.z=this.z-v.z)):new n(this.x-v.x,this.y-v.y,this.z-v.z)},n.prototype.crossmat=function(){return new E([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},n.prototype.normalize=function(){var v=this.x,A=this.y,E=this.z,R=Math.sqrt(v*v+A*A+E*E);if(R>0){var M=1/R;this.x*=M,this.y*=M,this.z*=M}else this.x=0,this.y=0,this.z=0;return R},n.prototype.unit=function(v){v=v||new n;var A=this.x,E=this.y,R=this.z,M=Math.sqrt(A*A+E*E+R*R);return M>0?(M=1/M,v.x=A*M,v.y=E*M,v.z=R*M):(v.x=1,v.y=0,v.z=0),v},n.prototype.norm=function(){var v=this.x,A=this.y,E=this.z;return Math.sqrt(v*v+A*A+E*E)},n.prototype.length=n.prototype.norm,n.prototype.norm2=function(){return this.dot(this)},n.prototype.lengthSquared=n.prototype.norm2,n.prototype.distanceTo=function(v){var A=this.x,E=this.y,R=this.z,M=v.x,O=v.y,V=v.z;return Math.sqrt((M-A)*(M-A)+(O-E)*(O-E)+(V-R)*(V-R))},n.prototype.distanceSquared=function(v){var A=this.x,E=this.y,R=this.z,M=v.x,O=v.y,V=v.z;return(M-A)*(M-A)+(O-E)*(O-E)+(V-R)*(V-R)},n.prototype.mult=function(v,A){A=A||new n;var E=this.x,R=this.y,M=this.z;return A.x=v*E,A.y=v*R,A.z=v*M,A},n.prototype.scale=n.prototype.mult,n.prototype.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.negate=function(v){return(v=v||new n).x=-this.x,v.y=-this.y,v.z=-this.z,v};var R=new n,M=new n;n.prototype.tangents=function(v,A){var E=this.norm();if(E>0){var O=R,V=1/E;O.set(this.x*V,this.y*V,this.z*V);var z=M;Math.abs(O.x)<.9?(z.set(1,0,0),O.cross(z,v)):(z.set(0,1,0),O.cross(z,v)),O.cross(v,A)}else v.set(1,0,0),A.set(0,1,0)},n.prototype.toString=function(){return this.x+","+this.y+","+this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.copy=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},n.prototype.lerp=function(v,A,E){var R=this.x,M=this.y,O=this.z;E.x=R+(v.x-R)*A,E.y=M+(v.y-M)*A,E.z=O+(v.z-O)*A},n.prototype.almostEquals=function(v,A){return void 0===A&&(A=1e-6),!(Math.abs(this.x-v.x)>A||Math.abs(this.y-v.y)>A||Math.abs(this.z-v.z)>A)},n.prototype.almostZero=function(v){return void 0===v&&(v=1e-6),!(Math.abs(this.x)>v||Math.abs(this.y)>v||Math.abs(this.z)>v)};var O=new n;n.prototype.isAntiparallelTo=function(v,A){return this.negate(O),O.almostEquals(v,A)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(v,A){function n(v){v=v||{},E.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new R,this.collisionFilterGroup="number"==typeof v.collisionFilterGroup?v.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof v.collisionFilterMask?v.collisionFilterMask:1,this.collisionResponse=!0,this.position=new R,v.position&&this.position.copy(v.position),this.previousPosition=new R,this.initPosition=new R,this.velocity=new R,v.velocity&&this.velocity.copy(v.velocity),this.initVelocity=new R,this.force=new R;var A="number"==typeof v.mass?v.mass:0;this.mass=A,this.invMass=A>0?1/A:0,this.material=v.material||null,this.linearDamping="number"==typeof v.linearDamping?v.linearDamping:.01,this.type=0>=A?n.STATIC:n.DYNAMIC,typeof v.type==typeof n.STATIC&&(this.type=v.type),this.allowSleep=void 0===v.allowSleep||v.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==v.sleepSpeedLimit?v.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==v.sleepTimeLimit?v.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new R,this.quaternion=new O,v.quaternion&&this.quaternion.copy(v.quaternion),this.initQuaternion=new O,this.angularVelocity=new R,v.angularVelocity&&this.angularVelocity.copy(v.angularVelocity),this.initAngularVelocity=new R,this.interpolatedPosition=new R,this.interpolatedQuaternion=new O,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new R,this.invInertia=new R,this.invInertiaWorld=new M,this.invMassSolve=0,this.invInertiaSolve=new R,this.invInertiaWorldSolve=new M,this.fixedRotation=void 0!==v.fixedRotation&&v.fixedRotation,this.angularDamping=void 0!==v.angularDamping?v.angularDamping:.01,this.aabb=new V,this.aabbNeedsUpdate=!0,this.wlambda=new R,v.shape&&this.addShape(v.shape),this.updateMassProperties()}A.exports=n;var E=v("../utils/EventTarget"),R=(v("../shapes/Shape"),v("../math/Vec3")),M=v("../math/Mat3"),O=v("../math/Quaternion"),V=(v("../material/Material"),v("../collision/AABB")),z=v("../shapes/Box");n.prototype=new E,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var v=this.sleepState;this.sleepState=0,v===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(v){if(this.allowSleep){var A=this.sleepState,E=this.velocity.norm2()+this.angularVelocity.norm2(),R=Math.pow(this.sleepSpeedLimit,2);A===n.AWAKE&&R>E?(this.sleepState=n.SLEEPY,this.timeLastSleepy=v,this.dispatchEvent(n.sleepyEvent)):A===n.SLEEPY&&E>R?this.wakeUp():A===n.SLEEPY&&v-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(v,A){return A=A||new R,v.vsub(this.position,A),this.quaternion.conjugate().vmult(A,A),A},n.prototype.vectorToLocalFrame=function(v,A){return A=A||new R,this.quaternion.conjugate().vmult(v,A),A},n.prototype.pointToWorldFrame=function(v,A){return A=A||new R,this.quaternion.vmult(v,A),A.vadd(this.position,A),A},n.prototype.vectorToWorldFrame=function(v,A){return A=A||new R,this.quaternion.vmult(v,A),A};var W=new R,H=new O;n.prototype.addShape=function(v,A,E){var M=new R,V=new O;return A&&M.copy(A),E&&V.copy(E),this.shapes.push(v),this.shapeOffsets.push(M),this.shapeOrientations.push(V),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var v=this.shapes,A=this.shapeOffsets,E=v.length,R=0,M=0;M!==E;M++){var O=v[M];O.updateBoundingSphereRadius();var V=A[M].norm(),z=O.boundingSphereRadius;V+z>R&&(R=V+z)}this.boundingRadius=R};var X=new V;n.prototype.computeAABB=function(){for(var v=this.shapes,A=this.shapeOffsets,E=this.shapeOrientations,R=v.length,M=W,O=H,V=this.quaternion,z=this.aabb,K=X,Z=0;Z!==R;Z++){var J=v[Z];E[Z].mult(V,O),O.vmult(A[Z],M),M.vadd(this.position,M),J.calculateWorldAABB(M,O,K.lowerBound,K.upperBound),0===Z?z.copy(K):z.extend(K)}this.aabbNeedsUpdate=!1};var K=new M,Z=new M;new M,n.prototype.updateInertiaWorld=function(v){var A=this.invInertia;if(A.x!==A.y||A.y!==A.z||v){var E=K,R=Z;E.setRotationFromQuaternion(this.quaternion),E.transpose(R),E.scale(A,E),E.mmult(R,this.invInertiaWorld)}};var J=new R,$=new R;n.prototype.applyForce=function(v,A){if(this.type===n.DYNAMIC){var E=J;A.vsub(this.position,E);var R=$;E.cross(v,R),this.force.vadd(v,this.force),this.torque.vadd(R,this.torque)}};var ee=new R,ne=new R;n.prototype.applyLocalForce=function(v,A){if(this.type===n.DYNAMIC){var E=ee,R=ne;this.vectorToWorldFrame(v,E),this.pointToWorldFrame(A,R),this.applyForce(E,R)}};var oe=new R,ie=new R,ae=new R;n.prototype.applyImpulse=function(v,A){if(this.type===n.DYNAMIC){var E=oe;A.vsub(this.position,E);var R=ie;R.copy(v),R.mult(this.invMass,R),this.velocity.vadd(R,this.velocity);var M=ae;E.cross(v,M),this.invInertiaWorld.vmult(M,M),this.angularVelocity.vadd(M,this.angularVelocity)}};var se=new R,le=new R;n.prototype.applyLocalImpulse=function(v,A){if(this.type===n.DYNAMIC){var E=se,R=le;this.vectorToWorldFrame(v,E),this.pointToWorldFrame(A,R),this.applyImpulse(E,R)}};var ce=new R;n.prototype.updateMassProperties=function(){var v=ce;this.invMass=this.mass>0?1/this.mass:0;var A=this.inertia,E=this.fixedRotation;this.computeAABB(),v.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),z.calculateInertia(v,this.mass,A),this.invInertia.set(A.x>0&&!E?1/A.x:0,A.y>0&&!E?1/A.y:0,A.z>0&&!E?1/A.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(v,A){var E=new R;return v.vsub(this.position,E),this.angularVelocity.cross(E,A),this.velocity.vadd(A,A),A}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(v,A){function n(v){this.chassisBody=v.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==v.indexRightAxis?v.indexRightAxis:1,this.indexForwardAxis=void 0!==v.indexForwardAxis?v.indexForwardAxis:0,this.indexUpAxis=void 0!==v.indexUpAxis?v.indexUpAxis:2}function o(v,A,E,R,M){var O=0,V=E,z=ee,W=ne,H=oe;return v.getVelocityAtWorldPoint(V,z),A.getVelocityAtWorldPoint(V,W),z.vsub(W,H),(O=-R.dot(H)*(1/(d(v,E,R)+d(A,E,R))))>M&&(O=M),-M>O&&(O=-M),O}function d(v,A,E){var R=ie,M=ae,O=se,V=le;return A.vsub(v.position,R),R.cross(E,M),v.invInertiaWorld.vmult(M,V),V.cross(R,O),v.invMass+E.dot(O)}function i(v,A,E,R,M,O){if(M.norm2()>1.1)return 0;var V=ce,z=ue,W=de;return v.getVelocityAtWorldPoint(A,V),E.getVelocityAtWorldPoint(R,z),V.vsub(z,W),-.2*M.dot(W)*(1/(v.invMass+E.invMass))}var E=(v("./Body"),v("../math/Vec3")),R=v("../math/Quaternion"),M=(v("../collision/RaycastResult"),v("../collision/Ray")),O=v("../objects/WheelInfo");A.exports=n;var V=(new E,new E,new E,new E),z=new E,W=new E;new M,n.prototype.addWheel=function(v){var A=new O(v=v||{}),E=this.wheelInfos.length;return this.wheelInfos.push(A),E},n.prototype.setSteeringValue=function(v,A){this.wheelInfos[A].steering=v},new E,n.prototype.applyEngineForce=function(v,A){this.wheelInfos[A].engineForce=v},n.prototype.setBrake=function(v,A){this.wheelInfos[A].brake=v},n.prototype.addToWorld=function(v){this.constraints,v.add(this.chassisBody);var A=this;this.preStepCallback=function(){A.updateVehicle(v.dt)},v.addEventListener("preStep",this.preStepCallback),this.world=v},n.prototype.getVehicleAxisWorld=function(v,A){A.set(0===v?1:0,1===v?1:0,2===v?1:0),this.chassisBody.vectorToWorldFrame(A,A)},n.prototype.updateVehicle=function(v){for(var A=this.wheelInfos,R=A.length,M=this.chassisBody,O=0;R>O;O++)this.updateWheelTransform(O);this.currentVehicleSpeedKmHour=3.6*M.velocity.norm();var V=new E;for(this.getVehicleAxisWorld(this.indexForwardAxis,V),V.dot(M.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),O=0;R>O;O++)this.castRay(A[O]);this.updateSuspension(v);var z=new E,W=new E;for(O=0;R>O;O++){var H=(J=A[O]).suspensionForce;H>J.maxSuspensionForce&&(H=J.maxSuspensionForce),J.raycastResult.hitNormalWorld.scale(H*v,z),J.raycastResult.hitPointWorld.vsub(M.position,W),M.applyImpulse(z,J.raycastResult.hitPointWorld)}this.updateFriction(v);var X=new E,K=new E,Z=new E;for(O=0;R>O;O++){var J=A[O];M.getVelocityAtWorldPoint(J.chassisConnectionPointWorld,Z);var $=1;if(1===this.indexUpAxis&&($=-1),J.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,K);var ee=K.dot(J.raycastResult.hitNormalWorld);J.raycastResult.hitNormalWorld.scale(ee,X),K.vsub(X,K);var ne=K.dot(Z);J.deltaRotation=$*ne*v/J.radius}!J.sliding&&J.isInContact||0===J.engineForce||!J.useCustomSlidingRotationalSpeed||(J.deltaRotation=(J.engineForce>0?1:-1)*J.customSlidingRotationalSpeed*v),Math.abs(J.brake)>Math.abs(J.engineForce)&&(J.deltaRotation=0),J.rotation+=J.deltaRotation,J.deltaRotation*=.99}},n.prototype.updateSuspension=function(){for(var v=this.chassisBody.mass,A=this.wheelInfos,E=A.length,R=0;E>R;R++){var M=A[R];if(M.isInContact){var O,V=M.suspensionRestLength-M.suspensionLength;O=M.suspensionStiffness*V*M.clippedInvContactDotSuspension;var z=M.suspensionRelativeVelocity;O-=(0>z?M.dampingCompression:M.dampingRelaxation)*z,M.suspensionForce=O*v,M.suspensionForce<0&&(M.suspensionForce=0)}else M.suspensionForce=0}},n.prototype.removeFromWorld=function(v){this.constraints,v.remove(this.chassisBody),v.removeEventListener("preStep",this.preStepCallback),this.world=null};var H=new E,X=new E;n.prototype.castRay=function(v){var A=H,R=X;this.updateWheelTransformWorld(v);var M=this.chassisBody,O=-1,V=v.suspensionRestLength+v.radius;v.directionWorld.scale(V,A);var z=v.chassisConnectionPointWorld;z.vadd(A,R);var W=v.raycastResult;W.reset();var K=M.collisionResponse;M.collisionResponse=!1,this.world.rayTest(z,R,W),M.collisionResponse=K;var Z=W.body;if(v.raycastResult.groundObject=0,Z){O=W.distance,v.raycastResult.hitNormalWorld=W.hitNormalWorld,v.isInContact=!0;var J=W.distance;v.suspensionLength=J-v.radius;var $=v.suspensionRestLength-v.maxSuspensionTravel,ee=v.suspensionRestLength+v.maxSuspensionTravel;v.suspensionLength<$&&(v.suspensionLength=$),v.suspensionLength>ee&&(v.suspensionLength=ee,v.raycastResult.reset());var ne=v.raycastResult.hitNormalWorld.dot(v.directionWorld),oe=new E;M.getVelocityAtWorldPoint(v.raycastResult.hitPointWorld,oe);var ie=v.raycastResult.hitNormalWorld.dot(oe);if(ne>=-.1)v.suspensionRelativeVelocity=0,v.clippedInvContactDotSuspension=10;else{var ae=-1/ne;v.suspensionRelativeVelocity=ie*ae,v.clippedInvContactDotSuspension=ae}}else v.suspensionLength=v.suspensionRestLength+0*v.maxSuspensionTravel,v.suspensionRelativeVelocity=0,v.directionWorld.scale(-1,v.raycastResult.hitNormalWorld),v.clippedInvContactDotSuspension=1;return O},n.prototype.updateWheelTransformWorld=function(v){v.isInContact=!1;var A=this.chassisBody;A.pointToWorldFrame(v.chassisConnectionPointLocal,v.chassisConnectionPointWorld),A.vectorToWorldFrame(v.directionLocal,v.directionWorld),A.vectorToWorldFrame(v.axleLocal,v.axleWorld)},n.prototype.updateWheelTransform=function(v){var A=V,E=z,M=W,O=this.wheelInfos[v];this.updateWheelTransformWorld(O),O.directionLocal.scale(-1,A),E.copy(O.axleLocal),A.cross(E,M),M.normalize(),E.normalize();var H=O.steering,X=new R;X.setFromAxisAngle(A,H);var K=new R;K.setFromAxisAngle(E,O.rotation);var Z=O.worldTransform.quaternion;this.chassisBody.quaternion.mult(X,Z),Z.mult(K,Z),Z.normalize();var J=O.worldTransform.position;J.copy(O.directionWorld),J.scale(O.suspensionLength,J),J.vadd(O.chassisConnectionPointWorld,J)};var K=[new E(1,0,0),new E(0,1,0),new E(0,0,1)];n.prototype.getWheelTransformWorld=function(v){return this.wheelInfos[v].worldTransform};var Z=new E,J=[],$=[];n.prototype.updateFriction=function(v){for(var A=Z,R=this.wheelInfos,M=R.length,O=this.chassisBody,V=$,z=J,W=0;M>W;W++)ne=(he=R[W]).raycastResult.body,he.sideImpulse=0,he.forwardImpulse=0,V[W]||(V[W]=new E),z[W]||(z[W]=new E);for(W=0;M>W;W++)if(ne=(he=R[W]).raycastResult.body){var H=z[W];this.getWheelTransformWorld(W).vectorToWorldFrame(K[this.indexRightAxis],H);var X=he.raycastResult.hitNormalWorld,ee=H.dot(X);X.scale(ee,A),H.vsub(A,H),H.normalize(),X.cross(H,V[W]),V[W].normalize(),he.sideImpulse=i(O,he.raycastResult.hitPointWorld,ne,he.raycastResult.hitPointWorld,H),he.sideImpulse*=1}for(this.sliding=!1,W=0;M>W;W++){var ne=(he=R[W]).raycastResult.body,oe=0;if(he.slipInfo=1,ne){var ie=he.brake?he.brake:0;oe=o(O,ne,he.raycastResult.hitPointWorld,V[W],ie);var ae=ie/(oe+=he.engineForce*v);he.slipInfo*=ae}if(he.forwardImpulse=0,he.skidInfo=1,ne){he.skidInfo=1;var se=he.suspensionForce*v*he.frictionSlip,le=se*se;he.forwardImpulse=oe;var ce=.5*he.forwardImpulse,ue=1*he.sideImpulse,de=ce*ce+ue*ue;he.sliding=!1,de>le&&(this.sliding=!0,he.sliding=!0,ae=se/Math.sqrt(de),he.skidInfo*=ae)}}if(this.sliding)for(W=0;M>W;W++)0!==(he=R[W]).sideImpulse&&he.skidInfo<1&&(he.forwardImpulse*=he.skidInfo,he.sideImpulse*=he.skidInfo);for(W=0;M>W;W++){var he=R[W],me=new E;if(me.copy(he.raycastResult.hitPointWorld),0!==he.forwardImpulse){var fe=new E;V[W].scale(he.forwardImpulse,fe),O.applyImpulse(fe,me)}if(0!==he.sideImpulse){ne=he.raycastResult.body;var ye=new E;ye.copy(he.raycastResult.hitPointWorld);var we=new E;z[W].scale(he.sideImpulse,we),O.pointToLocalFrame(me,me),me["xyz"[this.indexUpAxis]]*=he.rollInfluence,O.pointToWorldFrame(me,me),O.applyImpulse(we,me),we.scale(-1,we),ne.applyImpulse(we,ye)}}};var ee=new E,ne=new E,oe=new E,ie=new E,ae=new E,se=new E,le=new E,ce=new E,ue=new E,de=new E},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(v,A){function n(v){if(this.wheelBodies=[],this.coordinateSystem=void 0===v.coordinateSystem?new O(1,2,3):v.coordinateSystem.clone(),this.chassisBody=v.chassisBody,!this.chassisBody){var A=new M(new O(5,2,.5));this.chassisBody=new E(1,A)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var E=v("./Body"),R=v("../shapes/Sphere"),M=v("../shapes/Box"),O=v("../math/Vec3"),V=v("../constraints/HingeConstraint");A.exports=n,n.prototype.addWheel=function(v){var A=(v=v||{}).body;A||(A=new E(1,new R(1.2))),this.wheelBodies.push(A),this.wheelForces.push(0);var M=(new O,void 0!==v.position?v.position.clone():new O),z=new O;this.chassisBody.pointToWorldFrame(M,z),A.position.set(z.x,z.y,z.z);var W=void 0!==v.axis?v.axis.clone():new O(0,1,0);this.wheelAxes.push(W);var H=new V(this.chassisBody,A,{pivotA:M,axisA:W,pivotB:O.ZERO,axisB:W,collideConnected:!1});return this.constraints.push(H),this.wheelBodies.length-1},n.prototype.setSteeringValue=function(v,A){var E=this.wheelAxes[A],R=Math.cos(v),M=Math.sin(v),O=E.x,V=E.y;this.constraints[A].axisA.set(R*O-M*V,M*O+R*V,0)},n.prototype.setMotorSpeed=function(v,A){var E=this.constraints[A];E.enableMotor(),E.motorTargetVelocity=v},n.prototype.disableMotor=function(v){this.constraints[v].disableMotor()};var z=new O;n.prototype.setWheelForce=function(v,A){this.wheelForces[A]=v},n.prototype.applyWheelForce=function(v,A){var E=this.wheelAxes[A],R=this.wheelBodies[A],M=R.torque;E.scale(v,z),R.vectorToWorldFrame(z,z),M.vadd(z,M)},n.prototype.addToWorld=function(v){for(var A=this.constraints,E=this.wheelBodies.concat([this.chassisBody]),R=0;R<E.length;R++)v.add(E[R]);for(R=0;R<A.length;R++)v.addConstraint(A[R]);v.addEventListener("preStep",this._update.bind(this))},n.prototype._update=function(){for(var v=this.wheelForces,A=0;A<v.length;A++)this.applyWheelForce(v[A],A)},n.prototype.removeFromWorld=function(v){for(var A=this.constraints,E=this.wheelBodies.concat([this.chassisBody]),R=0;R<E.length;R++)v.remove(E[R]);for(R=0;R<A.length;R++)v.removeConstraint(A[R])};var W=new O;n.prototype.getWheelSpeed=function(v){var A=this.wheelAxes[v],E=this.wheelBodies[v].angularVelocity;return this.chassisBody.vectorToWorldFrame(A,W),E.dot(W)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(v,A){function n(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}A.exports=n;var E=(v("../shapes/Shape"),v("../math/Vec3"));v("../math/Quaternion"),v("../shapes/Particle"),v("../objects/Body"),v("../material/Material"),n.prototype.add=function(v){this.particles.push(v),this.neighbors.length<this.particles.length&&this.neighbors.push([])},n.prototype.remove=function(v){var A=this.particles.indexOf(v);-1!==A&&(this.particles.splice(A,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var R=new E;n.prototype.getNeighbors=function(v,A){for(var E=this.particles.length,M=v.id,O=this.smoothingRadius*this.smoothingRadius,V=R,z=0;z!==E;z++){var W=this.particles[z];W.position.vsub(v.position,V),M!==W.id&&V.norm2()<O&&A.push(W)}};var M=new E,O=new E,V=new E,z=new E,W=new E,H=new E;n.prototype.update=function(){for(var v=this.particles.length,A=M,E=this.speedOfSound,R=this.eps,X=0;X!==v;X++){var K=this.particles[X];(de=this.neighbors[X]).length=0,this.getNeighbors(K,de),de.push(this.particles[X]);for(var Z=de.length,J=0,$=0;$!==Z;$++){K.position.vsub(de[$].position,A);var ee=A.norm(),ne=this.w(ee);J+=de[$].mass*ne}this.densities[X]=J,this.pressures[X]=E*E*(this.densities[X]-this.density)}var oe=O,ie=V,ae=z,se=W,le=H;for(X=0;X!==v;X++){var ce,ue,de,he=this.particles[X];for(oe.set(0,0,0),ie.set(0,0,0),Z=(de=this.neighbors[X]).length,$=0;$!==Z;$++){var me=de[$];he.position.vsub(me.position,se);var fe=se.norm();ce=-me.mass*(this.pressures[X]/(this.densities[X]*this.densities[X]+R)+this.pressures[$]/(this.densities[$]*this.densities[$]+R)),this.gradw(se,ae),ae.mult(ce,ae),oe.vadd(ae,oe),me.velocity.vsub(he.velocity,le),le.mult(1/(1e-4+this.densities[X]*this.densities[$])*this.viscosity*me.mass,le),ue=this.nablaw(fe),le.mult(ue,le),ie.vadd(le,ie)}ie.mult(he.mass,ie),oe.mult(he.mass,oe),he.force.vadd(ie,he.force),he.force.vadd(oe,he.force)}},n.prototype.w=function(v){var A=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(A,9))*Math.pow(A*A-v*v,3)},n.prototype.gradw=function(v,A){var E=v.norm(),R=this.smoothingRadius;v.mult(945/(32*Math.PI*Math.pow(R,9))*Math.pow(R*R-E*E,2),A)},n.prototype.nablaw=function(v){var A=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(A,9))*(A*A-v*v)*(7*v*v-3*A*A)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(v,A){function n(v,A,R){R=R||{},this.restLength="number"==typeof R.restLength?R.restLength:1,this.stiffness=R.stiffness||100,this.damping=R.damping||1,this.bodyA=v,this.bodyB=A,this.localAnchorA=new E,this.localAnchorB=new E,R.localAnchorA&&this.localAnchorA.copy(R.localAnchorA),R.localAnchorB&&this.localAnchorB.copy(R.localAnchorB),R.worldAnchorA&&this.setWorldAnchorA(R.worldAnchorA),R.worldAnchorB&&this.setWorldAnchorB(R.worldAnchorB)}var E=v("../math/Vec3");A.exports=n,n.prototype.setWorldAnchorA=function(v){this.bodyA.pointToLocalFrame(v,this.localAnchorA)},n.prototype.setWorldAnchorB=function(v){this.bodyB.pointToLocalFrame(v,this.localAnchorB)},n.prototype.getWorldAnchorA=function(v){this.bodyA.pointToWorldFrame(this.localAnchorA,v)},n.prototype.getWorldAnchorB=function(v){this.bodyB.pointToWorldFrame(this.localAnchorB,v)};var R=new E,M=new E,O=new E,V=new E,z=new E,W=new E,H=new E,X=new E,K=new E,Z=new E,J=new E;n.prototype.applyForce=function(){var v=this.stiffness,A=this.damping,E=this.restLength,$=this.bodyA,ee=this.bodyB,ne=R,oe=M,ie=O,ae=V,se=J,le=z,ce=W,ue=H,de=X,he=K,me=Z;this.getWorldAnchorA(le),this.getWorldAnchorB(ce),le.vsub($.position,ue),ce.vsub(ee.position,de),ce.vsub(le,ne);var fe=ne.norm();oe.copy(ne),oe.normalize(),ee.velocity.vsub($.velocity,ie),ee.angularVelocity.cross(de,se),ie.vadd(se,ie),$.angularVelocity.cross(ue,se),ie.vsub(se,ie),oe.mult(-v*(fe-E)-A*ie.dot(oe),ae),$.force.vsub(ae,$.force),ee.force.vadd(ae,ee.force),ue.cross(ae,he),de.cross(ae,me),$.torque.vsub(he,$.torque),ee.torque.vadd(me,ee.torque)}},{"../math/Vec3":30}],36:[function(v,A){function n(v){v=O.defaults(v,{chassisConnectionPointLocal:new E,chassisConnectionPointWorld:new E,directionLocal:new E,directionWorld:new E,axleLocal:new E,axleWorld:new E,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=v.maxSuspensionTravel,this.customSlidingRotationalSpeed=v.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=v.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=v.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=v.chassisConnectionPointWorld.clone(),this.directionLocal=v.directionLocal.clone(),this.directionWorld=v.directionWorld.clone(),this.axleLocal=v.axleLocal.clone(),this.axleWorld=v.axleWorld.clone(),this.suspensionRestLength=v.suspensionRestLength,this.suspensionMaxLength=v.suspensionMaxLength,this.radius=v.radius,this.suspensionStiffness=v.suspensionStiffness,this.dampingCompression=v.dampingCompression,this.dampingRelaxation=v.dampingRelaxation,this.frictionSlip=v.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=v.rollInfluence,this.maxSuspensionForce=v.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=v.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new M,this.worldTransform=new R,this.isInContact=!1}var E=v("../math/Vec3"),R=v("../math/Transform"),M=v("../collision/RaycastResult"),O=v("../utils/Utils");A.exports=n;var V=new E,z=new E;V=new E,n.prototype.updateWheel=function(v){var A=this.raycastResult;if(this.isInContact){var E=A.hitNormalWorld.dot(A.directionWorld);A.hitPointWorld.vsub(v.position,z),v.getVelocityAtWorldPoint(z,V);var R=A.hitNormalWorld.dot(V);if(E>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var M=-1/E;this.suspensionRelativeVelocity=R*M,this.clippedInvContactDotSuspension=M}}else A.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,A.directionWorld.scale(-1,A.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(v,A){function n(v){E.call(this),this.type=E.types.BOX,this.halfExtents=v,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3"),M=v("./ConvexPolyhedron");n.prototype=new E,n.prototype.constructor=n,n.prototype.updateConvexPolyhedronRepresentation=function(){var v=this.halfExtents.x,A=this.halfExtents.y,E=this.halfExtents.z,O=R,V=[new O(-v,-A,-E),new O(v,-A,-E),new O(v,A,-E),new O(-v,A,-E),new O(-v,-A,E),new O(v,-A,E),new O(v,A,E),new O(-v,A,E)],z=(new O(0,0,1),new O(0,1,0),new O(1,0,0),new M(V,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=z,z.material=this.material},n.prototype.calculateLocalInertia=function(v,A){return A=A||new R,n.calculateInertia(this.halfExtents,v,A),A},n.calculateInertia=function(v,A,E){var R=v;E.x=1/12*A*(2*R.y*2*R.y+2*R.z*2*R.z),E.y=1/12*A*(2*R.x*2*R.x+2*R.z*2*R.z),E.z=1/12*A*(2*R.y*2*R.y+2*R.x*2*R.x)},n.prototype.getSideNormals=function(v,A){var E=v,R=this.halfExtents;if(E[0].set(R.x,0,0),E[1].set(0,R.y,0),E[2].set(0,0,R.z),E[3].set(-R.x,0,0),E[4].set(0,-R.y,0),E[5].set(0,0,-R.z),void 0!==A)for(var M=0;M!==E.length;M++)A.vmult(E[M],E[M]);return E},n.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var O=new R;new R,n.prototype.forEachWorldCorner=function(v,A,E){for(var R=this.halfExtents,M=[[R.x,R.y,R.z],[-R.x,R.y,R.z],[-R.x,-R.y,R.z],[-R.x,-R.y,-R.z],[R.x,-R.y,-R.z],[R.x,R.y,-R.z],[-R.x,R.y,-R.z],[R.x,-R.y,R.z]],V=0;V<M.length;V++)O.set(M[V][0],M[V][1],M[V][2]),A.vmult(O,O),v.vadd(O,O),E(O.x,O.y,O.z)};var V=[new R,new R,new R,new R,new R,new R,new R,new R];n.prototype.calculateWorldAABB=function(v,A,E,R){var M=this.halfExtents;V[0].set(M.x,M.y,M.z),V[1].set(-M.x,M.y,M.z),V[2].set(-M.x,-M.y,M.z),V[3].set(-M.x,-M.y,-M.z),V[4].set(M.x,-M.y,-M.z),V[5].set(M.x,M.y,-M.z),V[6].set(-M.x,M.y,-M.z),V[7].set(M.x,-M.y,M.z);var O=V[0];A.vmult(O,O),v.vadd(O,O),R.copy(O),E.copy(O);for(var z=1;8>z;z++){O=V[z],A.vmult(O,O),v.vadd(O,O);var W=O.x,H=O.y,X=O.z;W>R.x&&(R.x=W),H>R.y&&(R.y=H),X>R.z&&(R.z=X),W<E.x&&(E.x=W),H<E.y&&(E.y=H),X<E.z&&(E.z=X)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(v,A){function n(v,A,R){E.call(this),this.type=E.types.CONVEXPOLYHEDRON,this.vertices=v||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=A||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=R?R.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3"),M=(v("../math/Quaternion"),v("../math/Transform"));n.prototype=new E,n.prototype.constructor=n;var O=new R;n.prototype.computeEdges=function(){var v=this.faces,A=this.vertices,E=(A.length,this.uniqueEdges);E.length=0;for(var R=O,M=0;M!==v.length;M++)for(var V=v[M],z=V.length,W=0;W!==z;W++){var H=(W+1)%z;A[V[W]].vsub(A[V[H]],R),R.normalize();for(var X=!1,K=0;K!==E.length;K++)if(E[K].almostEquals(R)||E[K].almostEquals(R)){X=!0;break}X||E.push(R.clone())}},n.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var v=0;v<this.faces.length;v++){for(var A=0;A<this.faces[v].length;A++)if(!this.vertices[this.faces[v][A]])throw new Error("Vertex "+this.faces[v][A]+" not found!");var E=this.faceNormals[v]||new R;this.getFaceNormal(v,E),E.negate(E),this.faceNormals[v]=E;var M=this.vertices[this.faces[v][0]];if(E.dot(M)<0)for(console.error(".faceNormals["+v+"] = Vec3("+E.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),A=0;A<this.faces[v].length;A++)console.warn(".vertices["+this.faces[v][A]+"] = Vec3("+this.vertices[this.faces[v][A]].toString()+")")}};var V=new R,z=new R;n.computeNormal=function(v,A,E,R){A.vsub(v,z),E.vsub(A,V),V.cross(z,R),R.isZero()||R.normalize()},n.prototype.getFaceNormal=function(v,A){var E=this.faces[v],R=this.vertices[E[0]],M=this.vertices[E[1]],O=this.vertices[E[2]];return n.computeNormal(R,M,O,A)};var W=new R;n.prototype.clipAgainstHull=function(v,A,E,M,O,V,z,H,X){for(var K=W,Z=-1,J=-Number.MAX_VALUE,$=0;$<E.faces.length;$++){K.copy(E.faceNormals[$]),O.vmult(K,K);var ee=K.dot(V);ee>J&&(J=ee,Z=$)}for(var ne=[],oe=E.faces[Z],ie=oe.length,ae=0;ie>ae;ae++){var se=E.vertices[oe[ae]],le=new R;le.copy(se),O.vmult(le,le),M.vadd(le,le),ne.push(le)}Z>=0&&this.clipFaceAgainstHull(V,v,A,ne,z,H,X)};var H=new R,X=new R,K=new R,Z=new R,J=new R,$=new R;n.prototype.findSeparatingAxis=function(v,A,E,R,M,O,V,z){var W=H,ee=X,ne=K,oe=Z,ie=J,ae=$,se=Number.MAX_VALUE,le=this;if(le.uniqueAxes)for(var ce=0;ce!==le.uniqueAxes.length;ce++){if(E.vmult(le.uniqueAxes[ce],W),!1===(me=le.testSepAxis(W,v,A,E,R,M)))return!1;se>me&&(se=me,O.copy(W))}else{var ue=V?V.length:le.faces.length;for(ce=0;ue>ce;ce++){var de=V?V[ce]:ce;if(W.copy(le.faceNormals[de]),E.vmult(W,W),!1===(me=le.testSepAxis(W,v,A,E,R,M)))return!1;se>me&&(se=me,O.copy(W))}}if(v.uniqueAxes)for(ce=0;ce!==v.uniqueAxes.length;ce++){if(M.vmult(v.uniqueAxes[ce],ee),!1===(me=le.testSepAxis(ee,v,A,E,R,M)))return!1;se>me&&(se=me,O.copy(ee))}else{var he=z?z.length:v.faces.length;for(ce=0;he>ce;ce++){var me;if(de=z?z[ce]:ce,ee.copy(v.faceNormals[de]),M.vmult(ee,ee),!1===(me=le.testSepAxis(ee,v,A,E,R,M)))return!1;se>me&&(se=me,O.copy(ee))}}for(var fe=0;fe!==le.uniqueEdges.length;fe++){E.vmult(le.uniqueEdges[fe],oe);for(var ye=0;ye!==v.uniqueEdges.length;ye++)if(M.vmult(v.uniqueEdges[ye],ie),oe.cross(ie,ae),!ae.almostZero()){ae.normalize();var we=le.testSepAxis(ae,v,A,E,R,M);if(!1===we)return!1;se>we&&(se=we,O.copy(ae))}}return R.vsub(A,ne),ne.dot(O)>0&&O.negate(O),!0};var ee=[],ne=[];n.prototype.testSepAxis=function(v,A,E,R,M,O){n.project(this,v,E,R,ee),n.project(A,v,M,O,ne);var V=ee[0],z=ee[1],W=ne[0],H=ne[1];if(H>V||z>W)return!1;var X=V-H,K=W-z;return K>X?X:K};var oe=new R,ie=new R;n.prototype.calculateLocalInertia=function(v,A){this.computeLocalAABB(oe,ie);var E=ie.x-oe.x,R=ie.y-oe.y,M=ie.z-oe.z;A.x=1/12*v*(2*R*2*R+2*M*2*M),A.y=1/12*v*(2*E*2*E+2*M*2*M),A.z=1/12*v*(2*R*2*R+2*E*2*E)},n.prototype.getPlaneConstantOfFace=function(v){var A=this.faces[v],E=this.faceNormals[v],R=this.vertices[A[0]];return-E.dot(R)};var ae=new R,se=new R,le=new R,ce=new R,ue=new R,de=new R,he=new R,me=new R;n.prototype.clipFaceAgainstHull=function(v,A,E,R,M,O,V){for(var z=ae,W=se,H=le,X=ce,K=ue,Z=de,J=he,$=me,ee=this,ne=R,oe=[],ie=-1,fe=Number.MAX_VALUE,ye=0;ye<ee.faces.length;ye++){z.copy(ee.faceNormals[ye]),E.vmult(z,z);var we=z.dot(v);fe>we&&(fe=we,ie=ye)}if(!(0>ie)){var ve=ee.faces[ie];ve.connectedFaces=[];for(var be=0;be<ee.faces.length;be++)for(var Te=0;Te<ee.faces[be].length;Te++)-1!==ve.indexOf(ee.faces[be][Te])&&be!==ie&&-1===ve.connectedFaces.indexOf(be)&&ve.connectedFaces.push(be);for(var Se=(ne.length,ve.length),Ce=0;Se>Ce;Ce++){var Ee=ee.vertices[ve[Ce]],_e=ee.vertices[ve[(Ce+1)%Se]];Ee.vsub(_e,W),H.copy(W),E.vmult(H,H),A.vadd(H,H),X.copy(this.faceNormals[ie]),E.vmult(X,X),A.vadd(X,X),H.cross(X,K),K.negate(K),Z.copy(Ee),E.vmult(Z,Z),A.vadd(Z,Z);var Ie=(Z.dot(K),ve.connectedFaces[Ce]);J.copy(this.faceNormals[Ie]);var Pe=this.getPlaneConstantOfFace(Ie);$.copy(J),E.vmult($,$);var Be=Pe-$.dot(A);for(this.clipFaceAgainstPlane(ne,oe,$,Be);ne.length;)ne.shift();for(;oe.length;)ne.push(oe.shift())}for(J.copy(this.faceNormals[ie]),Pe=this.getPlaneConstantOfFace(ie),$.copy(J),E.vmult($,$),Be=Pe-$.dot(A),be=0;be<ne.length;be++){var ke=$.dot(ne[be])+Be;if(M>=ke&&(console.log("clamped: depth="+ke+" to minDist="+M),ke=M),O>=ke){var Re=ne[be];if(0>=ke){var Oe={point:Re,normal:$,depth:ke};V.push(Oe)}}}}},n.prototype.clipFaceAgainstPlane=function(v,A,E,M){var O,V,z=v.length;if(2>z)return A;var W=v[v.length-1],H=v[0];O=E.dot(W)+M;for(var X=0;z>X;X++){if(H=v[X],V=E.dot(H)+M,0>O)if(0>V)(K=new R).copy(H),A.push(K);else{var K=new R;W.lerp(H,O/(O-V),K),A.push(K)}else 0>V&&(K=new R,W.lerp(H,O/(O-V),K),A.push(K),A.push(H));W=H,O=V}return A},n.prototype.computeWorldVertices=function(v,A){for(var E=this.vertices.length;this.worldVertices.length<E;)this.worldVertices.push(new R);for(var M=this.vertices,O=this.worldVertices,V=0;V!==E;V++)A.vmult(M[V],O[V]),v.vadd(O[V],O[V]);this.worldVerticesNeedsUpdate=!1},new R,n.prototype.computeLocalAABB=function(v,A){var E=this.vertices.length,R=this.vertices;v.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var M=0;E>M;M++){var O=R[M];O.x<v.x?v.x=O.x:O.x>A.x&&(A.x=O.x),O.y<v.y?v.y=O.y:O.y>A.y&&(A.y=O.y),O.z<v.z?v.z=O.z:O.z>A.z&&(A.z=O.z)}},n.prototype.computeWorldFaceNormals=function(v){for(var A=this.faceNormals.length;this.worldFaceNormals.length<A;)this.worldFaceNormals.push(new R);for(var E=this.faceNormals,M=this.worldFaceNormals,O=0;O!==A;O++)v.vmult(E[O],M[O]);this.worldFaceNormalsNeedsUpdate=!1},n.prototype.updateBoundingSphereRadius=function(){for(var v=0,A=this.vertices,E=0,R=A.length;E!==R;E++){var M=A[E].norm2();M>v&&(v=M)}this.boundingSphereRadius=Math.sqrt(v)};var fe=new R;n.prototype.calculateWorldAABB=function(v,A,E,R){for(var M,O,V,z,W,H,X=this.vertices.length,K=this.vertices,Z=0;X>Z;Z++){fe.copy(K[Z]),A.vmult(fe,fe),v.vadd(fe,fe);var J=fe;J.x<M||void 0===M?M=J.x:(J.x>z||void 0===z)&&(z=J.x),J.y<O||void 0===O?O=J.y:(J.y>W||void 0===W)&&(W=J.y),J.z<V||void 0===V?V=J.z:(J.z>H||void 0===H)&&(H=J.z)}E.set(M,O,V),R.set(z,W,H)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.prototype.getAveragePointLocal=function(v){v=v||new R;for(var A=this.vertices.length,E=this.vertices,M=0;A>M;M++)v.vadd(E[M],v);return v.mult(1/A,v),v},n.prototype.transformAllPoints=function(v,A){var E=this.vertices.length,R=this.vertices;if(A){for(var M=0;E>M;M++){var O=R[M];A.vmult(O,O)}for(M=0;M<this.faceNormals.length;M++)O=this.faceNormals[M],A.vmult(O,O)}if(v)for(M=0;E>M;M++)(O=R[M]).vadd(v,O)};var ye=new R,we=new R,ve=new R;n.prototype.pointIsInside=function(v){var A=this.vertices.length,E=this.vertices,R=this.faces,M=this.faceNormals,O=this.faces.length,V=ye;this.getAveragePointLocal(V);for(var z=0;O>z;z++){this.faces[z].length,A=M[z];var W=E[R[z][0]],H=we;v.vsub(W,H);var X=A.dot(H),K=ve;V.vsub(W,K);var Z=A.dot(K);if(0>X&&Z>0||X>0&&0>Z)return!1}return-1};var be=(new R,new R),Te=new R;n.project=function(v,A,E,R,O){var V=v.vertices.length,z=be,W=0,H=0,X=Te,K=v.vertices;X.setZero(),M.vectorToLocalFrame(E,R,A,z),M.pointToLocalFrame(E,R,X,X);var Z=X.dot(z);H=W=K[0].dot(z);for(var J=1;V>J;J++){var $=K[J].dot(z);$>W&&(W=$),H>$&&(H=$)}if((H-=Z)>(W-=Z)){var ee=H;H=W,W=ee}O[0]=W,O[1]=H}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(v,A){function n(v,A,O,V){var z=V,W=[],H=[],X=[],K=[],Z=[],J=Math.cos,$=Math.sin;W.push(new R(A*J(0),A*$(0),.5*-O)),K.push(0),W.push(new R(v*J(0),v*$(0),.5*O)),Z.push(1);for(var ee=0;z>ee;ee++){var ne=2*Math.PI/z*(ee+1),oe=2*Math.PI/z*(ee+.5);z-1>ee?(W.push(new R(A*J(ne),A*$(ne),.5*-O)),K.push(2*ee+2),W.push(new R(v*J(ne),v*$(ne),.5*O)),Z.push(2*ee+3),X.push([2*ee+2,2*ee+3,2*ee+1,2*ee])):X.push([0,1,2*ee+1,2*ee]),(z%2==1||z/2>ee)&&H.push(new R(J(oe),$(oe),0))}X.push(Z),H.push(new R(0,0,1));var ie=[];for(ee=0;ee<K.length;ee++)ie.push(K[K.length-ee-1]);X.push(ie),this.type=E.types.CONVEXPOLYHEDRON,M.call(this,W,X,H)}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3"),M=(v("../math/Quaternion"),v("./ConvexPolyhedron"));n.prototype=new M},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(v,A){function n(v,A){A=O.defaults(A,{maxValue:null,minValue:null,elementSize:1}),this.data=v,this.maxValue=A.maxValue,this.minValue=A.minValue,this.elementSize=A.elementSize,null===A.minValue&&this.updateMinValue(),null===A.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,E.call(this),this.pillarConvex=new R,this.pillarOffset=new M,this.type=E.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var E=v("./Shape"),R=v("./ConvexPolyhedron"),M=v("../math/Vec3"),O=v("../utils/Utils");A.exports=n,n.prototype=new E,n.prototype.update=function(){this._cachedPillars={}},n.prototype.updateMinValue=function(){for(var v=this.data,A=v[0][0],E=0;E!==v.length;E++)for(var R=0;R!==v[E].length;R++){var M=v[E][R];A>M&&(A=M)}this.minValue=A},n.prototype.updateMaxValue=function(){for(var v=this.data,A=v[0][0],E=0;E!==v.length;E++)for(var R=0;R!==v[E].length;R++){var M=v[E][R];M>A&&(A=M)}this.maxValue=A},n.prototype.setHeightValueAtIndex=function(v,A,E){this.data[v][A]=E,this.clearCachedConvexTrianglePillar(v,A,!1),v>0&&(this.clearCachedConvexTrianglePillar(v-1,A,!0),this.clearCachedConvexTrianglePillar(v-1,A,!1)),A>0&&(this.clearCachedConvexTrianglePillar(v,A-1,!0),this.clearCachedConvexTrianglePillar(v,A-1,!1)),A>0&&v>0&&this.clearCachedConvexTrianglePillar(v-1,A-1,!0)},n.prototype.getRectMinMax=function(v,A,E,R,M){M=M||[];for(var O=this.data,V=this.minValue,z=v;E>=z;z++)for(var W=A;R>=W;W++){var H=O[z][W];H>V&&(V=H)}M[0]=this.minValue,M[1]=V},n.prototype.getIndexOfPosition=function(v,A,E,R){var M=this.elementSize,O=this.data,V=Math.floor(v/M),z=Math.floor(A/M);return E[0]=V,E[1]=z,R&&(0>V&&(V=0),0>z&&(z=0),V>=O.length-1&&(V=O.length-1),z>=O[0].length-1&&(z=O[0].length-1)),!(0>V||0>z||V>=O.length-1||z>=O[0].length-1)},n.prototype.getHeightAt=function(v,A,E){var R=[];this.getIndexOfPosition(v,A,R,E);var M=[];return this.getRectMinMax(R[0],R[1]+1,R[0],R[1]+1,M),(M[0]+M[1])/2},n.prototype.getCacheConvexTrianglePillarKey=function(v,A,E){return v+"_"+A+"_"+(E?1:0)},n.prototype.getCachedConvexTrianglePillar=function(v,A,E){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,E)]},n.prototype.setCachedConvexTrianglePillar=function(v,A,E,R,M){this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,E)]={convex:R,offset:M}},n.prototype.clearCachedConvexTrianglePillar=function(v,A,E){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,E)]},n.prototype.getConvexTrianglePillar=function(v,A,E){var O=this.pillarConvex,V=this.pillarOffset;if(this.cacheEnabled){if(z=this.getCachedConvexTrianglePillar(v,A,E))return this.pillarConvex=z.convex,void(this.pillarOffset=z.offset);O=new R,V=new M,this.pillarConvex=O,this.pillarOffset=V}var z=this.data,W=this.elementSize,H=O.faces;O.vertices.length=6;for(var X=0;6>X;X++)O.vertices[X]||(O.vertices[X]=new M);for(H.length=5,X=0;5>X;X++)H[X]||(H[X]=[]);var K=O.vertices,Z=(Math.min(z[v][A],z[v+1][A],z[v][A+1],z[v+1][A+1])-this.minValue)/2+this.minValue;E?(V.set((v+.75)*W,(A+.75)*W,Z),K[0].set(.25*W,.25*W,z[v+1][A+1]-Z),K[1].set(-.75*W,.25*W,z[v][A+1]-Z),K[2].set(.25*W,-.75*W,z[v+1][A]-Z),K[3].set(.25*W,.25*W,-Z-1),K[4].set(-.75*W,.25*W,-Z-1),K[5].set(.25*W,-.75*W,-Z-1),H[0][0]=0,H[0][1]=1,H[0][2]=2,H[1][0]=5,H[1][1]=4,H[1][2]=3,H[2][0]=2,H[2][1]=5,H[2][2]=3,H[2][3]=0,H[3][0]=3,H[3][1]=4,H[3][2]=1,H[3][3]=0,H[4][0]=1,H[4][1]=4,H[4][2]=5,H[4][3]=2):(V.set((v+.25)*W,(A+.25)*W,Z),K[0].set(-.25*W,-.25*W,z[v][A]-Z),K[1].set(.75*W,-.25*W,z[v+1][A]-Z),K[2].set(-.25*W,.75*W,z[v][A+1]-Z),K[3].set(-.25*W,-.25*W,-Z-1),K[4].set(.75*W,-.25*W,-Z-1),K[5].set(-.25*W,.75*W,-Z-1),H[0][0]=0,H[0][1]=1,H[0][2]=2,H[1][0]=5,H[1][1]=4,H[1][2]=3,H[2][0]=0,H[2][1]=2,H[2][2]=5,H[2][3]=3,H[3][0]=1,H[3][1]=0,H[3][2]=3,H[3][3]=4,H[4][0]=4,H[4][1]=5,H[4][2]=2,H[4][3]=1),O.computeNormals(),O.computeEdges(),O.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(v,A,E,O,V)},n.prototype.calculateLocalInertia=function(v,A){return(A=A||new M).set(0,0,0),A},n.prototype.volume=function(){return Number.MAX_VALUE},n.prototype.calculateWorldAABB=function(v,A,E,R){E.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),R.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},n.prototype.updateBoundingSphereRadius=function(){var v=this.data,A=this.elementSize;this.boundingSphereRadius=new M(v.length*A,v[0].length*A,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(v,A){function n(){E.call(this),this.type=E.types.PARTICLE}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(v,A){return(A=A||new R).set(0,0,0),A},n.prototype.volume=function(){return 0},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},n.prototype.calculateWorldAABB=function(v,A,E,R){E.copy(v),R.copy(v)}},{"../math/Vec3":30,"./Shape":43}],42:[function(v,A){function n(){E.call(this),this.type=E.types.PLANE,this.worldNormal=new R,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.computeWorldNormal=function(v){var A=this.worldNormal;A.set(0,0,1),v.vmult(A,A),this.worldNormalNeedsUpdate=!1},n.prototype.calculateLocalInertia=function(v,A){return A||new R},n.prototype.volume=function(){return Number.MAX_VALUE};var M=new R;n.prototype.calculateWorldAABB=function(v,A,E,R){M.set(0,0,1),A.vmult(M,M);var O=Number.MAX_VALUE;E.set(-O,-O,-O),R.set(O,O,O),1===M.x&&(R.x=v.x),1===M.y&&(R.y=v.y),1===M.z&&(R.z=v.z),-1===M.x&&(E.x=v.x),-1===M.y&&(E.y=v.y),-1===M.z&&(E.z=v.z)},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(v,A){function n(){this.id=n.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}A.exports=n;var n=v("./Shape");v("../math/Vec3"),v("../math/Quaternion"),v("../material/Material"),n.prototype.constructor=n,n.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},n.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},n.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+this.type},n.idCounter=0,n.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(v,A){function n(v){if(E.call(this),this.radius=void 0!==v?Number(v):1,this.type=E.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(v,A){A=A||new R;var E=2*v*this.radius*this.radius/5;return A.x=E,A.y=E,A.z=E,A},n.prototype.volume=function(){return 4*Math.PI*this.radius/3},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},n.prototype.calculateWorldAABB=function(v,A,E,R){for(var M=this.radius,O=["x","y","z"],V=0;V<O.length;V++){var z=O[V];E[z]=v[z]-M,R[z]=v[z]+M}}},{"../math/Vec3":30,"./Shape":43}],45:[function(v,A){function n(v,A){E.call(this),this.type=E.types.TRIMESH,this.vertices=new Float32Array(v),this.indices=new Int16Array(A),this.normals=new Float32Array(A.length),this.aabb=new O,this.edges=null,this.scale=new R(1,1,1),this.tree=new V,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}A.exports=n;var E=v("./Shape"),R=v("../math/Vec3"),M=(v("../math/Quaternion"),v("../math/Transform")),O=v("../collision/AABB"),V=v("../utils/Octree");n.prototype=new E,n.prototype.constructor=n;var z=new R;n.prototype.updateTree=function(){var v=this.tree;v.reset(),v.aabb.copy(this.aabb);var A=this.scale;v.aabb.lowerBound.x*=1/A.x,v.aabb.lowerBound.y*=1/A.y,v.aabb.lowerBound.z*=1/A.z,v.aabb.upperBound.x*=1/A.x,v.aabb.upperBound.y*=1/A.y,v.aabb.upperBound.z*=1/A.z;for(var E=new O,M=new R,V=new R,z=new R,W=[M,V,z],H=0;H<this.indices.length/3;H++){var X=3*H;this._getUnscaledVertex(this.indices[X],M),this._getUnscaledVertex(this.indices[X+1],V),this._getUnscaledVertex(this.indices[X+2],z),E.setFromPoints(W),v.insert(E,H)}v.removeEmptyNodes()};var W=new O;n.prototype.getTrianglesInAABB=function(v,A){W.copy(v);var E=this.scale,R=E.x,M=E.y,O=E.z,V=W.lowerBound,z=W.upperBound;return V.x/=R,V.y/=M,V.z/=O,z.x/=R,z.y/=M,z.z/=O,this.tree.aabbQuery(W,A)},n.prototype.setScale=function(v){var A=this.scale.x===this.scale.y===this.scale.z,E=v.x===v.y===v.z;A&&E||this.updateNormals(),this.scale.copy(v),this.updateAABB(),this.updateBoundingSphereRadius()},n.prototype.updateNormals=function(){for(var v=z,A=this.normals,E=0;E<this.indices.length/3;E++){var R=3*E,M=this.indices[R],O=this.indices[R+1],V=this.indices[R+2];this.getVertex(M,J),this.getVertex(O,$),this.getVertex(V,ee),n.computeNormal($,J,ee,v),A[R]=v.x,A[R+1]=v.y,A[R+2]=v.z}},n.prototype.updateEdges=function(){for(var v={},f=function(){v[M>R?R+"_"+M:M+"_"+R]=!0},A=0;A<this.indices.length/3;A++){var E=3*A,R=this.indices[E],M=this.indices[E+1];this.indices[E+2],f(),f(),f()}var O=Object.keys(v);for(this.edges=new Int16Array(2*O.length),A=0;A<O.length;A++){var V=O[A].split("_");this.edges[2*A]=parseInt(V[0],10),this.edges[2*A+1]=parseInt(V[1],10)}},n.prototype.getEdgeVertex=function(v,A,E){var R=this.edges[2*v+(A?1:0)];this.getVertex(R,E)};var H=new R,X=new R;n.prototype.getEdgeVector=function(v,A){var E=H,R=X;this.getEdgeVertex(v,0,E),this.getEdgeVertex(v,1,R),R.vsub(E,A)};var K=new R,Z=new R;n.computeNormal=function(v,A,E,R){A.vsub(v,Z),E.vsub(A,K),K.cross(Z,R),R.isZero()||R.normalize()};var J=new R,$=new R,ee=new R;n.prototype.getVertex=function(v,A){var E=this.scale;return this._getUnscaledVertex(v,A),A.x*=E.x,A.y*=E.y,A.z*=E.z,A},n.prototype._getUnscaledVertex=function(v,A){var E=3*v,R=this.vertices;return A.set(R[E],R[E+1],R[E+2])},n.prototype.getWorldVertex=function(v,A,E,R){return this.getVertex(v,R),M.pointToWorldFrame(A,E,R,R),R},n.prototype.getTriangleVertices=function(v,A,E,R){var M=3*v;this.getVertex(this.indices[M],A),this.getVertex(this.indices[M+1],E),this.getVertex(this.indices[M+2],R)},n.prototype.getNormal=function(v,A){var E=3*v;return A.set(this.normals[E],this.normals[E+1],this.normals[E+2])};var ne=new O;n.prototype.calculateLocalInertia=function(v,A){this.computeLocalAABB(ne);var E=ne.upperBound.x-ne.lowerBound.x,R=ne.upperBound.y-ne.lowerBound.y,M=ne.upperBound.z-ne.lowerBound.z;return A.set(1/12*v*(2*R*2*R+2*M*2*M),1/12*v*(2*E*2*E+2*M*2*M),1/12*v*(2*R*2*R+2*E*2*E))};var oe=new R;n.prototype.computeLocalAABB=function(v){var A=v.lowerBound,E=v.upperBound,R=this.vertices.length,M=(this.vertices,oe);this.getVertex(0,M),A.copy(M),E.copy(M);for(var O=0;O!==R;O++)this.getVertex(O,M),M.x<A.x?A.x=M.x:M.x>E.x&&(E.x=M.x),M.y<A.y?A.y=M.y:M.y>E.y&&(E.y=M.y),M.z<A.z?A.z=M.z:M.z>E.z&&(E.z=M.z)},n.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},n.prototype.updateBoundingSphereRadius=function(){for(var v=0,A=this.vertices,E=new R,M=0,O=A.length/3;M!==O;M++){this.getVertex(M,E);var V=E.norm2();V>v&&(v=V)}this.boundingSphereRadius=Math.sqrt(v)};var ie=(new R,new M),ae=new O;n.prototype.calculateWorldAABB=function(v,A,E,R){var M=ie,O=ae;M.position=v,M.quaternion=A,this.aabb.toWorldFrame(M,O),E.copy(O.lowerBound),R.copy(O.upperBound)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.createTorus=function(v,A,E,R,M){v=v||1,A=A||.5,E=E||8,R=R||6,M=M||2*Math.PI;for(var O=[],V=[],z=0;E>=z;z++)for(var W=0;R>=W;W++){var H=W/R*M,X=z/E*Math.PI*2,K=(v+A*Math.cos(X))*Math.cos(H),Z=(v+A*Math.cos(X))*Math.sin(H),J=A*Math.sin(X);O.push(K,Z,J)}for(z=1;E>=z;z++)for(W=1;R>=W;W++){var $=(R+1)*z+W-1,ee=(R+1)*(z-1)+W-1,ne=(R+1)*(z-1)+W,oe=(R+1)*z+W;V.push($,ee,oe),V.push(ee,ne,oe)}return new n(O,V)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(v,A){function n(){E.call(this),this.iterations=10,this.tolerance=1e-7}A.exports=n;var E=(v("../math/Vec3"),v("../math/Quaternion"),v("./Solver"));n.prototype=new E;var R=[],M=[],O=[];n.prototype.solve=function(v,A){var E,V,z,W,H,X=0,K=this.iterations,Z=this.tolerance*this.tolerance,J=this.equations,$=J.length,ee=A.bodies,ne=ee.length,oe=v;if(0!==$)for(var ie=0;ie!==ne;ie++)ee[ie].updateSolveMassProperties();var ae=M,se=O,le=R;for(ae.length=$,se.length=$,le.length=$,ie=0;ie!==$;ie++){var ce=J[ie];le[ie]=0,se[ie]=ce.computeB(oe),ae[ie]=1/ce.computeC()}if(0!==$){for(ie=0;ie!==ne;ie++){var ue=(me=ee[ie]).vlambda,de=me.wlambda;ue.set(0,0,0),de&&de.set(0,0,0)}for(X=0;X!==K;X++){W=0;for(var he=0;he!==$;he++)ce=J[he],E=se[he],V=ae[he],(H=le[he])+(z=V*(E-ce.computeGWlambda()-ce.eps*H))<ce.minForce?z=ce.minForce-H:H+z>ce.maxForce&&(z=ce.maxForce-H),le[he]+=z,W+=z>0?z:-z,ce.addToWlambda(z);if(Z>W*W)break}for(ie=0;ie!==ne;ie++){var me,fe=(me=ee[ie]).velocity,ye=me.angularVelocity;fe.vadd(me.vlambda,fe),ye&&ye.vadd(me.wlambda,ye)}}return X}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(v,A){function n(){this.equations=[]}A.exports=n,n.prototype.solve=function(){return 0},n.prototype.addEquation=function(v){v.enabled&&this.equations.push(v)},n.prototype.removeEquation=function(v){var A=this.equations,E=A.indexOf(v);-1!==E&&A.splice(E,1)},n.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(v,A){function n(v){for(E.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=v,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function o(v){for(var A=v.length,E=0;E!==A;E++){var R=v[E];if(!(R.visited||R.body.type&z))return R}return!1}function d(v,A,E,R){for(W.push(v),v.visited=!0,A(v,E,R);W.length;)for(var M,O=W.pop();M=o(O.children);)M.visited=!0,A(M,E,R),W.push(M)}function i(v,A,E){A.push(v.body);for(var R=v.eqs.length,M=0;M!==R;M++){var O=v.eqs[M];-1===E.indexOf(O)&&E.push(O)}}function t(v,A){return A.id-v.id}A.exports=n;var E=(v("../math/Vec3"),v("../math/Quaternion"),v("./Solver")),R=v("../objects/Body");n.prototype=new E;var M=[],O=[],V={bodies:[]},z=R.STATIC,W=[];n.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},n.prototype.solve=function(v,A){for(var E=M,R=this.nodePool,z=A.bodies,W=this.equations,H=W.length,X=z.length,K=this.subsolver;R.length<X;)R.push(this.createNode());E.length=X;for(var Z=0;X>Z;Z++)E[Z]=R[Z];for(Z=0;Z!==X;Z++){var J=E[Z];J.body=z[Z],J.children.length=0,J.eqs.length=0,J.visited=!1}for(var $=0;$!==H;$++){var ee=W[$],ne=(Z=z.indexOf(ee.bi),z.indexOf(ee.bj)),oe=E[Z],ie=E[ne];oe.children.push(ie),oe.eqs.push(ee),ie.children.push(oe),ie.eqs.push(ee)}var ae,se=0,le=O;K.tolerance=this.tolerance,K.iterations=this.iterations;for(var ce=V;ae=o(E);){le.length=0,ce.bodies.length=0,d(ae,i,ce.bodies,le);var ue=le.length;for(le=le.sort(t),Z=0;Z!==ue;Z++)K.addEquation(le[Z]);K.solve(v,ce),K.removeAllEquations(),se++}return se}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(v,A){var n=function(){};A.exports=n,n.prototype={constructor:n,addEventListener:function(v,A){void 0===this._listeners&&(this._listeners={});var E=this._listeners;return void 0===E[v]&&(E[v]=[]),-1===E[v].indexOf(A)&&E[v].push(A),this},hasEventListener:function(v,A){if(void 0===this._listeners)return!1;var E=this._listeners;return void 0!==E[v]&&-1!==E[v].indexOf(A)},removeEventListener:function(v,A){if(void 0===this._listeners)return this;var E=this._listeners;if(void 0===E[v])return this;var R=E[v].indexOf(A);return-1!==R&&E[v].splice(R,1),this},dispatchEvent:function(v){if(void 0===this._listeners)return this;var A=this._listeners[v.type];if(void 0!==A){v.target=this;for(var E=0,R=A.length;R>E;E++)A[E].call(this,v)}return this}}},{}],50:[function(v,A){function n(v){v=v||{},this.root=v.root||null,this.aabb=v.aabb?v.aabb.clone():new E,this.data=[],this.children=[]}function o(v,A){(A=A||{}).root=null,A.aabb=v,n.call(this,A),this.maxDepth=void 0!==A.maxDepth?A.maxDepth:8}var E=v("../collision/AABB"),R=v("../math/Vec3");A.exports=o,o.prototype=new n,n.prototype.reset=function(){this.children.length=this.data.length=0},n.prototype.insert=function(v,A,E){var R=this.data;if(E=E||0,!this.aabb.contains(v))return!1;var M=this.children;if(E<(this.maxDepth||this.root.maxDepth)){var O=!1;M.length||(this.subdivide(),O=!0);for(var V=0;8!==V;V++)if(M[V].insert(v,A,E+1))return!0;O&&(M.length=0)}return R.push(A),!0};var M=new R;n.prototype.subdivide=function(){var v=this.aabb,A=v.lowerBound,O=v.upperBound,V=this.children;V.push(new n({aabb:new E({lowerBound:new R(0,0,0)})}),new n({aabb:new E({lowerBound:new R(1,0,0)})}),new n({aabb:new E({lowerBound:new R(1,1,0)})}),new n({aabb:new E({lowerBound:new R(1,1,1)})}),new n({aabb:new E({lowerBound:new R(0,1,1)})}),new n({aabb:new E({lowerBound:new R(0,0,1)})}),new n({aabb:new E({lowerBound:new R(1,0,1)})}),new n({aabb:new E({lowerBound:new R(0,1,0)})})),O.vsub(A,M),M.scale(.5,M);for(var z=this.root||this,W=0;8!==W;W++){var H=V[W];H.root=z;var X=H.aabb.lowerBound;X.x*=M.x,X.y*=M.y,X.z*=M.z,X.vadd(A,X),X.vadd(M,H.aabb.upperBound)}},n.prototype.aabbQuery=function(v,A){for(var E=(this.data,this.children,[this]);E.length;){var R=E.pop();R.aabb.overlaps(v)&&Array.prototype.push.apply(A,R.data),Array.prototype.push.apply(E,R.children)}return A};var O=new E;n.prototype.rayQuery=function(v,A,E){return v.getAABB(O),O.toLocalFrame(A,O),this.aabbQuery(O,E),E},n.prototype.removeEmptyNodes=function(){for(var v=[this];v.length;){for(var A=v.pop(),E=A.children.length-1;E>=0;E--)A.children[E].data.length||A.children.splice(E,1);Array.prototype.push.apply(v,A.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(v,A){function n(){this.objects=[],this.type=Object}A.exports=n,n.prototype.release=function(){for(var v=arguments.length,A=0;A!==v;A++)this.objects.push(arguments[A])},n.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},n.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(v,A){function n(){this.data={keys:[]}}A.exports=n,n.prototype.get=function(v,A){if(v>A){var E=A;A=v,v=E}return this.data[v+"-"+A]},n.prototype.set=function(v,A,E){if(v>A){var R=A;A=v,v=R}var M=v+"-"+A;this.get(v,A)||this.data.keys.push(M),this.data[M]=E},n.prototype.reset=function(){for(var v=this.data,A=v.keys;A.length>0;)delete v[A.pop()]}},{}],53:[function(v,A){function n(){}A.exports=n,n.defaults=function(v,A){for(var E in v=v||{},A)E in v||(v[E]=A[E]);return v}},{}],54:[function(v,A){function n(){R.call(this),this.type=E}A.exports=n;var E=v("../math/Vec3"),R=v("./Pool");n.prototype=new R,n.prototype.constructObject=function(){return new E}},{"../math/Vec3":30,"./Pool":51}],55:[function(v,A){function n(v){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new W,this.world=v,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function o(v,A,E){for(var R=null,M=v.length,O=0;O!==M;O++){var V=v[O],z=Pe;v[(O+1)%M].vsub(V,z);var W=Be;z.cross(A,W);var H=ke;E.vsub(V,H);var X=W.dot(H);if(!(null===R||X>0&&!0===R||0>=X&&!1===R))return!1;null===R&&(R=X>0)}return!0}A.exports=n;var E=v("../collision/AABB"),R=v("../shapes/Shape"),M=v("../collision/Ray"),O=v("../math/Vec3"),V=v("../math/Transform"),z=(v("../shapes/ConvexPolyhedron"),v("../math/Quaternion")),W=(v("../solver/Solver"),v("../utils/Vec3Pool")),H=v("../equations/ContactEquation"),X=v("../equations/FrictionEquation");n.prototype.createContactEquation=function(v,A,E,R,M,O){var V;this.contactPointPool.length?((V=this.contactPointPool.pop()).bi=v,V.bj=A):V=new H(v,A),V.enabled=v.collisionResponse&&A.collisionResponse&&E.collisionResponse&&R.collisionResponse;var z=this.currentContactMaterial;V.restitution=z.restitution,V.setSpookParams(z.contactEquationStiffness,z.contactEquationRelaxation,this.world.dt);var W=E.material||v.material,X=R.material||A.material;return W&&X&&W.restitution>=0&&X.restitution>=0&&(V.restitution=W.restitution*X.restitution),V.si=M||E,V.sj=O||R,V},n.prototype.createFrictionEquationsFromContact=function(v,A){var E=v.bi,R=v.bj,M=v.si,O=v.sj,V=this.world,z=this.currentContactMaterial,W=z.friction,H=M.material||E.material,K=O.material||R.material;if(H&&K&&H.friction>=0&&K.friction>=0&&(W=H.friction*K.friction),W>0){var Z=W*V.gravity.length(),J=E.invMass+R.invMass;J>0&&(J=1/J);var $=this.frictionEquationPool,ee=$.length?$.pop():new X(E,R,Z*J),ne=$.length?$.pop():new X(E,R,Z*J);return ee.bi=ne.bi=E,ee.bj=ne.bj=R,ee.minForce=ne.minForce=-Z*J,ee.maxForce=ne.maxForce=Z*J,ee.ri.copy(v.ri),ee.rj.copy(v.rj),ne.ri.copy(v.ri),ne.rj.copy(v.rj),v.ni.tangents(ee.t,ne.t),ee.setSpookParams(z.frictionEquationStiffness,z.frictionEquationRelaxation,V.dt),ne.setSpookParams(z.frictionEquationStiffness,z.frictionEquationRelaxation,V.dt),ee.enabled=ne.enabled=v.enabled,A.push(ee,ne),!0}return!1};var K=new O,Z=new O,J=new O;n.prototype.createFrictionFromAverage=function(v){var A=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(A,this.frictionResult)&&1!==v){var E=this.frictionResult[this.frictionResult.length-2],R=this.frictionResult[this.frictionResult.length-1];K.setZero(),Z.setZero(),J.setZero();for(var M=A.bi,O=(A.bj,0);O!==v;O++)(A=this.result[this.result.length-1-O]).bodyA!==M?(K.vadd(A.ni,K),Z.vadd(A.ri,Z),J.vadd(A.rj,J)):(K.vsub(A.ni,K),Z.vadd(A.rj,Z),J.vadd(A.ri,J));var V=1/v;Z.scale(V,E.ri),J.scale(V,E.rj),R.ri.copy(E.ri),R.rj.copy(E.rj),K.normalize(),K.tangents(E.t,R.t)}};var $=new O,ee=new O,ne=new z,oe=new z;n.prototype.getContacts=function(v,A,E,R,M,O,V){this.contactPointPool=M,this.frictionEquationPool=V,this.result=R,this.frictionResult=O;for(var z=ne,W=oe,H=$,X=ee,K=0,Z=v.length;K!==Z;K++){var J=v[K],ie=A[K],ae=null;J.material&&ie.material&&(ae=E.getContactMaterial(J.material,ie.material)||null);for(var se=0;se<J.shapes.length;se++){J.quaternion.mult(J.shapeOrientations[se],z),J.quaternion.vmult(J.shapeOffsets[se],H),H.vadd(J.position,H);for(var le=J.shapes[se],ce=0;ce<ie.shapes.length;ce++){ie.quaternion.mult(ie.shapeOrientations[ce],W),ie.quaternion.vmult(ie.shapeOffsets[ce],X),X.vadd(ie.position,X);var ue=ie.shapes[ce];if(!(H.distanceTo(X)>le.boundingSphereRadius+ue.boundingSphereRadius)){var de=null;le.material&&ue.material&&(de=E.getContactMaterial(le.material,ue.material)||null),this.currentContactMaterial=de||ae||E.defaultContactMaterial;var he=this[le.type|ue.type];he&&(le.type<ue.type?he.call(this,le,ue,H,X,z,W,J,ie,le,ue):he.call(this,ue,le,X,H,W,z,ie,J,le,ue))}}}}},n.prototype[R.types.BOX|R.types.BOX]=n.prototype.boxBox=function(v,A,E,R,M,O,V,z){v.convexPolyhedronRepresentation.material=v.material,A.convexPolyhedronRepresentation.material=A.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.convexConvex(v.convexPolyhedronRepresentation,A.convexPolyhedronRepresentation,E,R,M,O,V,z,v,A)},n.prototype[R.types.BOX|R.types.CONVEXPOLYHEDRON]=n.prototype.boxConvex=function(v,A,E,R,M,O,V,z){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexConvex(v.convexPolyhedronRepresentation,A,E,R,M,O,V,z,v,A)},n.prototype[R.types.BOX|R.types.PARTICLE]=n.prototype.boxParticle=function(v,A,E,R,M,O,V,z){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexParticle(v.convexPolyhedronRepresentation,A,E,R,M,O,V,z,v,A)},n.prototype[R.types.SPHERE]=n.prototype.sphereSphere=function(v,A,E,R,M,O,V,z){var W=this.createContactEquation(V,z,v,A);R.vsub(E,W.ni),W.ni.normalize(),W.ri.copy(W.ni),W.rj.copy(W.ni),W.ri.mult(v.radius,W.ri),W.rj.mult(-A.radius,W.rj),W.ri.vadd(E,W.ri),W.ri.vsub(V.position,W.ri),W.rj.vadd(R,W.rj),W.rj.vsub(z.position,W.rj),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)};var ie=new O,ae=new O,se=new O;n.prototype[R.types.PLANE|R.types.TRIMESH]=n.prototype.planeTrimesh=function(v,A,E,R,M,z,W,H){var X=new O,K=ie;K.set(0,0,1),M.vmult(K,K);for(var Z=0;Z<A.vertices.length/3;Z++){A.getVertex(Z,X);var J=new O;J.copy(X),V.pointToWorldFrame(R,z,J,X);var $=ae;if(X.vsub(E,$),0>=K.dot($)){var ee=this.createContactEquation(W,H,v,A);ee.ni.copy(K);var ne=se;K.scale($.dot(K),ne),X.vsub(ne,ne),ee.ri.copy(ne),ee.ri.vsub(W.position,ee.ri),ee.rj.copy(X),ee.rj.vsub(H.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}};var le=new O,ce=new O,ue=(new O,new O),de=new O,he=new O,me=new O,fe=new O,ye=new O,we=new O,ve=new O,be=new O,Te=new O,Se=new O,Ce=new E,Ee=[];n.prototype[R.types.SPHERE|R.types.TRIMESH]=n.prototype.sphereTrimesh=function(v,A,E,R,O,z,W,H){var X=he,K=me,Z=fe,J=ye,$=we,ee=ve,ne=Ce,oe=de,ie=ce,ae=Ee;V.pointToLocalFrame(R,z,E,$);var se=v.radius;ne.lowerBound.set($.x-se,$.y-se,$.z-se),ne.upperBound.set($.x+se,$.y+se,$.z+se),A.getTrianglesInAABB(ne,ae);for(var _e=ue,Ie=v.radius*v.radius,Pe=0;Pe<ae.length;Pe++)for(var Be=0;3>Be;Be++)A.getVertex(A.indices[3*ae[Pe]+Be],_e),_e.vsub($,ie),ie.norm2()<=Ie&&(oe.copy(_e),V.pointToWorldFrame(R,z,oe,_e),_e.vsub(E,ie),(Oe=this.createContactEquation(W,H,v,A)).ni.copy(ie),Oe.ni.normalize(),Oe.ri.copy(Oe.ni),Oe.ri.scale(v.radius,Oe.ri),Oe.ri.vadd(E,Oe.ri),Oe.ri.vsub(W.position,Oe.ri),Oe.rj.copy(_e),Oe.rj.vsub(H.position,Oe.rj),this.result.push(Oe),this.createFrictionEquationsFromContact(Oe,this.frictionResult));for(Pe=0;Pe<ae.length;Pe++)for(Be=0;3>Be;Be++){A.getVertex(A.indices[3*ae[Pe]+Be],X),A.getVertex(A.indices[3*ae[Pe]+(Be+1)%3],K),K.vsub(X,Z),$.vsub(K,ee);var ke=ee.dot(Z);$.vsub(X,ee);var Re=ee.dot(Z);if(Re>0&&0>ke&&($.vsub(X,ee),J.copy(Z),J.normalize(),Re=ee.dot(J),J.scale(Re,ee),ee.vadd(X,ee),(We=ee.distanceTo($))<v.radius)){var Oe=this.createContactEquation(W,H,v,A);ee.vsub($,Oe.ni),Oe.ni.normalize(),Oe.ni.scale(v.radius,Oe.ri),V.pointToWorldFrame(R,z,ee,ee),ee.vsub(H.position,Oe.rj),V.vectorToWorldFrame(z,Oe.ni,Oe.ni),V.vectorToWorldFrame(z,Oe.ri,Oe.ri),this.result.push(Oe),this.createFrictionEquationsFromContact(Oe,this.frictionResult)}}for(var Le=be,Ve=Te,Ne=Se,Fe=le,Ue=(Pe=0,ae.length);Pe!==Ue;Pe++){A.getTriangleVertices(ae[Pe],Le,Ve,Ne),A.getNormal(ae[Pe],Fe),$.vsub(Le,ee);var We=ee.dot(Fe);Fe.scale(We,ee),$.vsub(ee,ee),We=ee.distanceTo($),M.pointInTriangle(ee,Le,Ve,Ne)&&We<v.radius&&(Oe=this.createContactEquation(W,H,v,A),ee.vsub($,Oe.ni),Oe.ni.normalize(),Oe.ni.scale(v.radius,Oe.ri),V.pointToWorldFrame(R,z,ee,ee),ee.vsub(H.position,Oe.rj),V.vectorToWorldFrame(z,Oe.ni,Oe.ni),V.vectorToWorldFrame(z,Oe.ri,Oe.ri),this.result.push(Oe),this.createFrictionEquationsFromContact(Oe,this.frictionResult))}ae.length=0};var _e=new O,Ie=new O;n.prototype[R.types.SPHERE|R.types.PLANE]=n.prototype.spherePlane=function(v,A,E,R,M,O,V,z){var W=this.createContactEquation(V,z,v,A);if(W.ni.set(0,0,1),O.vmult(W.ni,W.ni),W.ni.negate(W.ni),W.ni.normalize(),W.ni.mult(v.radius,W.ri),E.vsub(R,_e),W.ni.mult(W.ni.dot(_e),Ie),_e.vsub(Ie,W.rj),-_e.dot(W.ni)<=v.radius){var H=W.ri,X=W.rj;H.vadd(E,H),H.vsub(V.position,H),X.vadd(R,X),X.vsub(z.position,X),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}};var Pe=new O,Be=new O,ke=new O,Re=new O,Oe=new O,Le=new O,Ve=new O,Ne=[new O,new O,new O,new O,new O,new O],Fe=new O,Ue=new O,We=new O,Ge=new O;n.prototype[R.types.SPHERE|R.types.BOX]=n.prototype.sphereBox=function(v,A,E,R,M,O,V,z){var W=this.v3pool,H=Ne;E.vsub(R,Re),A.getSideNormals(H,O);for(var X=v.radius,K=!1,Z=Ue,J=We,$=Ge,ee=null,ne=0,oe=0,ie=0,ae=null,se=0,le=H.length;se!==le&&!1===K;se++){var ce=Oe;ce.copy(H[se]);var ue=ce.norm();ce.normalize();var de=Re.dot(ce);if(ue+X>de&&de>0){var he=Le,me=Ve;he.copy(H[(se+1)%3]),me.copy(H[(se+2)%3]);var fe=he.norm(),ye=me.norm();he.normalize(),me.normalize();var we=Re.dot(he),ve=Re.dot(me);if(fe>we&&we>-fe&&ye>ve&&ve>-ye){var be=Math.abs(de-ue-X);(null===ae||ae>be)&&(ae=be,oe=we,ie=ve,ee=ue,Z.copy(ce),J.copy(he),$.copy(me),ne++)}}}if(ne){K=!0;var Te=this.createContactEquation(V,z,v,A);Z.mult(-X,Te.ri),Te.ni.copy(Z),Te.ni.negate(Te.ni),Z.mult(ee,Z),J.mult(oe,J),Z.vadd(J,Z),$.mult(ie,$),Z.vadd($,Te.rj),Te.ri.vadd(E,Te.ri),Te.ri.vsub(V.position,Te.ri),Te.rj.vadd(R,Te.rj),Te.rj.vsub(z.position,Te.rj),this.result.push(Te),this.createFrictionEquationsFromContact(Te,this.frictionResult)}for(var Se=W.get(),Ce=Fe,Ee=0;2!==Ee&&!K;Ee++)for(var _e=0;2!==_e&&!K;_e++)for(var Ie=0;2!==Ie&&!K;Ie++)Se.set(0,0,0),Ee?Se.vadd(H[0],Se):Se.vsub(H[0],Se),_e?Se.vadd(H[1],Se):Se.vsub(H[1],Se),Ie?Se.vadd(H[2],Se):Se.vsub(H[2],Se),R.vadd(Se,Ce),Ce.vsub(E,Ce),Ce.norm2()<X*X&&(K=!0,(Te=this.createContactEquation(V,z,v,A)).ri.copy(Ce),Te.ri.normalize(),Te.ni.copy(Te.ri),Te.ri.mult(X,Te.ri),Te.rj.copy(Se),Te.ri.vadd(E,Te.ri),Te.ri.vsub(V.position,Te.ri),Te.rj.vadd(R,Te.rj),Te.rj.vsub(z.position,Te.rj),this.result.push(Te),this.createFrictionEquationsFromContact(Te,this.frictionResult));W.release(Se),Se=null;var Pe=W.get(),Be=W.get(),ke=(Te=W.get(),W.get()),qe=(be=W.get(),H.length);for(Ee=0;Ee!==qe&&!K;Ee++)for(_e=0;_e!==qe&&!K;_e++)if(Ee%3!=_e%3){H[_e].cross(H[Ee],Pe),Pe.normalize(),H[Ee].vadd(H[_e],Be),Te.copy(E),Te.vsub(Be,Te),Te.vsub(R,Te);var He=Te.dot(Pe);for(Pe.mult(He,ke),Ie=0;Ie===Ee%3||Ie===_e%3;)Ie++;be.copy(E),be.vsub(ke,be),be.vsub(Be,be),be.vsub(R,be);var Ye=Math.abs(He),Qe=be.norm();if(Ye<H[Ie].norm()&&X>Qe){K=!0;var Xe=this.createContactEquation(V,z,v,A);Be.vadd(ke,Xe.rj),Xe.rj.copy(Xe.rj),be.negate(Xe.ni),Xe.ni.normalize(),Xe.ri.copy(Xe.rj),Xe.ri.vadd(R,Xe.ri),Xe.ri.vsub(E,Xe.ri),Xe.ri.normalize(),Xe.ri.mult(X,Xe.ri),Xe.ri.vadd(E,Xe.ri),Xe.ri.vsub(V.position,Xe.ri),Xe.rj.vadd(R,Xe.rj),Xe.rj.vsub(z.position,Xe.rj),this.result.push(Xe),this.createFrictionEquationsFromContact(Xe,this.frictionResult)}}W.release(Pe,Be,Te,ke,be)};var qe=new O,He=new O,Ye=new O,Qe=new O,Xe=new O,Ze=new O,Je=new O,$e=new O,et=new O,nt=new O;n.prototype[R.types.SPHERE|R.types.CONVEXPOLYHEDRON]=n.prototype.sphereConvex=function(v,A,E,R,M,O,V,z){var W=this.v3pool;E.vsub(R,qe);for(var H=A.faceNormals,X=A.faces,K=A.vertices,Z=v.radius,J=0;J!==K.length;J++){var $=K[J],ee=Xe;O.vmult($,ee),R.vadd(ee,ee);var ne=Qe;if(ee.vsub(E,ne),ne.norm2()<Z*Z)return oe=!0,(be=this.createContactEquation(V,z,v,A)).ri.copy(ne),be.ri.normalize(),be.ni.copy(be.ri),be.ri.mult(Z,be.ri),ee.vsub(R,be.rj),be.ri.vadd(E,be.ri),be.ri.vsub(V.position,be.ri),be.rj.vadd(R,be.rj),be.rj.vsub(z.position,be.rj),this.result.push(be),void this.createFrictionEquationsFromContact(be,this.frictionResult)}for(var oe=!1,ie=(J=0,X.length);J!==ie&&!1===oe;J++){var ae=H[J],se=X[J],le=Ze;O.vmult(ae,le);var ce=Je;O.vmult(K[se[0]],ce),ce.vadd(R,ce);var ue=$e;le.mult(-Z,ue),E.vadd(ue,ue);var de=et;ue.vsub(ce,de);var he=de.dot(le),me=nt;if(E.vsub(ce,me),0>he&&me.dot(le)>0){for(var fe=[],ye=0,we=se.length;ye!==we;ye++){var ve=W.get();O.vmult(K[se[ye]],ve),R.vadd(ve,ve),fe.push(ve)}if(o(fe,le,E)){oe=!0;var be=this.createContactEquation(V,z,v,A);le.mult(-Z,be.ri),le.negate(be.ni);var Te=W.get();le.mult(-he,Te);var Se=W.get();le.mult(-Z,Se),E.vsub(R,be.rj),be.rj.vadd(Se,be.rj),be.rj.vadd(Te,be.rj),be.rj.vadd(R,be.rj),be.rj.vsub(z.position,be.rj),be.ri.vadd(E,be.ri),be.ri.vsub(V.position,be.ri),W.release(Te),W.release(Se),this.result.push(be),this.createFrictionEquationsFromContact(be,this.frictionResult),ye=0;for(var Ce=fe.length;ye!==Ce;ye++)W.release(fe[ye]);return}for(ye=0;ye!==se.length;ye++){var Ee=W.get(),_e=W.get();O.vmult(K[se[(ye+1)%se.length]],Ee),O.vmult(K[se[(ye+2)%se.length]],_e),R.vadd(Ee,Ee),R.vadd(_e,_e);var Ie=He;_e.vsub(Ee,Ie);var Pe=Ye;Ie.unit(Pe);var Be=W.get(),ke=W.get();E.vsub(Ee,ke);var Re=ke.dot(Pe);Pe.mult(Re,Be),Be.vadd(Ee,Be);var Oe=W.get();if(Be.vsub(E,Oe),Re>0&&Re*Re<Ie.norm2()&&Oe.norm2()<Z*Z){for(be=this.createContactEquation(V,z,v,A),Be.vsub(R,be.rj),Be.vsub(E,be.ni),be.ni.normalize(),be.ni.mult(Z,be.ri),be.rj.vadd(R,be.rj),be.rj.vsub(z.position,be.rj),be.ri.vadd(E,be.ri),be.ri.vsub(V.position,be.ri),this.result.push(be),this.createFrictionEquationsFromContact(be,this.frictionResult),ye=0,Ce=fe.length;ye!==Ce;ye++)W.release(fe[ye]);return W.release(Ee),W.release(_e),W.release(Be),W.release(Oe),void W.release(ke)}W.release(Ee),W.release(_e),W.release(Be),W.release(Oe),W.release(ke)}for(ye=0,Ce=fe.length;ye!==Ce;ye++)W.release(fe[ye])}}},new O,new O,n.prototype[R.types.PLANE|R.types.BOX]=n.prototype.planeBox=function(v,A,E,R,M,O,V,z){A.convexPolyhedronRepresentation.material=A.material,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.planeConvex(v,A.convexPolyhedronRepresentation,E,R,M,O,V,z)};var ot=new O,it=new O,rt=new O,at=new O;n.prototype[R.types.PLANE|R.types.CONVEXPOLYHEDRON]=n.prototype.planeConvex=function(v,A,E,R,M,O,V,z){var W=ot,H=it;H.set(0,0,1),M.vmult(H,H);for(var X=0,K=rt,Z=0;Z!==A.vertices.length;Z++)if(W.copy(A.vertices[Z]),O.vmult(W,W),R.vadd(W,W),W.vsub(E,K),0>=H.dot(K)){var J=this.createContactEquation(V,z,v,A),$=at;H.mult(H.dot(K),$),W.vsub($,$),$.vsub(E,J.ri),J.ni.copy(H),W.vsub(R,J.rj),J.ri.vadd(E,J.ri),J.ri.vsub(V.position,J.ri),J.rj.vadd(R,J.rj),J.rj.vsub(z.position,J.rj),this.result.push(J),X++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(J,this.frictionResult)}this.enableFrictionReduction&&X&&this.createFrictionFromAverage(X)};var st=new O,lt=new O;n.prototype[R.types.CONVEXPOLYHEDRON]=n.prototype.convexConvex=function(v,A,E,R,M,O,V,z,W,H,X,K){var Z=st;if(!(E.distanceTo(R)>v.boundingSphereRadius+A.boundingSphereRadius)&&v.findSeparatingAxis(A,E,M,R,O,Z,X,K)){var J=[],$=lt;v.clipAgainstHull(E,M,A,R,O,Z,-100,100,J);for(var ee=0,ne=0;ne!==J.length;ne++){var oe=this.createContactEquation(V,z,v,A,W,H),ie=oe.ri,ae=oe.rj;Z.negate(oe.ni),J[ne].normal.negate($),$.mult(J[ne].depth,$),J[ne].point.vadd($,ie),ae.copy(J[ne].point),ie.vsub(E,ie),ae.vsub(R,ae),ie.vadd(E,ie),ie.vsub(V.position,ie),ae.vadd(R,ae),ae.vsub(z.position,ae),this.result.push(oe),ee++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(oe,this.frictionResult)}this.enableFrictionReduction&&ee&&this.createFrictionFromAverage(ee)}};var ct=new O,ut=new O,dt=new O;n.prototype[R.types.PLANE|R.types.PARTICLE]=n.prototype.planeParticle=function(v,A,E,R,M,O,V,z){var W=ct;W.set(0,0,1),V.quaternion.vmult(W,W);var H=ut;if(R.vsub(V.position,H),0>=W.dot(H)){var X=this.createContactEquation(z,V,A,v);X.ni.copy(W),X.ni.negate(X.ni),X.ri.set(0,0,0);var K=dt;W.mult(W.dot(R),K),R.vsub(K,K),X.rj.copy(K),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult)}};var pt=new O;n.prototype[R.types.PARTICLE|R.types.SPHERE]=n.prototype.sphereParticle=function(v,A,E,R,M,O,V,z){var W=pt;if(W.set(0,0,1),R.vsub(E,W),W.norm2()<=v.radius*v.radius){var H=this.createContactEquation(z,V,A,v);W.normalize(),H.rj.copy(W),H.rj.mult(v.radius,H.rj),H.ni.copy(W),H.ni.negate(H.ni),H.ri.set(0,0,0),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult)}};var ht=new z,ft=new O,gt=(new O,new O),yt=new O,wt=new O;n.prototype[R.types.PARTICLE|R.types.CONVEXPOLYHEDRON]=n.prototype.convexParticle=function(v,A,E,R,M,O,V,z){var W=-1,H=gt,X=wt,K=null,Z=ft;if(Z.copy(R),Z.vsub(E,Z),M.conjugate(ht),ht.vmult(Z,Z),v.pointIsInside(Z)){v.worldVerticesNeedsUpdate&&v.computeWorldVertices(E,M),v.worldFaceNormalsNeedsUpdate&&v.computeWorldFaceNormals(M);for(var J=0,$=v.faces.length;J!==$;J++){var ee=[v.worldVertices[v.faces[J][0]]],ne=v.worldFaceNormals[J];R.vsub(ee[0],yt);var oe=-ne.dot(yt);(null===K||Math.abs(oe)<Math.abs(K))&&(K=oe,W=J,H.copy(ne))}if(-1!==W){var ie=this.createContactEquation(z,V,A,v);H.mult(K,X),X.vadd(R,X),X.vsub(E,X),ie.rj.copy(X),H.negate(ie.ni),ie.ri.set(0,0,0);var ae=ie.ri,se=ie.rj;ae.vadd(R,ae),ae.vsub(z.position,ae),se.vadd(E,se),se.vsub(V.position,se),this.result.push(ie),this.createFrictionEquationsFromContact(ie,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},n.prototype[R.types.BOX|R.types.HEIGHTFIELD]=n.prototype.boxHeightfield=function(v,A,E,R,M,O,V,z){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexHeightfield(v.convexPolyhedronRepresentation,A,E,R,M,O,V,z)};var vt=new O,bt=new O,Tt=[0];n.prototype[R.types.CONVEXPOLYHEDRON|R.types.HEIGHTFIELD]=n.prototype.convexHeightfield=function(v,A,E,R,M,O,z,W){var H=A.data,X=A.elementSize,K=v.boundingSphereRadius,Z=bt,J=Tt,$=vt;V.pointToLocalFrame(R,O,E,$);var ee=Math.floor(($.x-K)/X)-1,ne=Math.ceil(($.x+K)/X)+1,oe=Math.floor(($.y-K)/X)-1,ie=Math.ceil(($.y+K)/X)+1;if(!(0>ne||0>ie||ee>H.length||oe>H[0].length)){0>ee&&(ee=0),0>ne&&(ne=0),0>oe&&(oe=0),0>ie&&(ie=0),ee>=H.length&&(ee=H.length-1),ne>=H.length&&(ne=H.length-1),ie>=H[0].length&&(ie=H[0].length-1),oe>=H[0].length&&(oe=H[0].length-1);var ae=[];A.getRectMinMax(ee,oe,ne,ie,ae);var se=ae[0],le=ae[1];if(!($.z-K>le||$.z+K<se))for(var ce=ee;ne>ce;ce++)for(var ue=oe;ie>ue;ue++)A.getConvexTrianglePillar(ce,ue,!1),V.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.convexConvex(v,A.pillarConvex,E,Z,M,O,z,W,null,null,J,null),A.getConvexTrianglePillar(ce,ue,!0),V.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.convexConvex(v,A.pillarConvex,E,Z,M,O,z,W,null,null,J,null)}};var xt=new O,St=new O;n.prototype[R.types.SPHERE|R.types.HEIGHTFIELD]=n.prototype.sphereHeightfield=function(v,A,E,R,M,O,z,W){var H=A.data,X=v.radius,K=A.elementSize,Z=St,J=xt;V.pointToLocalFrame(R,O,E,J);var $=Math.floor((J.x-X)/K)-1,ee=Math.ceil((J.x+X)/K)+1,ne=Math.floor((J.y-X)/K)-1,oe=Math.ceil((J.y+X)/K)+1;if(!(0>ee||0>oe||$>H.length||oe>H[0].length)){0>$&&($=0),0>ee&&(ee=0),0>ne&&(ne=0),0>oe&&(oe=0),$>=H.length&&($=H.length-1),ee>=H.length&&(ee=H.length-1),oe>=H[0].length&&(oe=H[0].length-1),ne>=H[0].length&&(ne=H[0].length-1);var ie=[];A.getRectMinMax($,ne,ee,oe,ie);var ae=ie[0],se=ie[1];if(!(J.z-X>se||J.z+X<ae))for(var le=this.result,ce=$;ee>ce;ce++)for(var ue=ne;oe>ue;ue++){var de=le.length;if(A.getConvexTrianglePillar(ce,ue,!1),V.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.sphereConvex(v,A.pillarConvex,E,Z,M,O,z,W),A.getConvexTrianglePillar(ce,ue,!0),V.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.sphereConvex(v,A.pillarConvex,E,Z,M,O,z,W),le.length-de>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(v,A){function n(){z.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new R,this.broadphase=new ne,this.bodies=[],this.solver=new O,this.constraints=[],this.narrowphase=new V(this),this.collisionMatrix=new W,this.collisionMatrixPrevious=new W,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new Z,this.defaultMaterial=new H("default"),this.defaultContactMaterial=new X(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}A.exports=n;var E=v("../shapes/Shape"),R=v("../math/Vec3"),M=v("../math/Quaternion"),O=v("../solver/GSSolver"),V=(v("../utils/Vec3Pool"),v("../equations/ContactEquation"),v("../equations/FrictionEquation"),v("./Narrowphase")),z=v("../utils/EventTarget"),W=v("../collision/ArrayCollisionMatrix"),H=v("../material/Material"),X=v("../material/ContactMaterial"),K=v("../objects/Body"),Z=v("../utils/TupleDictionary"),J=v("../collision/RaycastResult"),$=v("../collision/AABB"),ee=v("../collision/Ray"),ne=v("../collision/NaiveBroadphase");n.prototype=new z;var oe=(new $,new ee);if(n.prototype.getContactMaterial=function(v,A){return this.contactMaterialTable.get(v.id,A.id)},n.prototype.numObjects=function(){return this.bodies.length},n.prototype.collisionMatrixTick=function(){var v=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=v,this.collisionMatrix.reset()},n.prototype.add=n.prototype.addBody=function(v){-1===this.bodies.indexOf(v)&&(v.index=this.bodies.length,this.bodies.push(v),v.world=this,v.initPosition.copy(v.position),v.initVelocity.copy(v.velocity),v.timeLastSleepy=this.time,v instanceof K&&(v.initAngularVelocity.copy(v.angularVelocity),v.initQuaternion.copy(v.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=v,this.dispatchEvent(this.addBodyEvent))},n.prototype.addConstraint=function(v){this.constraints.push(v)},n.prototype.removeConstraint=function(v){var A=this.constraints.indexOf(v);-1!==A&&this.constraints.splice(A,1)},n.prototype.rayTest=function(v,A,E){E instanceof J?this.raycastClosest(v,A,{skipBackfaces:!0},E):this.raycastAll(v,A,{skipBackfaces:!0},E)},n.prototype.raycastAll=function(v,A,E,R){return E.mode=ee.ALL,E.from=v,E.to=A,E.callback=R,oe.intersectWorld(this,E)},n.prototype.raycastAny=function(v,A,E,R){return E.mode=ee.ANY,E.from=v,E.to=A,E.result=R,oe.intersectWorld(this,E)},n.prototype.raycastClosest=function(v,A,E,R){return E.mode=ee.CLOSEST,E.from=v,E.to=A,E.result=R,oe.intersectWorld(this,E)},n.prototype.remove=function(v){v.world=null;var A=this.bodies.length-1,E=this.bodies,R=E.indexOf(v);if(-1!==R){E.splice(R,1);for(var M=0;M!==E.length;M++)E[M].index=M;this.collisionMatrix.setNumObjects(A),this.removeBodyEvent.body=v,this.dispatchEvent(this.removeBodyEvent)}},n.prototype.removeBody=n.prototype.remove,n.prototype.addMaterial=function(v){this.materials.push(v)},n.prototype.addContactMaterial=function(v){this.contactmaterials.push(v),this.contactMaterialTable.set(v.materials[0].id,v.materials[1].id,v)},"undefined"==typeof performance&&(performance={}),!performance.now){var ie=Date.now();performance.timing&&performance.timing.navigationStart&&(ie=performance.timing.navigationStart),performance.now=function(){return Date.now()-ie}}var ae=new R;n.prototype.step=function(v,A,E){if(E=E||10,0===(A=A||0))this.internalStep(v),this.time+=v;else{var R=Math.floor((this.time+A)/v)-Math.floor(this.time/v);R=Math.min(R,E);for(var M=performance.now(),O=0;O!==R&&(this.internalStep(v),!(performance.now()-M>1e3*v));O++);this.time+=A;for(var V=this.time%v/v,z=ae,W=this.bodies,H=0;H!==W.length;H++){var X=W[H];X.type!==K.STATIC&&X.sleepState!==K.SLEEPING?(X.position.vsub(X.previousPosition,z),z.scale(V,z),X.position.vadd(z,X.interpolatedPosition)):(X.interpolatedPosition.copy(X.position),X.interpolatedQuaternion.copy(X.quaternion))}}};var se={type:"postStep"},le={type:"preStep"},ce={type:"collide",body:null,contact:null},ue=[],de=[],he=[],me=[],fe=(new R,new R,new R,new R,new R,new R,new R,new R,new R,new M,new M),ye=new M,we=new R;n.prototype.internalStep=function(v){this.dt=v;var A,R=this.contacts,M=he,O=me,V=this.numObjects(),z=this.bodies,W=this.solver,H=this.gravity,X=this.doProfiling,Z=this.profile,J=K.DYNAMIC,$=this.constraints,ee=de,ne=(H.norm(),H.x),oe=H.y,ie=H.z,ae=0;for(X&&(A=performance.now()),ae=0;ae!==V;ae++)if((ke=z[ae]).type&J){var ve=ke.force,be=ke.mass;ve.x+=be*ne,ve.y+=be*oe,ve.z+=be*ie}ae=0;for(var Te=this.subsystems.length;ae!==Te;ae++)this.subsystems[ae].update();X&&(A=performance.now()),M.length=0,O.length=0,this.broadphase.collisionPairs(this,M,O),X&&(Z.broadphase=performance.now()-A);var Se=$.length;for(ae=0;ae!==Se;ae++)if(!(Oe=$[ae]).collideConnected)for(var Ce=M.length-1;Ce>=0;Ce-=1)(Oe.bodyA===M[Ce]&&Oe.bodyB===O[Ce]||Oe.bodyB===M[Ce]&&Oe.bodyA===O[Ce])&&(M.splice(Ce,1),O.splice(Ce,1));this.collisionMatrixTick(),X&&(A=performance.now());var Ee=ue,_e=R.length;for(ae=0;ae!==_e;ae++)Ee.push(R[ae]);R.length=0;var Ie=this.frictionEquations.length;for(ae=0;ae!==Ie;ae++)ee.push(this.frictionEquations[ae]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(M,O,this,R,Ee,this.frictionEquations,ee),X&&(Z.narrowphase=performance.now()-A),X&&(A=performance.now()),ae=0;ae<this.frictionEquations.length;ae++)W.addEquation(this.frictionEquations[ae]);for(var Pe=R.length,Be=0;Be!==Pe;Be++){var ke=(Oe=R[Be]).bi,Re=Oe.bj;Oe.si,Oe.sj,(ke.material&&Re.material&&this.getContactMaterial(ke.material,Re.material)||this.defaultContactMaterial).friction,ke.material&&Re.material&&(ke.material.friction>=0&&Re.material.friction>=0&&(ke.material.friction,Re.material.friction),ke.material.restitution>=0&&Re.material.restitution>=0&&(Oe.restitution=ke.material.restitution*Re.material.restitution)),W.addEquation(Oe),ke.allowSleep&&ke.type===K.DYNAMIC&&ke.sleepState===K.SLEEPING&&Re.sleepState===K.AWAKE&&Re.type!==K.STATIC&&Re.velocity.norm2()+Re.angularVelocity.norm2()>=2*Math.pow(Re.sleepSpeedLimit,2)&&(ke._wakeUpAfterNarrowphase=!0),Re.allowSleep&&Re.type===K.DYNAMIC&&Re.sleepState===K.SLEEPING&&ke.sleepState===K.AWAKE&&ke.type!==K.STATIC&&ke.velocity.norm2()+ke.angularVelocity.norm2()>=2*Math.pow(ke.sleepSpeedLimit,2)&&(Re._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(ke,Re,!0),this.collisionMatrixPrevious.get(ke,Re)||(ce.body=Re,ce.contact=Oe,ke.dispatchEvent(ce),ce.body=ke,Re.dispatchEvent(ce))}for(X&&(Z.makeContactConstraints=performance.now()-A,A=performance.now()),ae=0;ae!==V;ae++)(ke=z[ae])._wakeUpAfterNarrowphase&&(ke.wakeUp(),ke._wakeUpAfterNarrowphase=!1);for(Se=$.length,ae=0;ae!==Se;ae++){var Oe;(Oe=$[ae]).update(),Ce=0;for(var Le=Oe.equations.length;Ce!==Le;Ce++){var Ve=Oe.equations[Ce];W.addEquation(Ve)}}W.solve(v,this),X&&(Z.solve=performance.now()-A),W.removeAllEquations();var Ne=Math.pow;for(ae=0;ae!==V;ae++)if((ke=z[ae]).type&J){var Fe=Ne(1-ke.linearDamping,v),Ue=ke.velocity;Ue.mult(Fe,Ue);var We=ke.angularVelocity;if(We){var Ge=Ne(1-ke.angularDamping,v);We.mult(Ge,We)}}for(this.dispatchEvent(le),ae=0;ae!==V;ae++)(ke=z[ae]).preStep&&ke.preStep.call(ke);X&&(A=performance.now());var qe=fe,He=ye,Ye=this.stepnumber,Qe=K.DYNAMIC|K.KINEMATIC,Xe=Ye%(this.quatNormalizeSkip+1)==0,Ze=this.quatNormalizeFast,Je=.5*v;for(E.types.PLANE,E.types.CONVEXPOLYHEDRON,ae=0;ae!==V;ae++){var $e=z[ae],et=$e.force,nt=$e.torque;if($e.type&Qe&&$e.sleepState!==K.SLEEPING){var ot=$e.velocity,it=$e.angularVelocity,rt=$e.position,at=$e.quaternion,st=$e.invMass,lt=$e.invInertiaWorld;ot.x+=et.x*st*v,ot.y+=et.y*st*v,ot.z+=et.z*st*v,$e.angularVelocity&&(lt.vmult(nt,we),we.mult(v,we),we.vadd(it,it)),rt.x+=ot.x*v,rt.y+=ot.y*v,rt.z+=ot.z*v,$e.angularVelocity&&(qe.set(it.x,it.y,it.z,0),qe.mult(at,He),at.x+=Je*He.x,at.y+=Je*He.y,at.z+=Je*He.z,at.w+=Je*He.w,Xe&&(Ze?at.normalizeFast():at.normalize())),$e.aabb&&($e.aabbNeedsUpdate=!0),$e.updateInertiaWorld&&$e.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,X&&(Z.integrate=performance.now()-A),this.time+=v,this.stepnumber+=1,this.dispatchEvent(se),ae=0;ae!==V;ae++){var ct=(ke=z[ae]).postStep;ct&&ct.call(ke)}if(this.allowSleep)for(ae=0;ae!==V;ae++)z[ae].sleepTick(this.time)},n.prototype.clearForces=function(){for(var v=this.bodies,A=v.length,E=0;E!==A;E++){var R=v[E];R.force,R.torque,R.force.set(0,0,0),R.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})),define("src/modules/arcades/gameObjects/arcade",["require","exports","@dcl/ecs-scene-utils"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.Arcade=void 0;var R=function(v){function Arcade(A,E,R){void 0===R&&(R=!0);var M=v.call(this)||this;return M.knob=new Entity,engine.addEntity(M),M.addComponent(A),M.addComponent(E),R&&(M.knob.addComponent(new GLTFShape("models/core_building/knob.glb")),M.knob.addComponent(new Transform({position:new Vector3(0,1.383,-.397)})),M.knob.getComponent(Transform).rotate(Vector3.Left(),11.6),M.knob.setParent(M)),M}return __extends(Arcade,v),Arcade.prototype.controlStop=function(){this.knob.hasComponent(E.KeepRotatingComponent)&&this.knob.removeComponent(E.KeepRotatingComponent)},Arcade.prototype.controlLeft=function(){this.knob.addComponentOrReplace(new E.KeepRotatingComponent(Quaternion.Euler(0,-90,0)))},Arcade.prototype.controlRight=function(){this.knob.addComponentOrReplace(new E.KeepRotatingComponent(Quaternion.Euler(0,90,0)))},Arcade}(Entity);A.Arcade=R})),define("src/modules/arcades/gameObjects/ball",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.Ball=A.BallFlag=void 0;var E=function(){function BallFlag(){}return __decorate([Component("ballFlag")],BallFlag)}();A.BallFlag=E;var R=function(v){function Ball(A,R,M){var O=v.call(this)||this;return engine.addEntity(O),O.setParent(M),O.addComponent(A),O.addComponent(new E),O.addComponent(new BoxShape),O.getComponent(BoxShape).withCollisions=!1,O.direction=R,O}return __extends(Ball,v),Ball}(Entity);A.Ball=R})),define("src/modules/arcades/gameObjects/brick",["require","exports","src/modules/arcades/gameLogic/collision"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.Brick=A.BrickFlag=void 0;var R=function(){function BrickFlag(){}return __decorate([Component("brickFlag")],BrickFlag)}();A.BrickFlag=R;var M=function(v){function Brick(A,M,O){var V=v.call(this)||this;return engine.addEntity(V),V.addComponent(A),V.addComponent(new R),V.addComponent(new E.CollisionFlag),V.addComponent(new BoxShape),V.addComponent(new Material),V.getComponent(Material).albedoColor=M,V.getComponent(Material).emissiveColor=M,V.getComponent(Material).emissiveIntensity=.95,V.setParent(O),V}return __extends(Brick,v),Brick}(Entity);A.Brick=M})),define("src/modules/arcades/gameObjects/sound",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.Sound=void 0;var E=function(v){function Sound(A,E,R){void 0===E&&(E=!1);var M=v.call(this)||this;return engine.addEntity(M),M.addComponent(new AudioSource(A)),M.getComponent(AudioSource).loop=E,M.addComponent(new Transform),R?M.getComponent(Transform).position=R:M.setParent(Attachable.AVATAR),M}return __extends(Sound,v),Sound.prototype.playAudioOnceAtPos=function(v){this.getComponent(Transform).position=v,this.getComponent(AudioSource).playOnce()},Sound.prototype.playAudioAtPos=function(v){this.getComponent(Transform).position=v,this.getComponent(AudioSource).playing=!0},Sound}(Entity);A.Sound=E})),define("src/modules/arcades/gameObjects/wall",["require","exports","src/modules/arcades/gameLogic/collision"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.Wall=A.WallFlag=void 0;var R=function(){function WallFlag(){}return __decorate([Component("wallFlag")],WallFlag)}();A.WallFlag=R;var M=function(v){function Wall(A,M,O,V){var z=v.call(this)||this;return engine.addEntity(z),z.addComponent(A),z.addComponent(new R),z.addComponent(new E.CollisionFlag),z.addComponent(new BoxShape),z.addComponent(new Material),z.normal=M,z.getComponent(Material).albedoColor=O,z.setParent(V),z}return __extends(Wall,v),Wall}(Entity);A.Wall=M})),define("src/modules/arcades/gameLogic/collision",["require","exports","src/modules/arcades/gameObjects/ball","src/modules/arcades/gameObjects/brick","src/modules/arcades/gameObjects/paddle","src/modules/arcades/gameObjects/sound","@dcl/ecs-scene-utils","src/modules/arcades/gameObjects/wall"],(function(v,A,E,R,M,O,V,z){Object.defineProperty(A,"__esModule",{value:!0}),A.CollisionFlag=void 0;var W=function(){function CollisionFlag(){}return __decorate([Component("collisionFlag")],CollisionFlag)}();A.CollisionFlag=W;var H=new O.Sound(new AudioClip("sounds/hit.mp3")),X=function(){function CollisionDetection(){this.ballGroup=engine.getComponentGroup(E.BallFlag),this.collisionGroup=engine.getComponentGroup(W)}return CollisionDetection.prototype.update=function(v){var A,E,O,X;try{for(var K=__values(this.ballGroup.entities),Z=K.next();!Z.done;Z=K.next()){var J=Z.value,_loop_1=function(v){var A=J.getComponent(Transform).position,E=v.getComponent(Transform).position,O=J.getComponent(Transform).scale,X=v.getComponent(Transform).scale,K=A.x-O.x/2,Z=A.z+O.z/2,$=E.x-X.x/2,ee=E.z+X.z/2,ne=void 0;if(K+O.x>=$&&K<=$+X.x&&Z-O.z<=ee&&Z>=ee-X.z){H.getComponent(AudioSource).playOnce(),v.removeComponent(W),v.addComponentOrReplace(new V.Delay(100,(function(){v.addComponent(new W)})));var oe=v.hasComponent(M.PaddleFlag),ie=v.hasComponent(z.WallFlag);ne=ie?v.normal:collisionNormal(J,v),J.direction=reflectVector(J.direction,ne,oe,ie),v.hasComponent(R.BrickFlag)&&!v.hasComponent(V.ExpireIn)&&v.addComponent(new V.ExpireIn(100))}};try{for(var $=(O=void 0,__values(this.collisionGroup.entities)),ee=$.next();!ee.done;ee=$.next())_loop_1(ee.value)}catch(v){O={error:v}}finally{try{ee&&!ee.done&&(X=$.return)&&X.call($)}finally{if(O)throw O.error}}}}catch(v){A={error:v}}finally{try{Z&&!Z.done&&(E=K.return)&&E.call(K)}finally{if(A)throw A.error}}},CollisionDetection}();function reflectVector(v,A,E,R){var M=2*Vector3.Dot(v,A),O=v.subtract(A.multiplyByFloats(M,M,M));return R&&(1===A.x&&O.x<0&&(O.x*=-1),-1===A.x&&O.x>0&&(O.x*=-1),1===A.z&&O.z<0&&(O.z*=-1),-1===A.z&&O.z>0&&(O.z*=-1)),E&&O.z<=0&&(O.z*=-1),O.z>=0&&O.z<=.25&&(O.z=.35),O.z<=0&&O.z>=-.25&&(O.z=-.35),Vector3.Normalize(O)}function collisionNormal(v,A){var E=v.getComponent(Transform).position,R=A.getComponent(Transform).position,O=A.getComponent(Transform).scale.x,V=E.subtract(R),z=new Vector3(0,0,1);return A.hasComponent(M.PaddleFlag)?(z.x=V.x/2,(V.x<=-O/2||V.x>=O/2)&&z.set(1,0,0),V.x<=-O/2&&v.direction.x<0&&z.set(-1,0,1),V.x>=O/2&&v.direction.x>0&&z.set(1,0,1),Vector3.Normalize(z)):((V.x<=-O/2||V.x>=O/2)&&z.set(1,0,0),V.x<=-O/2&&v.direction.x<0&&z.set(0,0,1),V.x>=O/2&&v.direction.x>0&&z.set(0,0,1),Vector3.Normalize(z))}engine.addSystem(new X)})),define("src/modules/arcades/gameObjects/paddle",["require","exports","src/modules/arcades/gameLogic/collision"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.Paddle=A.PaddleFlag=void 0;var R=function(){function PaddleFlag(){}return __decorate([Component("paddleFlag")],PaddleFlag)}();A.PaddleFlag=R;var M=function(v){function Paddle(A,M,O){var V=v.call(this)||this;return engine.addEntity(V),V.addComponent(A),V.addComponent(new R),V.addComponent(new E.CollisionFlag),V.addComponent(new BoxShape),V.addComponent(new Material),V.getComponent(Material).albedoColor=M,V.setParent(O),V}return __extends(Paddle,v),Paddle}(Entity);A.Paddle=M})),define("src/modules/arcades/gameManager",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.GameManager=void 0;var E=function(){function GameManager(){}return GameManager.hasGameLoaded=!1,GameManager.isEKeyPressed=!1,GameManager.isFKeyPressed=!1,GameManager.isBallAlive=!1,GameManager.PLANE_HEIGHT=1,GameManager.BALL_SPEED=16,GameManager.PADDLE_SPEED=16,GameManager.POS_X_LIMIT=26.5,GameManager.NEG_X_LIMIT=5.5,GameManager.OUT_OF_BOUNDS=1.5,GameManager}();A.GameManager=E})),define("src/modules/arcades/player",["require","exports","src/modules/arcades/gameObjects/paddle","src/modules/arcades/gameObjects/ball","src/modules/arcades/gameManager"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.unloadPlayer=A.loadPlayer=void 0;var O,V,z,W=Input.instance,H=[];A.loadPlayer=function(v,A){z=v,M.GameManager.hasGameLoaded=!0,V=new E.Paddle(new Transform({position:new Vector3(16,M.GameManager.PLANE_HEIGHT,4),scale:new Vector3(2,.01,1)}),Color3.FromInts(127,127,255),z),H.push(V),W.subscribe("BUTTON_DOWN",ActionButton.POINTER,!1,(function(){if(M.GameManager.hasGameLoaded&&!M.GameManager.isBallAlive){M.GameManager.isBallAlive=!0;var v=Vector3.Forward();v.y=0,A=Vector3.Normalize(v),E=V.getComponent(Transform).position,O=new Vector3(E.x,M.GameManager.PLANE_HEIGHT,E.z+1),W=new R.Ball(new Transform({position:O,scale:new Vector3(.3,.1,.4)}),A,z),H.push(W)}var A,E,O,W})),W.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(){M.GameManager.isEKeyPressed=!0})),W.subscribe("BUTTON_UP",ActionButton.PRIMARY,!1,(function(){M.GameManager.isEKeyPressed=!1})),W.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(){M.GameManager.isFKeyPressed=!0})),W.subscribe("BUTTON_UP",ActionButton.SECONDARY,!1,(function(){M.GameManager.isFKeyPressed=!1}));var X=function(){function ButtonChecker(){}return ButtonChecker.prototype.update=function(v){var E=V.getComponent(Transform),R=Vector3.Right().scale(v*M.GameManager.PADDLE_SPEED);M.GameManager.isEKeyPressed||M.GameManager.isFKeyPressed||A.controlStop(),M.GameManager.isEKeyPressed&&E.position.x>=M.GameManager.NEG_X_LIMIT&&(E.translate(R.multiplyByFloats(-1,-1,-1)),A.controlLeft()),M.GameManager.isFKeyPressed&&E.position.x<=M.GameManager.POS_X_LIMIT&&(E.translate(R),A.controlRight())},ButtonChecker}();O=engine.addSystem(new X,0)},A.unloadPlayer=function(){for(;H.length;){var v=H.pop();engine.removeEntity(v)}M.GameManager.hasGameLoaded=!1,M.GameManager.isBallAlive=!1,engine.removeSystem(O)}})),define("src/modules/arcades/gameObjects/background",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.Background=void 0,new Entity;var E=function(v){function Background(A,E){var R=v.call(this)||this;return R.addComponent(A),R.addComponent(new BoxShape),R.addComponent(new Material),R.getComponent(Material).albedoColor=Color3.Black(),R.getComponent(Material).roughness=.9,R.setParent(E),R}return __extends(Background,v),Background}(Entity);A.Background=E})),define("src/modules/arcades/gameLogic/atariLevel",["require","exports","src/modules/arcades/gameObjects/brick","src/modules/arcades/gameObjects/wall","src/modules/arcades/gameObjects/background","src/modules/arcades/gameManager"],(function(v,A,E,R,M,O){Object.defineProperty(A,"__esModule",{value:!0}),A.unloadAtariBricks=A.loadAtariBricks=A.loadAtariLevel=void 0;var V=new Entity;V.addComponent(new GLTFShape("models/readyPlayerOne.glb")),V.addComponent(new Transform({position:new Vector3(16,1,16)}));var z=Color3.FromInts(255,127,0),W=Color3.FromInts(127,255,127),H=[];A.loadAtariLevel=function(v){V.setParent(v),new R.Wall(new Transform({position:new Vector3(3.5,O.GameManager.PLANE_HEIGHT+.1,16),scale:new Vector3(2,.1,32)}),new Vector3(1,0,0),Color3.White(),v),new R.Wall(new Transform({position:new Vector3(16,O.GameManager.PLANE_HEIGHT+.1,31.5),scale:new Vector3(27,.1,2)}),new Vector3(0,0,-1),Color3.White(),v),new R.Wall(new Transform({position:new Vector3(28.5,O.GameManager.PLANE_HEIGHT+.1,16),scale:new Vector3(2,.1,32)}),new Vector3(-1,0,0),Color3.White(),v),new M.Background(new Transform({position:new Vector3(16,O.GameManager.PLANE_HEIGHT-.1,16),scale:new Vector3(26,.01,32)}),v)},A.loadAtariBricks=function(v){V.getComponent(GLTFShape).visible=!1;for(var A=6,R=24,M=0;M<3;M++){for(var X=0;X<9;X++){var K=new E.Brick(new Transform({position:new Vector3(A,O.GameManager.PLANE_HEIGHT,R),scale:new Vector3(2,.1,1)}),z,v);A+=2.5,H.push(K)}R-=1.5,A=6}var Z=19.5;for(M=0;M<3;M++){for(X=0;X<9;X++)K=new E.Brick(new Transform({position:new Vector3(A,O.GameManager.PLANE_HEIGHT,Z),scale:new Vector3(2,.1,1)}),W,v),A+=2.5,H.push(K);Z-=1.5,A=6}},A.unloadAtariBricks=function(){for(V.getComponent(GLTFShape).visible=!0;H.length;){var v=H.pop();engine.removeEntity(v)}}})),define("src/modules/arcades/arcades",["require","exports","src/modules/arcades/gameObjects/arcade","src/modules/arcades/player","src/modules/arcades/gameLogic/atariLevel","src/modules/arcades/gameManager","@dcl/ecs-scene-utils"],(function(v,A,E,R,M,O,V){Object.defineProperty(A,"__esModule",{value:!0}),A.addArcades=void 0,A.addArcades=function(){for(var v=new GLTFShape("models/core_building/arcadeCabinetAtari.glb"),A=[new Transform({position:new Vector3(167,10.7,164),rotation:Quaternion.Euler(0,204,0)}),new Transform({position:new Vector3(154,10.7,163),rotation:Quaternion.Euler(0,156,0)}),new Transform({position:new Vector3(175,10.7,144.7),rotation:Quaternion.Euler(0,204,0)})],z=[new Vector3(0,2,.5),new Vector3(0,2,.5),new Vector3(0,2,.5)],_loop_2=function(W){var H=new E.Arcade(v,A[W]),X=new Entity;X.addComponent(new Transform({position:new Vector3(-.48,1.38,-.155)})),X.getComponent(Transform).scale.setAll(.03),X.getComponent(Transform).rotate(Vector3.Left(),75),X.setParent(H);var K=new V.TriggerBoxShape(new Vector3(3,3,3),z[W]);(0,M.loadAtariLevel)(X),H.addComponent(new V.TriggerComponent(K,{onCameraEnter:function(){O.GameManager.hasGameLoaded||((0,M.loadAtariBricks)(X),(0,R.loadPlayer)(X,H))},onCameraExit:function(){O.GameManager.hasGameLoaded&&((0,M.unloadAtariBricks)(),(0,R.unloadPlayer)())},enableDebug:!1}))},W=0;W<A.length;W++)_loop_2(W)}})),define("src/modules/wearables",["require","exports","src/modules/ui"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.addWearables=A.getWearableURL=A.Wearable=void 0;var R=function(v){function Wearable(A,R,M,O){var V=v.call(this)||this;V.isDefault=!1,engine.addEntity(V),V.addComponent(A),V.addComponent(new Transform(R)),O&&(V.isDefault=!0),V.wearableName=M.toLocaleLowerCase();var z=V;return V.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(A){switch(A.label){case 0:return z.isDefault?((0,E.wearableClassic)(z),log("This item is part of the classic collection of wearables. You can find it in your inventory."),[3,3]):[3,1];case 1:return(0,E.openLoadingUI)(),[4,getWearableOnSale(M.toLocaleLowerCase())];case 2:(v=A.sent()).data.nfts.length>0?(z.wearableData=v.data.nfts[0],(0,E.openWearableUI)(z,v.data.nfts[0])):((0,E.wearableNotForSale)(z),log("no results")),A.label=3;case 3:return[2]}}))}))}),{button:ActionButton.PRIMARY,hoverText:"Info"})),V}return __extends(Wearable,v),Wearable}(Entity);function getWearableOnSale(v){return __awaiter(this,void 0,void 0,(function(){var A,E,R,M,O,V;return __generator(this,(function(z){switch(z.label){case 0:A=String(Math.floor(Date.now()/1e3)),E='\n\t  {\n\t\t  nfts(first: 1,  orderBy: searchOrderPrice, orderDirection: asc, where:{ category: wearable, searchText: "'+v+'", searchOrderStatus:open, searchOrderExpiresAt_gt:'+A+"\n\t\t}) {\n\t\t\tid\n\t\t  name\n\t\t  image\n\t\t  contractAddress\n\t\t  tokenId\n\t\t  wearable{ name, representationId, collection, description, category, rarity, bodyShapes }\n\t\t  searchOrderPrice\n\t\t  searchOrderStatus\n\t\t  owner{address}\n\t\t  activeOrder {\n\t\t\t  id\n\t\t\t}\n\t\t  }\n\t  }",log("query: ",E),z.label=1;case 1:return z.trys.push([1,3,,4]),R=function(v){return __awaiter(this,void 0,void 0,(function(){var A;return __generator(this,(function(E){switch(E.label){case 0:return"https://api.thegraph.com/subgraphs/name/decentraland/marketplace",A={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:v})},[4,fetch("https://api.thegraph.com/subgraphs/name/decentraland/marketplace",A)];case 1:return[2,E.sent().json()]}}))}))}(E),M=log,O=["wearable info: "],[4,R];case 2:return M.apply(void 0,O.concat([z.sent()])),[2,R];case 3:throw V=z.sent(),log("Error fetching wearable dat ",V),V;case 4:return[2]}}))}))}A.Wearable=R,A.getWearableURL=function(v){return"https://market.decentraland.org/contracts/"+v.contractAddress+"/tokens/"+v.tokenId},A.addWearables=function(){engine.addSystem(new E.UIDistanceSystem),new R(new GLTFShape("models/wearables/first_floor/A/MANA_Eyewear.glb"),{position:new Vector3(284,10.5,110.4),rotation:Quaternion.Euler(0,60,0)},"MANA Eyewear"),new R(new GLTFShape("models/wearables/first_floor/A/Spysuit_Goggles.glb"),{position:new Vector3(283,10.5,111.8),rotation:Quaternion.Euler(0,60,0)},"Spy Suit Eyewear"),new R(new GLTFShape("models/wearables/first_floor/A/Eyewear_Raver.glb"),{position:new Vector3(282,10.5,113.1),rotation:Quaternion.Euler(0,60,0)},"Raver Goggles"),new R(new GLTFShape("models/wearables/first_floor/B/F_Hat_Foam.glb"),{position:new Vector3(276.5,10.5,110.4),rotation:Quaternion.Euler(0,60,0)},"Mexican Foam Hat"),new R(new GLTFShape("models/wearables/first_floor/B/sunhat.glb"),{position:new Vector3(275.5,10.5,111.8),rotation:Quaternion.Euler(0,60,0)},"Trendy Sport Hat"),new R(new GLTFShape("models/wearables/first_floor/B/MaleHat_DCL.glb"),{position:new Vector3(274.5,10.5,113.1),rotation:Quaternion.Euler(0,60,0)},"Decentraland Hat"),new R(new GLTFShape("models/wearables/first_floor/C/M_Mask_Skull.glb"),{position:new Vector3(265.9,10.5,122.5),rotation:Quaternion.Euler(0,90,0)},"lirio skull"),new R(new GLTFShape("models/wearables/first_floor/C/M_TopHead_Machete.glb"),{position:new Vector3(265.5,10.5,124.5),rotation:Quaternion.Euler(0,90,0)},"Machete Headband"),new R(new GLTFShape("models/wearables/first_floor/C/M_TopHead_Skull.glb"),{position:new Vector3(265.2,10.5,126.5),rotation:Quaternion.Euler(0,90,0)},"Skull Mexican Hat"),new R(new GLTFShape("models/wearables/first_floor/D/protection_mask_hot_mask.glb"),{position:new Vector3(265.7,10.5,131.5),rotation:Quaternion.Euler(0,115,0)},"Hot Protection Mask"),new R(new GLTFShape("models/wearables/first_floor/D/protection_mask_skull_mask.glb"),{position:new Vector3(266.23,10.5,132.73),rotation:Quaternion.Euler(0,115,0)},"Skull Protection Mask"),new R(new GLTFShape("models/wearables/first_floor/D/protection_mask_african_mask.glb"),{position:new Vector3(266.76,10.5,133.96),rotation:Quaternion.Euler(0,115,0)},"African Protection Mask"),new R(new GLTFShape("models/wearables/first_floor/D/protection_mask_funny_mask.glb"),{position:new Vector3(267.3,10.5,135.2),rotation:Quaternion.Euler(0,115,0)},"Graffiti Protection Mask"),new R(new GLTFShape("models/wearables/first_floor/E/Eyewear_XmasTree.glb"),{position:new Vector3(270.8,10.5,139),rotation:Quaternion.Euler(0,145,0)},"Christmas Tree Eyewear"),new R(new GLTFShape("models/wearables/first_floor/E/F_Hat_Elf.glb"),{position:new Vector3(272.3,10.5,140.7),rotation:Quaternion.Euler(0,145,0)},"Christmas Elf Hat"),new R(new GLTFShape("models/wearables/first_floor/E/F_Helmet_LedSuit.glb"),{position:new Vector3(273.8,10.5,141.7),rotation:Quaternion.Euler(0,145,0)},"Cyber Xmas Helmet"),new R(new GLTFShape("models/wearables/first_floor/F/Umbrella_Hat.glb"),{position:new Vector3(286.9,10.5,140.9),rotation:Quaternion.Euler(0,180,0)},"Umbrella Hat"),new R(new GLTFShape("models/wearables/first_floor/F/M_Hat_Hat_of_Wonder.glb"),{position:new Vector3(288.8,10.5,140.9),rotation:Quaternion.Euler(0,180,0)},"Hat of Wonder"),new R(new GLTFShape("models/wearables/first_floor/F/MaleHat_MANA.glb"),{position:new Vector3(290.4,10.5,140.9),rotation:Quaternion.Euler(0,180,0)},"MANA Hat"),new R(new GLTFShape("models/wearables/first_floor/G/Tiara_Bee.glb"),{position:new Vector3(291.4,10.5,135.3),rotation:Quaternion.Euler(0,180,0)},"Bee Headband"),new R(new GLTFShape("models/wearables/first_floor/G/F_Tiara_GreenStone.glb"),{position:new Vector3(293.26,10.5,135.3),rotation:Quaternion.Euler(0,180,0)},"F_Tiara_GreenStone",!0),new R(new GLTFShape("models/wearables/first_floor/G/F_Tiara_LaurelWreath.glb"),{position:new Vector3(294.8,10.5,135.5),rotation:Quaternion.Euler(0,180,0)},"F_Tiara_LaurelWreath",!0),new R(new GLTFShape("models/wearables/second_floor/A/spy_suit_lower_body"),{position:new Vector3(284,18.5,110.4),rotation:Quaternion.Euler(0,60,0)},"Spy Suit Pants"),new R(new GLTFShape("models/wearables/second_floor/A/creepy_nurse_lower_body.glb"),{position:new Vector3(283,19,111.8),rotation:Quaternion.Euler(0,60,0)},"Creepy Nurse Skirt"),new R(new GLTFShape("models/wearables/second_floor/A/M_lBody_GreyJoggers.glb"),{position:new Vector3(282,18.5,113.1),rotation:Quaternion.Euler(0,60,0)},"Gray Joggers",!0),new R(new GLTFShape("models/wearables/second_floor/B/m_barbarian_helmet_hat.glb"),{position:new Vector3(276.5,18.5,110.4),rotation:Quaternion.Euler(0,60,0)},"Barbarian Helmet"),new R(new GLTFShape("models/wearables/second_floor/B/cw_fox_top_head.glb"),{position:new Vector3(275.5,18.5,111.8),rotation:Quaternion.Euler(0,60,0)},"Fox Hat"),new R(new GLTFShape("models/wearables/second_floor/B/xmas_snowman_helmet.glb"),{position:new Vector3(274.5,18.5,113.1),rotation:Quaternion.Euler(0,60,0)},"Snowman Head"),new R(new GLTFShape("models/wearables/second_floor/C/asian_fox.glb"),{position:new Vector3(265.9,18.5,122.5),rotation:Quaternion.Euler(0,90,0)},"Asian Fox Mask"),new R(new GLTFShape("models/wearables/second_floor/C/tropical_mask.glb"),{position:new Vector3(265.5,18.5,124.5),rotation:Quaternion.Euler(0,90,0)},"Tropical Mask"),new R(new GLTFShape("models/wearables/second_floor/C/muzzle_mask.glb"),{position:new Vector3(265.2,18.5,126.5),rotation:Quaternion.Euler(0,90,0)},"Muzzle Mask"),new R(new GLTFShape("models/wearables/second_floor/D/razor_blade_feet.glb"),{position:new Vector3(265.7,18,131.5),rotation:Quaternion.Euler(0,115,0)},"Razor Blade Shoes"),new R(new GLTFShape("models/wearables/second_floor/D/cw_city_sneakers_feet.glb"),{position:new Vector3(266.4,18,133.45),rotation:Quaternion.Euler(0,115,0)},"City Decentraland Sneakers"),new R(new GLTFShape("models/wearables/second_floor/D/sad_clown_feet.glb"),{position:new Vector3(267.3,18,135.4),rotation:Quaternion.Euler(0,115,0)},"Sad Clown Shoes"),new R(new GLTFShape("models/wearables/second_floor/E/M_EyeWear_ThugLife.glb"),{position:new Vector3(270.8,18.5,139.7),rotation:Quaternion.Euler(0,145,0)},"Thug Life",!0),new R(new GLTFShape("models/wearables/second_floor/E/razor_blade_eyewear.glb"),{position:new Vector3(272.3,18.5,140.7),rotation:Quaternion.Euler(0,145,0)},"Razor Blade Eyewear"),new R(new GLTFShape("models/wearables/second_floor/E/cw_bitcoinglasses_eyewear.glb"),{position:new Vector3(273.8,18.5,141.7),rotation:Quaternion.Euler(0,145,0)},"Bitcoin Eyewear"),new R(new GLTFShape("models/wearables/second_floor/F/M_Feet_BearSlippers.glb"),{position:new Vector3(286.9,18,140.9),rotation:Quaternion.Euler(0,180,0)},"Bear Slippers",!0),new R(new GLTFShape("models/wearables/second_floor/F/M_Feet_ClassiShoes.glb"),{position:new Vector3(288.8,18,140.9),rotation:Quaternion.Euler(0,180,0)},"Classic Shoes",!0),new R(new GLTFShape("models/wearables/second_floor/F/F_Feet_Shoes_01.glb"),{position:new Vector3(290.4,18,140.9),rotation:Quaternion.Euler(0,180,0)},"Classic shoes",!0),new R(new GLTFShape("models/wearables/second_floor/G/dcl_mana_earring.glb"),{position:new Vector3(291.4,18.5,135.3),rotation:Quaternion.Euler(0,180,0)},"MANA Earrings"),new R(new GLTFShape("models/wearables/second_floor/G/F_Earrings_PunkPiercing.glb"),{position:new Vector3(293.26,18.5,135.3),rotation:Quaternion.Euler(0,180,0)},"Punk Earings",!0),new R(new GLTFShape("models/wearables/second_floor/G/F_Earrings_Skull.glb"),{position:new Vector3(294.8,18.5,135.5),rotation:Quaternion.Euler(0,180,0)},"Skull Earrings",!0);var v=new Entity;v.addComponent(new Transform({position:new Vector3(279.8,19.6,127.9)})),engine.addEntity(v);var A=new Entity;A.addComponent(new Transform({rotation:Quaternion.Euler(0,295,0)})),A.setParent(v),engine.addEntity(A),new R(new GLTFShape("models/wearables/second_floor/J/cw_tuxedo_tshirt_upper_body.glb"),{position:new Vector3(0,0,3.5),rotation:Quaternion.Euler(0,0,0)},"Tuxedo T Shirt").setParent(A);var M=new Entity;M.addComponent(new Transform({rotation:Quaternion.Euler(0,244,0)})),M.setParent(v),engine.addEntity(M),new R(new GLTFShape("models/wearables/second_floor/J/mana_hoodie_upper_body.glb"),{position:new Vector3(0,0,3.5),rotation:Quaternion.Euler(0,0,0)},"MANA Hoodie").setParent(M);var O=new Entity;O.addComponent(new Transform({rotation:Quaternion.Euler(0,193,0)})),O.setParent(v),engine.addEntity(O),new R(new GLTFShape("models/wearables/second_floor/J/m_cyber_suit_upper_body.glb"),{position:new Vector3(0,0,3.5),rotation:Quaternion.Euler(0,0,0)},"Cyber Suit").setParent(O);var V=new Entity;V.addComponent(new Transform({rotation:Quaternion.Euler(0,142,0)})),V.setParent(v),engine.addEntity(V),new R(new GLTFShape("models/wearables/second_floor/J/mch_fukuzawa_upper_body.glb"),{position:new Vector3(0,0,3.5),rotation:Quaternion.Euler(0,0,0)},"Fukuzawa T-Shirt").setParent(V);var z=new Entity;z.addComponent(new Transform({rotation:Quaternion.Euler(0,91,0)})),z.setParent(v),engine.addEntity(z),new R(new GLTFShape("models/wearables/second_floor/J/xmas_cyberpunk_upper_body.glb"),{position:new Vector3(0,0,3.5),rotation:Quaternion.Euler(0,0,0)},"Cyberpunk Jacket").setParent(z);var W=new Entity;W.addComponent(new Transform({rotation:Quaternion.Euler(0,40,0)})),W.setParent(v),engine.addEntity(W),new R(new GLTFShape("models/wearables/second_floor/J/f_cw_trendy_jacket_upper_body.glb"),{position:new Vector3(0,0,3.5),rotation:Quaternion.Euler(0,0,0)},"Trendy Sportwear Jacket").setParent(W);var H=new Entity;H.addComponent(new Transform({rotation:Quaternion.Euler(0,349,0)})),H.setParent(v),engine.addEntity(H),new R(new GLTFShape("models/wearables/second_floor/J/razor_blade_upper_body.glb"),{position:new Vector3(0,0,3.5),rotation:Quaternion.Euler(0,0,0)},"Razor Blade Jacket").setParent(H)}})),define("src/extensions/entityExtensions",["require","exports"],(function(v,A){function DivVectors(v,A){var E=new Vector3;return E.x=0!=A.x?v.x/A.x:0,E.y=0!=A.y?v.y/A.y:0,E.z=0!=A.z?v.z/A.z:0,E}Object.defineProperty(A,"__esModule",{value:!0}),Entity.prototype.getGlobalPosition=function(){var v=this.hasComponent(Transform)?this.getComponent(Transform).position.clone():Vector3.Zero(),A=this.getParent();if(null!=A){var E=A.hasComponent(Transform)?A.getComponent(Transform).rotation:Quaternion.Identity;return A.getGlobalPosition().add(v.rotate(E))}return v},Entity.prototype.setGlobalPosition=function(v){var A=this.getComponent(Transform);if(null!=A){var E=this.getParent();if(null!=E){var R=v.subtract(E.getGlobalPosition());A.position=DivVectors(R.rotate(Quaternion.Inverse(E.getGlobalRotation())),E.getGlobalScale())}else A.position=v}},Entity.prototype.getGlobalRotation=function(){var v=this.hasComponent(Transform)?this.getComponent(Transform).rotation.clone():Quaternion.Identity,A=this.getParent();return null!=A?A.getGlobalRotation().multiply(v):v},Entity.prototype.setGlobalRotation=function(v){var A=this.getComponent(Transform);if(null!=A){var E=this.getParent();A.rotation=null!=E?v.multiply(Quaternion.Inverse(E.getGlobalRotation())):v}},Entity.prototype.getGlobalScale=function(){var v=this.hasComponent(Transform)?this.getComponent(Transform).scale.clone():Vector3.One(),A=this.getParent();return null!=A?A.getGlobalScale().multiply(v):v},Entity.prototype.setGlobalScale=function(v){var A=this.getComponent(Transform);if(null!=A){var E=this.getParent();A.scale=null!=E?DivVectors(v,E.getGlobalScale()):v}},Entity.prototype.globalForward=function(){return Vector3.Forward().rotate(this.getGlobalRotation())},Entity.prototype.globalRight=function(){return Vector3.Right().rotate(this.getGlobalRotation())},Entity.prototype.globalUp=function(){return Vector3.Up().rotate(this.getGlobalRotation())}})),define("src/resources",["require","exports","@dcl/ecs-scene-utils"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.default={sounds:{robots:{alice:new AudioClip("sounds/alice.mp3"),bela:new AudioClip("sounds/bela.mp3"),betty:new AudioClip("sounds/betty.mp3"),bob:new AudioClip("sounds/bob.mp3"),charlie:new AudioClip("sounds/charlie.mp3"),marsha:new AudioClip("sounds/marsha.mp3"),ron:new AudioClip("sounds/ron.mp3")},ui:{navigationForward:new AudioClip("sounds/navigationForward.mp3"),navigationBackward:new AudioClip("sounds/navigationBackward.mp3")},piano:{whiteKeys:{c3:new AudioClip("sounds/piano/c3.mp3"),d3:new AudioClip("sounds/piano/d3.mp3"),e3:new AudioClip("sounds/piano/e3.mp3"),f3:new AudioClip("sounds/piano/f3.mp3"),g3:new AudioClip("sounds/piano/g3.mp3"),a3:new AudioClip("sounds/piano/a3.mp3"),b3:new AudioClip("sounds/piano/b3.mp3"),c4:new AudioClip("sounds/piano/c4.mp3"),d4:new AudioClip("sounds/piano/d4.mp3"),e4:new AudioClip("sounds/piano/e4.mp3"),f4:new AudioClip("sounds/piano/f4.mp3"),g4:new AudioClip("sounds/piano/g4.mp3"),a4:new AudioClip("sounds/piano/a4.mp3"),b4:new AudioClip("sounds/piano/b4.mp3"),c5:new AudioClip("sounds/piano/c5.mp3"),d5:new AudioClip("sounds/piano/d5.mp3"),e5:new AudioClip("sounds/piano/e5.mp3"),f5:new AudioClip("sounds/piano/f5.mp3"),g5:new AudioClip("sounds/piano/g5.mp3"),a5:new AudioClip("sounds/piano/a5.mp3"),b5:new AudioClip("sounds/piano/b5.mp3")},blackKeys:{cSharp3:new AudioClip("sounds/piano/cSharp3.mp3"),dSharp3:new AudioClip("sounds/piano/dSharp3.mp3"),fSharp3:new AudioClip("sounds/piano/fSharp3.mp3"),gSharp3:new AudioClip("sounds/piano/gSharp3.mp3"),aSharp3:new AudioClip("sounds/piano/aSharp3.mp3"),cSharp4:new AudioClip("sounds/piano/cSharp4.mp3"),dSharp4:new AudioClip("sounds/piano/dSharp4.mp3"),fSharp4:new AudioClip("sounds/piano/fSharp4.mp3"),gSharp4:new AudioClip("sounds/piano/gSharp4.mp3"),aSharp4:new AudioClip("sounds/piano/aSharp4.mp3"),cSharp5:new AudioClip("sounds/piano/cSharp5.mp3"),dSharp5:new AudioClip("sounds/piano/dSharp5.mp3"),fSharp5:new AudioClip("sounds/piano/fSharp5.mp3"),gSharp5:new AudioClip("sounds/piano/gSharp5.mp3"),aSharp5:new AudioClip("sounds/piano/aSharp5.mp3")}}},models:{standard:{pianoBase:new GLTFShape("models/piano/pianoBase.glb"),muralWall:new GLTFShape("models/mural/muralWall.glb")},robots:{alice:"models/robots/alice.glb",bela:"models/robots/bela.glb",betty:"models/robots/betty.glb",bob:"models/robots/bob.glb",charlie:"models/robots/charlie.glb",marsha:"models/robots/marsha.glb",ron:"models/robots/ron.glb",rings:new GLTFShape("models/robots/rings.glb")}},textures:{blank:new Texture("images/ui/blank.png"),buttonE:new Texture("images/ui/buttonE.png"),buttonF:new Texture("images/ui/buttonF.png"),leftClickIcon:new Texture("images/ui/leftClickIcon.png"),textPanel:new Texture("images/ui/textPanel.png"),nftPanel:new Texture("images/ui/nftPanel.png"),closeButton:new Texture("images/ui/closeButton.png"),placeholder:new Texture("images/ui/placeholder.png")},trigger:{triggerShape:new E.TriggerSphereShape(8,Vector3.Zero()),triggerWhitePianoKey:new E.TriggerBoxShape(new Vector3(.35,3.6,2),new Vector3(0,0,-1)),triggerBlackPianoKey:new E.TriggerBoxShape(new Vector3(.35,3.6,2),Vector3.Zero())}}})),define("src/modules/ui",["require","exports","src/modules/serverHandler","src/modules/wearables","src/resources","src/extensions/entityExtensions"],(function(v,A,E,R,M){function playOpenSound(){A.openDialogSound.hasComponent(AudioSource)||(A.openDialogSound.addComponent(new AudioSource(M.default.sounds.ui.navigationForward)),A.openDialogSound.setParent(Attachable.AVATAR)),A.openDialogSound.getComponent(AudioSource).playOnce()}function playCloseSound(){A.closeDialogSound.hasComponent(AudioSource)||(A.closeDialogSound.addComponent(A.closeDialogSound.addComponent(new AudioSource(M.default.sounds.ui.navigationBackward))),A.closeDialogSound.setParent(Attachable.AVATAR)),A.closeDialogSound.getComponent(AudioSource).playOnce()}function closeUI(){A.messagebg.visible=!1,K.visible=!1}function checkUIOpen(){return!(!A.messagebg.visible&&!K.visible)}function updateOpenUITime(){A.UIOpenTime=+Date.now()}Object.defineProperty(A,"__esModule",{value:!0}),A.UIDistanceSystem=A.setTeleportCountdown=A.showTeleportUI=A.openWearableUI=A.wearableNotForSale=A.wearableClassic=A.openLoadingUI=A.openMessageBoardConfirmation=A.openMessageBoardUI=A.messagebg=A.setUiOpener=A.updateOpenUITime=A.checkUIOpen=A.closeUI=A.playCloseSound=A.closeDialogSound=A.playOpenSound=A.openDialogSound=A.UIOpener=A.UIOpenTime=A.screenSpaceUI=void 0,A.screenSpaceUI=new UICanvas,A.screenSpaceUI.visible=!0,A.UIOpenTime=0,A.openDialogSound=new Entity,A.openDialogSound.addComponent(new Transform),engine.addEntity(A.openDialogSound),A.playOpenSound=playOpenSound,A.closeDialogSound=new Entity,A.closeDialogSound.addComponent(new Transform),engine.addEntity(A.closeDialogSound),A.playCloseSound=playCloseSound,A.closeUI=closeUI,A.checkUIOpen=checkUIOpen,A.updateOpenUITime=updateOpenUITime,A.setUiOpener=function(v){A.UIOpener=v};var O=new Font(Fonts.SanFrancisco),V=new Font(Fonts.SanFrancisco_Heavy),z=new Texture("images/inputText.png");function openMessageBoardConfirmation(v){updateOpenUITime(),A.messagebg.visible=!1,A.UIOpener=v,playOpenSound(),A.messagebg=new UIImage(A.screenSpaceUI,z),A.messagebg.name="mmbBackground",A.messagebg.width=848,A.messagebg.height=177,A.messagebg.hAlign="center",A.messagebg.vAlign="center",A.messagebg.sourceLeft=78,A.messagebg.sourceTop=323,A.messagebg.sourceWidth=848,A.messagebg.sourceHeight=177,A.messagebg.visible=!0}A.messagebg=new UIImage(A.screenSpaceUI,z),A.messagebg.visible=!1,A.openMessageBoardUI=function(v,R){updateOpenUITime(),A.messagebg.visible=!1,A.UIOpener=v,playOpenSound(),A.messagebg=new UIImage(A.screenSpaceUI,z),A.messagebg.name="mmbBackground",A.messagebg.width=998,A.messagebg.height=261,A.messagebg.hAlign="center",A.messagebg.vAlign="center",A.messagebg.sourceLeft=13,A.messagebg.sourceTop=0,A.messagebg.sourceWidth=998,A.messagebg.sourceHeight=261,A.messagebg.visible=!0;var M=new UIInputText(A.messagebg);M.name="mbMessage",M.width="677px",M.height="74",M.hAlign="center",M.vAlign="center",M.positionY=-35.5,M.fontSize=30,M.vTextAlign="center",M.hTextAlign="center",M.color=Color4.FromHexString("#53508F88"),M.placeholder="Write something",M.isPointerBlocker=!0,M.visible=!0,M.onTextSubmit=new OnTextSubmit((function(A){var M=A.text.substr(0,50);(0,E.setNewMessage)(R,M),openMessageBoardConfirmation(v)}))},A.openMessageBoardConfirmation=openMessageBoardConfirmation;var W=new Texture("images/wearablesModal.png"),H=new Texture("images/wearable-colors.png"),X=new Texture("images/clockIcon.png"),K=new UIImage(A.screenSpaceUI,W);K.visible=!1,A.openLoadingUI=function(){updateOpenUITime(),K.visible=!1,(K=new UIImage(A.screenSpaceUI,X)).visible=!0,K.sourceTop=0,K.sourceLeft=0,K.sourceHeight=58,K.sourceWidth=36,K.height=58,K.width=36,K.hAlign="center",K.vAlign="center"},A.wearableClassic=function(v){updateOpenUITime(),K.visible=!1,A.UIOpener=v,playOpenSound(),(K=new UIImage(A.screenSpaceUI,W)).name="wearablebackground",K.visible=!0,K.positionY=100,K.sourceTop=14,K.sourceLeft=16,K.sourceHeight=48,K.sourceWidth=301,K.height=48,K.width=301,K.hAlign="center",K.vAlign="center"},A.wearableNotForSale=function(v){updateOpenUITime(),K.visible=!1,A.UIOpener=v,playOpenSound(),(K=new UIImage(A.screenSpaceUI,W)).name="wearablebackground",K.visible=!0,K.positionY=100,K.sourceTop=75,K.sourceLeft=13,K.sourceHeight=54,K.sourceWidth=255,K.height=48,K.width=249,K.hAlign="center",K.vAlign="center"},A.openWearableUI=function(v,E){updateOpenUITime(),K.visible=!1,A.UIOpener=v,playOpenSound();var M=new Texture(E.image);(K=new UIImage(A.screenSpaceUI,W)).name="wearablebackground",K.visible=!0,K.positionY=-70,K.sourceTop=186,K.sourceLeft=6,K.sourceHeight=461,K.sourceWidth=385,K.height=461,K.width=385,K.hAlign="center",K.vAlign="center";var z=new UIImage(K,H);switch(z.name="wearableRarityColor",z.positionY=315.5,z.width=385,z.height=175,z.hAlign="center",z.vAlign="center",z.sourceWidth=385,z.sourceHeight=175,E.wearable.rarity){case"unique":z.sourceLeft=0,z.sourceTop=0;break;case"mythic":z.sourceLeft=0,z.sourceTop=175;break;case"legendary":z.sourceLeft=0,z.sourceTop=350;break;case"epic":z.sourceLeft=0,z.sourceTop=525;break;case"uncommon":z.sourceLeft=385,z.sourceTop=350;break;case"common":z.sourceLeft=385,z.sourceTop=175;break;case"rare":case"swanky":z.sourceLeft=385,z.sourceTop=525}var X=new UIImage(K,W);X.name="closeIcon",X.visible=!0,X.positionY=386.5,X.positionX=177,X.sourceTop=4,X.sourceLeft=328,X.sourceHeight=24,X.sourceWidth=24,X.height=24,X.width=24,X.hAlign="center",X.vAlign="center",X.onClick=new OnClick((function(){playCloseSound(),closeUI()}));var Z=new UIImage(K,M);Z.name="wearableThumbnail",Z.width=256,Z.height=256,Z.hAlign="center",Z.vAlign="center",Z.positionY=230.5,Z.sourceLeft=0,Z.sourceTop=0,Z.sourceWidth=256,Z.sourceHeight=256;var J=new UIText(K);J.name="wearableName",J.value=E.name,J.hTextAlign="center",J.vAlign="center",J.hAlign="center",J.fontSize=16,J.positionY=351.5,J.color=Color4.White(),J.font=V;var $=new UIText(K);$.name="wearableRarity",$.hTextAlign="center",$.value=E.wearable.rarity.toLocaleUpperCase(),$.vAlign="center",$.hAlign="center",$.fontSize=16,$.positionY=372.5,$.color=Color4.FromHexString("#FFFFFF88"),$.font=V;var ee=E.wearable.description;ee.length>45&&(ee=ee.slice(0,45)+ee.replace(/(.{45})/g,"\n"));var ne=new UIText(K);ne.name="wearableDesc",ne.value=ee,ne.vAlign="center",ne.hAlign="center",ne.fontSize=15,ne.positionY=-44.5,ne.positionX=-158.5,ne.width=10,ne.hTextAlign="left",ne.color=Color4.Black(),ne.font=O;var oe=E.owner.address.slice(0,5)+"..."+E.owner.address.slice(E.owner.address.length-4),ie=new UIText(K);ie.name="wearableOwner",ie.value=oe,ie.vAlign="center",ie.hAlign="center",ie.fontSize=15,ie.positionY=116.5,ie.positionX=-158.5,ie.width=10,ie.hTextAlign="left",ie.color=Color4.Black(),ie.font=O;var ae=new UIText(K);ae.name="wearableCollection",ae.value=E.wearable.collection,ae.vAlign="center",ae.hAlign="center",ae.fontSize=15,ae.positionY=50.5,ae.positionX=-158.5,ae.width=10,ae.hTextAlign="left",ae.color=Color4.Black(),ae.font=O;var se,le=new UIText(K);le.name="wearableCategory",le.value=E.wearable.category,le.vAlign="center",le.hAlign="center",le.fontSize=15,le.positionY=50.5,le.positionX=17.5,le.width=10,le.color=Color4.Black(),le.font=O,se=2===E.wearable.bodyShapes.length?"Unisex":"BaseMale"===E.wearable.bodyShapes[0]?"Male":"Female";var ce=new UIText(K);ce.name="wearableGender",ce.value=se,ce.vAlign="center",ce.hAlign="center",ce.fontSize=15,ce.positionY=25.5,ce.positionX=17.5,ce.width=10,ce.color=Color4.Black(),ce.font=O;var ue,de=(4,ue=E.searchOrderPrice/1e18*Math.pow(10,4),Math.round(ue)/Math.pow(10,4)),he=new UIImage(K,W);he.name="wButton",he.hAlign="center",he.vAlign="center",he.width=322,he.height=44,he.positionY=-175.5,he.sourceLeft=6,he.sourceTop=138,he.sourceWidth=322,he.sourceHeight=44,he.onClick=new OnClick((function(){var v=(0,R.getWearableURL)(E);openExternalURL(v),closeUI()}));var me=new UIText(K);me.name="wearablePrice",me.value=String(de),me.vAlign="center",me.hAlign="center",me.fontSize=15,me.positionY=-158.5,me.positionX=23.5,me.width=10,me.hTextAlign="left",me.color=Color4.White(),me.font=O};var Z=new Texture("images/ui_beam_up_bg.png"),J=new UIContainerRect(A.screenSpaceUI);J.width="40%",J.vAlign="top",J.height="20%",J.isPointerBlocker=!1;var $=new UIImage(J,Z);$.sourceLeft=0,$.sourceTop=0,$.sourceWidth=512,$.sourceHeight=256,$.width="256px",$.height="128px";var ee=new UIText(J);ee.value="3",ee.fontSize=32,ee.color=Color4.Black(),ee.font=new Font(Fonts.SanFrancisco_Heavy),ee.hAlign="center",ee.hTextAlign="center",ee.vAlign="bottom",ee.vTextAlign="bottom",ee.positionY=16,ee.isPointerBlocker=!1,A.showTeleportUI=function(v){J.visible=v},A.setTeleportCountdown=function(v){ee.value=v},Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,!1,(function(v){var E=+Date.now();checkUIOpen()&&E-A.UIOpenTime>100&&(closeUI(),playCloseSound())}));var ne=function(){function UIDistanceSystem(){}return UIDistanceSystem.prototype.update=function(){var v,E,R,M;checkUIOpen()&&(v=Camera.instance.position,E=A.UIOpener.getGlobalPosition(),(R=v.x-E.x)*R+(M=v.z-E.z)*M>64&&(closeUI(),playCloseSound()))},UIDistanceSystem}();A.UIDistanceSystem=ne})),define("src/modules/messageboard",["require","exports","src/modules/ui","src/modules/serverHandler","@dcl/ecs-scene-utils"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.startMessageBoards=A.serverChecker=A.setTowerText=A.ArtichokeFloatingTextShape=A.MessageBoards=void 0;var O,V=new Font(Fonts.SanFrancisco_Heavy);!function(v){v.ARTICHOKE="artichoke",v.TOWER="tower"}(O=A.MessageBoards||(A.MessageBoards={})),A.ArtichokeFloatingTextShape=new TextShape("Write something");var z=[];A.setTowerText=function(v){if(!(z.length<1))for(var A=0;A<=39;A++){var E=z[A].getComponent(TextShape);A<v.length?E.value=v[A]:E.value=""}},A.serverChecker=new R.CheckServer(30),A.startMessageBoards=function(){var v=new Entity;v.addComponent(new GLTFShape("models/artichoke_message.glb")),v.addComponent(new Transform({position:new Vector3(42,8.4,43),scale:new Vector3(1,1,1)})),v.addComponent(new OnPointerDown((function(A){(0,E.openMessageBoardUI)(v,O.ARTICHOKE)}),{button:ActionButton.PRIMARY,hoverText:"Write something"})),engine.addEntity(v);var W=new Entity;W.addComponent(new GLTFShape("models/message_booth.glb")),W.addComponent(new Transform({position:new Vector3(43.8,37.4,122.4),scale:new Vector3(1,1,1)})),W.addComponent(new OnPointerDown((function(v){(0,E.openMessageBoardUI)(W,O.TOWER)}),{button:ActionButton.PRIMARY,hoverText:"Write something"})),engine.addEntity(W);var H=new Entity;H.addComponent(new Transform({position:new Vector3(48.6,21,116.6),scale:new Vector3(1,1,1),rotation:Quaternion.Euler(0,0,0)})),engine.addEntity(H);for(var X=0;X<40;X++){var K=360-360*X/40,Z=K*(Math.PI/180),J=new Entity;J.setParent(H),J.addComponent(new TextShape("")),J.getComponent(TextShape).fontSize=22,J.getComponent(TextShape).color=Color3.White(),J.getComponent(TextShape).font=V,J.addComponent(new Transform({position:new Vector3(9*Math.sin(Z),0,9*Math.cos(Z)),rotation:Quaternion.Euler(0,K-180,0)})),engine.addEntity(J),z.push(J)}var $=new Entity;$.addComponent(new GLTFShape("models/screen-moon.glb")),$.setParent(H),engine.addEntity($);var ee=new Entity;A.ArtichokeFloatingTextShape.color=Color3.FromHexString("#8040E2"),A.ArtichokeFloatingTextShape.font=V,ee.addComponent(A.ArtichokeFloatingTextShape),ee.addComponent(new Transform({position:new Vector3(51,15.5,31.7),scale:new Vector3(1,1,1),rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ee),ee.getComponent(Transform).rotate(new Vector3(1,0,0),-15);var ne=function(){function SpinTextSystem(){}return SpinTextSystem.prototype.update=function(v){H.getComponent(Transform).rotate(Vector3.Up(),10*v)},SpinTextSystem}();R.sceneMessageBus.on("towerMessage",(function(v){M.setTimeout(500,(function(){(0,R.updateMessageBoards)()}))})),R.sceneMessageBus.on("artichokeMessage",(function(v){M.setTimeout(500,(function(){(0,R.updateMessageBoards)()}))})),engine.addSystem(new ne),engine.addSystem(A.serverChecker)}})),define("src/modules/tutorialHandler",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.tutorialEnableObservable=void 0,A.tutorialEnableObservable=new Observable,"undefined"!=typeof dcl&&(dcl.subscribe("externalAction"),dcl.onEvent((function(v){"externalAction"===v.type&&function(v){__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(E){return"tutorial"===v.type&&("begin"===v.payload?A.tutorialEnableObservable.notifyObservers(!0):"end"===v.payload&&A.tutorialEnableObservable.notifyObservers(!1)),[2]}))}))}(v.data)})))})),define("src/modules/npcDialogData",["require","exports","src/modules/npcRobotBuilder"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.BobDialog=A.MarshaDialog=A.CharlieDialog=A.BettyDialog=A.BelaDialog=A.RonDialog=A.AliceDialog=void 0,A.AliceDialog=[{text:"Hi, I'm Alice - welcome to Genesis Plaza! Would you like to learn more about this place?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"yes",fontSize:14},{label:"NO",goToDialog:"no",fontSize:14}]},{name:"no",text:"Okay, I'll be around if you get curious!",offsetY:18,triggeredByNext:function(){E.alice.playAnimation("Goodbye",!0,2),E.alice.endInteraction()},isEndOfDialog:!0},{name:"yes",text:"We’re currently in the center of the Genesis City map, the roads fan out in all directions from here.",offsetY:18},{text:"Genesis Plaza is a community-owned space that's open to everyone",offsetY:6},{text:"If you venture out into the world, you’ll see that the content is created by our growing community.",offsetY:6},{text:"Do you want to explore the rest of Genesis Plaza or explore the rest of the world?",offsetY:24,isQuestion:!0,buttons:[{label:"PLAZA",goToDialog:"plaza",fontSize:11,offsetY:-17.5},{label:"WORLD",goToDialog:"world",fontSize:11,offsetY:-17.5}]},{name:"plaza",text:"Great! There’s a lot to see right here.",offsetY:18},{text:"If you walk around you might run into my buddies and each is an expert on a different topic.",offsetY:18},{text:"You can learn a lot from them about how Decentraland works and what makes it special.",offsetY:18},{text:"I recommend you start at that boat-shaped building to the North!",offsetY:18},{text:"Do you also want to learn about what's beyond Genesis Plaza?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"world-end"},{label:"NO",goToDialog:"end"}]},{name:"world-end",text:"There’s a big world to explore out there!",offsetY:18},{text:"Around Genesis Plaza you'll find several teleports that can take you directly to special scenes marked as points of interest.",offsetY:6},{text:"There's also the 'crowd' teleport, which takes you to the biggest gathering of people in Decentraland so you can meet up and hang out.",offsetY:6},{text:"If you press the 'M' key, you’ll open the map. You'll see markers for points of interest that are worth visiting.",offsetY:6},{text:"Or simply explore the virtual world by foot and plot your own adventure. Just keep in mind that there's a LOT of ground to cover.",offsetY:6},{text:"So what are you waiting for? Go and explore the world!",offsetY:18,triggeredByNext:function(){E.alice.playAnimation("Goodbye",!0,2),E.alice.endInteraction()},isEndOfDialog:!0},{name:"world",text:"There’s a big world to explore out there!",offsetY:18},{text:"Around Genesis Plaza you'll find several teleports that can take you directly to special scenes marked as points of interest.",offsetY:6},{text:"There's also the 'crowd' teleport, which takes you to the biggest gathering of people in Decentraland so you can meet up and hang out.",offsetY:6},{text:"If you press the 'M' key, you’ll open the map. You'll see markers for points of interest that are worth visiting.",offsetY:6},{text:"Or simply explore the virtual world by foot and plot your own adventure. Just keep in mind that there's a LOT of ground to cover.",offsetY:6},{text:"Do you also want to find out what's here in Genesis Plaza?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"plaza-end"},{label:"NO",goToDialog:"end"}]},{name:"plaza-end",text:"Great! There’s a lot to see right here.",offsetY:18},{text:"If you walk around you might run into my buddies and each is an expert on a different topic.",offsetY:18},{text:"You can learn a lot from them about how Decentraland works and what makes it special.",offsetY:18},{text:"I recommend you start at that boat-shaped building to the North!",offsetY:18},{name:"end",text:"Well that's it from me. So what are you waiting for? Go and explore the world!",offsetY:18,triggeredByNext:function(){E.alice.playAnimation("Goodbye",!0,2),E.alice.endInteraction()},isEndOfDialog:!0}],A.RonDialog=[{text:"Hi! I'm Ron – a crafter of wearable items. Would you like to learn more about wearables?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"yes"},{label:"NO",goToDialog:"no"}]},{name:"no",text:"Okay, I'll be around if you get curious.",offsetY:18,triggeredByNext:function(){E.ron.playAnimation("Goodbye",!0,2),E.ron.endInteraction()},isEndOfDialog:!0},{name:"yes",text:"As you've probably already found out - you can customize your avatar and choose what items to wear.",offsetY:6},{text:"You may have also noticed that other players have fancy outfits that you can’t find in your item menu.",offsetY:6},{text:"That’s because certain wearables must be bought or earned.",offsetY:18},{text:"Do you want to know how wearables relate to the blockchain?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"blockchain"},{label:"NO",goToDialog:"no-chain"}]},{name:"blockchain",text:"Wearables are traded on the blockchain as non-fungible tokens (NFTs). This makes each item unique, with a traceable and unique history.",offsetY:6},{name:"no-chain",text:"If you go north to the boat-shaped building, I have a friend there who knows a lot about this stuff.",offsetY:6},{text:"Except for the default set of wearables you get when you start out, each wearable model has a limited supply.",offsetY:6},{text:"Some wearables are more rare than others.",offsetY:18},{text:"You can buy and sell wearables in the Decentraland Marketplace. To learn more about this topic, head to the Trade Center building.",offsetY:6},{text:"Before you go though, there are several wearables on display here. Take a look around!",offsetY:18},{text:"The wearables here are linked to the Marketplace so if you see anything you like, you can buy it from the community member who owns it.",offsetY:6},{text:"I hope you found this information useful and have fun expressing yourself with your new wearables!",offsetY:6,isEndOfDialog:!0},{text:"These wearables are from the Cyberchristmas 2019 collection. Real flashy huh?",offsetY:18,triggeredByNext:function(){E.ron.playAnimation("Goodbye",!0,2),E.ron.endInteraction()},isEndOfDialog:!0},{text:"These wearables are from the Halloween 2019 collection. Pretty creepy looking huh?",offsetY:18,triggeredByNext:function(){E.ron.playAnimation("Goodbye",!0,2),E.ron.endInteraction()},isEndOfDialog:!0}],A.BelaDialog=[{text:"Hello, I'm Bela - would you like to learn more about how the community shapes Decentraland?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"yes"},{label:"NO",goToDialog:"no"}]},{name:"no",text:"Okay, I'll be around if you get curious.",offsetY:18,triggeredByNext:function(){E.bela.playAnimation("Goodbye",!0,2),E.bela.endInteraction()},isEndOfDialog:!0},{name:"yes",text:"Decentraland is designed to be run 100% by the community.",offsetY:18},{text:"There's already been several petitions that have been voted on. Anyone with MANA or LAND can vote and determine the future of Decentraland.",offsetY:6},{text:"For example, the community decided through a vote that each land parcel should measure 16x16 meters instead of the original 10x10 meters.",offsetY:6},{text:"There will gradually be more and more ways in which you can pitch in to help shape the direction of the virtual world.",offsetY:6},{text:"You've joined us at a really exciting time, when we can own and shape the virtual spaces where we hang out.",offsetY:6},{text:"I hope you found this information interesting!",offsetY:18,triggeredByNext:function(){E.bela.playAnimation("Goodbye",!0,2),E.bela.endInteraction()},isEndOfDialog:!0}],A.BettyDialog=[{text:"Hi, I'm Betty - a content creator! Would you like to learn about how content in Decentraland is made?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"yes"},{label:"NO",goToDialog:"no"}]},{name:"no",text:"Okay, I'll be around if you get curious.",offsetY:18,triggeredByNext:function(){E.betty.playAnimation("Goodbye",!0,2),E.betty.endInteraction()},isEndOfDialog:!0},{name:"yes",text:"Decentraland is made up of scenes and each scene is its own self-contained world that sits next to other scenes.",offsetY:6},{text:"A scene can take up a single LAND parcel or as many parcels as you want. Each LAND parcel measures 16x16 meters.",offsetY:6},{text:"With the exception of public spaces like plazas and roads, everything you see is created by members of the community like yourself.",offsetY:6},{text:"There are two different tools that can be used to build. First there's The Builder - an easy drag and drop tool.",offsetY:6},{text:"Then there's the SDK (Software Development Kit), which is a more powerful coding tool for developers.",offsetY:6},{text:"Which one do you want to learn about first?",offsetY:24,isQuestion:!0,buttons:[{label:"BUILDER",fontSize:10,goToDialog:"builder"},{label:"SDK",goToDialog:"sdk"}]},{name:"builder",text:"The Builder is a lot of fun! You can drag and drop pre-made 3D items of a variety of themes into your scene.",offsetY:6},{text:"Some items come with built-in behaviors. You can use these as building-blocks to make up a whole game.",offsetY:6},{text:"If you’re a 3D artist, or want to import 3D content, you have the ability to import your own.",offsetY:18},{text:"Do you want to also learn about the SDK (Software Development Kit)?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"sdk-end"},{label:"NO",goToDialog:"end"}]},{name:"sdk-end",text:"The SDK is a very powerful tool that gives you a lot of freedom by writing your scenes in code.",offsetY:18},{text:"It is based on TypeScript, a language that’s very similar to JavaScript but more reliable.",offsetY:18},{text:"There are several great examples out in the world of scenes written with the SDK.",offsetY:18},{text:"Many of the teleports around this plaza take you to such scenes.",offsetY:18},{text:"You can also use the SDK to create your own smart items with built-in logic.",offsetY:18},{text:"These can then be easily used in the Builder by dragging and dropping them.",offsetY:18},{text:"You can also start a scene using the Builder. Lay out the parts before exporting them to add specific functionality with code, using the SDK.",offsetY:6},{text:"Remember you can always visit docs.decentraland.org for a more in-depth guide on building scenes",offsetY:6},{text:"Hope that gets you excited about creating and sharing great things. Can't wait to see what you come up with!",offsetY:6,triggeredByNext:function(){E.betty.playAnimation("Goodbye",!0,2),E.betty.endInteraction()},isEndOfDialog:!0},{name:"sdk",text:"The SDK is a very powerful tool that gives you a lot of freedom by writing your scenes in code.",offsetY:18},{text:"It is based on TypeScript, a language that’s very similar to JavaScript but more reliable.",offsetY:18},{text:"There are several great examples out in the world of scenes written with the SDK.",offsetY:18},{text:"Many of the teleports around this plaza take you to such scenes.",offsetY:18},{text:"You can also use the SDK to create your own smart items with built-in logic.",offsetY:18},{text:"These can then be easily used in the Builder by dragging and dropping them.",offsetY:18},{text:"You can also start a scene using the Builder. Lay out the parts before exporting them to add specific functionality with code, using the SDK.",offsetY:6},{text:"Do you also want to learn about the Builder, our visual editor tool?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"builder-end"},{label:"NO",goToDialog:"end"}]},{name:"builder-end",text:"The Builder is a lot of fun! You can drag and drop pre-made 3D items of a variety of themes into your scene.",offsetY:6},{text:"Some items come with built-in behaviors. You can use these as building-blocks to make up a whole game.",offsetY:6},{text:"If you’re a 3D artist, or want to import 3D content, you have the ability to import your own.",offsetY:18},{text:"Remember you can always visit docs.decentraland.org for a more in-depth guide on building scenes",offsetY:6},{name:"end",text:"Hope that gets you excited about creating and sharing great things. Can't wait to see what you come up with!",offsetY:6,triggeredByNext:function(){E.betty.playAnimation("Goodbye",!0,2),E.betty.endInteraction()},isEndOfDialog:!0},{text:"This is what a basic Builder scene looks like. There are tons of prefab items you can just drag and drop to create an experience of your own.",offsetY:6,isEndOfDialog:!0},{text:"This is what a Builder scene looks like with some smart items in it.",offsetY:18},{text:"Smart items can be dragged in just as easily as other items, but can make things so much more interesting!",offsetY:6,triggeredByNext:function(){E.betty.playAnimation("Goodbye",!0,2),E.betty.endInteraction()},isEndOfDialog:!0}],A.CharlieDialog=[{text:"Hey, I'm Charlie - a master trader. Would you like to learn more about the Decentraland Marketplace?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"yes"},{label:"NO",goToDialog:"no"}]},{name:"no",text:"Okay, I'll be around if you get curious.",offsetY:18,triggeredByNext:function(){E.charlie.playAnimation("Goodbye",!0,2),E.charlie.endInteraction()},isEndOfDialog:!0},{name:"yes",text:"This is the Metaverse Trade Center. Here you can see live stats from the Decentraland Marketplace.",offsetY:6},{text:"There’s a thriving economy behind Decentraland and every day people buy and sell unique items.",offsetY:18},{text:"Items like LAND parcels, wearable items and reserved names.",offsetY:18},{text:"As more trading happens on the platform, it grows and moves faster.",offsetY:18},{text:"You can explore this building to find real-time stats about what goes on in the Marketplace.",offsetY:18},{text:"Do you want to know more about how the Marketplace uses the blockchain?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"blockchain"},{label:"NO",goToDialog:"no-blockchain"}]},{name:"blockchain",text:"All sales, bids and other operations are transactions on the blockchain.",offsetY:18},{text:"Like all transactions, they require a small gas fee that is paid to the network of miners.",offsetY:18},{text:"The Marketplace charges a small fee over all transactions. This fee doesn't go into anyone's pocket. Instead it gets burned.",offsetY:6},{name:"no-blockchain",text:"Remember to visit market.decentraland.org - over there you can buy or sell LAND, wearables or unique names. Happy shopping!",offsetY:6,triggeredByNext:function(){E.charlie.playAnimation("Goodbye",!0,2),E.charlie.endInteraction()},isEndOfDialog:!0},{text:"All of Decentraland is made up of parcels of LAND. Each parcel is 16x16 meters (~17.5 yards)",offsetY:18},{text:"Some parcels of LAND are plazas or bits of road, those are owned by the Decentraland DAO.",offsetY:18},{text:"Together they make up all the public spaces of Decentraland and therefore cannot be traded on the market.",offsetY:6},{text:"People buy and sell LAND in the Marketplace.",offsetY:18,triggeredByNext:function(){E.charlie.playAnimation("Goodbye",!0,2),E.charlie.endInteraction()},isEndOfDialog:!0},{text:"If you have several adjacent parcels of LAND, you can form an Estate to group these together and trade them as a single token.",offsetY:6,triggeredByNext:function(){E.charlie.playAnimation("Goodbye",!0,2),E.charlie.endInteraction()},isEndOfDialog:!0},{text:"Not all wearables are created equal. We have a few categories available to help distinguish their rarity.",offsetY:6},{text:"If a wearable is 'Epic' then there are a maximum of 1000 of its kind in circulation.",offsetY:18},{text:"If a wearable is 'Legendary' then there are only 100 of its kind.",offsetY:18},{text:"If a wearable is 'Mythic' then there are just 10. If it is 'Unique' then...well you get the picture.",offsetY:18},{text:"'Rare', 'Common' and 'Uncommon' rarities are relatively abundant.",offsetY:18,triggeredByNext:function(){E.charlie.playAnimation("Goodbye",!0,2),E.charlie.endInteraction()},isEndOfDialog:!0}],A.MarshaDialog=[{text:"Hey there! My name is Marsha and I’m here to have fun! Would you like to learn more about how to interact with other players?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"yes"},{label:"NO",goToDialog:"no"}]},{name:"no",text:"Okay, I'll be around if you get curious.",offsetY:18,triggeredByNext:function(){E.marsha.playAnimation("Goodbye",!0,2),E.marsha.endInteraction()},isEndOfDialog:!0},{name:"yes",text:"You can perform emotes, like dances, hand waves, etc. Other players will see you when you do them.",offsetY:6},{text:"To do so, just press the 'B' key to open up the menu before clicking on one of the emote icons.",offsetY:18},{text:"When you write into the chat box, what you send can be read by all players nearby.",offsetY:18},{text:"If you click on a player you can read their bio, see what wearables they own etc.",offsetY:18},{text:"If at any point you find someone that acts abusively, you can block them so that they can no longer bother you.",offsetY:6},{text:'To do so, simply click on them to open the menu, and select "block player".',offsetY:18},{text:"If you can't find anyone around, there's a 'crowd' teleport just north of the main building that takes you to wherever there's a group of people.",offsetY:6},{text:'You can also type "/goto crowd" into the chat window to take you there, no matter where you are.',offsetY:6},{text:"Well that's it from me, don't want to keep you here any longer. There are folks out there who are a lot more interesting to talk to. Enjoy!",offsetY:6,triggeredByNext:function(){E.marsha.playAnimation("Goodbye",!0,2),E.marsha.endInteraction()},isEndOfDialog:!0}],A.BobDialog=[{text:"G'day human! My name is Bob and I'm a robot. Would you like to learn more about the history of Decentraland and how it all started?",offsetY:24,isQuestion:!0,buttons:[{label:"YES",goToDialog:"yes"},{label:"NO",goToDialog:"no"}]},{name:"no",text:"Okay, I'll be around if you get curious.",offsetY:18,triggeredByNext:function(){E.bob.playAnimation("Goodbye",!0,2),E.bob.endInteraction()},isEndOfDialog:!0},{name:"yes",text:"Decentraland's unique proposal is to create a virtual world governed by its users.",offsetY:18},{text:"This little museum takes you through some of the milestones in Decentraland's history.",offsetY:18},{text:"Some key events in the history of the project were: the Terraform Event, which had the first LAND auction.",offsetY:6},{text:"In late 2018 a second auction was held. This was followed by the creation of Avatars and Wearables in 2019.",offsetY:6},{text:"And in 2020, the open source client and the DAO were released. So much has happened already, and we're just getting started...",offsetY:6},{text:"Take a look around. If you're interested in any of the items, click on them and I'll tell you the background story.",offsetY:6,triggeredByNext:function(){E.bob.playAnimation("Goodbye",!0,2),E.bob.endInteraction()},isEndOfDialog:!0},{text:"A DAO is a Decentralized Autonomous Organization - the embodiment of decentralization.",offsetY:6},{text:"An entity that carries out its functions following pre-established rules that no person can alter. To put it another way, it's governance as code.",offsetY:6},{text:"Through a DAO, we can guarantee that what the community votes for is truly what gets done, and that nobody can stop that.",offsetY:6,isEndOfDialog:!0},{text:"Decentraland really took shape in 2017 amongst an exciting wave of enthusiasm around blockchain technologies.",offsetY:6},{text:"The transparency and fairness that smart contracts might bring has the potential to transform the way we interact with the world.",offsetY:6,isEndOfDialog:!0},{text:"The first few versions of Decentraland were not actually Ethereum-based!",offsetY:18},{text:"It actually started as a fork of Bitcoin back in 2015 before Ethereum was even launched.",offsetY:18},{text:"This map was the first little experiment with tokenized land as 2D pixels, each one is minted by miners.",offsetY:6,triggeredByNext:function(){E.bob.playAnimation("Goodbye",!0,2),E.bob.endInteraction()},isEndOfDialog:!0},{text:"The first 3D versions were based on hexagon-shaped land. Though quite limited, it was an exciting experiment already.",offsetY:6,isEndOfDialog:!0},{text:"A sign on this early 3D version spelled out a brave declaration of what we were setting off to build!",offsetY:6,isEndOfDialog:!0},{text:"Our first logo was quite nice and unique - makes me feel nostalgic just looking at it...",offsetY:18,isEndOfDialog:!0},{text:"Slowly things started to get more concrete. These guys were the first fun lively avatars we had. Don't they look happy?",offsetY:6,isEndOfDialog:!0},{text:"This guy was around in the early days. All he could do was float and move his head around - well if you ask me, that's plenty already.",offsetY:6,isEndOfDialog:!0},{text:"Then came the fox and the robots. This dude looks so cool, doesn't he?",offsetY:18},{text:"At the time, they were designed for VR so the hands and head were meant to match VR controllers.",offsetY:6,isEndOfDialog:!0},{text:"Floating made it simpler, as we didn't have to think about legs or walking animations - oh and I know all about that...",offsetY:6,isEndOfDialog:!0},{text:"Look at this classy little fellow, now here's someone I can relate to! Well at least for me that is, you know?",offsetY:6,isEndOfDialog:!0},{text:"And that brings us to the latest in human-shaped avatars! Like the one you're sporting now.",offsetY:18,isEndOfDialog:!0},{text:"Fully animated, super customizeable, charismatic, and fun. A huge leap forward!",offsetY:18},{text:"Even though... you know, *cough* robots are *cough* the future. *cough* Sorry did you say something?",offsetY:6,isEndOfDialog:!0},{text:"And then came the LAND auctions! The definitive map of Genesis City was laid out before each parcel was minted.",offsetY:6},{text:"That marked the start of a virtual real-estate market that continues to flourish to this day.",offsetY:18,isEndOfDialog:!0},{text:"Not all land was sold on the first auction, 9,300 parcels remained unclaimed.",offsetY:18},{text:"So in December 2018 came the second auction, where the community claimed the remaining ones.",offsetY:6,isEndOfDialog:!0},{text:"Decentraland needed a more modern look and with it a new logo. The design needed to look great even when viewed at a smaller scale.",offsetY:6},{text:"So in early 2019 this beauty was created... looking sleek right?",offsetY:18,isEndOfDialog:!0},{text:"At the time, the world was still in closed beta, so something attractive was needed for those that could not yet enter.",offsetY:6},{text:"A pretty slick landing site with a beautiful 3D intro was launched that made the promise of a 3D world more real.",offsetY:6},{text:"Come to think of it... this plaza we're on resembles that vision quite a lot - how cool is that?",offsetY:6,isEndOfDialog:!0},{text:"With 90,000 parcels of LAND to fill, creating content needs to be fun and easy to enable mass adoption.",offsetY:6},{text:"So, on April 2018, the Builder was launched. A visual tool designed to make content creation simple.",offsetY:6},{text:"Head on over to builder.decentraland.org to get building right away! ",offsetY:18,isEndOfDialog:!0},{text:"Another important milestone was creating player passports, which linked a player's identity to an ethereum wallet.",offsetY:6,isEndOfDialog:!0},{text:"With the addition of tokenized wearables, players were now able to customize their avatars a lot further.",offsetY:6},{text:"Beyond the collection of basic wearables, special ones became available that were more elaborate in design and also much rarer.",offsetY:6},{text:"A few of these were given out during the Halloween event and also in the Christmas event, as well as the official launch event.",offsetY:6,isEndOfDialog:!0},{text:"All of Decentraland is made up of parcels of LAND. Each parcel is 16x16meters (~17.5 yards)",offsetY:18},{text:"Most parcels are privately owned and the owner of the LAND can do anything they want with it. Create a game, a virtual store, anything they like.",offsetY:6},{text:"LAND parcels start empty until the owner or someone with permission from the owner uploads content onto it.",offsetY:6,isEndOfDialog:!0},{text:"With several adjacent parcels of LAND, you can form an Estate to group these together and trade them as a single token.",offsetY:6,isEndOfDialog:!0},{text:"Roads guarantee easy movement through the world even if people build towering structures in their privately-owned land.",offsetY:6,isEndOfDialog:!0},{text:"There are several plazas in Decentraland like the one we're in. Plazas are open to everyone and are owned by the Decentraland DAO.",offsetY:6},{text:"Each plaza has its own special theme so get out there and explore them!",offsetY:18,isEndOfDialog:!0},{text:"Districts are special privately-owned parcels of LAND. They appear as violet colored boxes on the map.",offsetY:6},{text:"Districts are owned by groups of people, who during the early days got together around a common theme and proposal.",offsetY:6},{text:"Many districts are thriving communities with a specific goal.",offsetY:18,isEndOfDialog:!0},{text:"The museum district is a great example of a District. This one focuses on providing artists a place to display their work.",offsetY:6},{text:"Amongst the other districts, you can find a university, a convention center, a vegas-themed area, a virtual shopping mall...",offsetY:6},{text:".. an amusement park, a place for music festivals, a gamer's battleground and so much more!",offsetY:6,isEndOfDialog:!0},{text:"With the launch of the Builder back in April 2019, there was a contest for creating the best scenes using just the Builder.",offsetY:6},{text:"Even with the limitations of that first version, the community blew everyone away with their creativity!",offsetY:6,isEndOfDialog:!0},{text:"With the release of Smart items in December 2019 came another creator contest using the Builder.",offsetY:6},{text:"This time, people could add items that were interactive, enabling all sorts of fun game mechanics.",offsetY:6},{text:"Again, it was amazing to see what can be created with a library of simple building blocks.",offsetY:18,isEndOfDialog:!0},{text:"MANA is a virtual currency that can be used to perform in-world transactions.",offsetY:18},{text:"Also, it can be used to trade LAND, wearables and unique names in the marketplace.",offsetY:18},{text:"Furthermore, MANA tokens give you also voting powers on the DAO...",offsetY:18},{text:"the decision making smart contract that governs many of the policy aspects of Decentraland.",offsetY:18,isEndOfDialog:!0},{text:"Many great scenes were created by developers writing code. A few Game Jams took place with amazing results.",offsetY:6,isEndOfDialog:!0},{text:"A huge number of really high-quality scenes were submitted at these competitions and there are many out there now.",offsetY:6},{text:"Some of which you can visit via one of the teleporters located on this plaza!",offsetY:18,isEndOfDialog:!0},{text:"At the start of 2020, the community held a contest to come up with designs for wearables.",offsetY:18},{text:"These were then crafted following specifications set out by the contestants.\t",offsetY:18},{text:"Some really fun and imaginative ideas came out from that. You can see some of those wearables circling around in the marketplace.",offsetY:6,isEndOfDialog:!0}]})),define("src/modules/npcRobotBuilder",["require","exports","src/resources","@dcl/npc-scene-utils","src/modules/npcDialogData"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.addRobots=A.bob=A.marsha=A.charlie=A.betty=A.bela=A.ron=A.alice=void 0,A.addRobots=function(){var v=E.default.models.robots.rings;A.ron=new R.NPC({position:new Vector3(297,11.365,123),rotation:Quaternion.Euler(0,-110,0)},E.default.models.robots.ron,(function(){A.ron.playAnimation("Hello",!0,2);var v=new Entity;v.addComponent(new R.NPCDelay(2,(function(){A.ron.playAnimation("Talk")}))),engine.addEntity(v),A.ron.addComponentOrReplace(new AudioSource(E.default.sounds.robots.alice)),A.ron.getComponent(AudioSource).playOnce(),A.ron.talk(M.RonDialog)}),{faceUser:!0,portrait:{path:"images/portraits/ron.png",height:256,width:256,section:{sourceHeight:384,sourceWidth:384}},onlyETrigger:!0,reactDistance:8,onWalkAway:function(){A.ron.playAnimation("Goodbye",!0,2)}});var O=new Entity;O.addComponent(v),O.addComponent(new Transform({position:new Vector3(0,-.65,0)})),O.setParent(A.ron),A.bela=new R.NPC({position:new Vector3(37.27,4,265.32),rotation:Quaternion.Euler(0,90,0)},E.default.models.robots.bela,(function(){A.bela.playAnimation("Hello",!0,2);var v=new Entity;v.addComponent(new R.NPCDelay(2,(function(){A.bela.playAnimation("Talk")}))),engine.addEntity(v),A.bela.addComponentOrReplace(new AudioSource(E.default.sounds.robots.bela)),A.bela.getComponent(AudioSource).playOnce(),A.bela.talk(M.BelaDialog)}),{faceUser:!0,portrait:{path:"images/portraits/bela.png",height:256,width:256,section:{sourceHeight:384,sourceWidth:384}},onlyETrigger:!0,continueOnWalkAway:!1});var V=new Entity;V.addComponent(v),V.addComponent(new Transform({position:new Vector3(0,-.65,0)})),V.setParent(A.bela),A.betty=new R.NPC({position:new Vector3(117.657,3.6,39.98)},E.default.models.robots.betty,(function(){A.betty.playAnimation("Hello",!0,2);var v=new Entity;v.addComponent(new R.NPCDelay(2,(function(){A.bela.playAnimation("Talk")}))),engine.addEntity(v),A.betty.addComponentOrReplace(new AudioSource(E.default.sounds.robots.betty)),A.betty.getComponent(AudioSource).playOnce(),A.betty.talk(M.BettyDialog)}),{faceUser:!0,portrait:{path:"images/portraits/betty.png",height:256,width:256,section:{sourceHeight:384,sourceWidth:384}},onlyETrigger:!0,reactDistance:8,onWalkAway:function(){A.betty.playAnimation("Goodbye",!0,2)}});var z=new Entity;z.addComponent(v),z.addComponent(new Transform({position:new Vector3(0,-.65,0)})),V.setParent(A.betty),A.charlie=new R.NPC({position:new Vector3(269.5,5.35,42.6),rotation:Quaternion.Euler(0,-90,0)},E.default.models.robots.charlie,(function(){A.charlie.playAnimation("Hello",!0,2);var v=new Entity;v.addComponent(new R.NPCDelay(2,(function(){A.bela.playAnimation("Talk")}))),engine.addEntity(v),A.charlie.addComponentOrReplace(new AudioSource(E.default.sounds.robots.charlie)),A.charlie.getComponent(AudioSource).playOnce(),A.charlie.talk(M.CharlieDialog)}),{faceUser:!0,portrait:{path:"images/portraits/charlie.png",height:256,width:256,section:{sourceHeight:384,sourceWidth:384}},onlyETrigger:!0,reactDistance:8,onWalkAway:function(){A.charlie.playAnimation("Goodbye",!0,2)}});var W=new Entity;W.addComponent(v),W.addComponent(new Transform({position:new Vector3(0,-.65,0)})),W.setParent(A.charlie),A.marsha=new R.NPC({position:new Vector3(50.945,9.65,31.1)},E.default.models.robots.marsha,(function(){A.marsha.playAnimation("Hello",!0,2);var v=new Entity;v.addComponent(new R.NPCDelay(2,(function(){A.bela.playAnimation("Talk")}))),engine.addEntity(v),A.marsha.addComponentOrReplace(new AudioSource(E.default.sounds.robots.marsha)),A.marsha.getComponent(AudioSource).playOnce(),A.marsha.talk(M.MarshaDialog)}),{faceUser:!0,portrait:{path:"images/portraits/marsha.png",height:256,width:256,section:{sourceHeight:384,sourceWidth:384}},onlyETrigger:!0,reactDistance:8,onWalkAway:function(){A.marsha.playAnimation("Goodbye",!0,2)}});var H=new Entity;H.addComponent(v),H.addComponent(new Transform({position:new Vector3(0,-.65,0)})),H.setParent(A.marsha),A.bob=new R.NPC({position:new Vector3(165.573,11.5,252.79),rotation:Quaternion.Euler(0,35,0)},E.default.models.robots.bob,(function(){A.bob.playAnimation("Hello",!0,2);var v=new Entity;v.addComponent(new R.NPCDelay(2,(function(){A.bela.playAnimation("Talk")}))),engine.addEntity(v),A.bob.addComponentOrReplace(new AudioSource(E.default.sounds.robots.bob)),A.bob.getComponent(AudioSource).playOnce(),A.bob.talk(M.BobDialog)}),{faceUser:!0,portrait:{path:"images/portraits/bob.png",height:256,width:256,section:{sourceHeight:384,sourceWidth:384}},onlyETrigger:!0,reactDistance:8,onWalkAway:function(){A.bob.playAnimation("Goodbye",!0,2)}});var X=new Entity;X.addComponent(v),X.addComponent(new Transform({position:new Vector3(0,-.65,0)})),X.setParent(A.bob)}})),define("src/modules/museumItems",["require","exports","@dcl/npc-scene-utils","src/modules/npcRobotBuilder","src/modules/npcDialogData","@dcl/ecs-scene-utils"],(function(v,A,E,R,M,O){Object.defineProperty(A,"__esModule",{value:!0}),A.animateMap=A.MapItems=A.placeGardenPieces=A.placeTradecenterPieces=A.invisibleMaterial=A.placeWearablePieces=A.placeMuseumPieces=A.MuseumPiece=void 0;var V=function(v){function MuseumPiece(A,R,M,V,z,W){var H=v.call(this)||this;engine.addEntity(H),H.addComponent(A),H.addComponent(new Transform(R)),H.name=M;var X=H;return H.addComponent(new OnPointerDown((function(){V&&z&&(O.addOneTimeTrigger(new E.TriggerBoxShape(new Vector3(10,5,10),Vector3.Zero()),{onCameraExit:function(){V.endInteraction()},enableDebug:!0},X),V.talk(z,W))}),{button:ActionButton.PRIMARY,hoverText:H.name})),H}return __extends(MuseumPiece,v),MuseumPiece.prototype.ask=function(){},MuseumPiece}(Entity);A.MuseumPiece=V;var z,W=new AnimationState("District_Action",{looping:!1}),H=new AnimationState("District_OFF_Action",{looping:!1}),X=new AnimationState("Roads_Action",{looping:!1}),K=new AnimationState("Roads_OFF_Action",{looping:!1}),Z=new AnimationState("Plazas_Action",{looping:!1}),J=new AnimationState("Plazas_OFF_Action",{looping:!1});A.placeMuseumPieces=function(){new V(new GLTFShape("models/museum/dao.glb"),{position:new Vector3(119.7,11.5,280.3),rotation:Quaternion.Euler(0,105,0)},"DAO",R.bob,M.BobDialog,8),new V(new GLTFShape("models/museum/first-image-dcl.glb"),{position:new Vector3(162,9.4,269.4),rotation:Quaternion.Euler(0,208,0)},"The Vision",R.bob,M.BobDialog,11),new V(new GLTFShape("models/museum/pixels-beginning.glb"),{position:new Vector3(168.24,9.5,266.3),rotation:Quaternion.Euler(0,208,0)},"First Experiments",R.bob,M.BobDialog,13),new V(new GLTFShape("models/museum/first-experiment.glb"),{position:new Vector3(174.5,9.7,262.5),rotation:Quaternion.Euler(0,208,0)},"First 3D Version",R.bob,M.BobDialog,16),new V(new GLTFShape("models/museum/declaration.glb"),{position:new Vector3(183.9,10,254.7),rotation:Quaternion.Euler(0,220,0)},"Declaration of independance",R.bob,M.BobDialog,17),new V(new GLTFShape("models/museum/old_logo.glb"),{position:new Vector3(189.2,10.4,250),rotation:Quaternion.Euler(0,212,0)},"Original Logo",R.bob,M.BobDialog,18),new V(new GLTFShape("models/museum/first-avatars.glb"),{position:new Vector3(193.7,10.45,245.95),rotation:Quaternion.Euler(0,230,0)},"First Avatars",R.bob,M.BobDialog,19),new V(new GLTFShape("models/museum/first_auction.glb"),{position:new Vector3(198.5,10.5,240.7),rotation:Quaternion.Euler(0,230,0)},"First Land Auction",R.bob,M.BobDialog,28),new V(new GLTFShape("models/museum/avatars/first-avatar.glb"),{position:new Vector3(200.99,10.7,234.22),rotation:Quaternion.Euler(0,315,0)},"Avatar",R.bob,M.BobDialog,20),new V(new GLTFShape("models/museum/avatars/fox-avatar.glb"),{position:new Vector3(199,10.3,231.8),rotation:Quaternion.Euler(0,315,0)},"Avatar",R.bob,M.BobDialog,21),new V(new GLTFShape("models/museum/avatars/square-robot-avatar.glb"),{position:new Vector3(196.8,10.3,229.7),rotation:Quaternion.Euler(0,315,0)},"Avatar",R.bob,M.BobDialog,23),new V(new GLTFShape("models/museum/avatars/round-robot-avatar.glb"),{position:new Vector3(194.38,10.3,227),rotation:Quaternion.Euler(0,315,0)},"Avatar",R.bob,M.BobDialog,24),new V(new GLTFShape("models/museum/avatars/boy.glb"),{position:new Vector3(191.59,10.8,224.95),rotation:Quaternion.Euler(0,315,0)},"Avatar",R.bob,M.BobDialog,25),new V(new GLTFShape("models/museum/avatars/girl.glb"),{position:new Vector3(188.7,10.8,223),rotation:Quaternion.Euler(0,315,0)},"Avatar",R.bob,M.BobDialog,26),new V(new GLTFShape("models/museum/second_auction.glb"),{position:new Vector3(182.6,10.5,226.5),rotation:Quaternion.Euler(0,45,0)},"Second Land Auction",R.bob,M.BobDialog,30),new V(new GLTFShape("models/museum/new_logo.glb"),{position:new Vector3(177,10.45,233.3),rotation:Quaternion.Euler(0,52,0)},"New Logo",R.bob,M.BobDialog,32),new V(new GLTFShape("models/museum/landing.glb"),{position:new Vector3(171.8,10.5,239.9),rotation:Quaternion.Euler(0,50,0)},"Landing",R.bob,M.BobDialog,34),new V(new GLTFShape("models/museum/builder.glb"),{position:new Vector3(165.9,9.8,246),rotation:Quaternion.Euler(0,45,0)},"Builder",R.bob,M.BobDialog,37),new V(new GLTFShape("models/museum/names.glb"),{position:new Vector3(159.8,9.5,251.9),rotation:Quaternion.Euler(0,42,0)},"Virtual identity",R.bob,M.BobDialog,40),new V(new GLTFShape("models/museum/halloween_event.glb"),{position:new Vector3(151.7,9.4,258.4),rotation:Quaternion.Euler(0,35,0)},"Token Wearables",R.bob,M.BobDialog,41);var v=new Entity;v.addComponent(new Transform({position:new Vector3(196.29,18,226.15),rotation:Quaternion.Euler(0,315,0),scale:new Vector3(1.25,1.25,1.25)})),v.addComponent(new GLTFShape("models/museum/map/map_base.glb")),engine.addEntity(v);var A=new Entity;A.addComponent(new Transform({position:new Vector3})),A.setParent(v),A.addComponent(new GLTFShape("models/museum/map/map_districts.glb")),A.addComponent(new Animator),A.getComponent(Animator).addClip(W),A.getComponent(Animator).addClip(H),W.stop(),A.addComponent(new OnPointerDown((function(){animateMap(z.DISTRICTS),R.bob.talk(M.BobDialog,51)}),{button:ActionButton.PRIMARY,hoverText:"Districts"}));var E=new Entity;E.setParent(v),E.addComponent(new Transform({position:new Vector3})),E.addComponent(new GLTFShape("models/museum/map/map_plazas.glb")),E.addComponent(new Animator),E.getComponent(Animator).addClip(Z),E.getComponent(Animator).addClip(J),Z.stop(),E.addComponent(new OnPointerDown((function(){animateMap(z.PLAZAS),R.bob.talk(M.BobDialog,49)}),{button:ActionButton.PRIMARY,hoverText:"Plazas"}));var O=new Entity;O.setParent(v),O.addComponent(new Transform({position:new Vector3})),O.addComponent(new GLTFShape("models/museum/map/map_roads.glb")),O.addComponent(new Animator),O.getComponent(Animator).addClip(X),O.getComponent(Animator).addClip(K),X.stop(),O.addComponent(new OnPointerDown((function(){animateMap(z.ROADS),R.bob.talk(M.BobDialog,48)}),{button:ActionButton.PRIMARY,hoverText:"Roads"})),new V(new GLTFShape("models/museum/land.glb"),{position:new Vector3(193,17.4,223.5),rotation:Quaternion.Euler(0,195,0)},"LAND Parcel",R.bob,M.BobDialog,44),new V(new GLTFShape("models/museum/pua.glb"),{position:new Vector3(193,17.55,223.5),rotation:Quaternion.Euler(0,195,0)},"LAND Parcel"),new V(new GLTFShape("models/museum/estate.glb"),{position:new Vector3(199.2,17.4,230),rotation:Quaternion.Euler(0,30,0)},"Estate",R.bob,M.BobDialog,47),new V(new GLTFShape("models/museum/pua.glb"),{position:new Vector3(199.2,17.55,230),rotation:Quaternion.Euler(0,30,0)},"Estate"),new V(new GLTFShape("models/museum/museum_district.glb"),{position:new Vector3(181.2,17.9,228.6),rotation:Quaternion.Euler(0,50,0)},"Museum District",R.bob,M.BobDialog,54),new V(new GLTFShape("models/museum/builder_winner.glb"),{position:new Vector3(175.2,17.8,236.6),rotation:Quaternion.Euler(0,50,0)},"First Builder Contest",R.bob,M.BobDialog,57),new V(new GLTFShape("models/museum/smart-items.glb"),{position:new Vector3(169,17.5,243.95),rotation:Quaternion.Euler(0,50,0)},"Creator contest",R.bob,M.BobDialog,59),new V(new GLTFShape("models/museum/mana.glb"),{position:new Vector3(168.4,18.8,255.7),rotation:Quaternion.Euler(0,135,0)},"MANA",R.bob,M.BobDialog,62),new V(new GLTFShape("models/museum/hackathon_winner.glb"),{position:new Vector3(185.7,17.6,252),rotation:Quaternion.Euler(0,220,0)},"September 2019 Hackathon",R.bob,M.BobDialog,67),new V(new GLTFShape("models/museum/contest_game.glb"),{position:new Vector3(192.9,17.7,245),rotation:Quaternion.Euler(0,225,0)},"Hackathons",R.bob,M.BobDialog,66),new V(new GLTFShape("models/museum/community_contest.glb"),{position:new Vector3(199.5,17.8,238.2),rotation:Quaternion.Euler(0,230,0)},"Community Wearable Contest",R.bob,M.BobDialog,69)},A.placeWearablePieces=function(){new V(new GLTFShape("models/wearables/xmas_stand.glb"),{position:new Vector3(279.67,9.5,145),rotation:Quaternion.Euler(0,180,0)},"About X-Mas Wearables",R.ron,M.RonDialog,14),new V(new GLTFShape("models/wearables/halloween_stand.glb"),{position:new Vector3(265.38,9.5,114),rotation:Quaternion.Euler(0,150,0)},"About Halloween Wearables",R.ron,M.RonDialog,15)},A.invisibleMaterial=new BasicMaterial,A.invisibleMaterial.texture=new Texture("images/transparent-texture.png"),A.invisibleMaterial.alphaTest=1,A.placeTradecenterPieces=function(){new V(new GLTFShape("models/museum/land.glb"),{position:new Vector3(282.9,11,39),rotation:Quaternion.Euler(0,195,0)},"LAND Parcel",R.charlie,M.CharlieDialog,12),new V(new GLTFShape("models/museum/pua.glb"),{position:new Vector3(282.9,11,39),rotation:Quaternion.Euler(0,195,0)},"LAND Parcel"),new V(new GLTFShape("models/museum/estate.glb"),{position:new Vector3(262.9,11,35.7),rotation:Quaternion.Euler(0,30,0)},"Estate",R.charlie,M.CharlieDialog,16),new V(new GLTFShape("models/museum/pua.glb"),{position:new Vector3(262.9,11,35.7),rotation:Quaternion.Euler(0,30,0)},"Estate"),new V(new BoxShape,{position:new Vector3(264.5,22.7,16.25),rotation:Quaternion.Euler(0,204,0),scale:new Vector3(5.8,1.2,1.2)},"Wearables",R.charlie,M.CharlieDialog,17).addComponent(A.invisibleMaterial),new V(new BoxShape,{position:new Vector3(251.4,22.7,46.13),rotation:Quaternion.Euler(0,293,0),scale:new Vector3(5.8,1.2,1.2)},"Wearables",R.charlie,M.CharlieDialog,17).addComponent(A.invisibleMaterial),new V(new BoxShape,{position:new Vector3(294.7,22.7,28.83),rotation:Quaternion.Euler(0,114,0),scale:new Vector3(5.8,1.2,1.2)},"Wearables",R.charlie,M.CharlieDialog,17).addComponent(A.invisibleMaterial),new V(new BoxShape,{position:new Vector3(281.4,22.7,59.17),rotation:Quaternion.Euler(0,24,0),scale:new Vector3(5.8,1.2,1.2)},"Wearables",R.charlie,M.CharlieDialog,17).addComponent(A.invisibleMaterial)},A.placeGardenPieces=function(){new V(new GLTFShape("models/garden/booth_builder_scene.glb"),{position:new Vector3(132.59,2,39.8),rotation:Quaternion.Euler(0,90,0)},"Builder scene",R.betty,M.BettyDialog,34),new V(new GLTFShape("models/garden/booth_smart_items.glb"),{position:new Vector3(106,2,27.7),rotation:Quaternion.Euler(0,180,0)},"Smart Item scene",R.betty,M.BettyDialog,35);var v=new Entity;v.addComponent(new Transform({position:new Vector3(121.6,1.2,20.5),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(1.5,1.5,1.5)})),v.addComponent(new GLTFShape("models/garden/builder.glb")),engine.addEntity(v),v.addComponent(new OnPointerDown((function(v){openExternalURL("https://builder.decentraland.org")}),{hoverText:"Try the Builder",button:ActionButton.PRIMARY}));var A=new Entity;A.addComponent(new Transform({position:new Vector3(121.6,1.2,17.5),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(1.5,1.5,1.5)})),A.addComponent(new GLTFShape("models/garden/docs.glb")),A.addComponent(new OnPointerDown((function(v){openExternalURL("https://docs.decentraland.org")}),{hoverText:"Read the Docs",button:ActionButton.PRIMARY})),engine.addEntity(A);var E=new Entity;E.addComponent(new Transform({position:new Vector3(113.6,1.5,20.5),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(1,1,1)})),E.addComponent(new GLTFShape("models/garden/discord.glb")),E.addComponent(new OnPointerDown((function(v){openExternalURL("https://dcl.gg/discord")}),{hoverText:"Join the Discussion",button:ActionButton.PRIMARY})),engine.addEntity(E);var O=new Entity;O.addComponent(new Transform({position:new Vector3(113.6,1.5,17.5),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(1,1,1)})),O.addComponent(new GLTFShape("models/garden/twitter.glb")),O.addComponent(new OnPointerDown((function(v){openExternalURL("https://twitter.com/decentraland")}),{hoverText:"Follow Us!",button:ActionButton.PRIMARY})),engine.addEntity(O)},function(v){v.DISTRICTS="districts",v.PLAZAS="plazas",v.ROADS="roads"}(z=A.MapItems||(A.MapItems={}));var $=null;function animateMap(v){switch(log("selected item: ",v),$){case z.DISTRICTS:H.play();break;case z.ROADS:X.stop(),K.play();break;case z.PLAZAS:Z.stop(),J.play()}if(v!=$)switch($=v,v){case z.DISTRICTS:log("clicked Districts"),H.stop(),W.stop(),W.play();break;case z.ROADS:log("clicked Roads"),K.stop(),X.stop(),X.play();break;case z.PLAZAS:log("clicked Plazas"),J.stop(),Z.stop(),Z.play()}else $=null}A.animateMap=animateMap})),define("src/modules/helperFunctions",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.firstNonBlank=A.shortenText=A.splitTextIntoLines=void 0,A.splitTextIntoLines=function(v,A,E){for(var R="",M=0;M<v.length;M++){var O=R.split("\n");if(O[O.length-1].length>=A&&M!==v.length){if(" "!==R[R.length-1]){if(E&&O.length>=E)return R.concat("...");R=R.concat("-")}if(R=R.concat("\n")," "===v[M])continue}R=R.concat(v[M])}return R},A.shortenText=function(v,A){return v.length>A?v.substring(0,A).concat("..."):v},A.firstNonBlank=function(v,A){for(var E in v){var R=v[E];if(void 0!==R&&R.length>0)return R}return A}})),define("src/modules/marketData",["require","exports","src/modules/museumItems","src/modules/helperFunctions"],(function(v,A,E,R){Object.defineProperty(A,"__esModule",{value:!0}),A.updateTradeCentrer=A.toMana=A.WearablePreview=A.StockData=A.StockDataTypes=A.StockDataRowTypes=void 0;var M="data not available",O=-3.365,V=new Entity;V.addComponent(new Transform({position:new Vector3(273.018,6.5,37.792)})),engine.addEntity(V);var z=new Entity;z.addComponent(new Transform({rotation:Quaternion.Euler(0,293,0)})),z.setParent(V);var W=new Entity;W.addComponent(new Transform({position:new Vector3(0,0,O)})),W.setParent(z),W.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var H=new Entity;H.addComponent(new Transform({rotation:Quaternion.Euler(0,353,0)})),H.setParent(V);var X=new Entity;X.addComponent(new Transform({position:new Vector3(0,0,O)})),X.setParent(H),X.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var K=new Entity;K.addComponent(new Transform({rotation:Quaternion.Euler(0,53,0)})),K.setParent(V);var Z=new Entity;Z.addComponent(new Transform({position:new Vector3(0,0,-3.4650000000000003)})),Z.setParent(K),Z.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var J=new Entity;J.addComponent(new Transform({rotation:Quaternion.Euler(0,113,0)})),J.setParent(V);var $=new Entity;$.addComponent(new Transform({position:new Vector3(0,0,O)})),$.setParent(J),$.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var ee=new Entity;ee.addComponent(new Transform({rotation:Quaternion.Euler(0,173,0)})),ee.setParent(V);var ne=new Entity;ne.addComponent(new Transform({position:new Vector3(0,0,O)})),ne.setParent(ee),ne.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var oe=new Entity;oe.addComponent(new Transform({rotation:Quaternion.Euler(0,233,0)})),oe.setParent(V);var ie=new Entity;ie.addComponent(new Transform({position:new Vector3(0,0,O)})),ie.setParent(oe),ie.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var ae=-4.536020000000001,se=new Entity;se.addComponent(new Transform({position:new Vector3(273.018,14.5,37.792)})),engine.addEntity(se);var le=new Entity;le.addComponent(new Transform({rotation:Quaternion.Euler(0,293,0)})),le.setParent(se);var ce=new Entity;ce.addComponent(new Transform({position:new Vector3(0,0,-4.486020000000001)})),ce.setParent(le),ce.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var ue=new Entity;ue.addComponent(new Transform({rotation:Quaternion.Euler(0,353,0)})),ue.setParent(se);var de=new Entity;de.addComponent(new Transform({position:new Vector3(0,0,-4.38602)})),de.setParent(ue),de.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var he=new Entity;he.addComponent(new Transform({rotation:Quaternion.Euler(0,53,0)})),he.setParent(se);var me=new Entity;me.addComponent(new Transform({position:new Vector3(0,0,-4.33602)})),me.setParent(he),me.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var fe=new Entity;fe.addComponent(new Transform({rotation:Quaternion.Euler(0,113,0)})),fe.setParent(se);var ye=new Entity;ye.addComponent(new Transform({position:new Vector3(0,0,-4.33602)})),ye.setParent(fe),ye.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var we=new Entity;we.addComponent(new Transform({rotation:Quaternion.Euler(0,173,0)})),we.setParent(se);var ve=new Entity;ve.addComponent(new Transform({position:new Vector3(0,0,ae)})),ve.setParent(we),ve.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var be=new Entity;be.addComponent(new Transform({rotation:Quaternion.Euler(0,233,0)})),be.setParent(se);var Te=new Entity;Te.addComponent(new Transform({position:new Vector3(0,0,ae)})),Te.setParent(be),Te.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var Se=-6.6627,Ce=new Entity;Ce.addComponent(new Transform({position:new Vector3(273.19,23.5,37.85)})),engine.addEntity(Ce);var Ee=new Entity;Ee.addComponent(new Transform({rotation:Quaternion.Euler(0,293,0)})),Ee.setParent(Ce);var _e=new Entity;_e.addComponent(new Transform({position:new Vector3(0,0,Se)})),_e.setParent(Ee),_e.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var Ie=new Entity;Ie.addComponent(new Transform({rotation:Quaternion.Euler(0,353,0)})),Ie.setParent(Ce);var Pe=new Entity;Pe.addComponent(new Transform({position:new Vector3(0,0,-6.5127)})),Pe.setParent(Ie),Pe.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var Be=new Entity;Be.addComponent(new Transform({rotation:Quaternion.Euler(0,53,0)})),Be.setParent(Ce);var ke=new Entity;ke.addComponent(new Transform({position:new Vector3(0,0,-6.4627)})),ke.setParent(Be),ke.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var Re=new Entity;Re.addComponent(new Transform({rotation:Quaternion.Euler(0,113,0)})),Re.setParent(Ce);var Oe=new Entity;Oe.addComponent(new Transform({position:new Vector3(0,0,-6.5627)})),Oe.setParent(Re),Oe.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var Le=new Entity;Le.addComponent(new Transform({rotation:Quaternion.Euler(0,173,0)})),Le.setParent(Ce);var Ve=new Entity;Ve.addComponent(new Transform({position:new Vector3(0,0,Se)})),Ve.setParent(Le),Ve.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var Ne=new Entity;Ne.addComponent(new Transform({rotation:Quaternion.Euler(0,233,0)})),Ne.setParent(Ce);var Fe=new Entity;Fe.addComponent(new Transform({position:new Vector3(0,0,-6.7127)})),Fe.setParent(Ne),Fe.getComponent(Transform).rotate(new Vector3(1,0,0),-30);var Ue=new Entity;Ue.addComponent(new Transform({position:new Vector3(271.09,21.6,14.38),rotation:Quaternion.Euler(0,204,0),scale:new Vector3(.7,.7,.7)})),engine.addEntity(Ue);var We=new Entity;We.addComponent(new Transform({position:new Vector3(258.25,21.6,19.46),rotation:Quaternion.Euler(0,203,0),scale:new Vector3(.7,.7,.7)})),engine.addEntity(We);var Ge=new Entity;Ge.addComponent(new Transform({position:new Vector3(296.2,21.6,35.56),rotation:Quaternion.Euler(0,113,0),scale:new Vector3(.7,.7,.7)})),engine.addEntity(Ge);var qe=new Entity;qe.addComponent(new Transform({position:new Vector3(291.21,21.6,22.68),rotation:Quaternion.Euler(0,114,0),scale:new Vector3(.7,.7,.7)})),engine.addEntity(qe);var He=new Entity;He.addComponent(new Transform({position:new Vector3(249.42,21.6,39.43),rotation:Quaternion.Euler(0,293,0),scale:new Vector3(.7,.7,.7)})),engine.addEntity(He);var Ye=new Entity;Ye.addComponent(new Transform({position:new Vector3(254.54,21.6,52.54),rotation:Quaternion.Euler(0,292,0),scale:new Vector3(.7,.7,.7)})),engine.addEntity(Ye);var Qe=new Entity;Qe.addComponent(new Transform({position:new Vector3(275.07,21.6,61.29),rotation:Quaternion.Euler(0,24,0),scale:new Vector3(.7,.7,.7)})),engine.addEntity(Qe);var Xe,Ze,Je=new Entity;Je.addComponent(new Transform({position:new Vector3(288.03,21.6,56),rotation:Quaternion.Euler(0,24,0),scale:new Vector3(.7,.7,.7)})),engine.addEntity(Je),function(v){v.LABEL_VALUE_UNIT="label-value-unit",v.LABEL_VALUE="label-value"}(Xe=A.StockDataRowTypes||(A.StockDataRowTypes={})),function(v){v.BIGTITLE="bigtitle",v.BIGVALUE="bigvalue",v.TITLE="title",v.LABEL="label",v.VALUE="value",v.UNIT="unit",v.TINYVALUE="tinyvalue",v.TINYTITLE="tinytitle"}(Ze=A.StockDataTypes||(A.StockDataTypes={}));var $e=new Font(Fonts.SanFrancisco),et=function(v){function StockData(A,E,R,M){var O=v.call(this)||this;engine.addEntity(O),O.addComponent(new Transform(R)),O.setParent(M);var V=O.textShape=new TextShape(E);switch(V.font=$e,V.width=10,A){case Ze.BIGTITLE:V.fontSize=6,V.color=Color3.White(),V.vTextAlign="center";break;case Ze.BIGVALUE:V.fontSize=3,V.color=Color3.Green(),V.vTextAlign="center";break;case Ze.TITLE:V.fontSize=3,V.color=Color3.White(),V.vTextAlign="center",V.width=10;break;case Ze.TINYTITLE:V.fontSize=2,V.color=Color3.White(),V.vTextAlign="center",V.width=10;break;case Ze.LABEL:V.fontSize=3,V.color=Color3.White(),V.vTextAlign="left";break;case Ze.VALUE:V.fontSize=3,V.color=Color3.Green(),V.vTextAlign="right";break;case Ze.TINYVALUE:V.fontSize=2,V.color=Color3.Green(),V.vTextAlign="right";break;case Ze.UNIT:V.fontSize=2,V.color=Color3.White(),V.vTextAlign="right"}return O.addComponent(V),O}return __extends(StockData,v),StockData}(Entity);A.StockData=et;var nt=function(v){function WearablePreview(A,E,R){var M=v.call(this)||this;engine.addEntity(M),M.setParent(R),M.addComponent(new Transform(E)),M.getComponent(Transform).scale=new Vector3(1.5,1.5,1),M.getComponent(Transform).rotation=Quaternion.Euler(180,0,0);var O=new Texture(A),V=new Material;return V.roughness=1,V.albedoTexture=O,M.addComponent(new PlaneShape),M.addComponent(V),M}return __extends(WearablePreview,v),WearablePreview}(Entity);function toMana(v){var A=v/1e18*Math.pow(10,4);return Math.round(A)/Math.pow(10,4)}function createStockPanelRow(v,A,E,R,O,V){var z,W,H,X=O.position.clone();z={position:new Vector3(-1,X.y,0)},W={position:new Vector3(.7,X.y,0)},H={position:new Vector3(1.7,X.y,0)};var K=R[1],Z=void 0===K||"NaN"===K||"0"===K;Z&&(K=M),new et(Ze.LABEL,R[0],z,V);var J,$=new et(Ze.VALUE,K,W,V);E==Xe.LABEL_VALUE_UNIT&&(J=new et(Ze.UNIT,R[2],H,V)),Z&&($.textShape.fontSize=$.textShape.fontSize-1,$.textShape.hTextAlign="center",J&&J.hasComponent(TextShape)?J.getComponent(TextShape).visible=!1:log("tried to remove but has TextShape shape??",J))}function avgPrice(v,A){return void 0===v||void 0===A||0==A?0:Math.floor(v/A*100)/100}A.WearablePreview=nt,A.toMana=toMana,A.updateTradeCentrer=function(v){new et(Ze.BIGTITLE,"BTC Price",{position:new Vector3(0,.4,0)},W),new et(Ze.BIGVALUE,v.coins&&v.coins.BTCUSDT?v.coins.BTCUSDT.toString()+" USD":M,{position:new Vector3(0,-.3,0)},W),new et(Ze.BIGTITLE,"ETH Price",{position:new Vector3(0,.4,0)},X),new et(Ze.BIGVALUE,v.coins&&v.coins.ETHUSDT?v.coins.ETHUSDT.toString()+" USD":M,{position:new Vector3(0,-.3,0)},X),new et(Ze.BIGTITLE,"MANA Price",{position:new Vector3(0,.4,0)},Z),new et(Ze.BIGVALUE,v.coins&&v.coins.MANAETH?v.coins.MANAETH.toString().slice(0,10)+" ETH":M,{position:new Vector3(0,-.3,0)},Z),new et(Ze.BIGTITLE,"MANA Price",{position:new Vector3(0,.4,0)},$),new et(Ze.BIGVALUE,v.coins&&v.coins.MANAUSD?v.coins.MANAUSD.toString().slice(0,8)+" USD":M,{position:new Vector3(0,-.3,0)},$),new et(Ze.TITLE,"DCL token transactions",{position:new Vector3(0,.5,0)},ne),new et(Ze.TITLE,"last 7 days",{position:new Vector3(0,.15,0)},ne);var A=v.landSalesWeek+v.wearableSalesWeek,O=(new et(Ze.BIGVALUE,0!=A?A.toString()+" tokens":M,{position:new Vector3(0,-.3,0)},ne),new et(Ze.TITLE,"DCL token transactions",{position:new Vector3(0,.5,0)},ie),new et(Ze.TITLE,"last 7 days",{position:new Vector3(0,.15,0)},ie),(v.totalMANALandAndEstateWeek+v.totalMANAWearablesWeek)*v.coins.MANAUSD),V=Math.floor(100*O)/100,z=(new et(Ze.BIGVALUE,0!=V?V.toString()+" USD":M,{position:new Vector3(0,-.3,0)},ie),new et(Ze.TITLE,"Parcel + Estate sales",{position:new Vector3(0,1.5,0)},ce),createStockPanelRow(0,0,Xe.LABEL_VALUE,["Yesterday",v.landSalesYesterday.toString()],{position:new Vector3(-.7,.9,0)},ce),createStockPanelRow(0,0,Xe.LABEL_VALUE,["7 Days",v.landSalesWeek.toString()],{position:new Vector3(-.7,.4,0)},ce),createStockPanelRow(0,0,Xe.LABEL_VALUE,["30 Days",v.landSalesMonth.toString()],{position:new Vector3(-.7,-.1,0)},ce),new et(Ze.TITLE,"Cheapest Parcel Sold",{position:new Vector3(0,1.5,0)},de),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Yesterday",v.cheapestLandYesterday.toString(),"MANA"],{position:new Vector3(-1,.9,0)},de),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["7 Days",v.cheapestLandWeek.toString(),"MANA"],{position:new Vector3(-1,.4,0)},de),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["30 Days",v.cheapestLandMonth.toString(),"MANA"],{position:new Vector3(-1,-.1,0)},de),new et(Ze.TITLE,"Most Expensive Single Parcel",{position:new Vector3(0,1.5,0)},me),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Yesterday",v.expensiveLandYesterday.toString(),"MANA"],{position:new Vector3(-1,.9,0)},me),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["7 Days",v.expensiveLandWeek.toString(),"MANA"],{position:new Vector3(-1,.4,0)},me),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["30 Days",v.expensiveLandMonth.toString(),"MANA"],{position:new Vector3(-1,-.1,0)},me),new et(Ze.TITLE,"Most Expensive Estate",{position:new Vector3(0,1.5,0)},ye),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Yesterday",v.expensiveEstateYesterday.toString(),"MANA"],{position:new Vector3(-1,.9,0)},ye),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["7 Days",v.expensiveEstateWeek.toString(),"MANA"],{position:new Vector3(-1,.4,0)},ye),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["30 Days",v.expensiveEstateMonth.toString(),"MANA"],{position:new Vector3(-1,-.1,0)},ye),new et(Ze.TITLE,"LAND Transaction Volume",{position:new Vector3(0,1.5,0)},ve),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Yesterday",v.totalMANALandAndEstateYesterday.toString(),"MANA"],{position:new Vector3(-1,.9,0)},ve),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["7 Days",v.totalMANALandAndEstateWeek.toString(),"MANA"],{position:new Vector3(-1,.4,0)},ve),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["30 Days",v.totalMANALandAndEstateMonth.toString(),"MANA"],{position:new Vector3(-1,-.1,0)},ve),new Entity);z.setParent(Te),z.addComponent(new PlaneShape),z.addComponent(new Transform({position:new Vector3(0,.5,-.25),scale:new Vector3(3,3,3)})),z.addComponent(E.invisibleMaterial),z.addComponent(new OnPointerDown((function(A){var E="https://market.decentraland.org/contracts/0xf87e31492faf9a91b02ee0deaad50d51d56d5d4d/tokens/"+v.cheapestLandNow.parcel.tokenId;openExternalURL(E)}),{button:ActionButton.PRIMARY,hoverText:"Open in Market"})),engine.addEntity(z),new et(Ze.TITLE,"Cheapest Parcel On Sale",{position:new Vector3(0,1.6,0)},Te),new et(Ze.TITLE,"now in the market",{position:new Vector3(0,1.3,0)},Te),new et(Ze.BIGTITLE,v.cheapestLandNow.parcel.x.toString()+", "+v.cheapestLandNow.parcel.y.toString(),{position:new Vector3(0,.8,0)},Te);var H=toMana(v.cheapestLandNow.searchOrderPrice).toString(),K=(new et(Ze.VALUE,H,{position:new Vector3(-.65,0,0)},Te),new et(Ze.UNIT,"MANA",{position:new Vector3(.65,0,0)},Te),new et(Ze.LABEL,"owner:",{position:new Vector3(-1,-.4,0)},Te),v.cheapestLandNow.owner.address.slice(0,5)+"..."+v.cheapestLandNow.owner.address.slice(v.cheapestLandNow.owner.address.length-4)),J=(new et(Ze.VALUE,K,{position:new Vector3(.5,-.4,0)},Te),new et(Ze.BIGTITLE,"Wearable Sales",{position:new Vector3(0,.9,0)},_e),createStockPanelRow(0,0,Xe.LABEL_VALUE,["Yesterday",v.wearableSalesYesterday.toString()],{position:new Vector3(-.7,0,0)},_e),createStockPanelRow(0,0,Xe.LABEL_VALUE,["7 Days",v.wearableSalesWeek.toString()],{position:new Vector3(-.7,-.5,0)},_e),createStockPanelRow(0,0,Xe.LABEL_VALUE,["30 Days",v.wearableSalesMonth.toString()],{position:new Vector3(-.7,-1,0)},_e),new et(Ze.BIGTITLE,"Most Expensive Wearable",{position:new Vector3(.2,.9,0)},Pe),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Yesterday",(0,R.shortenText)(v.expensiveWearableYesterday.toString(),24),"MANA"],{position:new Vector3(-1,0,0)},Pe),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["7 Days",(0,R.shortenText)(v.expensiveWearableWeek.toString(),24),"MANA"],{position:new Vector3(-1,-.5,0)},Pe),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["30 Days",(0,R.shortenText)(v.expensiveWearableMonth.toString(),24),"MANA"],{position:new Vector3(-1,-1,0)},Pe),new et(Ze.BIGTITLE,"Most Expensive Wearable",{position:new Vector3(.2,.9,0)},ke),new et(Ze.LABEL,"Yesterday",{position:new Vector3(-1.8,0,0)},ke),new et(Ze.LABEL,"7 days",{position:new Vector3(-1.8,-.5,0)},ke),new et(Ze.LABEL,"30 days",{position:new Vector3(-1.8,-1,0)},ke),new et(Ze.VALUE,(0,R.firstNonBlank)([(0,R.shortenText)(v.expensiveWearableNameYesterday,24)],M),{position:new Vector3(1.2,0,0)},ke),new et(Ze.VALUE,(0,R.firstNonBlank)([(0,R.shortenText)(v.expensiveWearableNameWeek,24)],M),{position:new Vector3(1.2,-.5,0)},ke),new et(Ze.VALUE,(0,R.firstNonBlank)([(0,R.shortenText)(v.expensiveWearableNameMonth,24)],M),{position:new Vector3(1.2,-1,0)},ke),new et(Ze.BIGTITLE,"Wearable Transactions",{position:new Vector3(0,.9,0)},Oe),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Yesterday",Math.floor(v.totalMANAWearablesYesterday).toString(),"MANA"],{position:new Vector3(-1.3,0,0)},Oe),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["7 Days",Math.floor(v.totalMANAWearablesWeek).toString(),"MANA"],{position:new Vector3(-1.3,-.5,0)},Oe),createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["30 Days",Math.floor(v.totalMANAWearablesMonth).toString(),"MANA"],{position:new Vector3(-1.3,-1,0)},Oe),new et(Ze.BIGTITLE,"Wearable Transactions",{position:new Vector3(0,1.05,0)},Ve),new et(Ze.TITLE,"last 30 days",{position:new Vector3(0,.6,0)},Ve),createStockPanelRow(0,0,Xe.LABEL_VALUE,["Uncommon",v.uncommonWearableMonthSales.toString()],{position:new Vector3(-1.3,.2,0)},Ve),createStockPanelRow(0,0,Xe.LABEL_VALUE,["Rare",v.rareWearableMonthSales.toString()],{position:new Vector3(-1.3,-.3,0)},Ve),createStockPanelRow(0,0,Xe.LABEL_VALUE,["Epic",v.epicWearableMonthSales.toString()],{position:new Vector3(-1.3,-.8,0)},Ve),createStockPanelRow(0,0,Xe.LABEL_VALUE,["Legendary",v.legendaryWearableMonthSales.toString()],{position:new Vector3(-1.3,-1.3,0)},Ve),createStockPanelRow(0,0,Xe.LABEL_VALUE,["Mythic",v.mythicWearableMonthSales.toString()],{position:new Vector3(-1.3,-1.8,0)},Ve),new et(Ze.BIGTITLE,"Average Price",{position:new Vector3(0,1.05,0)},Fe),new et(Ze.TITLE,"last 30 days",{position:new Vector3(0,.6,0)},Fe),avgPrice(v.uncommonWearableMonthMANA,v.uncommonWearableMonthSales)),ee=(createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Uncommon",J.toString(),"MANA"],{position:new Vector3(-1.3,.2,0)},Fe),avgPrice(v.rareWearableMonthMANA,v.rareWearableMonthSales)),oe=(createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Rare",ee.toString(),"MANA"],{position:new Vector3(-1.3,-.3,0)},Fe),avgPrice(v.epicWearableMonthMANA,v.epicWearableMonthSales)),ae=(createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Epic",oe.toString(),"MANA"],{position:new Vector3(-1.3,-.8,0)},Fe),avgPrice(v.legendaryWearableMonthMANA,v.legendaryWearableMonthSales)),se=(createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Legendary",ae.toString(),"MANA"],{position:new Vector3(-1.3,-1.3,0)},Fe),avgPrice(v.mythicWearableMonthMANA,v.mythicWearableMonthSales));createStockPanelRow(0,0,Xe.LABEL_VALUE_UNIT,["Mythic",se.toString(),"MANA"],{position:new Vector3(-1.3,-1.8,0)},Fe),new et(Ze.TINYTITLE,"Cheapest Rare Wearable",{position:new Vector3(0,3.8,-.2)},Qe),new et(Ze.TINYTITLE,"now in the market",{position:new Vector3(0,3.6,-.2)},Qe),new et(Ze.TINYVALUE,(0,R.firstNonBlank)([(0,R.shortenText)(v.cheapRareNow.name,24)],M),{position:new Vector3(0,2.9,-.2)},Qe).getComponent(TextShape).color=Color3.FromHexString("#3AD682");var le=new nt(v.cheapRareNow.image,{position:new Vector3(0,1.5,-.2)},Qe);new et(Ze.VALUE,toMana(v.cheapRareNow.searchOrderPrice).toString(),{position:new Vector3(0,.4,-.2)},Qe).getComponent(TextShape).color=Color3.FromHexString("#3AD682"),new et(Ze.UNIT,"MANA",{position:new Vector3(0,.1,-.2)},Qe),new et(Ze.TINYTITLE,"owner:",{position:new Vector3(-.6,-.4,-.2)},Qe);var ue=v.cheapRareNow.owner.address.slice(0,5)+"..."+v.cheapRareNow.owner.address.slice(v.cheapRareNow.owner.address.length-4);new et(Ze.TINYVALUE,ue,{position:new Vector3(.5,-.4,-.2)},Qe).getComponent(TextShape).color=Color3.FromHexString("#3AD682"),le.addComponent(new OnPointerDown((function(A){var E="https://market.decentraland.org/contracts/"+v.cheapRareNow.contractAddress+"/tokens/"+v.cheapRareNow.tokenId;openExternalURL(E)}),{button:ActionButton.PRIMARY,hoverText:"Open in Market"})),new et(Ze.TINYTITLE,"Priciest Rare Wearable",{position:new Vector3(0,3.8,-.2)},Je),new et(Ze.TINYTITLE,"sold in last 30 days",{position:new Vector3(0,3.6,-.2)},Je),new et(Ze.TINYVALUE,(0,R.firstNonBlank)([(0,R.shortenText)(v.rareWearableMonthExpensive.name,24)],M),{position:new Vector3(0,2.9,-.2)},Je).getComponent(TextShape).color=Color3.FromHexString("#3AD682"),new nt(v.rareWearableMonthExpensive.image,{position:new Vector3(0,1.5,-.2)},Je),new et(Ze.VALUE,v.rareWearableMonthExpensive.price.toString(),{position:new Vector3(0,.4,-.2)},Je).getComponent(TextShape).color=Color3.FromHexString("#3AD682"),new et(Ze.UNIT,"MANA",{position:new Vector3(0,.1,-.2)},Je),new et(Ze.TINYTITLE,"Cheapest Epic Wearable",{position:new Vector3(0,3.8,-.05)},He),new et(Ze.TINYTITLE,"now in the market",{position:new Vector3(0,3.6,-.05)},He),new et(Ze.TINYVALUE,(0,R.shortenText)(v.cheapEpicNow.name,24),{position:new Vector3(0,2.9,-.05)},He).getComponent(TextShape).color=Color3.FromHexString("#6297F2");var he=new nt(v.cheapEpicNow.image,{position:new Vector3(0,1.5,0)},He);new et(Ze.VALUE,toMana(v.cheapEpicNow.searchOrderPrice).toString(),{position:new Vector3(0,.4,-.05)},He).getComponent(TextShape).color=Color3.FromHexString("#6297F2"),new et(Ze.UNIT,"MANA",{position:new Vector3(0,.1,-.05)},He),new et(Ze.TINYTITLE,"owner:",{position:new Vector3(-.6,-.4,-.05)},He);var fe=v.cheapEpicNow.owner.address.slice(0,5)+"..."+v.cheapEpicNow.owner.address.slice(v.cheapEpicNow.owner.address.length-4);new et(Ze.TINYVALUE,fe,{position:new Vector3(.5,-.4,-.1)},He).getComponent(TextShape).color=Color3.FromHexString("#6297F2"),he.addComponent(new OnPointerDown((function(A){var E="https://market.decentraland.org/contracts/"+v.cheapEpicNow.contractAddress+"/tokens/"+v.cheapEpicNow.tokenId;openExternalURL(E)}),{button:ActionButton.PRIMARY,hoverText:"Open in Market"})),new et(Ze.TINYTITLE,"Priciest Epic Wearable",{position:new Vector3(0,3.8,-.2)},Ye),new et(Ze.TINYTITLE,"sold in last 30 days",{position:new Vector3(0,3.6,-.2)},Ye),new et(Ze.TINYVALUE,(0,R.shortenText)(v.epicWearableMonthExpensive.name,24),{position:new Vector3(0,2.9,-.2)},Ye).getComponent(TextShape).color=Color3.FromHexString("#6297F2"),new nt(v.epicWearableMonthExpensive.image,{position:new Vector3(0,1.5,-.2)},Ye),new et(Ze.VALUE,v.epicWearableMonthExpensive.price.toString(),{position:new Vector3(0,.4,-.2)},Ye).getComponent(TextShape).color=Color3.FromHexString("#6297F2"),new et(Ze.UNIT,"MANA",{position:new Vector3(0,.1,-.2)},Ye),new et(Ze.TINYTITLE,"Cheapest Legendary Wearable",{position:new Vector3(-.2,3.8,0)},Ge),new et(Ze.TINYTITLE,"now in the market",{position:new Vector3(-.2,3.6,0)},Ge),new et(Ze.TINYVALUE,(0,R.shortenText)(v.cheapLegendaryNow.name,24),{position:new Vector3(-.2,2.9,0)},Ge).getComponent(TextShape).color=Color3.FromHexString("#9E55E2");var we=new nt(v.cheapLegendaryNow.image,{position:new Vector3(-.2,1.5,0)},Ge);new et(Ze.VALUE,toMana(v.cheapLegendaryNow.searchOrderPrice).toString(),{position:new Vector3(-.2,.4,0)},Ge).getComponent(TextShape).color=Color3.FromHexString("#9E55E2"),new et(Ze.UNIT,"MANA",{position:new Vector3(-.2,.1,0)},Ge),new et(Ze.TINYTITLE,"owner:",{position:new Vector3(-.8,-.4,0)},Ge);var be=v.cheapLegendaryNow.owner.address.slice(0,5)+"..."+v.cheapLegendaryNow.owner.address.slice(v.cheapLegendaryNow.owner.address.length-4);new et(Ze.TINYVALUE,be,{position:new Vector3(.3,-.4,0)},Ge).getComponent(TextShape).color=Color3.FromHexString("#9E55E2"),we.addComponent(new OnPointerDown((function(A){var E="https://market.decentraland.org/contracts/"+v.cheapLegendaryNow.contractAddress+"/tokens/"+v.cheapLegendaryNow.tokenId;openExternalURL(E)}),{button:ActionButton.PRIMARY,hoverText:"Open in Market"})),new et(Ze.TINYTITLE,"Priciest Legendary Wearable",{position:new Vector3(0,3.8,-.2)},qe),new et(Ze.TINYTITLE,"sold in last 30 days",{position:new Vector3(0,3.6,-.2)},qe),new et(Ze.TINYVALUE,(0,R.shortenText)(v.legendaryWearableMonthExpensive.name,24),{position:new Vector3(0,2.9,-.2)},qe).getComponent(TextShape).color=Color3.FromHexString("#9E55E2"),new nt(v.legendaryWearableMonthExpensive.image,{position:new Vector3(0,1.5,-.2)},qe),new et(Ze.VALUE,v.legendaryWearableMonthExpensive.price.toString(),{position:new Vector3(0,.4,-.2)},qe).getComponent(TextShape).color=Color3.FromHexString("#9E55E2"),new et(Ze.UNIT,"MANA",{position:new Vector3(0,.1,-.2)},qe),new et(Ze.TINYTITLE,"Cheapest Mythic Wearable",{position:new Vector3(0,3.8,-.1)},Ue),new et(Ze.TINYTITLE,"now in the market",{position:new Vector3(0,3.6,-.1)},Ue),new et(Ze.TINYVALUE,(0,R.shortenText)(v.cheapMythicNow.name,24),{position:new Vector3(0,2.9,-.1)},Ue).getComponent(TextShape).color=Color3.FromHexString("#E43EC6");var Se=new nt(v.cheapMythicNow.image,{position:new Vector3(0,1.5,-.1)},Ue);new et(Ze.VALUE,toMana(v.cheapMythicNow.searchOrderPrice).toString(),{position:new Vector3(0,.4,-.1)},Ue).getComponent(TextShape).color=Color3.FromHexString("#E43EC6"),new et(Ze.UNIT,"MANA",{position:new Vector3(0,.1,-.1)},Ue),new et(Ze.TINYTITLE,"owner:",{position:new Vector3(-.6,-.4,-.1)},Ue).getComponent(TextShape).color=Color3.FromHexString("#E43EC6");var Ce=v.cheapMythicNow.owner.address.slice(0,5)+"..."+v.cheapMythicNow.owner.address.slice(v.cheapMythicNow.owner.address.length-4);new et(Ze.TINYVALUE,Ce,{position:new Vector3(.5,-.4,-.1)},Ue).getComponent(TextShape).color=Color3.FromHexString("#E43EC6"),Se.addComponent(new OnPointerDown((function(A){var E="https://market.decentraland.org/contracts/"+v.cheapMythicNow.contractAddress+"/tokens/"+v.cheapMythicNow.tokenId;openExternalURL(E)}),{button:ActionButton.PRIMARY,hoverText:"Open in Market"})),new et(Ze.TINYTITLE,"Priciest Mythic Wearable",{position:new Vector3(0,3.8,-.2)},We),new et(Ze.TINYTITLE,"sold in last 30 days",{position:new Vector3(0,3.6,-.2)},We),new et(Ze.TINYVALUE,(0,R.shortenText)(v.mythicWearableMonthExpensive.name,24),{position:new Vector3(0,2.9,-.2)},We).getComponent(TextShape).color=Color3.FromHexString("#E43EC6"),new nt(v.mythicWearableMonthExpensive.image,{position:new Vector3(0,1.5,-.2)},We),new et(Ze.VALUE,v.mythicWearableMonthExpensive.price.toString(),{position:new Vector3(0,.4,-.2)},We).getComponent(TextShape).color=Color3.FromHexString("#E43EC6"),new et(Ze.UNIT,"MANA",{position:new Vector3(0,.1,-.2)},We)}})),define("src/modules/serverHandler",["require","exports","src/modules/messageboard","src/modules/marketData"],(function(v,A,E,R){Object.defineProperty(A,"__esModule",{value:!0}),A.getMarketData=A.updateMarketData=A.updateMessageBoards=A.getLastMessage=A.setNewMessage=A.CheckServer=A.fireBaseServer=A.awsServer=A.sceneMessageBus=void 0,A.sceneMessageBus=new MessageBus,A.awsServer="https://genesis-plaza.s3.us-east-2.amazonaws.com/",A.fireBaseServer="https://us-central1-genesis-plaza.cloudfunctions.net/app/";var M=function(){function CheckServer(v){this.totalMessageTime=v,this.messageTimer=5,this.eventTimer=0,this.totalEventTimer=2}return CheckServer.prototype.update=function(v){this.messageTimer-=v,this.messageTimer<0&&(this.messageTimer+=this.totalMessageTime,updateMessageBoards())},CheckServer}();function getLastMessage(v){return __awaiter(this,void 0,void 0,(function(){var E,R;return __generator(this,(function(M){switch(M.label){case 0:return M.trys.push([0,3,,4]),E=A.awsServer+"messageboards/"+v+".json",[4,fetch(E).then()];case 1:return[4,M.sent().json()];case 2:return[2,(R=M.sent()).messages[R.messages.length-1]];case 3:return M.sent(),log("error fetching from AWS server"),[3,4];case 4:return[2]}}))}))}function updateMessageBoards(){return __awaiter(this,void 0,void 0,(function(){var v,A;return __generator(this,(function(R){switch(R.label){case 0:return log("checking boards"),[4,getLastMessage("artichoke")];case 1:return v=R.sent(),log("setting Artichoke message : ",v),v&&(E.ArtichokeFloatingTextShape.value=v),[4,getLastMessage("tower")];case 2:return A=R.sent(),log("setting Tower message : ",A),A&&(0,E.setTowerText)(A),[2]}}))}))}A.CheckServer=M,A.setNewMessage=function(v,R){return __awaiter(this,void 0,void 0,(function(){var M,O;return __generator(this,(function(V){try{M=void 0,log("location: ",v,"message: ",R),v===E.MessageBoards.ARTICHOKE?(M=R.substr(0,20),A.sceneMessageBus.emit("artichokeMessage",{text:M})):v===E.MessageBoards.TOWER&&(log("new message from tower"),M=R.substr(0,37),A.sceneMessageBus.emit("towerMessage",{text:M})),O=A.fireBaseServer+"addmessage/?location="+v+"&message="+M,log("new message ",O),fetch(O,{method:"POST"}),E.serverChecker.messageTimer=E.serverChecker.totalMessageTime}catch(v){log("error sending to firebase server")}return[2]}))}))},A.getLastMessage=getLastMessage,A.updateMessageBoards=updateMessageBoards;var O=null;function getMarketData(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(E){switch(E.label){case 0:return E.trys.push([0,3,,4]),v=A.awsServer+"market/marketData.json",[4,fetch(v).then()];case 1:return[4,E.sent().json()];case 2:return[2,E.sent()];case 3:return E.sent(),log("error fetching from AWS server"),[3,4];case 4:return[2]}}))}))}A.updateMarketData=function(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(A){switch(A.label){case 0:return[4,getMarketData()];case 1:return(v=A.sent())===O||(O=v,log("MARKET DATA: ",O),(0,R.updateTradeCentrer)(O)),[2]}}))}))},A.getMarketData=getMarketData})),define("src/modules/interactiveItems/sound",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.Sound=void 0;var E=function(v){function Sound(A,E,R){void 0===E&&(E=!1);var M=v.call(this)||this;return engine.addEntity(M),M.addComponent(new AudioSource(A)),M.getComponent(AudioSource).loop=E,M.addComponent(new Transform),R?M.getComponent(Transform).position=R:M.setParent(Attachable.AVATAR),M}return __extends(Sound,v),Sound.prototype.playAudioOnceAtPosition=function(v){this.getComponent(Transform).position=v,this.getComponent(AudioSource).playOnce()},Sound.prototype.playAudioAtPosition=function(v){this.getComponent(Transform).position=v,this.getComponent(AudioSource).playing=!0},Sound}(Entity);A.Sound=E})),define("src/modules/interactiveItems/player",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.Player=void 0;var E=function(){function Player(){}return Player.holdingItem=!1,Player}();A.Player=E})),define("src/modules/interactiveItems/barItem",["require","exports","src/modules/interactiveItems/sound","src/modules/interactiveItems/player","@dcl/ecs-scene-utils","src/modules/interactiveItems"],(function(v,A,E,R,M,O){Object.defineProperty(A,"__esModule",{value:!0}),A.barItems=A.BarItem=A.putDownSound=A.pickUpSound=void 0,A.pickUpSound=new E.Sound(new AudioClip("sounds/interactiveItems/pickUp.mp3")),A.putDownSound=new E.Sound(new AudioClip("sounds/interactiveItems/putDown.mp3"));var V=function(v){function BarItem(A,E,M,O,V){var z=v.call(this)||this;return z.holdPosition=O,z.rotatePosition=V,engine.addEntity(z),z.addComponent(E),z.addComponent(new Transform({position:M})),z.getComponent(Transform).scale.setAll(1.25),z.addComponent(new OnPointerDown((function(v){R.Player.holdingItem||z.pickup(A)}),{button:ActionButton.PRIMARY,showFeedback:!0,hoverText:"pick up"})),z}return __extends(BarItem,v),BarItem.prototype.pickup=function(v){A.pickUpSound.getComponent(AudioSource).playOnce(),this.setParent(Attachable.FIRST_PERSON_CAMERA),this.getComponent(Transform).rotate(Vector3.Right(),this.rotatePosition),this.addComponentOrReplace(new M.Delay(100,(function(){R.Player.holdingItem=!0}))),O.sceneMessageBus.emit("ItemPickedUp",{id:v,position:this.holdPosition})},BarItem.prototype.putDown=function(v,E){this.setParent(null),A.putDownSound.getComponent(AudioSource).playOnce(),R.Player.holdingItem=!1,O.sceneMessageBus.emit("ItemPutDown",{id:v,position:E})},BarItem}(Entity);A.BarItem=V,O.sceneMessageBus.on("ItemPickedUp",(function(v){A.barItems[v.id].getComponent(Transform).position.set(v.position.x,v.position.y,v.position.z)})),O.sceneMessageBus.on("ItemPutDown",(function(v){A.barItems[v.id].getComponent(Transform).rotation.set(0,0,0,1),A.barItems[v.id].getComponent(Transform).position.set(v.position.x,v.position.y,v.position.z)}));var z=new V(0,new GLTFShape("models/core_building/interactiveItems/Bottle_02.glb"),new Vector3(144.3,1.02,163.2),new Vector3(0,-.475,.5),0),W=new V(1,new GLTFShape("models/core_building/interactiveItems/Bottle_06.glb"),new Vector3(176.25,1.02,163.73),new Vector3(0,-.475,.5),0),H=new V(2,new GLTFShape("models/core_building/interactiveItems/Bottle_08.glb"),new Vector3(173.8,1.02,137.71),new Vector3(0,-.475,.5),0),X=new V(3,new GLTFShape("models/core_building/interactiveItems/Bottle_10.glb"),new Vector3(146.08,1.14,137.37),new Vector3(0,-.475,.5),0),K=new V(4,new GLTFShape("models/core_building/interactiveItems/cup_02.glb"),new Vector3(167.74,1.275,159.87),new Vector3(0,-.22,.525),-20),Z=new V(5,new GLTFShape("models/core_building/interactiveItems/cup_02.glb"),new Vector3(166.39,1.275,158.8),new Vector3(0,-.22,.525),-20),J=new V(6,new GLTFShape("models/core_building/interactiveItems/glass_01.glb"),new Vector3(179.61,11.76,143.1),new Vector3(0,-.275,.5),-10),$=new V(7,new GLTFShape("models/core_building/interactiveItems/glass_02.glb"),new Vector3(179.26,11.76,150.29),new Vector3(0,-.275,.5),-10),ee=new V(8,new GLTFShape("models/core_building/interactiveItems/glass_03.glb"),new Vector3(179.4,11.76,158.83),new Vector3(0,-.35,.5),-10),ne=new V(9,new GLTFShape("models/core_building/interactiveItems/glass_04.glb"),new Vector3(141.24,11.76,158.97),new Vector3(0,-.35,.5),-10),oe=new V(10,new GLTFShape("models/core_building/interactiveItems/glass_05.glb"),new Vector3(139.99,11.72,143.46),new Vector3(0,-.35,.5),-10);A.barItems=[z,W,H,X,K,Z,J,$,ee,ne,oe]})),define("src/modules/bar/rarestWearable",["require","exports","@decentraland/EnvironmentAPI","@decentraland/Identity"],(function(v,A,E,R){Object.defineProperty(A,"__esModule",{value:!0}),A.Type=A.BodyShape=A.Rarity=A.Code=A.Category=A.rarityLevel=A.getPlayerSnapshots=A.updateRarity=A.rarestItem=A.getUserInventory=A.getUserInfo=A.setRealm=A.setUserData=A.fetchUserData=A.playerRealm=A.userData=void 0;var M,O,V,z,W,H=0;function setUserData(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(E){switch(E.label){case 0:return[4,(0,R.getUserData)()];case 1:return(v=E.sent())&&(log(v.displayName),A.userData=v,A.userData.userId=A.userData.userId.toLocaleLowerCase()),[2]}}))}))}function setRealm(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(R){switch(R.label){case 0:return[4,(0,E.getCurrentRealm)()];case 1:return(v=R.sent())&&(log("You are in the realm: ".concat(JSON.stringify(v.displayName))),A.playerRealm=v,"http://127.0.0.1:8000"!==v.domain&&"http://192.168.0.18:8000"!==v.domain||(v.domain="https://peer.decentraland.org",log("CHANGED REALM TO: ",v.domain))),[2]}}))}))}function getUserInfo(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return[4,fetch("".concat(A.playerRealm.domain,"/content/entities/profiles?pointer=").concat(A.userData.userId)).then((function(v){return v.json()})).then((function(v){return v.length?v[0]:v}))];case 1:return[2,v.sent()]}}))}))}function getUserInventory(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return log("".concat(A.playerRealm.domain,"/lambdas/collections/wearables-by-owner/").concat(A.userData.userId,"?includeDefinitions")),[4,fetch("".concat(A.playerRealm.domain,"/lambdas/collections/wearables-by-owner/").concat(A.userData.userId,"?includeDefinitions"))];case 1:return[4,v.sent().json()];case 2:return[2,v.sent()]}}))}))}function updateRarity(v){var A=0;switch(v){case"common":A=1;break;case"uncommon":A=2;break;case"rare":A=3;break;case"epic":A=4;break;case"legendary":A=5;break;case"mythic":A=6;break;case"unique":A=7;break;default:A=0}A>H&&(H=A)}function mapToUrn(v){if(v.indexOf("dcl://")<0)return v;var A=__read(v.replace("dcl://","").split("/"),2),E=A[0],R=A[1];return"base-avatars"===E?"urn:decentraland:off-chain:base-avatars:".concat(R):"urn:decentraland:ethereum:collections-v1:".concat(E,":").concat(R)}A.fetchUserData=function(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(A){switch(A.label){case 0:return[4,(0,R.getUserData)()];case 1:return(v=A.sent())&&log(v.displayName),[2,v]}}))}))},A.setUserData=setUserData,A.setRealm=setRealm,A.getUserInfo=getUserInfo,A.getUserInventory=getUserInventory,A.rarestItem=function(v){var E,R,O;return void 0===v&&(v=!1),__awaiter(this,void 0,void 0,(function(){var V,z,W,X,K,Z,J,$,ee,ne,oe,ie,ae,se,le,ce,ue;return __generator(this,(function(de){switch(de.label){case 0:return A.userData?[3,2]:[4,setUserData()];case 1:de.sent(),de.label=2;case 2:return A.playerRealm?[3,4]:[4,setRealm()];case 3:de.sent(),de.label=4;case 4:return A.userData.hasConnectedWeb3?[4,getUserInfo()]:[2,M.none];case 5:return V=de.sent(),[4,getUserInventory()];case 6:if(z=de.sent(),!V||!z)return[2,M.none];if(v){W=null===(O=null===(R=null===(E=V.metadata.avatars[0])||void 0===E?void 0:E.avatar)||void 0===R?void 0:R.wearables)||void 0===O?void 0:O.map(mapToUrn);try{for(X=__values(W),K=X.next();!K.done;K=X.next()){Z=K.value;try{for(se=void 0,J=__values(z),$=J.next();!$.done;$=J.next())oe=$.value,Z===oe.definition.id&&oe.definition.rarity&&(updateRarity(oe.definition.rarity),log("ONE ITEM OF RARITY ",oe.definition.rarity))}catch(v){se={error:v}}finally{try{$&&!$.done&&(le=J.return)&&le.call(J)}finally{if(se)throw se.error}}}}catch(v){ie={error:v}}finally{try{K&&!K.done&&(ae=X.return)&&ae.call(X)}finally{if(ie)throw ie.error}}}else try{for(ee=__values(z),ne=ee.next();!ne.done;ne=ee.next())(oe=ne.value).definition.rarity&&updateRarity(oe.definition.rarity)}catch(v){ce={error:v}}finally{try{ne&&!ne.done&&(ue=ee.return)&&ue.call(ee)}finally{if(ce)throw ce.error}}return[2,H]}}))}))},A.updateRarity=updateRarity,A.getPlayerSnapshots=function(v){return __awaiter(this,void 0,void 0,(function(){var A,R;return __generator(this,(function(M){switch(M.label){case 0:return v?[3,2]:[4,getUserInfo()];case 1:A=M.sent(),v=A.id,M.label=2;case 2:return[4,(0,E.getCurrentRealm)().then((function(v){return"http://127.0.0.1:8000"!=v.domain?v.domain:"https://peer.decentraland.org"}))];case 3:return R=M.sent(),[4,fetch("".concat(R,"/lambdas/profiles?field=snapshots&id=").concat(v.toLowerCase())).then((function(v){return v.json()})).then((function(v){return v[0].avatars.length?v[0].avatars[0].avatar.snapshots:null}))];case 4:return[2,M.sent()]}}))}))},function(v){v[v.none=0]="none",v[v.common=1]="common",v[v.uncommon=2]="uncommon",v[v.rare=3]="rare",v[v.epic=4]="epic",v[v.legendary=5]="legendary",v[v.mythic=6]="mythic",v[v.unique=7]="unique"}(M=A.rarityLevel||(A.rarityLevel={})),(W=A.Category||(A.Category={})).BodyShape="body_shape",W.Earring="earring",W.Empty="",W.Eyebrows="eyebrows",W.Eyes="eyes",W.Eyewear="eyewear",W.FacialHair="facial_hair",W.Feet="feet",W.Hair="hair",W.Hat="hat",W.Head="head",W.Helmet="helmet",W.LowerBody="lower_body",W.Mask="mask",W.Mouth="mouth",W.Tiara="tiara",W.TopHead="top_head",W.UpperBody="upper_body",(z=A.Code||(A.Code={})).En="en",z.Es="es",(V=A.Rarity||(A.Rarity={})).Unique="unique",V.Mythic="mythic",V.Legendary="legendary",V.Epic="epic",V.Rare="rare",V.Uncommon="uncommon",V.Common="common",(O=A.BodyShape||(A.BodyShape={})).Basefemale="Basefemale",O.DCLBaseAvatarsBaseFemale="dcl://base-avatars/BaseFemale",O.DCLBaseAvatarsBaseMale="dcl://base-avatars/BaseMale",(A.Type||(A.Type={})).Wearable="wearable"})),define("src/modules/pointerArrow",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.PointerArrow=void 0;var E=function(v){function PointerArrow(A,E){var R=v.call(this)||this;return R.defaultPosition=new Vector3,R.defaultRotation=new Quaternion,R.defaultScale=new Vector3,R.addComponent(new GLTFShape("models/Arrow.glb")),R.addComponent(new Transform(A)),engine.addEntity(R),R.setParent(E),R.defaultRotation=R.getComponent(Transform).rotation.clone(),R.defaultPosition=R.getComponent(Transform).position.clone(),R.defaultScale=R.getComponent(Transform).scale.clone(),R}return __extends(PointerArrow,v),PointerArrow.prototype.show=function(){this.getComponent(GLTFShape).visible=!0},PointerArrow.prototype.hide=function(){this.getComponent(GLTFShape).visible=!1},PointerArrow.prototype.move=function(v,A,E,R){this.setParent(v),this.getComponent(GLTFShape).visible=!0,this.getComponent(Transform).rotation=A?Quaternion.Euler(A.x,A.y,A.z):this.defaultRotation,this.getComponent(Transform).position=E||this.defaultPosition,this.getComponent(Transform).scale=R||this.defaultScale},PointerArrow}(Entity);A.PointerArrow=E})),define("src/quests",["require","exports","@dcl/ecs-quests","@dcl/quests-query","dcl-quests-client/quests-client-amd","src/modules/bar/barNPCs","src/modules/pointerArrow"],(function(v,A,E,R,M,O,V){var z;Object.defineProperty(A,"__esModule",{value:!0}),A.updateQuests=A.handleQuests=A.arrow=A.questProg=A.client=A.taskIds=void 0,function(v){v.intro="e173239d-13dd-48bb-9332-b30472e7941a",v.forestHerb="fca9b784-bfd7-453c-b51e-34dbb36415e7",v.medievalHerb="bee981f6-53b9-4f60-b7c7-3578a325f4fb",v.asianHerb="8c2c4f32-590c-43ca-ba9c-03768065461a",v.bringHerbs="e24cee0f-def6-4952-afbd-b14ed8b2facf",v.catHair="812b968f-806d-4194-86ef-35edbd6d7712",v.bringHair="5bd92fc0-2c7b-47b1-95ef-66dd34b3b52d",v.talkChaman="285c92a6-84b8-4a68-a083-c8737c89d17a",v.gems="58e29d3b-bf6e-416b-bb77-35756120ab9c",v.placeGems="ae33a6b2-f4d2-48f6-bed6-406a8873b556",v.caliz="d142506e-84da-4955-8e56-a3e0fa5ae4b5",v.outro="cb67b6df-990c-4bcf-82b9-175126f7a302"}(z=A.taskIds||(A.taskIds={})),A.handleQuests=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return A.client?[2]:[4,new E.RemoteQuestTracker("18d80de8-9367-4cf1-9eda-de3513dc316d")];case 1:return A.client=v.sent(),[4,A.client.getCurrentStatePromise()];case 2:return A.questProg=v.sent(),log("QUEST ",A.questProg),A.questProg.progressStatus!=M.ProgressStatus.COMPLETED&&(!(0,R.query)(A.questProg).isTaskCompleted(z.intro)||!(0,R.query)(A.questProg).isTaskCompleted(z.bringHair)&&(0,R.query)(A.questProg).isTaskCompleted(z.catHair)||!(0,R.query)(A.questProg).isTaskCompleted(z.bringHerbs)&&(0,R.query)(A.questProg).isTaskCompleted(z.asianHerb)&&(0,R.query)(A.questProg).isTaskCompleted(z.forestHerb)&&(0,R.query)(A.questProg).isTaskCompleted(z.medievalHerb)||(0,R.query)(A.questProg).isTaskCompleted(z.caliz)&&!(0,R.query)(A.questProg).isTaskCompleted(z.outro)?A.arrow=new V.PointerArrow({position:new Vector3(-.5,2.5,-.3),scale:new Vector3(1.5,1.5,1.5)},O.octopus):(0,R.query)(A.questProg).isTaskCompleted(z.intro)&&!(0,R.query)(A.questProg).isTaskCompleted(z.bringHair)&&(A.arrow=new V.PointerArrow({position:new Vector3(0,1.5,0),scale:new Vector3(1.5,1.5,1.5)},O.catGuy))),[2]}}))}))},A.updateQuests=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return[4,A.client.getCurrentStatePromise()];case 1:return A.questProg=v.sent(),[2]}}))}))}})),define("src/modules/interactiveItems/calis",["require","exports","@dcl/ecs-scene-utils","@dcl/ui-scene-utils","src/modules/interactiveItems/player","src/modules/interactiveItems/barItem","@decentraland/RestrictedActions","src/modules/bar/barNPCs"],(function(v,A,E,R,M,O,V,z){var W;Object.defineProperty(A,"__esModule",{value:!0}),A.Danceystem=A.Calis1=A.Calis=A.CalisBaseState=void 0,function(v){v.EMPTY="empty",v.FULL="full"}(W=A.CalisBaseState||(A.CalisBaseState={}));var H=function(v){function Calis(A,E,R,M,O){var V=v.call(this)||this;return V.id=A,V.holdPosition=M,V.rotatePosition=O,V.calisBaseState=W.FULL,engine.addEntity(V),V.addComponent(E),V.addComponent(new Transform({position:R})),V.addComponent(new AudioSource(new AudioClip("sounds/drink.mp3"))),V}return __extends(Calis,v),Calis.prototype.pickup=function(v){var A=this;this.setParent(null),O.pickUpSound.getComponent(AudioSource).playOnce(),this.setParent(Attachable.FIRST_PERSON_CAMERA),this.getComponent(Transform).rotate(Vector3.Right(),this.rotatePosition),this.addComponentOrReplace(new E.Delay(100,(function(){M.Player.holdingItem=!0}))),this.getComponent(Transform).position.set(this.holdPosition.x,this.holdPosition.y,this.holdPosition.z),this.danceSystem||Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(E){A.drink(),v()}))},Calis.prototype.putDown=function(v,A){this.setParent(null),O.putDownSound.getComponent(AudioSource).playOnce(),M.Player.holdingItem=!1,this.getComponent(Transform).rotation.set(0,0,0,1),this.getComponent(Transform).position.set(v.x,v.y,v.z)},Calis.prototype.drink=function(){var v=this;this.getComponent(AudioSource).playOnce(),(0,z.octoTrip)(),this.danceSystem||E.setTimeout(1e3,(function(){v.danceSystem=new K,engine.addSystem(v.danceSystem)}))},Calis}(Entity);A.Calis=H;var X=new GLTFShape("models/core_building/interactiveItems/calisFull.glb");A.Calis1=new H(0,X,new Vector3(163,-8,139),new Vector3(0,-.5,.65),-10);var K=function(){function Danceystem(){this.timer=0,this.sintime=0,this.interval=11,this.pinkYpos=0}return Danceystem.prototype.update=function(v){this.timer+=v,this.sintime+=v,this.pinkYpos=150-100*Math.sin(this.sintime),this.pink.positionY=this.pinkYpos,this.timer>=this.interval&&(this.timer=0,(0,V.triggerEmote)({predefined:"hammer"}))},Danceystem.prototype.activate=function(){var v=R.canvas;v.visible=!1;var A=new Texture("images/ui/pink4.png",{hasAlpha:!0});this.pink=new UIImage(v,A),this.pink.isPointerBlocker=!1,this.pink.width="100%",this.pink.height=800,this.pink.positionY=100,this.pink.hAlign="center",this.pink.vAlign="center",this.pink.sourceWidth=32,this.pink.sourceHeight=800,v.visible=!0,(0,V.triggerEmote)({predefined:"hammer"})},Danceystem}();A.Danceystem=K})),define("src/lobby/resources/globals",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.lobbyRadius=A.lobbyHeight=A.lobbyCenter=void 0,A.lobbyCenter=new Vector3(160,0,150.22),A.lobbyHeight=104.73,A.lobbyRadius=14.8})),define("src/modules/triggerBox",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.TriggerBox=void 0;var E=new Material;E.albedoColor=Color4.FromHexString("66000066"),E.transparencyMode=2;var R=function(v){function TriggerBox(A,E,R){var M=v.call(this)||this;return M.active=!0,M.sizeX=1,M.sizeY=1,M.sizeZ=1,M.visible=!1,M.position=new Vector3,M.areaXMin=0,M.areaXMax=0,M.areaYMin=0,M.areaYMax=0,M.areaZMin=0,M.areaZMax=0,M.callback=R,M.position.copyFrom(A),M.sizeX=E.x,M.sizeY=E.y,M.sizeZ=E.z,M.areaXMin=A.x-M.sizeX/2,M.areaXMax=A.x+M.sizeX/2,M.areaYMin=A.y,M.areaYMax=A.y+M.sizeY,M.areaZMin=A.z-M.sizeZ/2,M.areaZMax=A.z+M.sizeZ/2,M.addComponent(new Transform({position:A,scale:new Vector3(M.sizeX,M.sizeY,M.sizeZ)})),M}return __extends(TriggerBox,v),TriggerBox.prototype.updatePosition=function(){this.position.copyFrom(this.getComponent(Transform).position),this.areaXMin=this.position.x-this.sizeX/2,this.areaXMax=this.position.x+this.sizeX/2,this.areaYMin=this.position.y,this.areaYMax=this.position.y+this.sizeY,this.areaZMin=this.position.z-this.sizeZ/2,this.areaZMax=this.position.z+this.sizeZ/2},TriggerBox.prototype.collide=function(v,A){return this.getComponent(Transform).position,v.x>this.areaXMin&&v.x<this.areaXMax&&v.y>this.areaYMin&&v.y<this.areaYMax&&v.z>this.areaZMin&&v.z<this.areaZMax&&(A||this.fire(),!0)},TriggerBox.prototype.fire=function(){this.active&&this.callback()},TriggerBox}(Entity);A.TriggerBox=R})),define("src/modules/player",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.player=A.PlayerState=void 0;var PlayerState=function(){this.camera=Camera.instance,this.feetPos=Camera.instance.feetPosition,this.headPos=Camera.instance.position};A.PlayerState=PlayerState,A.player=new PlayerState})),define("src/lobby/resources/resources",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.dateUIBGMaterial=A.dateDayColor=A.dateMonthColor=A.dateBGColor=A.divingSignShape=A.vortex2Shape=A.vortex1Shape=A.cloudBigShape=A.cloudSmall2Shape=A.cloudSmallShape=A.cloudPuffShape=A.cloudDissolveShape=A.loadMoreShape=A.refreshShape=A.playerCounterBGShape=A.scrollInstructionShape=A.timePanelShape=A.liveSignShape=A.menuTitleBGShape=A.coordsPanelShape=A.readMoreBtnShape=A.highlightRaysShape=A.highlightFrameShape=A.detailsBGShape=A.jumpInButtonShape=A.shelfShape=A.dateBGShape=A.menuTopClassicsShape=A.menuTopCrowdShape=A.menuTopEventsShape=A.menuBaseShape=A.menuPillarsShape=A.beamShape=A.portalSpiralShape=A.twitterShape=A.discordShape=A.beamUIBG=A.dummySceneBG=A.roundedSquareAlpha=void 0;var E="models/lobby/";A.roundedSquareAlpha=new Texture("images/rounded_alpha_square.png"),A.dummySceneBG=new Texture("images/dummy_scene.png"),A.beamUIBG=new Texture("images/ui_beam_up_bg.png"),A.discordShape=new GLTFShape(E+"icons/discord.glb"),A.twitterShape=new GLTFShape(E+"icons/twitter.glb"),A.portalSpiralShape=new GLTFShape(E+"portal_lift_spiral.glb"),A.beamShape=new GLTFShape(E+"beam.glb"),A.menuPillarsShape=new GLTFShape(E+"menu_pillars.glb"),A.menuBaseShape=new GLTFShape(E+"menu_base.glb"),A.menuTopEventsShape=new GLTFShape(E+"menu_top_events.glb"),A.menuTopCrowdShape=new GLTFShape(E+"menu_top_crowd.glb"),A.menuTopClassicsShape=new GLTFShape(E+"menu_top_classics.glb"),A.dateBGShape=new GLTFShape(E+"date_bg.glb"),A.shelfShape=new GLTFShape(E+"shelf_clickable.glb"),A.jumpInButtonShape=new GLTFShape(E+"jump_in_btn.glb"),A.detailsBGShape=new GLTFShape(E+"details_bg.glb"),A.highlightFrameShape=new GLTFShape(E+"highlight_frame.glb"),A.highlightRaysShape=new GLTFShape(E+"highlight_rays.glb"),A.readMoreBtnShape=new GLTFShape(E+"read_more_btn.glb"),A.coordsPanelShape=new GLTFShape(E+"coords_panel.glb"),A.menuTitleBGShape=new GLTFShape(E+"menu_title_bg.glb"),A.liveSignShape=new GLTFShape(E+"live_bg.glb"),A.timePanelShape=new GLTFShape(E+"time_panel.glb"),A.scrollInstructionShape=new GLTFShape(E+"scroll_instructions.glb"),A.playerCounterBGShape=new GLTFShape(E+"player_counter_bg.glb"),A.refreshShape=new GLTFShape(E+"refresh_button.glb"),A.loadMoreShape=new GLTFShape(E+"load_more_btn.glb"),A.cloudDissolveShape=new GLTFShape(E+"cloud_dissolve.glb"),A.cloudPuffShape=new GLTFShape(E+"cloud_puff.glb"),A.cloudSmallShape=new GLTFShape(E+"clouds_small.glb"),A.cloudSmall2Shape=new GLTFShape(E+"clouds_small2.glb"),A.cloudBigShape=new GLTFShape(E+"clouds_big.glb"),A.vortex1Shape=new GLTFShape(E+"vortex1.glb"),A.vortex2Shape=new GLTFShape(E+"vortex2.glb"),A.divingSignShape=new GLTFShape(E+"diving_sign.glb"),A.dateBGColor=Color3.FromHexString("#cdcdcd"),A.dateMonthColor=Color3.FromHexString("#ff3333"),A.dateDayColor=Color3.FromHexString("#000000"),A.dateUIBGMaterial=new Material,A.dateUIBGMaterial.albedoColor=A.dateBGColor,A.dateUIBGMaterial.alphaTexture=A.roundedSquareAlpha,A.dateUIBGMaterial.transparencyMode=2,A.dateUIBGMaterial.metallic=0,A.dateUIBGMaterial.roughness=1,A.dateUIBGMaterial.specularIntensity=0})),define("src/lobby/resources/sounds",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.impactHardSource=A.beamFallSource=A.beamFireSource=A.beamChargeSource=A.menuErrorSource=A.refreshSource=A.menuDeselectSource=A.menuSelectSource=A.menuScrollEndSource=A.menuDownSource=A.menuUpSource=A.lobbyAmbienceSource=A.lobbyMusicSource=void 0;var E=new AudioClip("sounds/lobby_music.mp3");A.lobbyMusicSource=new AudioSource(E),A.lobbyMusicSource.volume=.2;var R=new AudioClip("sounds/lobby_ambience.mp3");A.lobbyAmbienceSource=new AudioSource(R),A.lobbyAmbienceSource.volume=1;var M=new AudioClip("sounds/menu_woosh_up.mp3");A.menuUpSource=new AudioSource(M),A.menuUpSource.volume=1;var O=new AudioClip("sounds/menu_woosh.mp3");A.menuDownSource=new AudioSource(O),A.menuDownSource.volume=1;var V=new AudioClip("sounds/menu_scroll_end.mp3");A.menuScrollEndSource=new AudioSource(V),A.menuScrollEndSource.volume=1;var z=new AudioClip("sounds/menu_select.mp3");A.menuSelectSource=new AudioSource(z),A.menuSelectSource.volume=1;var W=new AudioClip("sounds/menu_deselect.mp3");A.menuDeselectSource=new AudioSource(W),A.menuDeselectSource.volume=1;var H=new AudioClip("sounds/refresh.mp3");A.refreshSource=new AudioSource(H),A.refreshSource.volume=1;var X=new AudioClip("sounds/menu_error.mp3");A.menuErrorSource=new AudioSource(X),A.menuErrorSource.volume=.8;var K=new AudioClip("sounds/beam_charge.mp3");A.beamChargeSource=new AudioSource(K),A.beamChargeSource.volume=.5;var Z=new AudioClip("sounds/beam_fire.mp3");A.beamFireSource=new AudioSource(Z),A.beamFireSource.volume=.5;var J=new AudioClip("sounds/beam_fall.mp3");A.beamFallSource=new AudioSource(J),A.beamFallSource.volume=3;var $=new AudioClip("sounds/impact_hard.mp3");A.impactHardSource=new AudioSource($),A.impactHardSource.volume=.3})),define("src/lobby/portalBeam",["require","exports","src/modules/triggerBox","src/modules/player","@decentraland/RestrictedActions","src/lobby/resources/globals","src/modules/ui","src/lobby/resources/resources","src/lobby/resources/sounds","src/modules/tutorialHandler","src/modules/bar/jukebox"],(function(v,A,E,R,M,O,V,z,W,H,X){Object.defineProperty(A,"__esModule",{value:!0}),A.TeleportController=A.tutorialRunning=A.DelayedTriggerBox=void 0;var K=function(){function DelayedTriggerBox(v){this.delay=2,this.elapsed=0,this.delay=v}return __decorate([Component("DelayedTriggerBox")],DelayedTriggerBox)}();A.DelayedTriggerBox=K;var Z=new Entity;Z.addComponent(W.lobbyAmbienceSource),Z.addComponent(new Transform({position:new Vector3(O.lobbyCenter.x,O.lobbyHeight,O.lobbyCenter.z)})),W.lobbyAmbienceSource.loop=!0,W.lobbyAmbienceSource.playing=!0,engine.addEntity(Z);var J=new Entity;J.addComponent(new Transform({position:new Vector3(0,2,0)})),J.addComponent(W.lobbyMusicSource),W.lobbyMusicSource.loop=!0,W.lobbyMusicSource.playing=!0,engine.addEntity(J),J.setParent(Attachable.AVATAR),H.tutorialEnableObservable.add((function(v){v?(W.lobbyMusicSource.playing=!1,A.tutorialRunning=!0):(A.tutorialRunning=!1,R.player.camera.position.y>30?W.lobbyMusicSource.playing=!0:X.isInBar&&(0,X.setBarMusicOn)()),W.lobbyMusicSource.playing=!v})),A.tutorialRunning=!1;var $=new Entity;$.addComponent(new Transform({position:new Vector3(O.lobbyCenter.x,O.lobbyCenter.y,O.lobbyCenter.z)})),$.addComponent(z.beamShape),engine.addEntity($);var ee=function(){function TeleportController(){var v=this;this.triggers=[],this.delayedTriggers=[],this.triggerBoxUp=new E.TriggerBox(new Vector3(O.lobbyCenter.x,O.lobbyCenter.y,O.lobbyCenter.z),new Vector3(6,4.5,6),(function(){(0,M.movePlayerTo)({x:O.lobbyCenter.x+5,y:140,z:O.lobbyCenter.z-10},{x:O.lobbyCenter.x,y:80,z:O.lobbyCenter.z}),A.tutorialRunning||(W.lobbyMusicSource.playing=!0),W.lobbyAmbienceSource.playing=!0,v.triggerBoxFallCheck.active=!0})),this.triggerBoxUp.addComponent(new K(3)),engine.addEntity(this.triggerBoxUp),this.triggerBoxDown=new E.TriggerBox(new Vector3(O.lobbyCenter.x,O.lobbyCenter.y+8,O.lobbyCenter.z),new Vector3(6,6,6),(function(){(0,M.movePlayerTo)({x:O.lobbyCenter.x-5,y:0,z:O.lobbyCenter.z+2},{x:O.lobbyCenter.x,y:2,z:O.lobbyCenter.z-12}),W.lobbyMusicSource.playing=!1,W.lobbyAmbienceSource.playing=!1,v.impactSound.getComponent(AudioSource).playOnce()})),engine.addEntity(this.triggerBoxDown),this.triggerBoxFallCheck=new E.TriggerBox(new Vector3(O.lobbyCenter.x,O.lobbyCenter.y+90,O.lobbyCenter.z),new Vector3(6,10,6),(function(){W.lobbyMusicSource.playing=!1,W.lobbyAmbienceSource.playing=!1,v.beamFallSound.getComponent(AudioSource).playOnce(),v.triggerBoxFallCheck.active=!1})),engine.addEntity(this.triggerBoxFallCheck),this.delayedTriggers.push(this.triggerBoxUp),this.triggers.push(this.triggerBoxDown),this.triggers.push(this.triggerBoxFallCheck),this.portalLiftSpiral=new Entity,this.portalLiftSpiral.addComponent(new Transform({position:new Vector3(O.lobbyCenter.x,O.lobbyCenter.y,O.lobbyCenter.z),scale:new Vector3(1,0,1)})),this.portalLiftSpiral.addComponent(z.portalSpiralShape),this.portalLiftSpiral.addComponent(W.beamChargeSource),engine.addEntity(this.portalLiftSpiral),this.portalSys=new ne(this),engine.addSystem(this.portalSys),this.beamFireSound=new Entity,this.beamFireSound.addComponent(new Transform({position:new Vector3(0,1,0)})),this.beamFireSound.addComponent(W.beamFireSource),engine.addEntity(this.beamFireSound),this.beamFireSound.setParent(Attachable.AVATAR),this.beamFallSound=new Entity,this.beamFallSound.addComponent(new Transform({position:new Vector3(0,4,0)})),this.beamFallSound.addComponent(W.beamFallSource),engine.addEntity(this.beamFallSound),this.beamFallSound.setParent(Attachable.AVATAR),this.impactSound=new Entity,this.impactSound.addComponent(new Transform({position:new Vector3(0,1,0)})),this.impactSound.addComponent(W.impactHardSource),engine.addEntity(this.impactSound),this.impactSound.setParent(Attachable.AVATAR)}return TeleportController.prototype.showTeleport=function(){this.triggerBoxUp.getComponent(Transform).position.y=O.lobbyCenter.y,this.triggerBoxUp.updatePosition()},TeleportController.prototype.hideTeleport=function(){this.triggerBoxUp.getComponent(Transform).position.y=O.lobbyCenter.y-10,this.triggerBoxUp.updatePosition()},TeleportController.prototype.collideSimple=function(){for(var v=0;v<this.triggers.length;v++)this.triggers[v].collide(R.player.feetPos)},TeleportController.prototype.collideDelayed=function(v){for(var A=this.portalLiftSpiral.getComponent(Transform),E=0;E<this.delayedTriggers.length;E++)if(this.delayedTriggers[E].collide(R.player.feetPos,!0)){var M=this.delayedTriggers[E].getComponent(K);M.elapsed+=v,(0,V.showTeleportUI)(!0);var z=M.delay-M.elapsed+1;z<1&&(z=1),(0,V.setTeleportCountdown)(z.toFixed(0)),A.scale.y+=v/M.delay,A.position.y+=.9*v,this.portalLiftSpiral.getComponent(AudioSource).playing||this.portalLiftSpiral.getComponent(AudioSource).playOnce(),M.elapsed>M.delay&&(this.delayedTriggers[E].fire(),this.portalLiftSpiral.getComponent(AudioSource).playing=!1,this.beamFireSound.getComponent(AudioSource).playOnce(),M.elapsed=0,A.scale.y=0,A.position.y=O.lobbyCenter.y)}else this.delayedTriggers[E].getComponent(K).elapsed=0,(0,V.showTeleportUI)(!1),(0,V.setTeleportCountdown)("0"),A.scale.y=0,A.position.y=O.lobbyCenter.y,this.portalLiftSpiral.getComponent(AudioSource).playing=!1},TeleportController}();A.TeleportController=ee;var ne=function(){function PortalCheckSystem(v){this.teleportControl=v}return PortalCheckSystem.prototype.update=function(v){this.teleportControl.collideDelayed(v),this.teleportControl.collideSimple()},PortalCheckSystem}()})),define("src/modules/bar/jukebox",["require","exports","src/modules/serverHandler","@dcl/ecs-scene-utils","src/modules/museumItems","src/modules/bar/barNPCs","src/lobby/portalBeam"],(function(v,A,E,R,M,O,V){var z;Object.defineProperty(A,"__esModule",{value:!0}),A.addMicFeedback=A.setStreamVolume=A.raiseVolume=A.lowerVolume=A.setBarMusicOff=A.intoBar=A.outOfBar=A.setBarMusicOn=A.JukeboxButton=A.placeJukeBox=A.barMusicStream=A.isInBar=A.Radios=void 0,function(v){v.RAVE="https://icecast.ravepartyradio.org/ravepartyradio-192.mp3",v.DELTA="https://cdn.instream.audio/:9069/stream?_=171cd6c2b6e",v.GRAFFITI="https://n07.radiojar.com/2qm1fc5kb.m4a?1617129761=&rj-tok=AAABeIR7VqwAilDFeUM39SDjmw&rj-ttl=5",v.SIGNS="https://edge.singsingmusic.net/MC2.mp3",v.JAZZ="https://live.vegascity.fm/radio/8010/the_flamingos.mp3"}(z=A.Radios||(A.Radios={}));var W=.1;A.isInBar=!1;var H=z.RAVE,X=0,K=!0,Z=new Entity;engine.addEntity(Z),A.barMusicStream=null;var J=new Entity,$=new Entity,ee=new Entity;A.placeJukeBox=function(){A.barMusicStream=new AudioStream(H),A.barMusicStream.volume=W,A.barMusicStream.playing=!1,J.addComponent(new GLTFShape("models/core_building/jukebox/Jukebox_Base.glb")),J.addComponent(new Transform({position:new Vector3(179,0,144),rotation:Quaternion.Euler(0,-45,0),scale:new Vector3(.75,.75,.75)})),engine.addEntity(J),$.addComponent(new GLTFShape("models/core_building/jukebox/Lights_01.glb")),$.getComponent(GLTFShape).visible=!1,$.addComponent(new Transform({})),$.setParent(J),engine.addEntity($),ee.addComponent(new GLTFShape("models/core_building/jukebox/Lights_02.glb")),ee.getComponent(GLTFShape).visible=!1,ee.addComponent(new Transform({})),ee.setParent(J),engine.addEntity(ee);var v=new Entity,R=new TextShape("Radio:\nRave Party");R.fontSize=1,v.addComponent(R),v.setParent(J),v.addComponent(new Transform({position:new Vector3(0,2.55,.25),rotation:Quaternion.Euler(0,180,0)})),new ne(new GLTFShape("models/core_building/jukebox/Button_On.glb"),"Button_On",(function(){var v=A.barMusicStream&&A.barMusicStream.playing;E.sceneMessageBus.emit("BarRadioToggle",{state:!v})}),"On/Off"),new ne(new GLTFShape("models/core_building/jukebox/ButtonForward.glb"),"Button_Forward",(function(){(X+=1)>4&&(X=0),R.value="Radio:\n"+getRadioName(X),A.barMusicStream&&A.barMusicStream.playing&&E.sceneMessageBus.emit("setBarRadio",{index:X})}),"Next"),new ne(new GLTFShape("models/core_building/jukebox/Button_Previous.glb"),"Button_Preview",(function(){(X-=1)<0&&(X=3),R.value="Radio:\n"+getRadioName(X),A.barMusicStream&&A.barMusicStream.playing&&E.sceneMessageBus.emit("setBarRadio",{index:X})}),"Previous"),E.sceneMessageBus.on("BarRadioToggle",(function(v){A.barMusicStream&&v.state===A.barMusicStream.playing||(v.state?(barRadioOn(),K=!0):(barRadioOff(),K=!1))})),E.sceneMessageBus.on("setBarRadio",(function(v){var E;switch(v.index){case 0:E=z.RAVE;break;case 1:E=z.DELTA;break;case 2:E=z.GRAFFITI;break;case 3:E=z.JAZZ;break;case 4:E=z.SIGNS;break;case null:E=null}H===E&&A.barMusicStream&&A.barMusicStream.playing||(A.barMusicStream&&(A.barMusicStream.playing=!1,A.barMusicStream=null),X=v.index,H=E,R.value="Radio:\n"+getRadioName(X),barRadioOn(H))})),E.sceneMessageBus.on("enteredRadioRange",(function(v){A.isInBar&&null!==H&&!V.tutorialRunning&&v.radio!==X&&E.sceneMessageBus.emit("setBarRadio",{index:X})}))};var ne=function(v){function JukeboxButton(A,E,R,M){var O=v.call(this)||this;return engine.addEntity(O),O.addComponent(A),O.setParent(J),O.addComponent(new AudioSource(new AudioClip("sounds/click.mp3"))),O.addComponent(new Animator),O.clickAnim=new AnimationState(E,{looping:!1}),O.getComponent(Animator).addClip(O.clickAnim),O.addComponent(new OnPointerDown((function(){R(),O.press()}),{button:ActionButton.POINTER,hoverText:M||"Press"})),O}return __extends(JukeboxButton,v),JukeboxButton.prototype.press=function(){this.clickAnim.stop(),this.clickAnim.play(),this.getComponent(AudioSource).playOnce()},JukeboxButton}(Entity);function barRadioOn(v){V.tutorialRunning||(A.isInBar&&Z.addComponent(new R.Delay(100,(function(){A.barMusicStream=new AudioStream(v||H),A.barMusicStream.volume=W,Z.addComponentOrReplace(A.barMusicStream),$.getComponent(GLTFShape).visible=!0,ee.getComponent(GLTFShape).visible=!0}))),K=!0)}function barRadioOff(){A.barMusicStream&&(A.barMusicStream.playing=!1),$.getComponent(GLTFShape).visible=!1,ee.getComponent(GLTFShape).visible=!1}function getRadioName(v){var A="";switch(v){case 0:A="Rave Party";break;case 1:A="Delta";break;case 2:A="Graffiti Kings";break;case 3:A="Vegas Jazz FM";break;case 4:A="Signs";break;case null:A="Off"}return A}A.JukeboxButton=ne,A.setBarMusicOn=function(){V.tutorialRunning||(E.sceneMessageBus.emit("enteredRadioRange",{radio:X}),A.isInBar=!0,A.barMusicStream&&(A.barMusicStream.volume=W),K&&H&&barRadioOn(H))},A.outOfBar=function(){A.isInBar=!1},A.intoBar=function(){A.isInBar=!1},A.setBarMusicOff=function(){A.isInBar=!1,barRadioOff()},A.lowerVolume=function(){A.isInBar||V.tutorialRunning||(K&&A.barMusicStream&&!A.barMusicStream.playing&&(A.barMusicStream.playing=!0),A.barMusicStream&&(A.barMusicStream.volume=.03))},A.raiseVolume=function(){V.tutorialRunning||(A.isInBar=!0,K&&A.barMusicStream&&!A.barMusicStream.playing&&(A.barMusicStream.playing=!0),A.barMusicStream.volume=W)},A.setStreamVolume=function(v){A.isInBar&&(A.barMusicStream.playing=!0,A.barMusicStream.volume=v)};var oe=!1;A.addMicFeedback=function(){var v=new AudioClip("sounds/micFeedback.mp3");v.loop=!1,v.volume=1;var V=new Entity;V.addComponent(new BoxShape),V.addComponent(new Transform({position:new Vector3(160,2.2,167.7),scale:new Vector3(.35,.35,.35)})),V.addComponent(new AudioSource(v)),V.addComponent(new OnPointerDown((function(){v.volume=1,V.getComponent(AudioSource).playOnce(),E.sceneMessageBus.emit("micFeedback",{}),oe||(oe=!0,O.octopus.talk(O.OctoComments,"mic"),R.setTimeout(6e3,(function(){O.octopus.endInteraction()})))}),{hoverText:"Use mic"})),V.addComponent(M.invisibleMaterial),engine.addEntity(V),E.sceneMessageBus.on("micFeedback",(function(E){A.isInBar&&(v.volume=.2,V.getComponent(AudioSource).playOnce())}))}})),define("src/modules/bar/barNPCs",["require","exports","@dcl/npc-scene-utils","@decentraland/Identity","@dcl/ecs-scene-utils","src/modules/bar/rarestWearable","src/quests","@dcl/quests-query","dcl-quests-client/quests-client-amd","src/modules/interactiveItems/calis","src/modules/bar/jukebox"],(function(v,A,E,R,M,O,V,z,W,H,X){function setUserData(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(E){switch(E.label){case 0:return[4,(0,R.getUserData)()];case 1:return v=E.sent(),log(v.displayName),A.userData=v,[2]}}))}))}Object.defineProperty(A,"__esModule",{value:!0}),A.octoTrip=A.backToIdle=A.endArtistTalk=A.wenMoonTalk=A.artistHints=A.artistsBackToNormal=A.artist2Talk=A.artist1Talk=A.wearabesCTalk=A.catQuest=A.ILoveCats=A.DogeTalk=A.OctoComments=A.OctoQuest=A.OctoHi=A.addNPCsOutside=A.addBarNPCs=A.setUserData=A.fetchUserData=A.userData=A.areNPCsAdded=A.wenMoon=A.artist2=A.artist1=A.wearablesC=A.catGuy=A.doge=A.octopus=void 0,A.areNPCsAdded=!1,A.userData={displayName:"",publicKey:"",hasConnectedWeb3:!1,userId:"",avatar:null,version:null},A.fetchUserData=function(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(A){switch(A.label){case 0:return[4,(0,R.getUserData)()];case 1:return v=A.sent(),log(v.displayName),[2,v]}}))}))},A.setUserData=setUserData,setUserData(),A.addBarNPCs=function(){return __awaiter(this,void 0,void 0,(function(){var v,R,z=this;return __generator(this,(function(W){return A.areNPCsAdded=!0,A.octopus=new E.NPC({position:new Vector3(160,.2,141.4)},"models/core_building/BobOctorossV46.glb",(function(){A.octopus.getComponent(E.NPCTriggerComponent).onCameraEnter&&(A.octopus.getComponent(E.NPCTriggerComponent).onCameraEnter=void 0),A.octopus.talk(A.OctoHi),V.arrow&&V.arrow.getParent()===A.octopus&&V.arrow.hide(),A.octopus.changeIdleAnim("TalkLoop"),A.octopus.playAnimation("TalkIntro",!0,.63)}),{portrait:"images/portraits/bartender.png",dialogSound:"sounds/navigationForward.mp3",idleAnim:"Idle",faceUser:!1,darkUI:!0,onWalkAway:function(){backToIdle()}}),(v=new Entity).addComponent(new Transform),v.addComponent(new GLTFShape("models/core_building/BobOctorossPartB_V02.glb")),engine.addEntity(v),v.setParent(A.octopus),R={path:[new Vector3(166.7,.24,163.9),new Vector3(161,.24,160),new Vector3(157.5,.24,157.4),new Vector3(153.7,.24,156.2),new Vector3(148.1,.24,156.8),new Vector3(146.4,.24,156),new Vector3(143.1,.24,153.1),new Vector3(143,.24,152.8),new Vector3(143.2,.24,150.7),new Vector3(143.26,.24,147.5),new Vector3(148.1,.24,142.3),new Vector3(151.9,.24,142.3),new Vector3(153.8,.24,144.9),new Vector3(154,.24,146.9),new Vector3(154.6,.24,149.57),new Vector3(156.65,.24,154.7),new Vector3(162.3,.24,156.2),new Vector3(166.4,.24,156.1),new Vector3(169.7,.24,156.2),new Vector3(171.9,.24,157.8),new Vector3(173.8,.24,158.7),new Vector3(173.8,.24,160.1),new Vector3(173.15,.24,161.59),new Vector3(171.3,.24,163.22)],loop:!0},A.doge=new E.NPC({position:R.path[0],scale:new Vector3(2,2,2)},"models/core_building/dogeNPC.glb",(function(){A.doge.stopWalking(),A.artist1.endInteraction(),A.artist2.endInteraction(),A.doge.playAnimation("Talk1",!0);var v=Math.floor(10*Math.random());A.doge.talkBubble(A.DogeTalk,v)}),{walkingAnim:"Walk",faceUser:!0,hoverText:"WOW",onlyETrigger:!0,walkingSpeed:1.2,continueOnWalkAway:!0,onWalkAway:function(){A.doge.followPath()},textBubble:!0,noUI:!0,bubbleHeight:2.2}),A.doge.followPath(R),A.wearablesC=new E.NPC({position:new Vector3(162.65,.23,133.15)},"models/core_building/WearableConnoisseurRotatedV08.glb",(function(){return __awaiter(z,void 0,void 0,(function(){var v;return __generator(this,(function(E){switch(E.label){case 0:return[4,(0,O.rarestItem)(!0)];case 1:switch(v=E.sent(),A.wearablesC.playAnimation("TurnIn",!0,3.13),M.setTimeout(3130,(function(){A.wearablesC.playAnimation("Talk")})),log(v),v){case O.rarityLevel.none:A.wearablesC.talk(A.wearabesCTalk,"none");break;case O.rarityLevel.common:case O.rarityLevel.uncommon:case O.rarityLevel.rare:A.wearablesC.talk(A.wearabesCTalk,"common");break;case O.rarityLevel.epic:case O.rarityLevel.legendary:A.wearablesC.talk(A.wearabesCTalk,"epic");break;case O.rarityLevel.mythic:case O.rarityLevel.unique:A.wearablesC.talk(A.wearabesCTalk,"mythic")}return[2]}}))}))}),{portrait:"images/portraits/WearableConnoisseur.png",faceUser:!0,darkUI:!0,dialogSound:"sounds/navigationForward.mp3",hoverText:"Talk",turningSpeed:.35,onlyETrigger:!0,onWalkAway:function(){A.wearablesC.endInteraction(),A.wearablesC.playAnimation("TurnOut",!0,1.47),A.wearablesC.addComponentOrReplace(new M.RotateTransformComponent(A.wearablesC.getComponent(Transform).rotation.clone(),Quaternion.Euler(0,0,0),1))}}),A.artist1=new E.NPC({position:new Vector3(142.9,-.2,165.7),rotation:Quaternion.Euler(0,270,0)},"models/core_building/ch2_crowdV5.glb",(function(){A.artist1.bubble.closeDialogEndAll(),A.artist2.bubble.closeDialogEndAll(),A.artist1.talk(A.artistHints),A.artist1.playAnimation("TurnIn",!0,.57),M.setTimeout(570,(function(){A.artist1.playAnimation("TalkToUser")})),A.artist2.playAnimation("TurnIn",!0,.57),M.setTimeout(570,(function(){A.artist2.playAnimation("TalkToUser")}))}),{portrait:"images/portraits/ACch2.png",idleAnim:"Talk",darkUI:!0,faceUser:!1,dialogSound:"sounds/navigationForward.mp3",hoverText:"Art Recommendations",onlyETrigger:!0,textBubble:!0,onWalkAway:function(){A.artist1.dialog.container.visible&&(A.artist1.bubble.closeDialogEndAll(),A.artist2.bubble.closeDialogEndAll(),A.artist1.playAnimation("TurnOut",!0,.5),A.artist2.playAnimation("TurnOut",!0,.5),M.setTimeout(500,(function(){A.artist1.playAnimation("Talk"),A.artist2.playAnimation("Talk")})))}}),A.artist2=new E.NPC({position:new Vector3(142.9,-.2,165.7),rotation:Quaternion.Euler(0,270,0)},"models/core_building/ch1_crowdV5.glb",(function(){A.artist1.bubble.closeDialogWindow(),A.artist2.bubble.closeDialogWindow(),A.artist2.endInteraction(),A.artist1.talkBubble(A.artist1Talk,"1st")}),{portrait:"images/portraits/ACch2.png",idleAnim:"Talk",faceUser:!1,darkUI:!0,hoverText:"Talk",reactDistance:16,textBubble:!0,onWalkAway:function(){A.artist1.bubble.closeDialogEndAll(),A.artist2.bubble.closeDialogEndAll(),A.artist1.getComponent(Animator).getClip("Talk").playing||A.artist1.playAnimation("Talk"),A.artist2.getComponent(Animator).getClip("Talk").playing||A.artist2.playAnimation("Talk")}}),A.artist2.addComponentOrReplace(new OnPointerDown((function(){A.artist1.inCooldown||A.artist1.dialog.isDialogOpen||A.artist1.activate()}),{hoverText:"Art Recommendations",button:ActionButton.PRIMARY})),A.artist2.bubble.rootEntity.getComponent(Transform).position=new Vector3(-.1,.6,.8),A.artist1.bubble.rootEntity.getComponent(Transform).position=new Vector3(.2,.6,-.3),[2]}))}))},A.addNPCsOutside=function(){var v={path:[new Vector3(82,0,138),new Vector3(45,0,149),new Vector3(40,0,179),new Vector3(45,0,216),new Vector3(101,0,259),new Vector3(132,0,253),new Vector3(159,0,228),new Vector3(166,0,195),new Vector3(198,0,189),new Vector3(204,0,151),new Vector3(201.9,0,121),new Vector3(207.6,0,87.3),new Vector3(175.6,0,70),new Vector3(159.8,0,75.5),new Vector3(139.1,0,70),new Vector3(116.3,0,84.9),new Vector3(91,0,110)],loop:!0};A.wenMoon=new E.NPC({position:v.path[0],scale:new Vector3(1.1,1.1,1.1)},"models/core_building/wenMoonV12.glb",(function(){A.wenMoon.stopWalking(),A.wenMoon.talk(A.wenMoonTalk,0),A.wenMoon.playAnimation("TurnIn",!0,5.77)}),{portrait:"images/portraits/wenmoon.png",reactDistance:10,idleAnim:"Talk",walkingAnim:"Walk",onlyETrigger:!0,dialogSound:"sounds/navigationForward.mp3",faceUser:!0,darkUI:!0,walkingSpeed:1,onWalkAway:function(){A.wenMoon.playAnimation("TurnOut",!0,.53),M.setTimeout(2e3,(function(){A.wenMoon.followPath()}))}}),A.wenMoon.followPath(v),A.catGuy=new E.NPC({position:new Vector3(191.8,.225,68.2),rotation:Quaternion.Euler(0,290,0)},"models/core_building/cat_guySittedV12.glb",(function(){V.questProg.progressStatus===W.ProgressStatus.ON_GOING&&!(0,z.query)(V.questProg).isTaskCompleted(V.taskIds.catHair)&&(0,z.query)(V.questProg).isTaskCompleted(V.taskIds.intro)?A.catGuy.talk(A.catQuest):A.catGuy.talk(A.ILoveCats,0),V.arrow&&V.arrow.getParent()===A.catGuy&&V.arrow.hide(),A.catGuy.playAnimation("talk")}),{portrait:"images/portraits/catguy.png",reactDistance:9,idleAnim:"idle",onlyETrigger:!0,dialogSound:"sounds/navigationForward.mp3",faceUser:!1,darkUI:!0,onWalkAway:function(){A.catGuy.playAnimation("idle")}})},onIdleStateChangedObservable.add((function(v){var E=v.isIdle;log("Idle State change: ",E),E&&(A.artist1.bubble.closeDialogEndAll(),A.artist2.bubble.closeDialogEndAll(),A.artist1.playAnimation("Talk"),A.artist2.playAnimation("Talk"))})),A.OctoHi=[{text:"Welcome traveler, how can I help you!",skipable:!0},{text:"I may look quite busy, but worry not, I still have like 2 free hands and/or tentacles to spare.",skipable:!0},{text:"Is this your first time here? Do you want some pointers about how you can get around the place?",isQuestion:!0,buttons:[{label:"YES",goToDialog:"yes"},{label:"NO",goToDialog:"end"}]},{name:"end",text:"Oh well, if for any reason you need a hand and/or tentacle, I’ll be here!",triggeredByNext:function(){A.octopus.endInteraction(),log("ended conversation"),backToIdle()}},{name:"yes",text:"Here you can also find funky characters like myself. Don’t be shy, chat them up, everyone has a story to tell.",skipable:!0},{text:"You can also take that glowing beam of light back up to the happy place up in the clouds where you started out.",skipable:!0},{text:'There you can find a whole bunch of suggestions of places inside Decentraland you can visit, including <color="red">live events</color> and other highlights.',skipable:!0},{text:'You can also open up the map and <color="red">fast travel</color> anywhere! Just press <color="red">M</color> on your keyboard and explore it. You’ll see it’s pretty damn big!',skipable:!0},{text:"Or you can just walk out the door and keep walking, and see what you run into.",skipable:!0},{text:'Right now we’re in the center of the <color="red">Genesis Plaza</color>, a community-owned space that´s open to everyone. The roads fan out in all directions from here.',skipable:!0},{text:"If you venture out into the world beyond the plaza, you’ll see that the content is created by our growing community. Randomly bumping into things you didn’t expect is half the fun here.",skipable:!0,triggeredByNext:function(){A.octopus.talk(A.OctoHi,"normalEnd")}},{name:"normalEnd",text:"Well that´s it from me. So what are you waiting for? Go and explore the world!",skipable:!0,triggeredByNext:function(){backToIdle()},isEndOfDialog:!0}],A.OctoQuest=[{name:"questQ",text:"",skipable:!0},{text:"There's an item that's not on our menu, but if you're willing to fetch the ingredients I can make it for you",skipable:!0},{text:'A drink so amazing, it\'s been called <color="red">The drink of the gods</color> by... well by some drunk that tried it. Do you want me to make it for you?',isQuestion:!0,buttons:[{label:"YES",goToDialog:"quest1",triggeredActions:function(){V.client.startQuest(),V.arrow.move(A.catGuy,new Vector3(0,0,0),new Vector3(0,1.5,0)),V.arrow.show()}},{label:"NO",goToDialog:"end"}]},{name:"end",text:"Oh well, if for any reason you need a hand and/or tentacle, I’ll be here!",triggeredByNext:function(){log("ended conversation"),backToIdle()},isEndOfDialog:!0},{name:"quest1",text:"Alright! This is a rich herbal concoction, so I'm going to need some exotic spices from a few places.",skipable:!0},{text:"But let's start with the most unusual and controversial ingredient in the list, this one really puts the drink together, you'll see!",skipable:!0},{text:'We need to make an infusion with just a few <color="red">cat hairs</color>. Sounds weird, right? But it gives it that extra oomph. If you\'re allergic, even better!',skipable:!0},{text:"I'm sure you can get some cat hairs from the <color=\"red\">Cat Guy</color>. He's somewhere here in Genesis Plaza. Last time I saw him he was South of here.",skipable:!0},{text:"Let's start with that. Bring me some cat hairs first so I can get that infusion going, and then I'll tell you what I need next.",skipable:!0,triggeredByNext:function(){V.client.makeProgress(V.taskIds.intro,{type:"single",status:W.ProgressStatus.COMPLETED}),(0,V.updateQuests)(),backToIdle()},isEndOfDialog:!0},{name:"quest2",text:"Great! Those hairs are nice and scruffy, you'll taste them for sure! Let's get down to the rest of the ingredients.",skipable:!0,triggeredByNext:function(){V.arrow.hide()}},{name:"ingredients",text:'We start with some sweet <color="red">sugar berries</color>, you can find those in the <color="red">Forest Plaza</color>: 0, 80.',skipable:!0,image:{path:"images/quest/berryThumb.png",offsetY:20,offsetX:-20,section:{sourceHeight:512,sourceWidth:512}}},{text:"This plant tends to grow near water, so look out for the shores of lakes and ponds in that plaza.",skipable:!0,image:{path:"images/quest/berryThumb.png",offsetY:20,offsetX:-20,section:{sourceHeight:512,sourceWidth:512}}},{text:'We balance that out with some acidity from some <color="red">kim-kim</color>, you can find that in the <color="red">Asian Plaza</color>: 60, -60.',skipable:!0,image:{path:"images/quest/kimkimThumb.png",offsetY:10,offsetX:-25,section:{sourceHeight:512,sourceWidth:512}}},{text:"This plant only grows at some altitude, so make sure you check out the higher spots on Asian Plaza.",skipable:!0,image:{path:"images/quest/kimkimThumb.png",offsetY:10,offsetX:-25,section:{sourceHeight:512,sourceWidth:512}}},{text:'And finally add some smoky notes from a <color="red">dried leather vine</color>, you can find that growing in the <color="red">Medieval Plaza</color>: -60, -60.',skipable:!0,image:{path:"images/quest/vineThumb.png",offsetY:15,offsetX:-20,section:{sourceHeight:512,sourceWidth:512}}},{text:"This plant grows best near human settlements. It probably has to do with the manure from the farm animals... the less you know the better, really.",skipable:!0,image:{path:"images/quest/vineThumb.png",offsetY:15,offsetX:-20,section:{sourceHeight:512,sourceWidth:512}}},{text:"Bring me those and then I'll tell you what's next in the list. You can ask me to go over those ingredients again any time.",skipable:!0,triggeredByNext:function(){backToIdle(),V.client.makeProgress(V.taskIds.bringHair,{type:"single",status:W.ProgressStatus.COMPLETED}),(0,V.updateQuests)()},isEndOfDialog:!0},{name:"quest3",text:"Super, all of these ingredients you collected smell super fresh.",triggeredByNext:function(){V.arrow.hide()},skipable:!0},{text:'We can\'t just serve that in any regular glass. I\'m going to need a special <color="red">Chalice</color> for that. Look for the chaman in <color="red">Gamer Plaza</color>, 80,0, he\'ll know.',skipable:!0},{text:"When you have that ready, come back to me and I'll make you the drink. It's going to be worth it, I promise!",triggeredByNext:function(){V.client.makeProgress(V.taskIds.bringHerbs,{type:"single",status:W.ProgressStatus.COMPLETED}),(0,V.updateQuests)(),backToIdle()},isEndOfDialog:!0},{name:"noHerbs",text:"Looks like we're still missing some ingredients. If you bring them all, I can make you the drink!",skipable:!0,triggeredByNext:function(){backToIdle()}},{text:"Do you want me to go over the list of ingredients again?",isQuestion:!0,buttons:[{label:"YES",goToDialog:"ingredients"},{label:"NO",goToDialog:"end"}]},{name:"noHairs",text:"We're still missing the key ingredient, the cat hairs! I refuse to do this without following the recipe to the letter. Look for the cat guy, he's sitting somewhere south of here in this same plaza.",skipable:!0,triggeredByNext:function(){backToIdle()},isEndOfDialog:!0},{name:"noCalis",text:"We have all the ingredients, but we wouldn't do the drink justice if we just served it in a regular glass. Go to the Chaman on Gamer Plaza, he'll know where you can get something worthy of it.",skipable:!0,triggeredByNext:function(){backToIdle()},isEndOfDialog:!0},{name:"makeDrink",text:"Amazing, you found everything! Time to do my magic",triggeredByNext:function(){V.arrow.hide(),A.octopus.playAnimation("CalisPrep",!0,7.17),A.octopus.getComponent(E.NPCTriggerComponent).onCameraExit=function(){},Z.hasComponent(GLTFShape)||(Z.addComponent(new GLTFShape("models/core_building/BobOctorossTripOnly.glb")),Z.getComponent(GLTFShape).visible=!1,Z.addComponent(new Animator).addClip(new AnimationState("Trip",{looping:!1}))),M.setTimeout(7250,(function(){A.octopus.talk(A.OctoQuest,"serveDrink"),H.Calis1.pickup((function(){(0,X.setStreamVolume)(.5)}))}))},isEndOfDialog:!0},{name:"serveDrink",text:'Here you go. Enjoy it, it\'s not every day that you can get to taste of such a rare elixir. \nHit <color="red">F</color> to drink up!',triggeredByNext:function(){V.client.makeProgress(V.taskIds.outro,{type:"single",status:W.ProgressStatus.COMPLETED}),(0,V.updateQuests)(),octoTrip()},isEndOfDialog:!0}],A.OctoComments=[{name:"firstBeer",text:"Hey you found a mug!\nYou`re welcome to jump behind the bar, put the mug under a tap and and pour yourself one.",skipable:!0,isEndOfDialog:!0},{name:"firstServe",text:"Hit F to drink up.",skipable:!0,isEndOfDialog:!0},{name:"thirdBeer",text:"Wohooo pace your self a little buddy.",skipable:!0,isEndOfDialog:!0},{name:"mic",text:"Ohh that old thing is broken. But if you want to talk, just keep T pressed. Works anywhere.",skipable:!0,isEndOfDialog:!0}],A.DogeTalk=[{text:"Wow, so very game changing revolutionary use case of blockchain technology",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"Such community generated content.",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"How true asset ownership!",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"Very potential to become the so awaited true incarnation of the metaverse",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"So decentralized governance by community voting",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"Much open source",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"So 3d social platform",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"How social experiment in self-governance",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"Very redefining how we interchange value with each other",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0},{text:"Much persistent virtual world",triggeredByNext:function(){A.doge.followPath()},timeOn:4.1,isEndOfDialog:!0}],A.ILoveCats=[{text:"Hey there! Let me introduce myself. I’m the cat guy",skipable:!0},{text:"That’s what everyone calls me. Or well, my cats don’t call me anything really, I wish they did. But if people other than my cats were to hang out with me, that’s what they’d call me for sure.",skipable:!0},{text:"You’re welcome to call me that, but no pressure. But you see I’m really into cats, that’s my thing.",skipable:!0},{text:'So it would make sense to call me the  <color="red">cat guy </color>.',skipable:!0},{text:"I’m sorry, I’m talking about cats again. Such a broken record, aren’t I? Like a cat that won’t stop meowing all day.",skipable:!0},{text:"Dammit!",skipable:!0,isEndOfDialog:!0,triggeredByNext:function(){A.catGuy.playAnimation("idle")}}];var K=!1;function artistsBackToNormal(){A.artist1.playAnimation("TurnOut",!0,.57),A.artist2.playAnimation("TurnOut",!0,.57),M.setTimeout(570,(function(){A.artist1.playAnimation("Talk"),A.artist2.playAnimation("Talk")})),A.artist1.talkBubble(A.artist1Talk,"1st")}function backToIdle(){A.octopus.changeIdleAnim("Idle"),A.octopus.playAnimation("TalkOutro",!0,.63)}A.catQuest=[{text:"Hey there! Let me introduce myself. I’m the cat guy",skipable:!0},{text:"That’s what everyone calls me. Or well, my cats don’t call me anything really, I wish they did. But if people other than my cats were to hang out with me, that’s what they’d call me for sure.",skipable:!0},{text:"Oh so you're also into that weird fad of drinking cat hairs, huh?",skipable:!0},{text:"Pretty strange if you ask me. Then they say I'm the freak just because I eat cat food.",skipable:!0,triggeredByNext:function(){K||(K=!0,function(){var v=new Entity;v.addComponent(new GLTFShape("models/core_building/cat_orange.glb")),v.addComponent(new Transform({position:new Vector3(191.9,.225,68.2),scale:new Vector3(.45,.45,.45),rotation:Quaternion.Euler(0,-10,0)})),v.addComponent(new Animator);var E=new AnimationState("WalkCycle");v.getComponent(Animator).addClip(E),M.setTimeout(4e3,(function(){E.play(),v.addComponent(new M.MoveTransformComponent(v.getComponent(Transform).position,v.getComponent(Transform).position.add(new Vector3(-.15,0,1)),4,(function(){var A=new AnimationState("IdleNorm");v.getComponent(Animator).addClip(A),A.play(),V.arrow.move(v,new Vector3(0,0,0),new Vector3(0,1,0))})))})),v.addComponent(new OnPointerDown((function(){var E=new AnimationState("IdleTailSwoosh");v.getComponent(Animator).addClip(E),E.play(),v.addComponent(new AudioSource(new AudioClip("sounds/cat.mp3"))),v.getComponent(AudioSource).playOnce(),M.setTimeout(1e3,(function(){A.catGuy.talk(A.catQuest,"collect"),V.client.makeProgress(V.taskIds.catHair,{type:"single",status:W.ProgressStatus.COMPLETED}),(0,V.updateQuests)()})),V.arrow.move(A.octopus,new Vector3(0,0,0),new Vector3(-.5,2.5,-.3),new Vector3(1.5,1.5,1.5))}),{button:ActionButton.PRIMARY,hoverText:"Pick hair"})),engine.addEntity(v)}())}},{text:"Well, if you really want to go forward with that... here's whiskers. You can pinch some of his hairs and be done with it.",skipable:!0,isEndOfDialog:!0},{name:"collect",text:"Be gentle, you weirdo!",skipable:!0,isEndOfDialog:!0}],A.wearabesCTalk=[{name:"none",text:"Why? … Umm, what would someone <i>dressed like you</i> have to say to me?",skipable:!0},{text:"Clearly you just put on whatever rags you slept in and think that’s an outfit, let me tell you something: you don’t cause a good impression on me like that.",skipable:!0},{text:"I guess you’re fine, I mean <i>we’re not going to be friends</i>, but I’m feeling generous today and will acknowledge that you exist.",skipable:!0,triggeredByNext:function(){A.wearablesC.talk(A.wearabesCTalk,"default")}},{name:"common",text:"Well look at you, <i>all dressed up</i> with outlet-grade clothes that you probably bought at a gas station.",skipable:!0},{text:"I guess you’re fine, I mean <i>we’re not going to be friends</i>, but I’m feeling generous today and will acknowledge that you exist.",skipable:!0,triggeredByNext:function(){A.wearablesC.talk(A.wearabesCTalk,"default")}},{name:"epic",text:"I see that you know how to present yourself. If only everyone had a baseline of taste like yours. <i>Not that it’s a very high bar</i>, but it would be quite an improvement.",skipable:!0,triggeredByNext:function(){A.wearablesC.talk(A.wearabesCTalk,"default")}},{name:"mythic",text:"Oh well <i>finally</i> someone I can talk to here without feeling embarrassed to be seen. You sir know how to dress, well done!",skipable:!0,triggeredByNext:function(){A.wearablesC.talk(A.wearabesCTalk,"default")}},{name:"default",text:"I always say <i>“you are what you wear”</i>. So true. Dressing up is all about expressing who you want to be in the eyes of others.",skipable:!0},{text:"I always say <i>“you are what you wear”</i>. So true.\nDressing up is all about expressing who you want to be in the eyes of others.",skipable:!0},{text:"Me, as you can tell, I’m <i>one of a kind</i>. Dressed in the finest Non-Fungible Tokens in the marketplace. Worthy of a queen!",skipable:!0},{text:"And you, who do your clothes say you are?\n<i>Have a think about that, hun</i>.",skipable:!0,isEndOfDialog:!0,triggeredByNext:function(){A.wearablesC.endInteraction(),A.wearablesC.playAnimation("TurnOut",!0,1.47),A.wearablesC.addComponentOrReplace(new M.RotateTransformComponent(A.wearablesC.getComponent(Transform).rotation.clone(),Quaternion.Euler(0,0,0),1))}}],A.artist1Talk=[{name:"1st",text:"So there I was, questioning what my work really meant to me as an artist, after having spent <b>so much</b> time on it and put <b>so much</b> of myself into it."},{text:"Now locked up in a container where no one can see my work, where it would hopefully gain value with time or if I die in some <i>flamboyant scandalous way</i>.",isEndOfDialog:!0,triggeredByNext:function(){A.artist2.talkBubble(A.artist2Talk,"1st")}},{name:"2nd",text:"Well yeah, but back then there wasn’t much of a market for NFTs, <i>or I didn’t know about it at least</i>. I was just trying to make a living by selling canvases, like everyone else.",isEndOfDialog:!0,triggeredByNext:function(){A.artist2.talkBubble(A.artist2Talk,"2nd")}},{name:"3rd",text:" The thing is <b>I would still be removing my work from the public view</b>, the form of payment doesn’t change that."},{text:"My audience suddenly got reduced to some rich guy and <i>maybe</i> his occasional dinner guests. That’s the part that upset me.",isEndOfDialog:!0,triggeredByNext:function(){A.artist2.talkBubble(A.artist2Talk,"3rd")}},{name:"4th",text:"Kinda… <i>yes and no</i>. The owner of the work might be just one person, but it’s still available for any curious eyes out there.",isEndOfDialog:!0,triggeredByNext:function(){A.artist2.talkBubble(A.artist2Talk,"4th"),A.artist2.playAnimation("TurnIn",!0,.57),M.setTimeout(570,(function(){A.artist2.playAnimation("TalkToUser")}))}},{name:"5th",text:"Yeah, otherwise our rambling would have bored you to death by now. If all of this space is new to you, <i>you’re in for a treat!</i>",isEndOfDialog:!0,triggeredByNext:function(){A.artist2.talkBubble(A.artist2Talk,"5th"),A.artist2.playAnimation("Talk")}},{name:"6th",text:"Yeah and well… it’s <i>good</i> art too. A lot of it, at least."},{text:"Ask me and I’ll give you some hints.",triggeredByNext:function(){A.artist2.playAnimation("TurnOut",!0,.5),A.artist1.playAnimation("TurnOut",!0,.5),M.setTimeout(500,(function(){A.artist2.playAnimation("Talk"),A.artist1.playAnimation("Talk"),A.artist1.talkBubble(A.artist1Talk,"1st")}))},isEndOfDialog:!0}],A.artist2Talk=[{name:"1st",text:"And that was <i>such a good time</i> to get into ether, so cheap back then. Imagine if you sold those for eth then?",isEndOfDialog:!0,triggeredByNext:function(){A.artist1.talkBubble(A.artist1Talk,"2nd")}},{name:"2nd",text:" Just imagine if you sold a painting for 200 eth, it was <b>nothing</b> back then.",isEndOfDialog:!0,triggeredByNext:function(){A.artist1.talkBubble(A.artist1Talk,"3rd")}},{name:"3rd",text:"But your NFTs also end up going to the wallet of some rich whale just the same.",isEndOfDialog:!0,triggeredByNext:function(){A.artist1.talkBubble(A.artist1Talk,"4th")}},{name:"4th",text:"Speaking of audiences, looks like we have one here. Hey! I take it that you have an interest in art",isEndOfDialog:!0,triggeredByNext:function(){A.artist1.playAnimation("TurnIn",!0,.57),M.setTimeout(570,(function(){A.artist1.playAnimation("TalkToUser")})),A.artist1.talkBubble(A.artist1Talk,"5th")}},{name:"5th",text:"A ton of places you can check out. With <b>crazy expensive</b> virtual art on display. You can’t imagine what some of these cost!",isEndOfDialog:!0,triggeredByNext:function(){A.artist1.talkBubble(A.artist1Talk,"6th")}}],A.artistsBackToNormal=artistsBackToNormal,A.artistHints=[{text:"Hey so you want to find out where you can find good art to admire?",isQuestion:!0,buttons:[{label:"yes",goToDialog:"voltaire"},{label:"no",goToDialog:"no"}]},{name:"no",text:"Alright, I’ll be around if you want to hear more.",triggeredByNext:function(){artistsBackToNormal()},isEndOfDialog:!0},{name:"dummy",text:"",isEndOfDialog:!0},{name:"voltaire",text:'Ok, so first there’s <color="red">Voltaire District</color>, at 55,97. Lots of big players in the crypto art space have spot there.',isQuestion:!0,buttons:[{label:"Visit",goToDialog:"dummy",triggeredActions:function(){A.artist1.endInteraction(),artistsBackToNormal(),teleportTo("55,97")}},{label:"More",goToDialog:"museum"}]},{name:"museum",text:'There’s the <color="red"> Museum District</color> at 20,80, quite a pioneer of the metaverse.',isQuestion:!0,buttons:[{label:"Visit",goToDialog:"dummy",triggeredActions:function(){A.artist1.endInteraction(),artistsBackToNormal(),teleportTo("20,80")}},{label:"More",goToDialog:"rapture"}]},{name:"rapture",text:'The  <color="red">Rapture Gallery</color> at -88,-65 is also a really hip spot worth visiting',isQuestion:!0,buttons:[{label:"Visit",goToDialog:"dummy",triggeredActions:function(){A.artist1.endInteraction(),artistsBackToNormal(),teleportTo("-88,-65")}},{label:"More",goToDialog:"100x"}]},{name:"100x",text:'Also  <color="red">100x Gallery</color>, at 86,-24, there’s a whole bunch of things around that area.',isQuestion:!0,buttons:[{label:"Visit",goToDialog:"dummy",triggeredActions:function(){A.artist1.endInteraction(),artistsBackToNormal(),teleportTo("86,-24")}},{label:"More",goToDialog:"momus"}]},{name:"momus",text:' <color="red">Momus Park</color> covers a huge area made up of passages, it’s quite a scenic route. You could start your visti at 8,43.',isQuestion:!0,buttons:[{label:"Visit",goToDialog:"dummy",triggeredActions:function(){A.artist1.endInteraction(),artistsBackToNormal(),teleportTo("8,43")}},{label:"More",goToDialog:"vegas"}]},{name:"vegas",text:'Also the <color="red">Vegas Art Village</color> at -125,100 includes a whole assortment of very creative small museums from the community.',isQuestion:!0,buttons:[{label:"Visit",goToDialog:"dummy",triggeredActions:function(){A.artist1.endInteraction(),artistsBackToNormal(),teleportTo("-125,100")}},{label:"More",goToDialog:"skate"}]},{name:"skate",text:'If you´re looking for a place with a more edgy underground vibe, check out the <color="red">Vegas City Skatepark Gallery</color> at -100,150.',isQuestion:!0,buttons:[{label:"Visit",goToDialog:"dummy",triggeredActions:function(){A.artist1.endInteraction(),artistsBackToNormal(),teleportTo("-100,150")}},{label:"Done",goToDialog:"end"}]},{name:"end",text:"Those are the ones that come to mind to me right now. But there´s a LOT more to explore too."},{isEndOfDialog:!0,text:"Hope you have fun exploring!",triggeredByNext:function(){artistsBackToNormal()}}],A.wenMoonTalk=[{text:"Hey there! Seen any promising new coins? It’s full of them, all over the place. You just need to be at the <i>right place</i> at the <i>right time</i>..",skipable:!0},{text:'I’m  <color="red">Wen Moon </color>, a future millionaire, you’ll see. Any minute now!',skipable:!0},{text:"Everyone gets a break except me. But it’s a matter of time now, I got a bit of everything, you never know what’s the next big thing.",skipable:!0},{text:"For example, my friend was really psyched about Ponzi Coin, you heard of it? He says it’s going to be huge, and he’ll even cut me a special deal if I buy it from him.",skipable:!0},{text:"Then there’s Bad Press Coin: its value is directly tied to how many negative mentions it gets on twitter. You think it’s a bad idea? <i>Go tweet about it haha</i>",skipable:!0},{text:"Any of these could be the <i>next bitcoin</i>...",skipable:!0},{text:"<i>Gotta get them all!</i> Haha You know, just like that yellow cat says..",skipable:!0},{text:"You know the one… The one from that famous comic book kids read today, Poker Nom ...or something",skipable:!0},{text:"Anyway, I’ll keep looking. I’m gonna miss my big break if I stay chatting here. See you around!",skipable:!0,isEndOfDialog:!0,triggeredByNext:function(){A.wenMoon.playAnimation("TurnOut",!0,.53),M.setTimeout(535,(function(){A.wenMoon.followPath()}))}}],A.endArtistTalk=function(){A.artist1.bubble.closeDialogEndAll(),A.artist2.bubble.closeDialogEndAll()},A.backToIdle=backToIdle;var Z=new Entity;function octoTrip(){Z.hasComponent(GLTFShape)&&(A.octopus.getComponent(GLTFShape).visible=!1,Z.getComponent(GLTFShape).visible=!0,Z.getComponent(Transform).position=new Vector3(160,.2,141.4),Z.getComponent(Animator).getClip("Trip").play(),M.setTimeout(7330,(function(){Z.getComponent(GLTFShape).visible=!1,A.octopus.getComponent(GLTFShape).visible=!0,A.octopus.playAnimation("Idle")})))}Z.addComponent(new Transform({position:new Vector3(160,-4,141.4)})),engine.addEntity(Z),A.octoTrip=octoTrip})),define("src/modules/interactiveItems/beerGlass",["require","exports","@dcl/ecs-scene-utils","src/modules/interactiveItems/sound","src/modules/interactiveItems/player","src/modules/interactiveItems","src/modules/interactiveItems/barItem","src/modules/bar/barNPCs"],(function(v,A,E,R,M,O,V,z){var W;Object.defineProperty(A,"__esModule",{value:!0}),A.beerGlasses=A.BeerGlass=A.BeerBaseState=void 0,function(v){v.NONE="Blank",v.RED_BEER="PourRed",v.YELLOW_BEER="PourYellow",v.GREEN_BEER="PourGreen"}(W=A.BeerBaseState||(A.BeerBaseState={}));var H=0,X=new R.Sound(new AudioClip("sounds/interactiveItems/swallow.mp3")),K=function(v){function BeerGlass(A,E,R,O,V){var z=v.call(this)||this;return z.id=A,z.holdPosition=O,z.rotatePosition=V,z.isFull=!1,z.beerBaseState=W.NONE,engine.addEntity(z),z.addComponent(E),z.addComponent(new Transform({position:R})),z.addComponent(new Animator),z.getComponent(Animator).addClip(new AnimationState("Blank",{looping:!1})),z.getComponent(Animator).addClip(new AnimationState("PourRed",{looping:!1})),z.getComponent(Animator).addClip(new AnimationState("PourYellow",{looping:!1})),z.getComponent(Animator).addClip(new AnimationState("PourGreen",{looping:!1})),z.getComponent(Animator).getClip("Blank").play(),z.addComponent(new OnPointerDown((function(){M.Player.holdingItem||z.pickup(z.id)}),{button:ActionButton.PRIMARY,showFeedback:!0,hoverText:"pick up"})),z}return __extends(BeerGlass,v),BeerGlass.prototype.playPourAnim=function(){O.sceneMessageBus.emit("BeerGlassPourAnim",{id:this.id,position:this.holdPosition})},BeerGlass.prototype.stopAnimations=function(){this.getComponent(Animator).getClip("Blank").stop(),this.getComponent(Animator).getClip("PourRed").stop(),this.getComponent(Animator).getClip("PourYellow").stop(),this.getComponent(Animator).getClip("PourGreen").stop()},BeerGlass.prototype.pickup=function(v){this.setParent(null),V.pickUpSound.getComponent(AudioSource).playOnce(),this.setParent(Attachable.FIRST_PERSON_CAMERA),this.getComponent(Transform).rotate(Vector3.Right(),this.rotatePosition),this.addComponentOrReplace(new E.Delay(100,(function(){M.Player.holdingItem=!0}))),0!==H||this.isFull?0===H&&this.isFull&&(z.octopus.talk(z.OctoComments,"firstServe"),E.setTimeout(4e3,(function(){z.octopus.endInteraction()}))):(z.octopus.talk(z.OctoComments,"firstBeer"),E.setTimeout(6e3,(function(){z.octopus.endInteraction()}))),O.sceneMessageBus.emit("BeerGlassPickedUp",{id:v,position:this.holdPosition})},BeerGlass.prototype.putDown=function(v,A,E){this.setParent(null),V.putDownSound.getComponent(AudioSource).playOnce(),M.Player.holdingItem=!1,O.sceneMessageBus.emit("BeerGlassPutDown",{id:v,position:A,beerState:E})},BeerGlass.prototype.drink=function(v){X.getComponent(AudioSource).playOnce(),O.sceneMessageBus.emit("BeerGlassDrink",{id:v}),3===(H+=1)&&(z.octopus.talk(z.OctoComments,"thirdBeer"),E.setTimeout(3e3,(function(){z.octopus.endInteraction()})))},BeerGlass.prototype.addPointerDown=function(){var v=this;this.addComponent(new OnPointerDown((function(){M.Player.holdingItem||v.pickup(v.id)}),{button:ActionButton.PRIMARY,showFeedback:!0,hoverText:"pick up"}))},BeerGlass}(Entity);A.BeerGlass=K,O.sceneMessageBus.on("BeerGlassPickedUp",(function(v){A.beerGlasses[v.id].getComponent(Transform).position.set(v.position.x,v.position.y,v.position.z),A.beerGlasses[v.id].beerBaseState=W.NONE})),O.sceneMessageBus.on("BeerGlassPutDown",(function(v){A.beerGlasses[v.id].beerBaseState=v.beerState,A.beerGlasses[v.id].getComponent(Transform).rotation.set(0,0,0,1),A.beerGlasses[v.id].getComponent(Transform).position.set(v.position.x,v.position.y,v.position.z)})),O.sceneMessageBus.on("BeerGlassDrink",(function(v){A.beerGlasses[v.id].isFull=!1,A.beerGlasses[v.id].stopAnimations(),A.beerGlasses[v.id].getComponent(Animator).getClip("Blank").play()})),O.sceneMessageBus.on("BeerGlassPourAnim",(function(v){A.beerGlasses[v.id].isFull=!0,A.beerGlasses[v.id].stopAnimations(),A.beerGlasses[v.id].getComponent(Animator).getClip(A.beerGlasses[v.id].beerBaseState).play(),A.beerGlasses[v.id].removeComponent(OnPointerDown),A.beerGlasses[v.id].addComponent(new E.Delay(2500,(function(){A.beerGlasses[v.id].addPointerDown()})))}));var Z=new GLTFShape("models/core_building/interactiveItems/beerGlass.glb"),J=new K(0,Z,new Vector3(163.77,1.28,139.87),new Vector3(0,-.4,.5),-10),$=new K(1,Z,new Vector3(156.32,1.28,140.2),new Vector3(0,-.4,.5),-10),ee=new K(2,Z,new Vector3(149.28,1.27,145.76),new Vector3(0,-.4,.5),-10),ne=new K(3,Z,new Vector3(151.1,1.27,145.61),new Vector3(0,-.4,.5),-10),oe=new K(4,Z,new Vector3(151.77,1.27,160.54),new Vector3(0,-.4,.5),-10),ie=new K(5,Z,new Vector3(153.07,1.27,159.2),new Vector3(0,-.4,.5),-10),ae=new K(6,Z,new Vector3(169.91,1.28,145.48),new Vector3(0,-.4,.5),-10),se=new K(7,Z,new Vector3(168.15,1.28,145.75),new Vector3(0,-.4,.5),-10);A.beerGlasses=[J,$,ee,ne,oe,ie,ae,se]})),define("src/modules/interactiveItems/tap",["require","exports","@dcl/ecs-scene-utils","src/modules/interactiveItems/beerGlass","src/modules/interactiveItems/sound","src/modules/interactiveItems"],(function(v,A,E,R,M,O){Object.defineProperty(A,"__esModule",{value:!0}),A.Tap=A.beerDispenser=void 0,A.beerDispenser=new Entity,A.beerDispenser.addComponent(new GLTFShape("models/core_building/interactiveItems/beerDispenser.glb")),A.beerDispenser.addComponent(new Transform({position:new Vector3(164.275,1.28,137.82)})),A.beerDispenser.getComponent(Transform).rotate(Vector3.Up(),-90),engine.addEntity(A.beerDispenser);var V=new M.Sound(new AudioClip("sounds/interactiveItems/beerPump.mp3")),z=function(v){function Tap(A,E,R,M){var O=v.call(this)||this;return O.id=A,O.beerGlasses=R,O.beerBaseState=M,engine.addEntity(O),O.addComponent(E),O.addComponent(new Transform),O.beerGlasses=R,O.addComponent(new Animator),O.getComponent(Animator).addClip(new AnimationState("Blank",{looping:!1})),O.getComponent(Animator).addClip(new AnimationState("Pour",{looping:!1})),O.getComponent(Animator).getClip("Blank").play(),O.addPointerDown(),O}return __extends(Tap,v),Tap.prototype.playPourAnim=function(){V.getComponent(AudioSource).playOnce();for(var v=0;v<this.beerGlasses.length;v++)this.beerGlasses[v].beerBaseState===this.beerBaseState&&this.beerGlasses[v].playPourAnim();O.sceneMessageBus.emit("TapPourAnim",{id:this.id})},Tap.prototype.stopAnimations=function(){this.getComponent(Animator).getClip("Blank").stop(),this.getComponent(Animator).getClip("Pour").stop()},Tap.prototype.addPointerDown=function(){var v=this;this.addComponent(new OnPointerDown((function(){v.playPourAnim()}),{button:ActionButton.PRIMARY,hoverText:"Pour",showFeedback:!0}))},Tap}(Entity);A.Tap=z,O.sceneMessageBus.on("TapPourAnim",(function(v){K[v.id].stopAnimations(),K[v.id].getComponent(Animator).getClip("Pour").play(),K[v.id].removeComponent(OnPointerDown),K[v.id].addComponent(new E.Delay(2500,(function(){K[v.id].addPointerDown()})))}));var W=new z(0,new GLTFShape("models/core_building/interactiveItems/redTap.glb"),R.beerGlasses,R.BeerBaseState.RED_BEER);W.setParent(A.beerDispenser);var H=new z(1,new GLTFShape("models/core_building/interactiveItems/yellowTap.glb"),R.beerGlasses,R.BeerBaseState.YELLOW_BEER);H.setParent(A.beerDispenser);var X=new z(2,new GLTFShape("models/core_building/interactiveItems/greenTap.glb"),R.beerGlasses,R.BeerBaseState.GREEN_BEER);X.setParent(A.beerDispenser);var K=[W,H,X]})),define("src/modules/interactiveItems",["require","exports","src/modules/interactiveItems/sound","src/modules/interactiveItems/player","@dcl/ui-scene-utils","src/modules/interactiveItems/tap","src/modules/interactiveItems/beerGlass","src/modules/interactiveItems/barItem"],(function(v,A,E,R,M,O,V,z){Object.defineProperty(A,"__esModule",{value:!0}),A.addPunchBag=A.sceneMessageBus=void 0,A.sceneMessageBus=new MessageBus;var W=new E.Sound(new AudioClip("sounds/interactiveItems/error.mp3")),H=Input.instance;H.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!0,(function(v){var A,E;if(log("Hit Point: ",v.hit.hitPoint),R.Player.holdingItem&&v.hit)if(v.hit.normal.y>.99)for(var M=0;M<V.beerGlasses.length;M++){if(null===(A=V.beerGlasses[M].getParent())||void 0===A?void 0:A.alive){var H=void 0;switch(v.hit.meshName){case"redBase_collider":H=O.beerDispenser.getComponent(Transform).position.clone().subtract(new Vector3(.31,-.02,-.368)),V.beerGlasses[M].putDown(M,H,V.beerGlasses[M].beerBaseState=V.BeerBaseState.RED_BEER);break;case"yellowBase_collider":H=O.beerDispenser.getComponent(Transform).position.clone().subtract(new Vector3(.31,-.02,0)),V.beerGlasses[M].putDown(M,H,V.beerGlasses[M].beerBaseState=V.BeerBaseState.YELLOW_BEER);break;case"greenBase_collider":H=O.beerDispenser.getComponent(Transform).position.clone().subtract(new Vector3(.31,-.02,.368)),V.beerGlasses[M].putDown(M,H,V.beerGlasses[M].beerBaseState=V.BeerBaseState.GREEN_BEER);break;default:log("DEFAULT"),V.beerGlasses[M].putDown(M,v.hit.hitPoint,V.BeerBaseState.NONE)}}for(var K=0;K<z.barItems.length;K++)(null===(E=z.barItems[K].getParent())||void 0===E?void 0:E.alive)&&z.barItems[K].putDown(K,v.hit.hitPoint)}else X.show(1),W.getComponent(AudioSource).playOnce()})),H.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(){var v;if(R.Player.holdingItem)for(var A=0;A<V.beerGlasses.length;A++)(null===(v=V.beerGlasses[A].getParent())||void 0===v?void 0:v.alive)&&V.beerGlasses[A].isFull&&V.beerGlasses[A].drink(A)}));var X=new M.CenterImage("images/interactiveItems/no-sign.png",1,!0,0,20,128,128,{sourceHeight:512,sourceWidth:512,sourceLeft:0,sourceTop:0});A.addPunchBag=function(){var v=new E.Sound(new AudioClip("sounds/interactiveItems/punch.mp3")),A=new Entity;A.addComponent(new GLTFShape("models/core_building/interactiveItems/dogePunchBag.glb")),A.addComponent(new Transform({position:new Vector3(139.84,10.69,147.5)})),A.getComponent(Transform).scale.setAll(.5),engine.addEntity(A);var R=Vector3.Forward().rotate(Camera.instance.rotation),M=12.5;A.addComponent(new OnPointerDown((function(A){Z.wakeUp(),Z.applyImpulse(new CANNON.Vec3(R.x*M,R.y*M,R.z*M),new CANNON.Vec3(Z.position.x,Z.position.y,Z.position.z)),v.getComponent(AudioSource).playOnce()}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"punch",distance:4}));var O=new CANNON.World;O.gravity.set(0,10,0),O.broadphase=new CANNON.NaiveBroadphase;var V=new CANNON.Body({mass:0});V.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2);var z=new CANNON.Material("physicsMaterial"),W=new CANNON.ContactMaterial(z,z,{friction:0,restitution:.1});O.addContactMaterial(W);var H=new CANNON.Plane;V.addShape(H),V.material=z,O.addBody(V);var X=new CANNON.Body({mass:0});X.position.set(139.84,10.69,147.5),O.addBody(X);var K=new CANNON.Sphere(.2),Z=new CANNON.Body({mass:5});Z.addShape(K),Z.position.set(139.84,13.69,147.5),Z.sleep(),O.addBody(Z),Z.linearDamping=.4,Z.angularDamping=1;var J=new CANNON.Spring(Z,X,{localAnchorA:new CANNON.Vec3(0,0,0),localAnchorB:new CANNON.Vec3(0,0,0),restLength:0,stiffness:50,damping:8});O.addEventListener("postStep",(function(){J.applyForce()}));var $=function(){function UpdateSystem(){}return UpdateSystem.prototype.update=function(v){O.step(.016666666666666666,v,10);var E=A.getComponent(Transform),M=Z.position.vsub(new CANNON.Vec3(E.position.x,E.position.y,E.position.z));E.rotation=Quaternion.LookRotation(new Vector3(M.x,M.y,M.z),Vector3.Forward()),Z.velocity.almostEquals(new CANNON.Vec3(0,0,0),.02)&&Z.sleep(),R=Vector3.Forward().rotate(Camera.instance.rotation)},UpdateSystem}();engine.addSystem(new $)}})),define("src/modules/platforms",["require","exports","@dcl/ecs-scene-utils","src/modules/arcades/arcades","src/modules/serverHandler","src/modules/interactiveItems"],(function(v,A,E,R,M,O){Object.defineProperty(A,"__esModule",{value:!0}),A.upstairsBar=A.barPlatforms=A.upstairsLoaded=A.placePlatforms=A.Platform=void 0;var V=function(v){function Platform(A,R,O,V,z,W,H){var X=v.call(this)||this;engine.addEntity(X),X.addComponent(A),X.addComponent(new Transform(R)),X.addComponent(new Animator),X.animation=new AnimationState(z,{looping:!1}),X.getComponent(Animator).addClip(X.animation);var K=new Entity;K.addComponent(new Transform(O));var Z=new E.TriggerBoxShape(V,Vector3.Zero());return K.addComponent(new E.TriggerComponent(Z,{onCameraEnter:function(){M.sceneMessageBus.emit(W,{}),H&&H()}})),engine.addEntity(K),X}return __extends(Platform,v),Platform.prototype.activate=function(){this.animation.play()},Platform}(Entity);function upstairsBar(){A.upstairsLoaded||(A.upstairsLoaded=!0,(0,R.addArcades)(),(0,O.addPunchBag)())}A.Platform=V,A.placePlatforms=function(){var v=new V(new GLTFShape("models/L'architoque_Elevator.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(51,3,39.5)},new Vector3(4,4,4),"L'architoque_Elevator","artichokeElevatorActivated"),A=new V(new GLTFShape("models/TheWhale_Action_Elevator.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(188.5,3,236)},new Vector3(7,3,7),"WhaleElevator_Action","whaleElevatorActivated"),R=new V(new GLTFShape("models/MoonTower_Action_Elevator.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(48.6,2.4,116.6)},new Vector3(7,3,7),"MoonTower_Action_Elevator","moonElevatorActivated"),O=new V(new GLTFShape("models/shell_elevator.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(300.5,11.3,120),rotation:Quaternion.Euler(0,45,0)},new Vector3(7,2,6),"TheShell_ElevatorAction","shellElevatorActivated"),z=new V(new GLTFShape("models/train_elevator.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(229.7,1.3,143),rotation:Quaternion.Euler(0,45,0)},new Vector3(2,2,2),"TrainElevator_Action","trainElevatorActivated"),W=!1,H=new V(new GLTFShape("models/balloon.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(80,2,181),rotation:Quaternion.Euler(0,45,0)},new Vector3(2,1,2),"Balloon_Action","balloonActivated"),X=!1,K=new V(new GLTFShape("models/train.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(234.5,7,143),rotation:Quaternion.Euler(0,45,0)},new Vector3(2,2,6),"Train_Action","trainActivated");M.sceneMessageBus.on("artichokeElevatorActivated",(function(A){v.activate(),log("artichoke elevator")})),M.sceneMessageBus.on("whaleElevatorActivated",(function(v){A.activate(),log("whale elevator")})),M.sceneMessageBus.on("moonElevatorActivated",(function(v){R.activate(),log("moon tower elevator")})),M.sceneMessageBus.on("shellElevatorActivated",(function(v){O.activate(),log("shell elevator")})),M.sceneMessageBus.on("trainElevatorActivated",(function(v){z.activate(),log("train elevator")})),M.sceneMessageBus.on("balloonActivated",(function(v){W?log("baloon was already in flight"):(W=!0,H.activate(),H.addComponentOrReplace(new E.Delay(15e4,(function(){W=!1}))))})),M.sceneMessageBus.on("trainActivated",(function(v){X?log("train was already in movement"):(X=!0,K.activate(),K.addComponentOrReplace(new E.Delay(1e5,(function(){X=!1}))))}))},A.upstairsLoaded=!1,A.barPlatforms=function(){var v=new V(new GLTFShape("models/core_building/Elevator_Left.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(146,2.5,151)},new Vector3(4,4,4),"Elevator_Left_Up","elevatorLeft",(function(){upstairsBar()})),A=new V(new GLTFShape("models/core_building/Elevator_Right.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(173,2.5,151)},new Vector3(4,4,4),"Elevator_Right_Up","elevatorRight",(function(){upstairsBar()}));M.sceneMessageBus.on("elevatorLeft",(function(A){v.activate()})),M.sceneMessageBus.on("elevatorRight",(function(v){A.activate()}))},A.upstairsBar=upstairsBar})),define("src/modules/video",["require","exports","@dcl/ecs-scene-utils"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.addScreen=A.VideoScreen=void 0;var R=function(v){function VideoScreen(A,R,M,O,V){var z=v.call(this)||this;engine.addEntity(z),z.addComponent(new PlaneShape),z.addComponent(new Transform(A)),z.addComponent(new Animator),z.texture=new VideoTexture(new VideoClip(O)),z.texture.playing=!1,V&&(z.texture.loop=!0);var W=new Material;W.albedoTexture=z.texture,W.specularIntensity=0,W.roughness=1,W.metallic=0,z.addComponent(W);var H=new Entity;H.addComponent(new Transform(R));var X=new E.TriggerBoxShape(M,Vector3.Zero());return H.addComponent(new E.TriggerComponent(X,{onCameraEnter:function(){z.activate()},onCameraExit:function(){z.deactivate()}})),engine.addEntity(H),z}return __extends(VideoScreen,v),VideoScreen.prototype.activate=function(){this.texture.playing=!0},VideoScreen.prototype.deactivate=function(){this.texture.playing=!1},VideoScreen}(Entity);A.VideoScreen=R,A.addScreen=function(){new R({position:new Vector3(285,17.5,279),rotation:Quaternion.Euler(0,210,0),scale:new Vector3(28,5.6*2.8,28)},{position:new Vector3(270,5,255)},new Vector3(90,90,90),"https://player.vimeo.com/external/552481870.m3u8?s=c312c8533f97e808fccc92b0510b085c8122a875",!0).getComponent(Transform).rotate(new Vector3(1,0,0),10)}})),define("src/modules/buildings",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.addBuildings=void 0,A.addBuildings=function(){var v=new Entity;v.addComponent(new GLTFShape("models/lobby/lobby_platform.glb")),v.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(v);var A=new Entity;A.addComponent(new GLTFShape("models/agora.glb")),A.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(A);var E=new Entity;E.addComponent(new GLTFShape("models/artichoke.glb")),E.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(E);var R=new Entity;R.addComponent(new GLTFShape("models/hallway.glb")),R.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(R);var M=new Entity;M.addComponent(new GLTFShape("models/mountains.glb")),M.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(M);var O=new Entity;O.addComponent(new GLTFShape("models/moon-tower.glb")),O.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(O);var V=new Entity;V.addComponent(new GLTFShape("models/MoonTower_Action_Cosmos.glb")),V.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(V);var z=new Entity;z.addComponent(new GLTFShape("models/MoonTower_Action_Moon.glb")),z.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)}));var W=new Animator;z.addComponent(W);var H=new AnimationState("MoonTower_Action_MoonDark.001");W.addClip(H),H.play(),engine.addEntity(z);var X=new Entity;X.addComponent(new GLTFShape("models/MoonTower_Action_Ringu.glb")),X.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(X);var K=new Entity;K.addComponent(new GLTFShape("models/Text_A.glb")),K.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(K);var Z=new Entity;Z.addComponent(new GLTFShape("models/Text_B.glb")),Z.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(Z);var J=new Entity;J.addComponent(new GLTFShape("models/Text_C.glb")),J.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(J);var $=new Entity;$.addComponent(new GLTFShape("models/flare.glb")),$.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity($);var ee=new Entity;ee.addComponent(new GLTFShape("models/TheWhale_Action_Sculpture.glb")),ee.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ee);var ne=new Entity;ne.addComponent(new GLTFShape("models/core_building.glb")),ne.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ne);var oe=new Entity;oe.addComponent(new GLTFShape("models/msg_welcome.glb")),oe.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(oe);var ie=new Entity;ie.addComponent(new GLTFShape("models/core_art.glb")),ie.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ie);var ae=new Entity;ae.addComponent(new GLTFShape("models/garden.glb")),ae.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ae);var se=new Entity;se.addComponent(new GLTFShape("models/auditorium.glb")),se.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(se);var le=new Entity;le.addComponent(new GLTFShape("models/shell.glb")),le.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(le);var ce=new Entity;ce.addComponent(new GLTFShape("models/shoe_prop.glb")),ce.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ce);var ue=new Entity;ue.addComponent(new GLTFShape("models/tshirt_prop.glb")),ue.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ue);var de=new Entity;de.addComponent(new GLTFShape("models/whale.glb")),de.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(de);var he=new Entity;he.addComponent(new GLTFShape("models/trading_center.glb")),he.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(he);var me=new Entity;me.addComponent(new GLTFShape("models/trading_land.glb")),me.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(me);var fe=new Entity;fe.addComponent(new GLTFShape("models/trading_crypto.glb")),fe.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(fe);var ye=new Entity;ye.addComponent(new GLTFShape("models/trading_wearables.glb")),ye.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ye);var we=new Entity;we.addComponent(new GLTFShape("models/street.glb")),we.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(we);var ve=new Entity;ve.addComponent(new GLTFShape("models/vogu_pod.glb")),ve.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(ve),ve.addComponent(new OnPointerDown((function(){openExternalURL("https://assembly.thevogu.io/ ")}),{hoverText:"Visit VOGU site",button:ActionButton.PRIMARY}))};var E=new Entity;E.addComponent(new GLTFShape("models/zepellin.glb")),E.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(E);var R=new Entity;R.addComponent(new GLTFShape("models/core_building/Eth_Details.glb")),R.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(R);var M=new Entity;M.addComponent(new GLTFShape("models/core_building/Eth_Details_02.glb")),M.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),engine.addEntity(M)})),define("src/modules/nftData",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.nftData=void 0,A.nftData=[{id:0,images:"images/nfts/cryptoKittiesFurbeard.png",type:{name:"CryptoKitties",link:"https://www.cryptokitties.co/"},title:{name:"Furbeard",fontSize:24},details:{info:"#1540722 / Gen 9 /Plodding Cooldown (8h)",fontSize:15},directLink:{link:"https://www.cryptokitties.co/kitty/1540722",fontSize:11},address:"0x06012c8cf97bead5deae237070f9587f8e7a266d/1540722"},{id:1,images:"images/nfts/makersPlaceAliceInWater.png",type:{name:"MakersPlace",link:"https://makersplace.com/"},title:{name:"Alice in Water",fontSize:24},details:{info:"Artist: Katy Arrington",fontSize:18},directLink:{link:"https://makersplace.com/katyarrington/alice-in-water-4-of-10-23747",fontSize:10},address:"0x2a46f2ffd99e19a89476e2f62270e0a35bbf0756/20606"},{id:2,images:"images/nfts/knownOriginPussyBird.png",type:{name:"Known Origin",link:"https://knownorigin.io/"},title:{name:"Pussy Bird",fontSize:24},details:{info:"Artist: Kozachok",fontSize:18},directLink:{link:"https://knownorigin.io/token/165777",fontSize:11},address:"0xfbeef911dc5821886e1dda71586d90ed28174b7d/165777"},{id:3,images:"images/nfts/axieInfinity265.png",type:{name:"Axie Infinity",link:"https://axieinfinity.com/"},title:{name:"Axie #265",fontSize:24},details:{info:"Aquatic / Breed count: 0 of 7 / Level: 1 / Battles ready: 3 of 3",fontSize:11},directLink:{link:"https://axieinfinity.com/axie/265",fontSize:11},address:"0xf5b0a3efb8e8e4c201e2a935f110eaaf3ffecb8d/265"},{id:4,images:"images/nfts/myCryptoHeroesGeorgeWashington.png",type:{name:"MyCryptoHeroes",link:"https://www.mycryptoheroes.net/"},title:{name:"George Washington",fontSize:24},details:{info:"Legendary / #50040004",fontSize:18},directLink:{link:"https://www.mycryptoheroes.net/heroes/50040004",fontSize:11},address:"0x273f7f8e6489682df756151f5525576e322d51a3/50040004"},{id:5,images:"images/nfts/mlbChampionsBabeRuth.png",type:{name:"MLB Champions",link:"https://mlbc.app/"},title:{name:"Babe Ruth",fontSize:24},details:{info:"Jersey No. #3 / Team: New York Yankees",fontSize:15},directLink:{link:"https://mlbc.app/asset/101663",fontSize:11},address:"0x8c9b261faef3b3c2e64ab5e58e04615f8c788099/101663"},{id:6,images:"images/nfts/blockchainCutiesDecentralander.png",type:{name:"BlockchainCuties",link:"https://blockchaincuties.com/"},title:{name:"Decentralander Gen0Lev10 Noble",fontSize:20},details:{info:"Generation 0 / Fast / Powerless",fontSize:15},directLink:{link:"https://blockchaincuties.com/pet/64359",fontSize:11},address:"0xd73be539d6b2076bab83ca6ba62dfe189abc6bbe/64359"},{id:7,images:"images/nfts/hyperDragons23221.png",type:{name:"HyperDragons",link:"https://hyperdragons.alfakingdom.com/"},title:{name:"Dragon #23221",fontSize:24},details:{info:"Gen 5 / Swift / Strong / High Cooldown",fontSize:15},directLink:{link:"https://hyperdragons.alfakingdom.com/home/marketplace-buy?id=23221",fontSize:10},address:"0x7fdcd2a1e52f10c28cb7732f46393e297ecadda1/23221"},{id:8,images:"images/nfts/chainGuardiansCaptainDevexAttazer3.png",type:{name:"ChainGuardians",link:"https://chainguardians.io/"},title:{name:"Captain Devex Attazer #3",fontSize:24},details:{info:"Legendary / Rank: Captain / Catch: 3 of 1000 / Level: 0001",fontSize:12},directLink:{link:"https://chainguardians.io/4",fontSize:11},address:"0x3cd41ec039c1f2dd1f76144bb3722e7b503f50ab/4"},{id:9,images:"images/nfts/cryptoMorph4252.png",type:{name:"CryptoMorph",link:"https://nftcryptonews.com/cryptomorph/"},title:{name:"Mint #4252",fontSize:24},details:{info:"Burnsides Ghostwriter",fontSize:18},directLink:{link:"https://opensea.io/assets/0x9255ed258dcbafe165dccd93ea0a72f4ed88e24d/4252",fontSize:9},address:"0x9255ed258dcbafe165dccd93ea0a72f4ed88e24d/4252"},{id:10,images:"images/nfts/josieOutOfManyOne1.png",type:{name:"Josie",link:"https://josie.io/"},title:{name:"Out of Many, One - Original #1",fontSize:22},details:{info:"Artist: Josie Bellini",fontSize:18},directLink:{link:"https://opensea.io/assets/0xecf7ef42b57ee37a959bf507183c5dd6bf182081/100",fontSize:9},address:"0xecf7ef42b57ee37a959bf507183c5dd6bf182081/100"},{id:11,images:"images/nfts/superRareTillDeathUsDoPart.png",type:{name:"SuperRare",link:"https://superrare.co/"},title:{name:"Till death do us part",fontSize:24},details:{info:"Artist: hisartwork",fontSize:18},directLink:{link:"https://superrare.co/artwork/till-death-do-us-part-3734",fontSize:11},address:"0x41a322b28d0ff354040e2cbc676f0320d8c8850d/3734"},{id:12,images:"images/nfts/makersPlaceIcebergInTheLight.png",type:{name:"MakersPlace",link:"https://makersplace.com/"},title:{name:"Iceberg in the Light",fontSize:24},details:{info:"Artist: David Loblaw",fontSize:18},directLink:{link:"https://makersplace.com/davidloblaw/iceberg-in-the-light-2-of-10-23483",fontSize:10},address:"0x2a46f2ffd99e19a89476e2f62270e0a35bbf0756/20343"},{id:13,images:"images/nfts/makersPlaceIsTheEasiestWayAlwaysTheBestWay.png",type:{name:"MakersPlace",link:"https://makersplace.com/"},title:{name:"Is the easiest way always the best way?",fontSize:17},details:{info:"Artist: Federico Paoli",fontSize:18},directLink:{link:"https://makersplace.com/sergueivinnitskii/is-the-easiest-way-always-the-best-way-1-of-1-23276",fontSize:8},address:"0x2a46f2ffd99e19a89476e2f62270e0a35bbf0756/20136"},{id:14,images:"images/nfts/knownOriginWinterMemories.png",type:{name:"Known Origin",link:"https://knownorigin.io/"},title:{name:"Winter Memories",fontSize:18},details:{info:"Artist: Difelice5000",fontSize:18},directLink:{link:"https://knownorigin.io/token/84252",fontSize:11},address:"0xfbeef911dc5821886e1dda71586d90ed28174b7d/84252"},{id:15,images:"images/nfts/knownOriginTwistedRoomSeries1.png",type:{name:"Known Origin",link:"https://knownorigin.io/"},title:{name:"Twisted Room Series #1",fontSize:18},details:{info:"Artist: TwistedVacancy",fontSize:18},directLink:{link:"https://knownorigin.io/token/144376",fontSize:11},address:"0xfbeef911dc5821886e1dda71586d90ed28174b7d/144376"}]})),define("src/modules/nft",["require","exports","src/resources","src/modules/nftData"],(function(v,A,E,R){Object.defineProperty(A,"__esModule",{value:!0}),A.NFT=void 0;var M=function(v){function NFT(A,M,O,V){var z=v.call(this)||this;return z.sound=new Entity,engine.addEntity(z),z.addComponent(A),z.addComponent(M),z.getComponent(NFTShape).color=O,z.id=V,z.sound.addComponent(new Transform),z.sound.addComponent(new AudioSource(E.default.sounds.ui.navigationForward)),engine.addEntity(z.sound),z.sound.setParent(Attachable.AVATAR),z.addComponent(new OnPointerDown((function(v){z.sound.getComponent(AudioSource).playOnce(),openNFTDialog(A.src,R.nftData[z.id].details.info)}),{button:ActionButton.PRIMARY,hoverText:"More Info",distance:8})),z}return __extends(NFT,v),NFT}(Entity);A.NFT=M})),define("src/modules/nftBuilder",["require","exports","@dcl/ecs-scene-utils","src/modules/nft","src/modules/nftData"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.addNFTs=void 0,A.addNFTs=function(){new R.NFT(new NFTShape("ethereum://"+M.nftData[0].address),new Transform({position:new Vector3(126.94,5,93.823),rotation:Quaternion.Euler(0,36.068+180,0),scale:new Vector3(4,4,2)}),new Color3(.75,.75,1.5),M.nftData[0].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[1].address),new Transform({position:new Vector3(124.055,5,95.885),rotation:Quaternion.Euler(0,36.068+180,0),scale:new Vector3(4,4,2)}),new Color3(0,1,1.5),M.nftData[1].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[2].address),new Transform({position:new Vector3(116.075,5,102.364),rotation:Quaternion.Euler(0,220.278,0),scale:new Vector3(4,4,2)}),new Color3(1.5,.5,0),M.nftData[2].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[3].address),new Transform({position:new Vector3(113.39,5,104.817),rotation:Quaternion.Euler(0,45.432+180,0),scale:new Vector3(5,5,2)}),new Color3(1.25,1.25,1.25),M.nftData[3].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[4].address),new Transform({position:new Vector3(106.977,5,113.486),rotation:Quaternion.Euler(0,61.533+180,0),scale:new Vector3(4,4,2)}),new Color3(.25,.5,1.5),M.nftData[4].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[5].address),new Transform({position:new Vector3(105.261,5,116.672),rotation:Quaternion.Euler(0,61.533+180,0),scale:new Vector3(4,4,2)}),new Color3(.25,.25,.25),M.nftData[5].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[6].address),new Transform({position:new Vector3(111.754,5,120.193),rotation:Quaternion.Euler(0,61.533,0),scale:new Vector3(4,4,2)}),new Color3(1,1.1,.85),M.nftData[6].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[7].address),new Transform({position:new Vector3(113.465,5,117.004),rotation:Quaternion.Euler(0,61.533,0),scale:new Vector3(4,4,2)}),new Color3(.5,1,1),M.nftData[7].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[8].address),new Transform({position:new Vector3(118.655,5,110.005),rotation:Quaternion.Euler(0,44.895,0),scale:new Vector3(4,4,2)}),new Color3(0,1,1.5),M.nftData[8].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[9].address),new Transform({position:new Vector3(120.991,5,107.84),rotation:Quaternion.Euler(0,40.278,0),scale:new Vector3(4,4,2)}),new Color3(.9,.25,1.25),M.nftData[9].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[10].address),new Transform({position:new Vector3(128.412,5,101.866),rotation:Quaternion.Euler(0,36.068,0),scale:new Vector3(4,4,2)}),new Color3(1.5,.5,0),M.nftData[10].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[11].address),new Transform({position:new Vector3(131.283,5,99.787),rotation:Quaternion.Euler(0,36.068,0),scale:new Vector3(4,4,2)}),new Color3(1.25,.5,1.5),M.nftData[11].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[12].address),new Transform({position:new Vector3(136.106,5,89.079),rotation:Quaternion.Euler(0,203.725,0),scale:new Vector3(4,4,2)}),new Color3(1,1,1),M.nftData[12].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[13].address),new Transform({position:new Vector3(139.43,5,95.704),rotation:Quaternion.Euler(0,23.725,0),scale:new Vector3(4,4,2)}),new Color3(1.5,0,0),M.nftData[13].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[14].address),new Transform({position:new Vector3(100.982,5,125.806),rotation:Quaternion.Euler(0,65.83+180,0),scale:new Vector3(4,4,2)}),new Color3(.5,0,1.5),M.nftData[14].id),new R.NFT(new NFTShape("ethereum://"+M.nftData[15].address),new Transform({position:new Vector3(107.804,5,128.694),rotation:Quaternion.Euler(0,65.83,0),scale:new Vector3(4,4,2)}),new Color3(.5,0,1.5),M.nftData[15].id);var v=new Entity;v.addComponent(new Transform({position:new Vector3(120.491,5,108.638)})),new E.TriggerBoxShape(new Vector3(60,10,60),Vector3.Zero()),engine.addEntity(v)}})),define("src/piano/pianoKey",["require","exports","@dcl/ecs-scene-utils"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.addKeyListeners=A.PianoKey=A.keys=A.sceneMessageBus=void 0,A.sceneMessageBus=new MessageBus,A.keys=[];var R=function(v){function PianoKey(R,M,O,V,z,W){var H=v.call(this)||this;return H.material=new Material,H.onColor=new Color3(1.75,1.25,0),H.offColor=Color3.Black(),engine.addEntity(H),H.addComponent(R),H.addComponent(M),H.material.albedoColor=O,H.material.metallic=0,H.material.roughness=1,H.addComponent(H.material),H.note=W,H.addComponent(new AudioSource(V)),H.addComponent(new E.TriggerComponent(z,{onCameraEnter:function(){A.sceneMessageBus.emit("noteOn",{note:H.note})},onCameraExit:function(){A.sceneMessageBus.emit("noteOff",{note:H.note})}})),H}return __extends(PianoKey,v),PianoKey.prototype.play=function(){this.getComponent(AudioSource).playOnce(),this.material.emissiveColor=this.onColor},PianoKey.prototype.end=function(){this.material.emissiveColor=this.offColor},PianoKey}(Entity);A.PianoKey=R,A.addKeyListeners=function(){A.sceneMessageBus.on("noteOn",(function(v){A.keys[v.note].play()})),A.sceneMessageBus.on("noteOff",(function(v){A.keys[v.note].end()}))}})),define("src/piano/pianoBuilder",["require","exports","src/resources","src/piano/pianoKey"],(function(v,A,E,R){Object.defineProperty(A,"__esModule",{value:!0}),A.addPiano=void 0,A.addPiano=function(){var v=new Entity;v.addComponent(E.default.models.standard.pianoBase),v.addComponent(new Transform({position:new Vector3(162,0,291.312)})),engine.addEntity(v);for(var A=new PlaneShape,M=[E.default.sounds.piano.whiteKeys.c3,E.default.sounds.piano.whiteKeys.d3,E.default.sounds.piano.whiteKeys.e3,E.default.sounds.piano.whiteKeys.f3,E.default.sounds.piano.whiteKeys.g3,E.default.sounds.piano.whiteKeys.a3,E.default.sounds.piano.whiteKeys.b3,E.default.sounds.piano.whiteKeys.c4,E.default.sounds.piano.whiteKeys.d4,E.default.sounds.piano.whiteKeys.e4,E.default.sounds.piano.whiteKeys.f4,E.default.sounds.piano.whiteKeys.g4,E.default.sounds.piano.whiteKeys.a4,E.default.sounds.piano.whiteKeys.b4,E.default.sounds.piano.whiteKeys.c5,E.default.sounds.piano.whiteKeys.d5,E.default.sounds.piano.whiteKeys.e5,E.default.sounds.piano.whiteKeys.f5,E.default.sounds.piano.whiteKeys.g5,E.default.sounds.piano.whiteKeys.a5,E.default.sounds.piano.whiteKeys.b5],O=-8.0001,V=0;V<M.length;V++)(X=new R.PianoKey(A,new Transform({position:new Vector3(O,.11,0),scale:new Vector3(.7,4,1),rotation:new Quaternion(.70711,0,0,.70711)}),Color3.White(),M[V],E.default.trigger.triggerWhitePianoKey,V)).setParent(v),R.keys.push(X),O+=.8;var z=[E.default.sounds.piano.blackKeys.cSharp3,E.default.sounds.piano.blackKeys.dSharp3,E.default.sounds.piano.blackKeys.fSharp3,E.default.sounds.piano.blackKeys.gSharp3,E.default.sounds.piano.blackKeys.aSharp3,E.default.sounds.piano.blackKeys.cSharp4,E.default.sounds.piano.blackKeys.dSharp4,E.default.sounds.piano.blackKeys.fSharp4,E.default.sounds.piano.blackKeys.gSharp4,E.default.sounds.piano.blackKeys.aSharp4,E.default.sounds.piano.blackKeys.cSharp5,E.default.sounds.piano.blackKeys.dSharp5,E.default.sounds.piano.blackKeys.fSharp5,E.default.sounds.piano.blackKeys.gSharp5,E.default.sounds.piano.blackKeys.aSharp5],W=-7.6001,H=1;for(V=0;V<z.length;V++){var X;(X=new R.PianoKey(A,new Transform({position:new Vector3(W,.12,1),scale:new Vector3(.45,2,1),rotation:new Quaternion(.70711,0,0,.70711)}),Color3.Black(),z[V],E.default.trigger.triggerBlackPianoKey,V+M.length)).setParent(v),R.keys.push(X),W+=++H%3!=0?.8:1.6,6===H&&(H=1)}(0,R.addKeyListeners)()}})),define("src/modules/ambientSound",["require","exports","@dcl/ecs-scene-utils"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.AmbientSound=void 0;var R=function(v){function AmbientSound(A,R,M,O,V){void 0===M&&(M=0),void 0===O&&(O=!1),void 0===V&&(V=1);var z=v.call(this)||this;return z.clip=new AudioClip(R),z.source=new AudioSource(z.clip),z.addComponent(z.source),z.addComponent(new Transform(A)),engine.addEntity(z),M>1?(z.source.loop=!1,z.addComponent(new E.Interval(M,(function(){z.source.playOnce()})))):O&&(z.source.loop=!0,z.source.playing=!0),z.source.volume=V,z}return __extends(AmbientSound,v),AmbientSound.prototype.play=function(){this.source.playOnce()},AmbientSound.prototype.stop=function(){this.source.playing=!1},AmbientSound}(Entity);A.AmbientSound=R})),define("src/zenquencer/resources",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.default={models:{pool:new GLTFShape("models/zenquencer/pool.glb"),stone:new GLTFShape("models/zenquencer/stone.glb"),linearButton:new GLTFShape("models/zenquencer/linear.glb"),randomButton:new GLTFShape("models/zenquencer/random.glb"),speedButton:new GLTFShape("models/zenquencer/speedButton.glb"),tube:new GLTFShape("models/zenquencer/tube.glb")},sounds:{kalimbaNotes:{f3:new AudioClip("sounds/zenquencer/f3.mp3"),a3:new AudioClip("sounds/zenquencer/a3.mp3"),c3:new AudioClip("sounds/zenquencer/c3.mp3"),a4:new AudioClip("sounds/zenquencer/a4.mp3"),e4:new AudioClip("sounds/zenquencer/e4.mp3"),f4:new AudioClip("sounds/zenquencer/f4.mp3"),g4:new AudioClip("sounds/zenquencer/g4.mp3")}}}})),define("src/zenquencer/musicalDrops",["require","exports","src/zenquencer/stones","src/zenquencer/stones","src/zenquencer/zenquencerBuilder"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.loopPlayer=A.PlaySequence=A.MusicalDrop=A.drops=A.loopDuration=void 0,A.loopDuration=60,A.drops=[];var O=function(v){function MusicalDrop(A,E,R,M){var O=v.call(this)||this;return engine.addEntity(O),O.addComponent(E),O.note=M,O.shape=A,O.addComponent(new AudioSource(R)),O.anim=new AnimationState("ArmatureAction.001",{looping:!1}),O.addComponent(new Animator).addClip(O.anim),O}return __extends(MusicalDrop,v),MusicalDrop.prototype.play=function(){this.getComponent(AudioSource).playOnce(),this.anim.stop(),this.anim.play()},MusicalDrop}(Entity);A.MusicalDrop=O;var V=function(){function PlaySequence(v,A,E){this.durationLeft=A,this.loopDuration=v,this.beats=E,this.currentLoop=0,this.currentBeat=0,this.beatDuration=this.loopDuration/this.beats}return PlaySequence.prototype.update=function(v){if(this.playingMode&&(this.durationLeft-=v,this.durationLeft<0&&(this.playingMode=0,M.energyAnimation.stop(),M.linear.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),M.random.getComponent(Transform).rotation=Quaternion.Euler(0,180,0)),this.currentLoop+=v,this.currentLoop>=this.currentBeat*this.beatDuration))if(this.currentBeat+=1,this.currentBeat>=this.beats&&(this.currentLoop=0,this.currentBeat=0,log("new loop")),1===this.playingMode)for(var A=0;A<7;A++)E.seqNumbers[this.currentBeat][A]&&R.stones[7*this.currentBeat+A].drop.play();else{var O=Math.floor(Math.random()*this.beats);for(A=0;A<7;A++)E.seqNumbers[O][A]&&R.stones[7*O+A].drop.play()}},PlaySequence}();A.PlaySequence=V,A.loopPlayer=new V(8,A.loopDuration,16),engine.addSystem(A.loopPlayer)})),define("src/modules/realmData",["require","exports","@decentraland/EnvironmentAPI"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.getRealm=A.setRealm=A.playerRealm=void 0,A.setRealm=function(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(R){switch(R.label){case 0:return[4,(0,E.getCurrentRealm)()];case 1:return v=R.sent(),log("You are in the realm: ".concat(JSON.stringify(v.displayName))),A.playerRealm=v.displayName,[2]}}))}))},A.getRealm=function(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(A){switch(A.label){case 0:return[4,(0,E.getCurrentRealm)()];case 1:return v=A.sent(),log("You are in the realm: ".concat(JSON.stringify(v.displayName))),[2,v.displayName]}}))}))}})),define("src/zenquencer/serverHandler",["require","exports","src/zenquencer/stones","src/modules/realmData","@dcl/ecs-scene-utils"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.changeSequencer=A.getStones=A.fireBaseServer=A.awsServer=void 0,A.awsServer="https://genesis-plaza.s3.us-east-2.amazonaws.com/",A.fireBaseServer="https://us-central1-genesis-plaza.cloudfunctions.net/app/",A.getStones=function(){return __awaiter(this,void 0,void 0,(function(){var v;return __generator(this,(function(E){switch(E.label){case 0:return E.trys.push([0,5,,6]),R.playerRealm?[3,2]:[4,(0,R.setRealm)()];case 1:E.sent(),E.label=2;case 2:return v=A.awsServer+"sequencer/"+R.playerRealm+"/stones.json",log("url used ",v),[4,fetch(v)];case 3:return[4,E.sent().json()];case 4:return[2,E.sent().stones];case 5:return E.sent(),log("error fetching from AWS server"),[3,6];case 6:return[2]}}))}))},A.changeSequencer=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return R.playerRealm?[3,2]:[4,(0,R.setRealm)()];case 1:v.sent(),v.label=2;case 2:return O.addComponentOrReplace(new M.Delay(1e3,(function(){return __awaiter(this,void 0,void 0,(function(){var v,M;return __generator(this,(function(O){switch(O.label){case 0:return O.trys.push([0,2,,3]),v=A.fireBaseServer+"update-sequencer?realm="+R.playerRealm,M=JSON.stringify({stones:E.seqNumbers}),[4,fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:M})];case 1:return[2,O.sent().json()];case 2:return O.sent(),log("error fetching from AWS server"),[3,3];case 3:return[2]}}))}))}))),[2]}}))}))};var O=new Entity;engine.addEntity(O)})),define("src/zenquencer/stones",["require","exports","src/zenquencer/musicalDrops","src/zenquencer/serverHandler","src/modules/serverHandler"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.Stone=A.seqNumbers=A.stones=void 0,A.stones=[],A.seqNumbers=[];var O=function(v){function Stone(A,R,O,V,z){var W=v.call(this)||this;W.stoneOn=!1,W.setParent(z),engine.addEntity(W),W.addComponent(A),W.addComponent(R),W.sound=O,W.index=V;var H=W;return W.addComponent(new OnPointerDown((function(v){log("toggle stone"),W.stoneOn?M.sceneMessageBus.emit("hideStone",{stone:H.index}):M.sceneMessageBus.emit("showStone",{stone:H.index})}),{button:ActionButton.POINTER,hoverText:"Toggle"})),W.drop=new E.MusicalDrop(new GLTFShape("models/zenquencer/music-drop.glb"),new Transform({position:new Vector3(0,0,0)}),W.sound,W.index),W.drop.setParent(W),W.drop.removeComponent(GLTFShape),E.drops.push(W.drop),W}return __extends(Stone,v),Stone}(Entity);A.Stone=O,M.sceneMessageBus.on("showStone",(function(v){A.stones[v.stone].stoneOn=!0,A.stones[v.stone].getComponent(Transform).rotation=Quaternion.Euler(0,0,0),A.stones[v.stone].drop.addComponentOrReplace(A.stones[v.stone].drop.shape),E.loopPlayer.playingMode||A.stones[v.stone].drop.play();var M=v.stone%7,O=Math.floor(v.stone/7);log("beat ",O," note ",M),A.seqNumbers[O][M]=1,(0,R.changeSequencer)()})),M.sceneMessageBus.on("hideStone",(function(v){A.stones[v.stone].stoneOn=!1,A.stones[v.stone].getComponent(Transform).rotation=Quaternion.Euler(180,0,0),A.stones[v.stone].drop.removeComponent(GLTFShape);var E=v.stone%7,M=Math.floor(v.stone/7);A.seqNumbers[M][E]=0,(0,R.changeSequencer)()}))})),define("src/zenquencer/zenquencerBuilder",["require","exports","@dcl/ecs-scene-utils","src/zenquencer/resources","src/zenquencer/stones","src/zenquencer/serverHandler","src/modules/serverHandler","src/zenquencer/musicalDrops"],(function(v,A,E,R,M,O,V,z){Object.defineProperty(A,"__esModule",{value:!0}),A.energyAnimation=A.random=A.linear=A.addZenquencer=void 0,A.addZenquencer=function(){var v=new E.TriggerBoxShape(new Vector3(40,4,40),new Vector3(0,2,0)),W=new Entity;W.addComponent(R.default.models.pool),W.addComponent(new Transform({position:new Vector3(127,.55,225),rotation:Quaternion.Euler(0,315,0)})),W.addComponent(new E.TriggerComponent(v,{onCameraEnter:function(){!function(){__awaiter(this,void 0,void 0,(function(){var v,A,E,R;return __generator(this,(function(V){switch(V.label){case 0:return[4,(0,O.getStones)()];case 1:if(!(v=V.sent()))return[2];for(log(v),A=0;A<v.length;A++)for(E=0;E<v[A].length;E++)M.seqNumbers[A][E]=v[A][E],R=M.stones[7*A+E],0===v[A][E]?(R.stoneOn=!1,R.drop.removeComponent(GLTFShape)):(R.stoneOn=!0,R.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),R.drop.addComponentOrReplace(R.drop.shape));return[2]}}))}))}()}})),engine.addEntity(W);for(var H=new Vector3(7.5,.3,-3),X=[R.default.sounds.kalimbaNotes.f3,R.default.sounds.kalimbaNotes.a3,R.default.sounds.kalimbaNotes.c3,R.default.sounds.kalimbaNotes.e4,R.default.sounds.kalimbaNotes.f4,R.default.sounds.kalimbaNotes.g4,R.default.sounds.kalimbaNotes.a4],K=0;K<16;K++){M.seqNumbers.push([]);for(var Z=0;Z<X.length;Z++){var J=new M.Stone(R.default.models.stone,new Transform({position:new Vector3(H.x-K,H.y,H.z+Z),scale:new Vector3(1,1,1),rotation:Quaternion.Euler(180,0,0)}),X[Z],7*K+Z,W);J.setParent(W),M.stones.push(J),M.seqNumbers[K].push(0)}}var $=new Entity;$.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),$.addComponent(new Animator).addClip(A.energyAnimation),$.setParent(W),$.addComponent(R.default.models.tube),engine.addEntity($),A.linear.addComponent(new Transform({position:new Vector3(-9.54,1.48,4.59),rotation:Quaternion.Euler(0,180,0)})),A.linear.addComponent(R.default.models.linearButton),A.linear.setParent($),engine.addEntity(A.linear),A.linear.addComponent(new OnPointerDown((function(){V.sceneMessageBus.emit("seqOn",{})}),{hoverText:"Loop"})),A.random.addComponent(new Transform({position:new Vector3(-9.54,1.49,4.33),rotation:Quaternion.Euler(0,180,0)})),A.random.addComponent(R.default.models.randomButton),engine.addEntity(A.random),A.random.setParent($),A.random.addComponent(new OnPointerDown((function(){V.sceneMessageBus.emit("randomMode",{})}),{hoverText:"Random"}));var ee=new Entity;ee.addComponent(new Transform({position:new Vector3(-9.54,1.6,4.59),rotation:Quaternion.Euler(0,180,0)})),ee.addComponent(R.default.models.speedButton),ee.setParent($),engine.addEntity(ee),ee.addComponent(new OnPointerDown((function(){V.sceneMessageBus.emit("seqSpeed",{speed:12})}),{hoverText:"Very Slow"}));var ne=new Entity;ne.addComponent(new Transform({position:new Vector3(-9.54,1.6,4.53),rotation:Quaternion.Euler(0,180,0)})),ne.addComponent(R.default.models.speedButton),ne.setParent($),engine.addEntity(ne),ne.addComponent(new OnPointerDown((function(){V.sceneMessageBus.emit("seqSpeed",{speed:8})}),{hoverText:"Slow"}));var oe=new Entity;oe.addComponent(new Transform({position:new Vector3(-9.54,1.6,4.47),rotation:Quaternion.Euler(0,180,0)})),oe.addComponent(R.default.models.speedButton),oe.setParent($),engine.addEntity(oe),oe.addComponent(new OnPointerDown((function(){V.sceneMessageBus.emit("seqSpeed",{speed:4})}),{hoverText:"Normal"}));var ie=new Entity;ie.addComponent(new Transform({position:new Vector3(-9.54,1.6,4.41),rotation:Quaternion.Euler(0,180,0)})),ie.addComponent(R.default.models.speedButton),ie.setParent($),engine.addEntity(ie),ie.addComponent(new OnPointerDown((function(){V.sceneMessageBus.emit("seqSpeed",{speed:2})}),{hoverText:"Fast"}));var ae=new Entity;ae.addComponent(new Transform({position:new Vector3(-9.54,1.6,4.35),rotation:Quaternion.Euler(0,180,0)})),ae.addComponent(R.default.models.speedButton),ae.setParent($),engine.addEntity(ae),ae.addComponent(new OnPointerDown((function(){V.sceneMessageBus.emit("seqSpeed",{speed:1})}),{hoverText:"Very Fast"})),V.sceneMessageBus.on("playStone",(function(v){z.drops[v.note].play()})),V.sceneMessageBus.on("seqOn",(function(v){z.loopPlayer.playingMode=1,z.loopPlayer.currentBeat=-1,z.loopPlayer.durationLeft=z.loopDuration,z.loopPlayer.currentLoop=0,A.linear.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),A.random.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),oe.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),A.energyAnimation.stop(),A.energyAnimation.play()})),V.sceneMessageBus.on("randomMode",(function(v){z.loopPlayer.playingMode=2,z.loopPlayer.currentBeat=-1,z.loopPlayer.durationLeft=z.loopDuration,z.loopPlayer.currentLoop=0,A.random.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),A.linear.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),oe.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),A.energyAnimation.stop(),A.energyAnimation.play()})),V.sceneMessageBus.on("seqOff",(function(v){z.loopPlayer.playingMode=0,A.linear.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),A.random.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),oe.getComponent(Transform).rotation=Quaternion.Euler(0,180,0)})),V.sceneMessageBus.on("seqSpeed",(function(v){if(z.loopPlayer.playingMode){var A=4*v.speed;switch(log("new duration = ",A),z.loopPlayer.loopDuration=A,z.loopPlayer.beatDuration=z.loopPlayer.loopDuration/z.loopPlayer.beats,z.loopPlayer.currentLoop=z.loopPlayer.currentBeat*z.loopPlayer.beatDuration,v.speed){case 12:ee.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),ne.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),oe.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),ie.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),ae.getComponent(Transform).rotation=Quaternion.Euler(0,180,0);break;case 8:ee.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),ne.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),oe.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),ie.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),ae.getComponent(Transform).rotation=Quaternion.Euler(0,180,0);break;case 4:ee.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),ne.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),oe.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),ie.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),ae.getComponent(Transform).rotation=Quaternion.Euler(0,180,0);break;case 2:ee.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),ne.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),oe.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),ie.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),ae.getComponent(Transform).rotation=Quaternion.Euler(0,180,0);break;case 1:ee.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),ne.getComponent(Transform).rotation=Quaternion.Euler(0,180,0),oe.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),ie.getComponent(Transform).rotation=Quaternion.Euler(0,0,0),ae.getComponent(Transform).rotation=Quaternion.Euler(0,0,0)}}else V.sceneMessageBus.emit("seqOn",{})}))},A.linear=new Entity,A.random=new Entity,A.energyAnimation=new AnimationState("Energy_Action",{looping:!1})})),define("src/modules/Utils",["require","exports","@dcl/ecs-scene-utils"],(function(v,A,E){Object.defineProperty(A,"__esModule",{value:!0}),A.addRepeatTrigger=A.shuffleArray=void 0,A.shuffleArray=function(v){for(var A,E=v.length-1;E>0;E--){var R=Math.floor(Math.random()*(E+1));A=__read([v[R],v[E]],2),v[E]=A[0],v[R]=A[1]}return v},A.addRepeatTrigger=function(v,A,R,M,O,V){void 0===R&&(R=void 0),void 0===O&&(O=!1),void 0===V&&(V=void 0);var z=new E.TriggerBoxShape(A,Vector3.Zero()),W=new Entity;W.addComponent(new Transform({position:v})),W.addComponent(new E.TriggerComponent(z,{onCameraEnter:function(){R()},onCameraExit:function(){V()},enableDebug:O})),M&&W.setParent(M),engine.addEntity(W)}})),define("src/modules/bar/doors",["require","exports","@dcl/ecs-scene-utils","src/modules/serverHandler"],(function(v,A,E,R){Object.defineProperty(A,"__esModule",{value:!0}),A.placeDoors=A.Door=void 0;var M=new AudioClip("sounds/door-open.mp3"),O=new AudioClip("sounds/door-close.mp3");M.volume=1,M.loop=!1,O.volume=1,O.loop=!1;var V=function(v){function Door(A,O,V,z,W,H,X,K){void 0===K&&(K=!0);var Z=v.call(this)||this;if(Z.isOpen=!1,Z.isPlayerIn=!1,engine.addEntity(Z),Z.addComponent(A),Z.addComponent(new Transform(O)),Z.addComponent(new Animator),Z.animationOpen=new AnimationState(W,{looping:!1}),Z.getComponent(Animator).addClip(Z.animationOpen),Z.animationClose=new AnimationState(H,{looping:!1}),Z.getComponent(Animator).addClip(Z.animationClose),Z.addComponent(new AudioSource(M)),K){var J=new Entity;J.addComponent(new Transform(V));var $=new E.TriggerBoxShape(z,Vector3.Zero());J.addComponent(new E.TriggerComponent($,{onCameraEnter:function(){log("open door"),Z.isPlayerIn=!0,R.sceneMessageBus.emit(X,{open:!0})},onCameraExit:function(){log("close door"),Z.isPlayerIn=!1,R.sceneMessageBus.emit(X,{open:!1})}})),engine.addEntity(J)}return Z.animationOpen.stop(),Z}return __extends(Door,v),Door.prototype.open=function(){if(!this.isOpen){this.animationClose.stop(),this.animationOpen.stop(),this.animationOpen.play(),this.isOpen=!0;var v=new AudioSource(M);this.addComponentOrReplace(v),v.playing=!0}},Door.prototype.close=function(){if(this.isOpen&&!this.isPlayerIn){this.animationOpen.stop(),this.animationClose.stop(),this.animationClose.play(),this.isOpen=!1;var v=new AudioSource(O);this.addComponentOrReplace(v),v.playing=!0}},Door}(Entity);A.Door=V,A.placeDoors=function(){var v=new V(new GLTFShape("models/core_building/Door_Entrance_L.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(160,2,126)},new Vector3(16,8,8),"DoorLeft_Open","DoorLeft_Close","mainDoor"),A=new V(new GLTFShape("models/core_building/Door_Entrance_R.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(160,2,126)},new Vector3(16,8,8),"DoorRight_Open","DoorRight_Close","mainDoor",!1);R.sceneMessageBus.on("mainDoor",(function(E){E.open?(v.open(),A.open()):(v.close(),A.close())}));var E=new V(new GLTFShape("models/core_building/Door_Entrance_Right_L.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(186,2,153)},new Vector3(8,8,16),"EntranceRight_DoorLeft_Open","EntranceRight_DoorLeft_Close","rightDoor"),M=new V(new GLTFShape("models/core_building/Door_Entrance_Right_R.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(186,2,153)},new Vector3(8,8,16),"EntranceRight_DoorRight_Open","EntranceRight_DoorRight_Close","rightDoor",!1);R.sceneMessageBus.on("rightDoor",(function(v){v.open?(E.open(),M.open()):(E.close(),M.close())}));var O=new V(new GLTFShape("models/core_building/Door_Entrance_Left_L.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(135,2,153)},new Vector3(8,8,16),"EntranceLeft_DoorLeft_Open","EntranceLeft_DoorLeft_Close","leftDoor"),z=new V(new GLTFShape("models/core_building/Door_Entrance_Left_R.glb"),{rotation:Quaternion.Euler(0,180,0)},{position:new Vector3(135,2,153)},new Vector3(8,8,16),"EntranceLeft_DoorRight_Open","EntranceLeft_DoorRight_Close","leftDoor",!1);R.sceneMessageBus.on("leftDoor",(function(v){v.open?(O.open(),z.open()):(O.close(),z.close())}))}})),define("src/modules/artichoke",["require","exports","src/modules/serverHandler","@dcl/ecs-scene-utils","src/modules/bar/jukebox"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.startArtichoke=void 0,A.startArtichoke=function(){var v=!1,A=null,O=new Entity;engine.addEntity(O);var V=null,z=new Entity;z.addComponent(new GLTFShape("models/console-artichoke/base_console.glb")),z.addComponent(new Transform({position:new Vector3(44.8,8.5,36.8),rotation:Quaternion.Euler(0,60,0)})),engine.addEntity(z);var W=function(v){function ConsoleButton(A,E,R){var M=v.call(this)||this;return engine.addEntity(M),M.addComponent(A),M.setParent(E),M.addComponent(new AudioSource(new AudioClip("sounds/click.mp3"))),M.addComponent(new Animator),M.clickAnim=new AnimationState(R,{looping:!1}),M.getComponent(Animator).addClip(M.clickAnim),M}return __extends(ConsoleButton,v),ConsoleButton.prototype.press=function(){this.clickAnim.stop(),this.clickAnim.play(),this.getComponent(AudioSource).playOnce()},ConsoleButton}(Entity),H=new W(new GLTFShape("models/console-artichoke/blue_button.glb"),z,"Blue_ButtonAction");H.addComponent(new OnPointerDown((function(){E.sceneMessageBus.emit("setRadio",{station:M.Radios.RAVE}),H.press()}),{button:ActionButton.PRIMARY,hoverText:"Rave"}));var X=new W(new GLTFShape("models/console-artichoke/green_button.glb"),z,"Green_ButtonAction");X.addComponent(new OnPointerDown((function(){E.sceneMessageBus.emit("setRadio",{station:M.Radios.JAZZ}),X.press()}),{button:ActionButton.PRIMARY,hoverText:"Vegas Jazz FM"}));var K=new W(new GLTFShape("models/console-artichoke/lightblue_button.glb"),z,"Lightblue_ButtonAction");K.addComponent(new OnPointerDown((function(){E.sceneMessageBus.emit("setRadio",{station:M.Radios.DELTA}),K.press()}),{button:ActionButton.PRIMARY,hoverText:"Delta"}));var Z=new W(new GLTFShape("models/console-artichoke/red_button.glb"),z,"Red_ButtonAction");Z.addComponent(new OnPointerDown((function(){E.sceneMessageBus.emit("setRadio",{station:M.Radios.SIGNS}),Z.press()}),{button:ActionButton.PRIMARY,hoverText:"Signs"}));var J=new W(new GLTFShape("models/console-artichoke/yellow_button.glb"),z,"Yellow_ButtonAction");function radioOn(A){$.play(),ee.play(),ne.play(),v&&O.addComponent(new R.Delay(100,(function(){V=new AudioStream(A),O.addComponentOrReplace(V)})))}J.addComponent(new OnPointerDown((function(){E.sceneMessageBus.emit("setRadio",{station:M.Radios.GRAFFITI}),J.press()}),{button:ActionButton.PRIMARY,hoverText:"Graffiti Kings"})),E.sceneMessageBus.on("setRadio",(function(v){V&&(V.playing=!1,V=null),A=v.station,radioOn(v.station)}));var $=new AnimationState("Lights_Anim"),ee=new AnimationState("LightsB_Artichoke"),ne=new AnimationState("LightsC_Artichoke"),oe=new Entity;oe.addComponent(new GLTFShape("models/LightsA_Artichoke.glb")),oe.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),oe.addComponent(new Animator).addClip($),engine.addEntity(oe);var ie=new Entity;ie.addComponent(new GLTFShape("models/LightsB_Artichoke.glb")),ie.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),ie.addComponent(new Animator).addClip(ee),engine.addEntity(ie);var ae=new Entity;ae.addComponent(new GLTFShape("models/LightsC_Artichoke.glb")),ae.addComponent(new Transform({rotation:Quaternion.Euler(0,180,0)})),ae.addComponent(new Animator).addClip(ne),engine.addEntity(ae),$.stop(),ee.stop(),ne.stop();var se=new Entity;se.addComponent(new Transform({position:new Vector3(47,6,46)}));var le=new R.TriggerBoxShape(new Vector3(90,14,90),Vector3.Zero());se.addComponent(new R.TriggerComponent(le,{onCameraEnter:function(){E.sceneMessageBus.emit("enteredRadioRange",{}),v=!0,A&&radioOn(A),log("triggered!")},onCameraExit:function(){v=!1,$.stop(),ee.stop(),ne.stop(),V&&(V.playing=!1)}})),engine.addEntity(se),E.sceneMessageBus.on("enteredRadioRange",(function(R){v&&null!==A&&E.sceneMessageBus.emit("setRadio",{station:A})}))}})),define("src/game",["require","exports","src/modules/platforms","src/modules/wearables","src/modules/museumItems","src/modules/video","src/modules/buildings","src/modules/npcRobotBuilder","src/modules/nftBuilder","src/piano/pianoBuilder","src/modules/serverHandler","src/modules/ambientSound","src/zenquencer/zenquencerBuilder","src/modules/Utils","src/modules/messageboard","src/modules/bar/doors","@dcl/ecs-scene-utils","src/lobby/resources/sounds","src/modules/bar/jukebox","src/modules/bar/barNPCs","src/modules/artichoke","src/quests"],(function(v,A,E,R,M,O,V,z,W,H,X,K,Z,J,$,ee,ne,oe,ie,ae,se,le){function insideBar(){ae.areNPCsAdded||((0,le.handleQuests)(),(0,ae.addBarNPCs)()),(0,ie.placeJukeBox)(),(0,ie.addMicFeedback)()}function outsideBar(){log("CALLING OUTSIDE BAR"),A.isOutsideLoaded||(A.isOutsideLoaded=!0,oe.lobbyMusicSource.playing=!1,(0,ae.addNPCsOutside)(),(0,E.placePlatforms)(),(0,O.addScreen)(),(0,se.startArtichoke)(),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(60,60,60),new Vector3(180,2,244)),{onCameraEnter:function(){(0,M.placeMuseumPieces)()}}),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(50,50,50),new Vector3(275,5,130)),{onCameraEnter:function(){(0,R.addWearables)(),(0,M.placeWearablePieces)(),log("loading wearables")}}),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(80,80,80),new Vector3(269,5,37)),{onCameraEnter:function(){(0,X.updateMarketData)(),(0,M.placeTradecenterPieces)()}}),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(60,60,60),new Vector3(118,3,39)),{onCameraEnter:function(){(0,M.placeGardenPieces)()}}),(0,z.addRobots)(),(0,W.addNFTs)(),(0,H.addPiano)(),(0,Z.addZenquencer)(),(0,$.startMessageBoards)(),new K.AmbientSound({position:new Vector3(215,2,183)},"sounds/Forest.mp3",0,!0,.6),new K.AmbientSound({position:new Vector3(117,2,42)},"sounds/Forest2.mp3",0,!0,.6))}Object.defineProperty(A,"__esModule",{value:!0}),A.outsideBar=A.isOutsideLoaded=A.insideBar=void 0,Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!0,(function(v){log("pos: ",Camera.instance.position),log("rot: ",Camera.instance.rotation)})),(0,V.addBuildings)(),(0,ee.placeDoors)(),(0,E.barPlatforms)(),ne.setTimeout(2e4,(function(){ae.areNPCsAdded||((0,le.handleQuests)(),(0,ae.addBarNPCs)())})),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(50,25,50),new Vector3(160,10,155)),{onCameraEnter:function(){insideBar()},onCameraExit:function(){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(v){switch(v.label){case 0:return[4,(0,ie.lowerVolume)()];case 1:return v.sent(),outsideBar(),log("stepped out"),[2]}}))}))}}),(0,J.addRepeatTrigger)(new Vector3(160,50,155),new Vector3(50,102,50),(function(){(0,ie.setBarMusicOn)(),log("went in")}),null,!1,(function(){(0,ie.outOfBar)(),(0,ae.endArtistTalk)(),(0,ie.lowerVolume)(),log("mid distance")})),(0,J.addRepeatTrigger)(new Vector3(160,30,155),new Vector3(75,60,75),(function(){(0,ie.lowerVolume)(),log("got closer")}),null,!1,(function(){(0,ie.setBarMusicOff)(),log("got far")})),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(2,5,305),new Vector3(0,2,160)),{onCameraEnter:function(){log("WEST BORDER"),outsideBar()}}),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(2,5,320),new Vector3(320,2,155)),{onCameraEnter:function(){log("EAST BORDER"),outsideBar()}}),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(320,5,2),new Vector3(165,2,0)),{onCameraEnter:function(){log("SOUTH BORDER"),outsideBar()}}),ne.addOneTimeTrigger(new ne.TriggerBoxShape(new Vector3(320,5,2),new Vector3(155,2,300)),{onCameraEnter:function(){log("NORTH BORDER"),outsideBar()}}),A.insideBar=insideBar,A.isOutsideLoaded=!1,A.outsideBar=outsideBar})),define("src/lobby/checkApi",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.getTimeStamp=A.getCurrentTime=A.getTrendingScenes=A.getEvents=void 0,A.getEvents=function(v){return __awaiter(this,void 0,void 0,(function(){var A,E,R,M,O,V,z,W,H;return __generator(this,(function(X){switch(X.label){case 0:A=[],E="https://events.decentraland.org/api/events/?limit="+v.toString(),X.label=1;case 1:return X.trys.push([1,4,,5]),[4,fetch(E)];case 2:return[4,X.sent().json()];case 3:R=X.sent();try{for(M=__values(R.data),O=M.next();!O.done;O=M.next())V=O.value,A.push(V)}catch(v){W={error:v}}finally{try{O&&!O.done&&(H=M.return)&&H.call(M)}finally{if(W)throw W.error}}return[2,A];case 4:return z=X.sent(),log("error getting event data ",z),[3,5];case 5:return[2]}}))}))},A.getTrendingScenes=function(v){return __awaiter(this,void 0,void 0,(function(){var A,E,R,M,O,V,z,W,H;return __generator(this,(function(X){switch(X.label){case 0:A=[],E="https://peer.decentraland.org/lambdas/explore/hot-scenes/",X.label=1;case 1:return X.trys.push([1,4,,5]),[4,fetch(E)];case 2:return[4,X.sent().json()];case 3:R=X.sent();try{for(M=__values(R),O=M.next();!O.done;O=M.next())if((V=O.value).usersTotalCount.toFixed()>1){if(!(A.length<v))break;A.push(V)}}catch(v){W={error:v}}finally{try{O&&!O.done&&(H=M.return)&&H.call(M)}finally{if(W)throw W.error}}return log(R),[2,A];case 4:return z=X.sent(),log("error getting trending scene data ",z),[3,5];case 5:return[2]}}))}))},A.getCurrentTime=function(){return __awaiter(this,void 0,void 0,(function(){var v,A,E;return __generator(this,(function(R){switch(R.label){case 0:v="https://worldtimeapi.org/api",R.label=1;case 1:return R.trys.push([1,4,,5]),[4,fetch(v)];case 2:return[4,R.sent().json()];case 3:return A=R.sent(),log(A),[2,A];case 4:return E=R.sent(),log("error getting event data ",E),[3,5];case 5:return[2]}}))}))},A.getTimeStamp=function(){var v=new Date,A=v.getUTCFullYear(),E=v.getUTCMonth()+1,R=E.toString();E<10&&(R="0"+E);var M=v.getUTCDate(),O=M.toString();M<10&&(O="0"+M);var V=v.getUTCHours(),z=V.toString();V<10&&(z="0"+V);var W=v.getUTCMinutes(),H=W.toString();W<10&&(H="0"+W);var X=v.getUTCSeconds(),K=X.toString();X<10&&(K="0"+X);var Z=v.getUTCSeconds(),J=X.toString();Z<100&&(J="0"+Z),Z<10&&(J="0"+J);var $=A+"-"+R+"-"+O+"T"+z+":"+H+":"+K+"."+J+"Z";return log("DATE:NOW: "+$),$}})),define("src/lobby/thumbnail",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.ThumbnailPlane=void 0;var E=function(v){function ThumbnailPlane(A,E,R){var M=v.call(this)||this;return M.planeShape=new PlaneShape,M.planeShape.withCollisions=!1,M.material=new Material,M.material.albedoTexture=A,M.material.specularIntensity=0,M.material.metallic=0,M.material.roughness=1,R&&(M.material.alphaTexture=R),M.planeShape.uvs=[0,0,1,0,1,1,0,1,1,0,0,0,0,1,1,1],M.addComponent(M.planeShape),M.addComponent(M.material),M.addComponent(new Transform({position:new Vector3(E.position.x,E.position.y,E.position.z),scale:new Vector3(E.scale.x,E.scale.y,E.scale.z)})),M}return __extends(ThumbnailPlane,v),ThumbnailPlane.prototype.updateImage=function(v){this.material.albedoTexture=v},ThumbnailPlane}(Entity);A.ThumbnailPlane=E})),define("src/lobby/helperFunctions",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.monthToString=A.shortenText=A.wordWrap=A.cleanString=A.splitTextIntoLines=void 0,A.splitTextIntoLines=function(v,A,E){for(var R="",M=0;M<v.length;M++){var O=R.split("\n");if(O[O.length-1].length>=A&&M!==v.length){if(" "!==R[R.length-1]){if(E&&O.length>=E)return R.concat("...");R=R.concat("-")}if(R=R.concat("\n")," "===v[M])continue}R=R.concat(v[M])}return R},A.cleanString=function(v){for(var A="",E=0;E<v.length;E++)(v.charCodeAt(E)<=127||v.charCodeAt(E)>=160&&v.charCodeAt(E)<=255)&&(A+=v.charAt(E));return A},A.wordWrap=function(v,A,E){for(var R,M="\n",O="",V=v.split(M),z="",W=0;W<V.length;W++){for(O="";V[W].length>A;){for(var H=!1,X=A-1;X>=0;X--)if(R=V[W].charAt(X),new RegExp(/^\s$/).test(R.charAt(0))){O+=[V[W].slice(0,X),M].join(""),V[W]=V[W].slice(X+1),H=!0;break}H||(O+=[V[W].slice(0,A),M].join(""),V[W]=V[W].slice(A))}z+=O+V[W]+"\n"}var K=z.split("\n"),Z="";for(X=0;X<E&&X<K.length;X++)Z+=K[X]+"\n";return K.length>E&&(Z+="..."),Z},A.shortenText=function(v,A){return v.length>A?v.substring(0,A).concat("..."):v},A.monthToString=function(v){switch(v){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec"}return"N/A"}})),define("src/lobby/simpleAnimator",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.AnimatedItem=void 0;var E=function(){function AnimatedItem(v,A,E){this.wasClicked=!1,this.isHighlighted=!1,this.animFraction=0,this.animVeclocity=0,this.speed=2,this.defaultTransform=v,this.highlightTransform=A,this.speed=E}return __decorate([Component("AnimatedItem")],AnimatedItem)}();A.AnimatedItem=E;var R=function(){function ItemAnimationSystem(){this.group=engine.getComponentGroup(E,Transform)}return ItemAnimationSystem.prototype.update=function(v){var A,R;try{for(var M=__values(this.group.entities),O=M.next();!O.done;O=M.next()){var V=O.value,z=V.getComponent(E),W=V.getComponent(Transform);z.isHighlighted?(W.scale=this.springVec3(z.highlightTransform.scale,W.scale,z.animVeclocity,z.speed*v),W.position=this.springVec3(z.highlightTransform.position,W.position,z.animVeclocity,z.speed*v)):(W.scale=this.springVec3(z.defaultTransform.scale,W.scale,z.animVeclocity,z.speed*v),W.position=this.springVec3(z.defaultTransform.position,W.position,z.animVeclocity,z.speed*v))}}catch(v){A={error:v}}finally{try{O&&!O.done&&(R=M.return)&&R.call(M)}finally{if(A)throw A.error}}},ItemAnimationSystem.prototype.springPos=function(v,A,E,R){return A+(E+=(60*(v-A)+10*-E)*R)*R},ItemAnimationSystem.prototype.springVec3=function(v,A,E,R){var M=v.subtract(A),O=(E+=(50*M.length()+2*-E*Math.sqrt(50))*R)*R;return A.add(M.normalize().multiplyByFloats(O,O,O))},ItemAnimationSystem}();engine.addSystem(new R)})),define("src/lobby/menuItem",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.MenuItem=void 0;var E=function(v){function MenuItem(){var A=v.call(this)||this;return A.selected=!1,A.defaultItemScale=new Vector3(2,2,2),A}return __extends(MenuItem,v),MenuItem.prototype.updateItemInfo=function(v){},MenuItem.prototype.select=function(){},MenuItem.prototype.deselect=function(v){},MenuItem.prototype.show=function(){},MenuItem.prototype.hide=function(){},MenuItem}(Entity);A.MenuItem=E})),define("src/lobby/menuItemEvent",["require","exports","src/lobby/thumbnail","src/lobby/helperFunctions","src/lobby/simpleAnimator","src/lobby/resources/resources","src/lobby/menuItem","src/lobby/resources/globals"],(function(v,A,E,R,M,O,V,z){Object.defineProperty(A,"__esModule",{value:!0}),A.EventMenuItem=void 0;var W=new Entity;W.addComponent(new Transform({position:new Vector3(z.lobbyCenter.x,z.lobbyCenter.y-20,z.lobbyCenter.z)})),W.addComponent(O.liveSignShape),engine.addEntity(W);var H=function(v){function EventMenuItem(A,V,z){var W=v.call(this)||this;W.addComponent(new Transform(A)),W.itemBox=new Entity,W.itemBox.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1)})),W.itemBox.addComponent(O.menuTitleBGShape),W.itemBox.setParent(W),W.defaultItemScale=new Vector3(2,2,2),W.scale=new Vector3(1,.5,1),W.scaleMultiplier=1.2,W.thumbNail=new E.ThumbnailPlane(new Texture(z.image),{position:new Vector3(.25,.27,0),scale:new Vector3(1.1,.55,1)},V),W.thumbNail.setParent(W.itemBox),W.leftDetailsRoot=new Entity,W.leftDetailsRoot.addComponent(new Transform({position:new Vector3(-.32,.28,-.02),scale:new Vector3(.9,.9,.9)})),W.leftDetailsRoot.setParent(W.itemBox),W.live=z.live,W.liveText=new TextShape,W.liveText.fontSize=3,W.liveText.color=Color3.Green(),W.liveSign=new Entity,W.liveSign.addComponent(new Transform({position:new Vector3(-.25,0,0),scale:new Vector3(.4,.4,.4)})),W.liveSign.addComponent(O.liveSignShape),W.dateBG=new Entity,W.dateBG.addComponent(new Transform({position:new Vector3(-.25,0,0),scale:new Vector3(.4,.4,.4)})),W.dateBG.addComponent(O.dateBGShape),W.dateRoot=new Entity,W.dateRoot.addComponent(new Transform({position:new Vector3(0,-.15,-.05)})),W.dateRoot.setParent(W.dateBG),W.dateMonthRoot=new Entity,W.dateMonthRoot.addComponent(new Transform({position:new Vector3(0,.25,-.05)})),W.dateMonthRoot.setParent(W.dateBG);var H=new TextShape,X=new TextShape;W.date=new Date(z.next_start_at),H.value=W.date.getDate().toString(),H.fontSize=5,H.color=O.dateDayColor,H.outlineColor=O.dateDayColor,H.outlineWidth=.2,X.value=(0,R.monthToString)(W.date.getMonth()).toUpperCase(),X.fontSize=3,X.color=O.dateMonthColor,W.dateRoot.addComponent(H),W.dateMonthRoot.addComponent(X),W.live?W.liveSign.setParent(W.leftDetailsRoot):W.dateBG.setParent(W.leftDetailsRoot),W.addComponent(new M.AnimatedItem({position:new Vector3(0,0,0),scale:new Vector3(W.defaultItemScale.x,W.defaultItemScale.y,W.defaultItemScale.z)},{position:new Vector3(0,0,-.6),scale:new Vector3(2.3,2.3,2.3)},2)),W.detailsRoot=new Entity,W.detailsRoot.addComponent(new Transform),W.detailsRoot.setParent(W),W.timePanel=new Entity,W.timePanel.addComponent(new Transform({position:new Vector3(-.4,0,-.2),rotation:Quaternion.Euler(0,-30,0)})),W.timePanel.addComponent(O.timePanelShape),W.timePanel.setParent(W.detailsRoot),W.timePanel.addComponent(new M.AnimatedItem({position:new Vector3(-.7,.25,.1),scale:new Vector3(0,0,0)},{position:new Vector3(-1.1,.25,-.2),scale:new Vector3(1,1,1)},2)),W.startTime=new Entity,W.startTimeText=new TextShape,W.startTimeText.font=new Font(Fonts.SanFrancisco_Heavy),W.startTimeText.value=z.next_start_at.substring(11,16)+"\nUTC",W.startTime.addComponent(new Transform({scale:new Vector3(.1,.1,.1)})),W.startTime.addComponent(W.startTimeText),W.startTime.setParent(W.timePanel),W.titleText=new TextShape,W.title=new Entity;var K=z.name;return K=(0,R.cleanString)(K),K=(0,R.wordWrap)(K,36,3),W.titleText.value=K,W.titleText.font=new Font(Fonts.SanFrancisco_Heavy),W.titleText.height=20,W.titleText.width=2,W.titleText.fontSize=2,W.titleText.color=Color3.Black(),W.titleText.hTextAlign="center",W.titleText.vTextAlign="center",W.title.addComponent(new Transform({position:new Vector3(0,-.15,-.01),scale:new Vector3(.3,.3,.3)})),W.title.addComponent(W.titleText),W.title.setParent(W.itemBox),W.coordsPanel=new Entity,W.coordsPanel.addComponent(new Transform({position:new Vector3(-.3,-.2,0),scale:new Vector3(.4,.4,.4)})),W.coordsPanel.addComponent(O.coordsPanelShape),W.coordsPanel.setParent(W.detailsRoot),W.coordsPanel.addComponent(new M.AnimatedItem({position:new Vector3(0,0,.2),scale:new Vector3(.1,.1,.1)},{position:new Vector3(-.4,-.25,-.05),scale:new Vector3(.5,.5,.5)},1.9)),W.coordsPanel.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return teleportTo(z.coordinates[0]+","+z.coordinates[1]),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"GO THERE"})),W.coords=new Entity,W.coordsText=new TextShape,W.coordsText.value=z.coordinates[0]+","+z.coordinates[1],W.coordsText.color=Color3.FromHexString("#111111"),W.coordsText.font=new Font(Fonts.SanFrancisco_Heavy),W.coords.addComponent(W.coordsText),W.coords.addComponent(new Transform({position:new Vector3(.18,-.33,-.05),scale:new Vector3(.18,.18,.18)})),W.coords.setParent(W.coordsPanel),W.jumpInButton=new Entity,W.jumpInButton.addComponent(new Transform({position:new Vector3(0,-.2,0),scale:new Vector3(.4,.4,.4)})),W.jumpInButton.addComponent(O.jumpInButtonShape),W.jumpInButton.setParent(W.detailsRoot),W.jumpInButton.addComponent(new M.AnimatedItem({position:new Vector3(0,0,.2),scale:new Vector3(.1,.1,.1)},{position:new Vector3(.4,-.25,-.05),scale:new Vector3(.5,.5,.5)},1.8)),W.jumpButtonText=new Entity,W.jumpButtonTextShape=new TextShape,W.jumpButtonTextShape.color=Color3.FromHexString("#FFFFFF"),W.jumpButtonTextShape.font=new Font(Fonts.SanFrancisco_Heavy),W.jumpButtonTextShape.hTextAlign="center",W.jumpButtonText.addComponent(W.jumpButtonTextShape),W.jumpButtonText.addComponent(new Transform({position:new Vector3(0,-.33,-.05),scale:new Vector3(.22,.22,.22)})),W.jumpButtonText.setParent(W.jumpInButton),W.live?(W.jumpButtonTextShape.value="JUMP IN",W.jumpInButton.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return teleportTo(z.coordinates[0]+","+z.coordinates[1]),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"JUMP IN"}))):(W.jumpButtonTextShape.value="SIGN UP",W.jumpInButton.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return openExternalURL("https://events.decentraland.org/en/?event="+z.id),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"CHECK EVENT PAGE"}))),W.detailTextPanel=new Entity,W.detailTextPanel.addComponent(new Transform({position:new Vector3(.8,0,.2),scale:new Vector3(0,.8,0),rotation:Quaternion.Euler(0,30,0)})),W.detailTextPanel.addComponent(O.detailsBGShape),W.detailTextPanel.setParent(W.detailsRoot),W.detailTextPanel.addComponent(new M.AnimatedItem({position:new Vector3(.8,0,.2),scale:new Vector3(0,.8,0)},{position:new Vector3(.9,0,-.1),scale:new Vector3(1,1,1)},2.2)),W.detailTitle=new TextShape,W.detailTitle.value=(0,R.wordWrap)((0,R.cleanString)(z.name),45,3),W.detailTitle.font=new Font(Fonts.SanFrancisco_Heavy),W.detailTitle.height=20,W.detailTitle.width=2,W.detailTitle.fontSize=2,W.detailTitle.color=Color3.Black(),W.detailTitle.hTextAlign="left",W.detailTitle.vTextAlign="top",W.detailEventTitle=new Entity,W.detailEventTitle.addComponent(new Transform({position:new Vector3(.1,.55,0),scale:new Vector3(.3,.3,.3)})),W.detailEventTitle.addComponent(W.detailTitle),W.detailEventTitle.setParent(W.detailTextPanel),W.detailTextContent=new TextShape,W.detailTextContent.value="\n\n"+(0,R.wordWrap)((0,R.cleanString)(z.description),75,11)+"</cspace>",W.detailTextContent.font=new Font(Fonts.SanFrancisco_Semibold),W.detailTextContent.height=20,W.detailTextContent.width=2,W.detailTextContent.fontSize=1,W.detailTextContent.color=Color3.FromHexString("#111111"),W.detailTextContent.hTextAlign="left",W.detailTextContent.vTextAlign="top",W.detailTextContent.lineSpacing="0",W.detailText=new Entity,W.detailText.addComponent(new Transform({position:new Vector3(.1,.48,0),scale:new Vector3(.4,.4,.4)})),W.detailText.addComponent(W.detailTextContent),W.detailText.setParent(W.detailTextPanel),W.readMoreButton=new Entity,W.readMoreButton.addComponent(new Transform({position:new Vector3(.23,-.2,0)})),W.readMoreButton.addComponent(O.readMoreBtnShape),W.readMoreButton.addComponent(new OnPointerDown((function(){openExternalURL("https://events.decentraland.org/en/?event="+z.id)}),{hoverText:"READ MORE"})),W.readMoreButton.setParent(W.detailTextPanel),W.highlightRays=new Entity,W.highlightRays.addComponent(new Transform),W.highlightRays.addComponent(O.highlightRaysShape),W.highlightRays.setParent(W.detailsRoot),W.highlightRays.addComponent(new M.AnimatedItem({position:new Vector3(0,0,.05),scale:new Vector3(0,0,0)},{position:new Vector3(0,0,.05),scale:new Vector3(1,1,1)},3)),W.highlightFrame=new Entity,W.highlightFrame.addComponent(new Transform),W.highlightFrame.addComponent(O.highlightFrameShape),W.highlightFrame.setParent(W.highlightRays),W}return __extends(EventMenuItem,v),EventMenuItem.prototype.updateItemInfo=function(v){this.thumbNail.updateImage(new Texture(v.image)),this.live=v.live,this.live?(this.liveSign.setParent(this.leftDetailsRoot),this.jumpButtonTextShape.value="JUMP IN",this.jumpInButton.getComponent(OnPointerDown).callback=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(A){return teleportTo(v.coordinates[0]+","+v.coordinates[1]),[2]}))}))},this.jumpInButton.getComponent(OnPointerDown).hoverText="JUMP IN",this.jumpInButton.getComponent(OnPointerDown).button=ActionButton.POINTER,this.dateBG.setParent(null)):(this.dateBG.setParent(this.leftDetailsRoot),this.jumpButtonTextShape.value="SIGN UP",this.jumpInButton.getComponent(OnPointerDown).callback=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(A){return openExternalURL("https://events.decentraland.org/en/?event="+v.id),[2]}))}))},this.jumpInButton.getComponent(OnPointerDown).hoverText="CHECK EVENT PAGE",this.jumpInButton.getComponent(OnPointerDown).button=ActionButton.POINTER,this.liveSign.setParent(null)),this.date=new Date(v.next_start_at),this.dateRoot.getComponent(TextShape).value=this.date.getDate().toString(),this.dateMonthRoot.getComponent(TextShape).value=(0,R.monthToString)(this.date.getMonth()).toUpperCase(),this.startTimeText.value=v.next_start_at.substring(11,16)+"\nUTC";var A=v.name;A=(0,R.cleanString)(A),A=(0,R.wordWrap)(A,36,3),this.title.getComponent(TextShape).value=A,this.coords.getComponent(TextShape).value=v.coordinates[0]+","+v.coordinates[1],this.coordsPanel.addComponentOrReplace(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(A){return teleportTo(v.coordinates[0]+","+v.coordinates[1]),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"GO THERE"})),this.detailTitle.value=(0,R.wordWrap)((0,R.cleanString)(v.name),45,3),this.detailTextContent.value="\n\n"+(0,R.wordWrap)((0,R.cleanString)(v.description),75,11)+"</cspace>",this.readMoreButton.getComponent(OnPointerDown).callback=function(){openExternalURL("https://events.decentraland.org/en/?event="+v.id)},this.readMoreButton.getComponent(OnPointerDown).hoverText="READ MORE"},EventMenuItem.prototype.select=function(){this.selected||(this.selected=!0,this.jumpInButton.getComponent(M.AnimatedItem).isHighlighted=!0,this.detailTextPanel.getComponent(M.AnimatedItem).isHighlighted=!0,this.highlightRays.getComponent(M.AnimatedItem).isHighlighted=!0,this.coordsPanel.getComponent(M.AnimatedItem).isHighlighted=!0,this.timePanel.getComponent(M.AnimatedItem).isHighlighted=!0)},EventMenuItem.prototype.deselect=function(v){this.selected&&(this.selected=!1),this.jumpInButton.getComponent(M.AnimatedItem).isHighlighted=!1,this.detailTextPanel.getComponent(M.AnimatedItem).isHighlighted=!1,this.highlightRays.getComponent(M.AnimatedItem).isHighlighted=!1,this.coordsPanel.getComponent(M.AnimatedItem).isHighlighted=!1,this.timePanel.getComponent(M.AnimatedItem).isHighlighted=!1},EventMenuItem.prototype.show=function(){},EventMenuItem.prototype.hide=function(){},EventMenuItem}(V.MenuItem);A.EventMenuItem=H})),define("src/lobby/menuItemTrending",["require","exports","src/lobby/thumbnail","src/lobby/helperFunctions","src/lobby/resources/resources","src/lobby/simpleAnimator","src/lobby/menuItem"],(function(v,A,E,R,M,O,V){Object.defineProperty(A,"__esModule",{value:!0}),A.TrendingMenuItem=void 0;var z=function(v){function TrendingMenuItem(A,V,z){var W=v.call(this)||this;W.addComponent(new Transform(A)),W.defaultItemScale=new Vector3(2,2,2),W.itemBox=new Entity,W.itemBox.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1)})),W.itemBox.addComponent(M.menuTitleBGShape),W.itemBox.setParent(W),W.scale=new Vector3(1,.5,1),W.scaleMultiplier=1.2,z.thumbnail?(W.thumbNail=new E.ThumbnailPlane(new Texture(z.thumbnail),{position:new Vector3(.25,.275,0),scale:new Vector3(1.1,.55,1)},V),W.thumbNail.setParent(W.itemBox)):(W.thumbNail=new E.ThumbnailPlane(M.dummySceneBG,{position:new Vector3(.25,.275,0),scale:new Vector3(1.1,.55,1)},V),W.thumbNail.setParent(W.itemBox)),W.leftDetailsRoot=new Entity,W.leftDetailsRoot.addComponent(new Transform({position:new Vector3(-.32,.28,-.02),scale:new Vector3(.9,.9,.9)})),W.leftDetailsRoot.setParent(W.itemBox),W.playerCounterBG=new Entity,W.playerCounterBG.addComponent(new Transform({position:new Vector3(-.25,0,0),scale:new Vector3(.45,.45,.45)})),W.playerCounterBG.addComponent(M.playerCounterBGShape),W.playerCounterBG.setParent(W.leftDetailsRoot),W.userCountRoot=new Entity,W.userCountRoot.addComponent(new Transform({position:new Vector3(.52,-.4,-.025),scale:new Vector3(.93,.93,.93)})),W.userCountRoot.setParent(W.playerCounterBG),W.usersTitleRoot=new Entity,W.usersTitleRoot.addComponent(new Transform({position:new Vector3(0,-.12,.05),scale:new Vector3(.8,.8,.8)})),W.usersTitleRoot.setParent(W.playerCounterBG),W.userCountText=new TextShape;var H=new TextShape;W.userCount=z.usersTotalCount,W.userCountText.value=W.userCount.toString(),W.userCountText.fontSize=4,W.userCountText.hTextAlign="right",W.userCountText.color=M.dateDayColor,W.userCountText.outlineColor=M.dateDayColor,W.userCountText.outlineWidth=.2,H.value="PLAYERS:",H.fontSize=2,H.font=new Font(Fonts.SanFrancisco_Semibold),H.color=Color3.Black(),W.userCountRoot.addComponent(W.userCountText),W.usersTitleRoot.addComponent(H),W.addComponent(new O.AnimatedItem({position:new Vector3(0,0,0),scale:new Vector3(W.defaultItemScale.x,W.defaultItemScale.y,W.defaultItemScale.z)},{position:new Vector3(0,0,-.6),scale:new Vector3(2.3,2.3,2.3)},2)),W.detailsRoot=new Entity,W.detailsRoot.addComponent(new Transform),W.detailsRoot.setParent(W),W.titleText=new TextShape,W.title=new Entity;var X=z.name;return"interactive-text"===X?W.titleText.value="Unnamed Scene":(X=(0,R.wordWrap)(X,36,3),W.titleText.value=X),W.titleText.font=new Font(Fonts.SanFrancisco_Heavy),W.titleText.height=20,W.titleText.width=2,W.titleText.fontSize=2,W.titleText.color=Color3.Black(),W.titleText.hTextAlign="center",W.titleText.vTextAlign="center",W.title.addComponent(new Transform({position:new Vector3(0,-.15,-.01),scale:new Vector3(.3,.3,.3)})),W.title.addComponent(W.titleText),W.title.setParent(W.itemBox),W.coordsPanel=new Entity,W.coordsPanel.addComponent(new Transform({position:new Vector3(-.3,-.2,0),scale:new Vector3(.4,.4,.4)})),W.coordsPanel.addComponent(M.coordsPanelShape),W.coordsPanel.setParent(W.detailsRoot),W.coordsPanel.addComponent(new O.AnimatedItem({position:new Vector3(0,0,.2),scale:new Vector3(.1,.1,.1)},{position:new Vector3(-.4,-.25,-.05),scale:new Vector3(.5,.5,.5)},1.9)),W.coords=new Entity,W.coordsText=new TextShape,W.coordsText.value=z.baseCoords[0]+","+z.baseCoords[1],W.coordsText.color=Color3.FromHexString("#111111"),W.coordsText.font=new Font(Fonts.SanFrancisco_Heavy),W.coords.addComponent(W.coordsText),W.coords.addComponent(new Transform({position:new Vector3(.18,-.33,-.05),scale:new Vector3(.18,.18,.18)})),W.coords.setParent(W.coordsPanel),W.jumpInButton=new Entity,W.jumpInButton.addComponent(new Transform({position:new Vector3(0,-.2,0),scale:new Vector3(.4,.4,.4)})),W.jumpInButton.addComponent(M.jumpInButtonShape),W.jumpInButton.setParent(W.detailsRoot),W.jumpInButton.addComponent(new O.AnimatedItem({position:new Vector3(0,0,.2),scale:new Vector3(.1,.1,.1)},{position:new Vector3(.4,-.25,-.05),scale:new Vector3(.5,.5,.5)},1.8)),W.jumpButtonText=new Entity,W.jumpButtonTextShape=new TextShape,W.jumpButtonTextShape.color=Color3.FromHexString("#FFFFFF"),W.jumpButtonTextShape.font=new Font(Fonts.SanFrancisco_Heavy),W.jumpButtonTextShape.fontSize=10,W.jumpButtonTextShape.hTextAlign="center",W.jumpButtonText.addComponent(W.jumpButtonTextShape),W.jumpButtonText.addComponent(new Transform({position:new Vector3(0,-.33,-.05),scale:new Vector3(.22,.22,.22)})),W.jumpButtonText.setParent(W.jumpInButton),z.baseCoords[0]<10&&z.baseCoords[0]>-10?(W.coordsText.value="0,0",W.coordsPanel.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return[2]}))}))}),{button:ActionButton.POINTER,hoverText:"YOU ARE HERE"})),W.jumpButtonTextShape.value="YOU'RE HERE",W.jumpButtonTextShape.fontSize=7,W.jumpInButton.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return[2]}))}))}),{button:ActionButton.POINTER,hoverText:"YOU ARE HERE"}))):(W.coordsPanel.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return teleportTo(z.baseCoords[0]+","+z.baseCoords[1]),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"GO THERE"})),W.jumpButtonTextShape.value="JUMP IN",W.jumpInButton.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return teleportTo(z.baseCoords[0]+","+z.baseCoords[1]),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"JUMP IN"}))),W.highlightRays=new Entity,W.highlightRays.addComponent(new Transform),W.highlightRays.addComponent(M.highlightRaysShape),W.highlightRays.setParent(W.detailsRoot),W.highlightRays.addComponent(new O.AnimatedItem({position:new Vector3(0,0,.05),scale:new Vector3(0,0,0)},{position:new Vector3(0,0,.05),scale:new Vector3(1,1,1)},3)),W.highlightFrame=new Entity,W.highlightFrame.addComponent(new Transform),W.highlightFrame.addComponent(M.highlightFrameShape),W.highlightFrame.setParent(W.highlightRays),W}return __extends(TrendingMenuItem,v),TrendingMenuItem.prototype.updateItemInfo=function(v){v.thumbnail?this.thumbNail.updateImage(new Texture(v.thumbnail)):this.thumbNail.updateImage(M.dummySceneBG),this.userCount=v.usersTotalCount,this.userCountText.value=this.userCount.toString();var A=v.name;"interactive-text"===A?this.titleText.value="Unnamed Scene":(A=(0,R.wordWrap)(A,36,3),this.titleText.value=A),this.coordsText.value=v.baseCoords[0]+","+v.baseCoords[1],v.baseCoords[0]<10&&v.baseCoords[0]>-10?(this.coordsText.value="0,0",this.coordsPanel.getComponent(OnPointerDown).callback=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return[2]}))}))},ActionButton.POINTER,this.jumpButtonTextShape.value="YOU'RE HERE",this.jumpButtonTextShape.fontSize=7,this.jumpInButton.getComponent(OnPointerDown).hoverText="YOU ARE HERE"):(this.coordsPanel.getComponent(OnPointerDown).callback=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(A){return teleportTo(v.baseCoords[0]+","+v.baseCoords[1]),[2]}))}))},ActionButton.POINTER,this.jumpButtonTextShape.value="JUMP IN",this.jumpButtonTextShape.fontSize=10,this.jumpInButton.getComponent(OnPointerDown).callback=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(A){return teleportTo(v.baseCoords[0]+","+v.baseCoords[1]),[2]}))}))},this.jumpInButton.getComponent(OnPointerDown).hoverText="JUMP IN")},TrendingMenuItem.prototype.select=function(){this.selected||(this.selected=!0,this.jumpInButton.getComponent(O.AnimatedItem).isHighlighted=!0,this.highlightRays.getComponent(O.AnimatedItem).isHighlighted=!0,this.coordsPanel.getComponent(O.AnimatedItem).isHighlighted=!0)},TrendingMenuItem.prototype.deselect=function(){this.selected=!1,this.jumpInButton.getComponent(O.AnimatedItem).isHighlighted=!1,this.highlightRays.getComponent(O.AnimatedItem).isHighlighted=!1,this.coordsPanel.getComponent(O.AnimatedItem).isHighlighted=!1},TrendingMenuItem.prototype.show=function(){},TrendingMenuItem.prototype.hide=function(){},TrendingMenuItem}(V.MenuItem);A.TrendingMenuItem=z})),define("src/lobby/teleports",["require","exports","src/lobby/resources/globals"],(function(v,A,E){var R;Object.defineProperty(A,"__esModule",{value:!0}),A.teleports=A.Teleport=A.Locations=void 0,function(v){v.CROWD="crowd",v.MAGIC="magic",v.KOKO="-39,58",v.SALMONOMICON="-52,1",v.DRAGONRUSH="-43,53",v.MUSEUM="16,83",v.TOMBCHASER="12,46",v.BLOCK="61,-27",v.FRUIT="59,133",v.CASTLE="-134,-121",v.INFINITY="-71,-38",v.MOLES="59,135",v.PRESENT="-40,-49",v.CASINO="-55,143",v.TOKI="28,45"}(R=A.Locations||(A.Locations={}));var M=function(v){function Teleport(A,E,R,M,O){var V=v.call(this)||this;engine.addEntity(V),V.addComponent(A),V.addComponent(new Transform(E)),V.name=M,V.location=R;var z=V;V.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return teleportTo(z.location),[2]}))}))}),{button:ActionButton.POINTER,hoverText:V.name}));var W=new Entity;W.addComponent(new GLTFShape("models/particles.glb")),W.setParent(V);var H=new Entity;return H.addComponent(new GLTFShape("models/teleports/teleport.glb")),H.addComponent(new Transform({})),H.setParent(V),V}return __extends(Teleport,v),Teleport}(Entity);A.Teleport=M;for(var O=new Vector3(E.lobbyCenter.x,E.lobbyHeight,E.lobbyCenter.z),V=[],z=[],W=0;W<14;W++){var H=O.add(Vector3.Forward().rotate(Quaternion.Euler(0,70+230*W/14,0)).multiplyByFloats(18,18,18));V.push(H);var X=Quaternion.Euler(0,250+230*W/14,0);z.push(X)}var K=new Transform({position:V[0],rotation:z[0]}),Z=new Transform({position:V[1],rotation:z[1]}),J=(new Transform({position:V[2],rotation:z[2]}),new Transform({position:V[3],rotation:z[3]})),$=(new Transform({position:V[4],rotation:z[4]}),new Transform({position:V[5],rotation:z[5]})),ee=new Transform({position:V[6],rotation:z[6]}),ne=(new Transform({position:V[7],rotation:z[7]}),new Transform({position:V[8],rotation:z[8]}),new Transform({position:V[9],rotation:z[9]})),oe=new Transform({position:V[10],rotation:z[10]}),ie=(new Transform({position:V[11],rotation:z[11]}),new Transform({position:V[12],rotation:z[12]})),ae=new Transform({position:V[13],rotation:z[13]});new Transform({position:V[14],rotation:z[14]}),A.teleports=[{name:"Dragon Rush",model:new GLTFShape("models/lobby/classics/dragon_rush.glb"),location:R.DRAGONRUSH,transform:K,description:"Fly on the back of a dragon, need we\nsay more?\nScene by the amusement park district."},{name:"Toki Toki Land",model:new GLTFShape("models/lobby/classics/toki_land.glb"),location:R.TOKI,transform:Z,description:"A christmas themed adventure.\nSave the Toki Tokis from\nan evil snowman and his henchmen."},{name:"Block Runner",model:new GLTFShape("models/lobby/classics/block_runner.glb"),location:R.BLOCK,transform:J,description:"A collection of competitive minigames\nthat are a lot of fun to play!\n"},{name:"Koko Jones",model:new GLTFShape("models/lobby/classics/koko_jones.glb"),location:R.KOKO,transform:$,description:"Visit the temple of eternal bananas\nto collect gems and face evil monkeys\nScene by the amusement park district."},{name:"Fruit Catcher",model:new GLTFShape("models/lobby/classics/fruit_catcher.glb"),location:R.FRUIT,transform:ee,description:"Catch as many fruits as you can,\navoid bombs! Compete for the\nhighest score!"},{name:"Book of Salmonomicon",model:new GLTFShape("models/lobby/classics/salmonomicon.glb"),location:R.SALMONOMICON,transform:ne,description:"In this bizarre horror-themed game\nhelp Mika out and defeat a\nterrible creature."},{name:"Museum District",model:new GLTFShape("models/lobby/classics/museum_district.glb"),location:R.MUSEUM,transform:oe,description:"The Museum district houses works\nfrom digital and traditional artists.\nSuperb moving sculptures & paintings."},{name:"Tomb Chaser",model:new GLTFShape("models/lobby/classics/tomb_chaser.glb"),location:R.TOMBCHASER,transform:ie,description:"Speed run through an ancient pyramid\navoiding obstacles as you try to keep\nup, in this exciting game."},{name:"Infinity Engine",model:new GLTFShape("models/lobby/classics/infinity_engine.glb"),location:R.INFINITY,transform:ae,description:"Mine for loot underground, then\ndefend a train from\nbandits."}]})),define("src/lobby/menuItemClassic",["require","exports","src/lobby/helperFunctions","src/lobby/resources/resources","src/lobby/simpleAnimator","src/lobby/menuItem"],(function(v,A,E,R,M,O){Object.defineProperty(A,"__esModule",{value:!0}),A.ClassicMenuItem=void 0;var V=function(v){function ClassicMenuItem(A,O,V,z,W){var H=v.call(this)||this;H.addComponent(new Transform(A)),H.defaultItemScale=new Vector3(1,1,1),H.itemBox=new Entity,H.itemBox.addComponent(new Transform({position:new Vector3(0,0,-.2),scale:new Vector3(.75,.75,.75)})),H.itemBox.addComponent(W),H.itemBox.getComponent(GLTFShape).isPointerBlocker=!1,H.itemBox.addComponent(new Billboard(!1,!0,!1)),H.itemBox.setParent(H),H.scaleMultiplier=1.2,H.teleportLocation=z,H.addComponent(new M.AnimatedItem({position:new Vector3(0,0,-.2),scale:new Vector3(H.defaultItemScale.x,H.defaultItemScale.y,H.defaultItemScale.z)},{position:new Vector3(-.7,0,-.2),scale:new Vector3(1,1,1)},2)),H.detailsRoot=new Entity,H.detailsRoot.addComponent(new Transform({position:new Vector3(0,.15,0),rotation:Quaternion.Euler(0,180,0)})),H.detailsRoot.setParent(H),H.detailTextPanel=new Entity,H.detailTextPanel.addComponent(new Transform({position:new Vector3(.9,0,0),rotation:Quaternion.Euler(0,15,0)})),H.detailTextPanel.addComponent(R.detailsBGShape),H.detailTextPanel.setParent(H.detailsRoot),H.detailTextPanel.addComponent(new M.AnimatedItem({position:new Vector3(.8,0,.2),scale:new Vector3(0,.8,0)},{position:new Vector3(.9,0,-.1),scale:new Vector3(1.5,1.5,1.5)},2.2));var X=new TextShape;X.value=O,X.font=new Font(Fonts.SanFrancisco_Heavy),X.height=20,X.width=2,X.fontSize=3,X.color=Color3.Black(),X.hTextAlign="left",X.vTextAlign="top",H.detailTitle=new Entity,H.detailTitle.addComponent(new Transform({position:new Vector3(.1,.5,0),scale:new Vector3(.4,.4,.4)})),H.detailTitle.addComponent(X),H.detailTitle.setParent(H.detailTextPanel);var K=new TextShape;K.value="\n\n"+(0,E.wordWrap)(V,75,11)+"</cspace>",K.font=new Font(Fonts.SanFrancisco_Semibold),K.height=20,K.width=2,K.fontSize=2,K.color=Color3.FromHexString("#111111"),K.hTextAlign="left",K.vTextAlign="top",K.lineSpacing="0",H.detailTextBody=new Entity,H.detailTextBody.addComponent(new Transform({position:new Vector3(.1,.4,0),scale:new Vector3(.3,.3,.3)})),H.detailTextBody.addComponent(K),H.detailTextBody.setParent(H.detailTextPanel),H.coordsPanel=new Entity,H.coordsPanel.addComponent(new Transform({position:new Vector3(-.3,-.2,0),scale:new Vector3(.4,.4,.4)})),H.coordsPanel.addComponent(R.coordsPanelShape),H.coordsPanel.setParent(H.detailTextPanel),H.coordsPanel.addComponent(new M.AnimatedItem({position:new Vector3(0,0,.2),scale:new Vector3(.1,.1,.1)},{position:new Vector3(1.1,-.3,-.05),scale:new Vector3(.5,.5,.5)},1.9)),H.jumpInButton=new Entity,H.jumpInButton.addComponent(new Transform({position:new Vector3(0,-.2,0),scale:new Vector3(.4,.4,.4)})),H.jumpInButton.addComponent(R.jumpInButtonShape),H.jumpInButton.setParent(H.detailTextPanel),H.jumpInButton.addComponent(new M.AnimatedItem({position:new Vector3(0,0,.2),scale:new Vector3(.1,.1,.1)},{position:new Vector3(.35,-.3,-.05),scale:new Vector3(.5,.5,.5)},1.8));var Z=new Entity,J=new TextShape;J.color=Color3.FromHexString("#FFFFFF"),J.font=new Font(Fonts.SanFrancisco_Heavy),J.hTextAlign="center",Z.addComponent(J),Z.addComponent(new Transform({position:new Vector3(0,-.33,-.05),scale:new Vector3(.22,.22,.22)})),J.value="JUMP IN",H.jumpInButton.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return teleportTo(z),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"JUMP IN"})),Z.setParent(H.jumpInButton);var $=new Entity,ee=new TextShape;return ee.value=z,ee.color=Color3.FromHexString("#111111"),ee.font=new Font(Fonts.SanFrancisco_Heavy),$.addComponent(ee),$.addComponent(new Transform({position:new Vector3(.18,-.33,-.05),scale:new Vector3(.18,.18,.18)})),$.setParent(H.coordsPanel),H.highlightRays=new Entity,H.highlightRays.addComponent(new Transform),H.highlightRays.addComponent(R.highlightRaysShape),H.highlightRays.setParent(H.detailsRoot),H.highlightRays.addComponent(new M.AnimatedItem({position:new Vector3(0,0,.3),scale:new Vector3(0,0,0)},{position:new Vector3(0,0,.3),scale:new Vector3(1,1,1)},3)),H.highlightRays.addComponent(new Billboard(!1,!0,!1)),H}return __extends(ClassicMenuItem,v),ClassicMenuItem.prototype.select=function(){this.selected||(this.selected=!0,this.jumpInButton.getComponent(M.AnimatedItem).isHighlighted=!0,this.detailTextPanel.getComponent(M.AnimatedItem).isHighlighted=!0,this.highlightRays.getComponent(M.AnimatedItem).isHighlighted=!0,this.coordsPanel.getComponent(M.AnimatedItem).isHighlighted=!0)},ClassicMenuItem.prototype.deselect=function(){this.selected=!1,this.jumpInButton.getComponent(M.AnimatedItem).isHighlighted=!1,this.detailTextPanel.getComponent(M.AnimatedItem).isHighlighted=!1,this.highlightRays.getComponent(M.AnimatedItem).isHighlighted=!1,this.coordsPanel.getComponent(M.AnimatedItem).isHighlighted=!1},ClassicMenuItem.prototype.show=function(){},ClassicMenuItem.prototype.hide=function(){},ClassicMenuItem}(O.MenuItem);A.ClassicMenuItem=V})),define("src/lobby/player",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.player=void 0,A.player=Camera.instance})),define("src/lobby/verticalScrollMenu",["require","exports","src/lobby/simpleAnimator","src/lobby/resources/resources","src/lobby/resources/sounds"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0}),A.clickScrollSystem=A.VerticalScrollMenu=A.VerticalScroller=void 0;var O=function(){function VerticalScroller(){this.base=0,this.stops=0,this.currentItem=0,this.scrollTarget=0,this.scrollStep=2.2,this.scrollFraction=0,this.speed=3,this.currentMenuVelocity=0}return VerticalScroller.prototype.scrollUp=function(){this.currentItem<this.stops-1&&(this.currentItem+=1,this.scrollTarget=this.base-this.currentItem*this.scrollStep)},VerticalScroller.prototype.scrollDown=function(){this.currentItem>0&&(this.currentItem-=1,this.scrollTarget=this.base-this.currentItem*this.scrollStep)},VerticalScroller.prototype.reset=function(){this.base=0,this.stops=0,this.currentItem=0,this.scrollTarget=0,this.scrollStep=2.2,this.scrollFraction=0,this.speed=3,this.currentMenuVelocity=0},__decorate([Component("VerticalScroller")],VerticalScroller)}();A.VerticalScroller=O;var V=function(v){function VerticalScrollMenu(A,E,V,z,W,H){var X=v.call(this)||this;return X.visibleItemCount=5,X.verticalSpacing=1.2,X.currentOffset=0,X.maxHeight=1,X.visibleItemCount=V,X.items=[],X.clickBoxes=[],X.itemRoots=[],X.menuFrame=new Entity,X.menuFrame.addComponent(new Transform({position:new Vector3(0,0,.05),scale:new Vector3(4,1,4)})),X.menuFrame.addComponent(R.menuPillarsShape),X.menuFrame.addComponent(new OnPointerDown((function(v){2===v.buttonId&&X.scrollUp(),1===v.buttonId&&X.scrollDown()}),{distance:20,showFeedback:!1})),X.menuFrame.setParent(X),X.menuFrame.addComponent(M.menuDownSource),X.topMesh=new Entity,X.topMesh.addComponent(new Transform({position:new Vector3(0,X.visibleItemCount*E-1,0),scale:new Vector3(4,4,4)})),X.topMesh.addComponent(z),X.topMesh.setParent(X),X.addComponent(M.menuUpSource),X.addComponent(new Transform(A)),X.baseMesh=new Entity,X.baseMesh.addComponent(new Transform({position:new Vector3(0,-.6,0),scale:new Vector3(4,4,4)})),X.baseMesh.addComponent(W),X.baseMesh.addComponent(new OnPointerDown((function(v){2===v.buttonId&&X.scrollUp(),1===v.buttonId&&X.scrollDown()}),{distance:20,showFeedback:!1})),X.baseMesh.setParent(X),X.baseText=new Entity,X.baseTextShape=new TextShape,X.baseTextShape.value=H,X.baseTextShape.color=Color3.FromHexString("#111111"),X.baseTextShape.font=new Font(Fonts.SanFrancisco_Heavy),X.baseTextShape.fontSize=3,X.baseText.addComponent(X.baseTextShape),X.baseText.addComponent(new Transform({position:new Vector3(0,-.15,-.16),scale:new Vector3(.25,.25,.25),rotation:Quaternion.Euler(27,0,0)})),X.baseText.setParent(X.baseMesh),X.origin=new Vector3(0,0,0),X.origin.copyFrom(X.getComponent(Transform).position),X.verticalSpacing=E,X.scrollerRootA=new Entity,X.scrollerRootA.addComponent(new Transform),X.scrollerRootA.addComponent(new O),X.scrollerRootA.getComponent(O).base=X.scrollerRootA.getComponent(Transform).position.y,X.scrollerRootA.getComponent(O).scrollStep=X.verticalSpacing,X.scrollerRootA.setParent(X),engine.addEntity(X),X.instructions=new Entity,X.instructions.addComponent(new Transform({position:new Vector3(-3,.25,-.3),scale:new Vector3(1.5,1.5,1.5),rotation:Quaternion.Euler(0,-10,0)})),X.instructions.addComponent(R.scrollInstructionShape),X.instructions.addComponent(new OnPointerDown((function(v){2===v.buttonId&&X.scrollUp(),1===v.buttonId&&X.scrollDown()}),{distance:20,showFeedback:!0,hoverText:"USE E/F TO SCROLL EVENTS"})),X.instructions.setParent(X),X.maxHeight=X.visibleItemCount*X.verticalSpacing+1,X.menuFrame.getComponent(Transform).position.y=X.maxHeight/2-X.verticalSpacing,X.menuFrame.getComponent(Transform).scale.y=X.maxHeight,X.selectSound=new Entity,X.selectSound.addComponent(new Transform),X.selectSound.addComponent(M.menuSelectSource),X.selectSound.setParent(X),X.deselectSound=new Entity,X.deselectSound.addComponent(new Transform),X.deselectSound.addComponent(M.menuDeselectSource),X.deselectSound.setParent(X),X.scrollEndSound=new Entity,X.scrollEndSound.addComponent(new Transform),X.scrollEndSound.addComponent(M.menuScrollEndSource),X.scrollEndSound.setParent(X),X}return __extends(VerticalScrollMenu,v),VerticalScrollMenu.prototype.addMenuItem=function(v){var A=this,E=new Entity;E.addComponent(new Transform({position:new Vector3(0,this.currentOffset,0)})),this.itemRoots.push(E);var V=new Entity;V.addComponent(new Transform({})),V.addComponent(R.shelfShape),V.setParent(E),V.addComponent(new OnPointerDown((function(E){A.scrollerRootA.getComponent(O),0===E.buttonId&&(v.selected?(A.deselectItem(v,!1),V.getComponent(OnPointerDown).hoverText="SELECT",M.menuDeselectSource.playOnce()):(A.selectItem(v),V.getComponent(OnPointerDown).hoverText="DESELECT",M.menuSelectSource.playOnce())),2===E.buttonId&&A.scrollUp(),1===E.buttonId&&A.scrollDown()}),{distance:20,showFeedback:!0,hoverText:"SELECT"})),this.items.push(v),this.clickBoxes.push(V),this.itemRoots.length<=this.visibleItemCount&&(E.setParent(this.scrollerRootA),v.setParent(E)),this.currentOffset+=this.verticalSpacing,this.scrollerRootA.getComponent(O).stops=this.items.length},VerticalScrollMenu.prototype.removeMenuItem=function(v){v>-1&&(engine.removeEntity(this.items[v]),engine.removeEntity(this.itemRoots[v]),engine.removeEntity(this.clickBoxes[v]),this.items.splice(v,1),this.itemRoots.splice(v,1),this.clickBoxes.splice(v,1),this.scrollerRootA.getComponent(O).stops=this.items.length,this.currentOffset-=this.verticalSpacing)},VerticalScrollMenu.prototype.scrollUp=function(){var v=this.scrollerRootA.getComponent(O);v.currentItem<v.stops-1?(v.scrollUp(),this.deselectAll(),this.showItem(v.currentItem+(this.visibleItemCount-1)),this.hideItem(v.currentItem-2),this.halveSizeItem(v.currentItem-1),M.menuUpSource.playOnce()):(this.scrollerRootA.getComponent(Transform).position.y-=.3,M.menuScrollEndSource.playOnce())},VerticalScrollMenu.prototype.scrollDown=function(){var v=this.scrollerRootA.getComponent(O);v.currentItem>0?(v.scrollDown(),this.deselectAll(),this.showItem(v.currentItem-1),this.hideItem(v.currentItem+this.visibleItemCount),this.fullSizeItem(v.currentItem),M.menuDownSource.playOnce()):(this.scrollerRootA.getComponent(Transform).position.y+=.3,M.menuScrollEndSource.playOnce())},VerticalScrollMenu.prototype.selectItem=function(v){v.hasComponent(E.AnimatedItem)?v.selected||(this.deselectAll(),v.getComponent(E.AnimatedItem).isHighlighted=!0,v.select()):v.select()},VerticalScrollMenu.prototype.deselectItem=function(v,A){v.hasComponent(E.AnimatedItem)?v.selected&&(v.getComponent(E.AnimatedItem).isHighlighted=!1,v.deselect(A)):v.deselect(A)},VerticalScrollMenu.prototype.deselectAll=function(){for(var v=0;v<this.items.length;v++)this.items[v].getComponent(E.AnimatedItem).isHighlighted=!1,this.deselectItem(this.items[v],!0),this.clickBoxes[v].getComponent(OnPointerDown).hoverText="SELECT"},VerticalScrollMenu.prototype.hideItem=function(v){v<this.items.length&&v>=0&&engine.removeEntity(this.itemRoots[v])},VerticalScrollMenu.prototype.showItem=function(v){v<this.itemRoots.length&&v>=0&&(engine.addEntity(this.itemRoots[v]),this.itemRoots[v].setParent(this.scrollerRootA),this.items[v].setParent(this.itemRoots[v]),this.items[v].getComponent(Transform).scale.setAll(0),this.items[v].getComponent(Transform).position.z=2)},VerticalScrollMenu.prototype.halveSizeItem=function(v){if(v<this.items.length&&v>=0){var A=this.items[v].getComponent(E.AnimatedItem).defaultTransform;A.scale.x=.5*this.items[v].defaultItemScale.x,A.scale.y=.5*this.items[v].defaultItemScale.y,A.scale.z=.5*this.items[v].defaultItemScale.z}},VerticalScrollMenu.prototype.fullSizeItem=function(v){v<this.items.length&&v>=0&&this.items[v].getComponent(E.AnimatedItem).defaultTransform.scale.copyFrom(this.items[v].defaultItemScale)},VerticalScrollMenu.prototype.resetScroll=function(){this.deselectAll(),this.scrollerRootA.getComponent(O).reset(),this.scrollerRootA.getComponent(O).scrollStep=this.verticalSpacing,this.scrollerRootA.getComponent(O).stops=this.items.length;for(var v=0;v<this.items.length;v++)v<this.visibleItemCount?this.showItem(v):this.hideItem(v),this.items[v].getComponent(E.AnimatedItem).defaultTransform.scale.copyFrom(this.items[v].defaultItemScale)},VerticalScrollMenu}(Entity);A.VerticalScrollMenu=V;var z=function(){function clickScrollSystem(){this.group=engine.getComponentGroup(O,Transform)}return clickScrollSystem.prototype.update=function(v){var A,E;try{for(var R=__values(this.group.entities),M=R.next();!M.done;M=R.next()){var V=M.value,z=V.getComponent(O),W=V.getComponent(Transform);W.position.y=this.springPos(z.scrollTarget,W.position.y,z.currentMenuVelocity,v)}}catch(v){A={error:v}}finally{try{M&&!M.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},clickScrollSystem.prototype.springPos=function(v,A,E,R){return A+(E+=(150*(v-A)+2*-E)*R)*R},clickScrollSystem}();A.clickScrollSystem=z,engine.addSystem(new z)})),define("src/lobby/menuPlaceholders",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.crowdMenuPlaceholder=A.eventItemPlaceholder=void 0,A.eventItemPlaceholder={id:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",name:"Loading Event",image:"images/dummy_scene.png",description:"Loading Event Description",start_at:"2121-01-01T00:00:00.000Z",finish_at:"2121-01-01T01:00:00.000Z",coordinates:[0,0],user:"0x16c28211f185e283178668e784af5b791cc41730",approved:!0,created_at:"2021-04-05T10:56:37.911Z",updated_at:"2021-04-11T16:08:39.085Z",total_attendees:0,latest_attendees:[],url:"https://play.decentraland.org/?position=0%2C0",scene_name:null,user_name:"Decentraland",rejected:!1,trending:!1,realm:null,estate_id:null,estate_name:null,x:0,y:0,all_day:!1,recurrent:!1,recurrent_frequency:null,recurrent_weekday_mask:0,recurrent_month_mask:0,recurrent_interval:1,recurrent_count:null,recurrent_until:null,duration:118488e4,recurrent_dates:["2121-01-01T00:00:00.000Z"],recurrent_setpos:null,recurrent_monthday:null,highlighted:!1,next_start_at:"2121-01-01T00:00:00.000Z",attending:!1,notify:!1,position:[0,0],editable:!1,owned:!1,live:!1},A.crowdMenuPlaceholder={id:"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",name:"Loading Scene",baseCoords:[0,0],usersTotalCount:1,parcels:[[0,0]],creator:"Creator",projectId:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",realms:[{serverName:"fenrir",layer:"amber",usersCount:1,usersMax:100,userParcels:[[0,0]]}]}})),define("src/modules/bar/panels",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.addPanels=void 0,A.addPanels=function(v,A,E,R){var M=new Material;M.albedoTexture=v,M.roughness=1;var O=new Material;O.albedoTexture=A,O.roughness=1;var V=new Material;V.albedoTexture=E,V.roughness=1;var z=new Material;z.albedoTexture=R,z.roughness=1;var W=new Entity;W.addComponent(new PlaneShape),W.addComponent(new Transform({position:new Vector3(160,4.65,140.4),rotation:Quaternion.Euler(180,0,0),scale:new Vector3(2.8,1.55,1.55)})),W.addComponent(M),engine.addEntity(W),W.getComponent(Transform).rotate(new Vector3(1,0,0),33);var H=new Entity;H.addComponent(new PlaneShape),H.addComponent(new Transform({position:new Vector3(157.4,4.65,137.8),rotation:Quaternion.Euler(0,90,180),scale:new Vector3(2.8,1.55,1.55)})),H.addComponent(O),engine.addEntity(H),H.getComponent(Transform).rotate(new Vector3(1,0,0),33);var X=new Entity;X.addComponent(new PlaneShape),X.addComponent(new Transform({position:new Vector3(160,4.65,135.25),rotation:Quaternion.Euler(180,180,0),scale:new Vector3(2.8,1.55,1.55)})),X.addComponent(V),engine.addEntity(X),X.getComponent(Transform).rotate(new Vector3(1,0,0),33);var K=new Entity;K.addComponent(new PlaneShape),K.addComponent(new Transform({position:new Vector3(162.6,4.65,137.8),rotation:Quaternion.Euler(0,270,180),scale:new Vector3(2.8,1.55,1.55)})),K.addComponent(z),engine.addEntity(K),K.getComponent(Transform).rotate(new Vector3(1,0,0),33)}})),define("src/lobby/menuItemLoad",["require","exports","src/lobby/simpleAnimator","src/lobby/resources/resources","src/lobby/menuItem","src/lobby/resources/globals","src/lobby/menuMainFunctions"],(function(v,A,E,R,M,O,V){Object.defineProperty(A,"__esModule",{value:!0}),A.loadMoreMenuItem=void 0;var z=new Entity;z.addComponent(new Transform({position:new Vector3(O.lobbyCenter.x,O.lobbyCenter.y-20,O.lobbyCenter.z)})),z.addComponent(R.loadMoreShape),engine.addEntity(z);var W=function(v){function loadMoreMenuItem(A,M){var O=v.call(this)||this;return O.addComponent(new Transform(A)),O.menuRef=M,O.defaultItemScale=new Vector3(1,1,1),O.button=new Entity,O.button.addComponent(new Transform),O.button.addComponent(R.loadMoreShape),O.button.setParent(O),O.addComponent(new E.AnimatedItem({position:new Vector3(0,0,0),scale:new Vector3(O.defaultItemScale.x,O.defaultItemScale.y,O.defaultItemScale.z)},{position:new Vector3(0,0,-.1),scale:new Vector3(1,1,1)},2)),O}return __extends(loadMoreMenuItem,v),loadMoreMenuItem.prototype.updateItemInfo=function(v){},loadMoreMenuItem.prototype.select=function(){this.selected||(this.selected=!0,(0,V.updateEventsMenu)(this.menuRef,30,!1))},loadMoreMenuItem.prototype.deselect=function(v){this.selected=!1},loadMoreMenuItem.prototype.show=function(){},loadMoreMenuItem.prototype.hide=function(){},loadMoreMenuItem}(M.MenuItem);A.loadMoreMenuItem=W})),define("src/lobby/cooldown",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.CooldownActivated=void 0;var E=function(){function CooldownActivated(v,A,E){this.active=!0,this.elapsed=0,this.cooldownLength=20,this.cooldownLength=v,this.originalHoverText=A,this.inactiveHoverText=E}return CooldownActivated.prototype.startCooldown=function(){this.elapsed=0},__decorate([Component("CooldownActivated")],CooldownActivated)}();A.CooldownActivated=E;var R=function(){function CooldownSystem(){this.group=engine.getComponentGroup(E,Transform)}return CooldownSystem.prototype.update=function(v){var A,R;try{for(var M=__values(this.group.entities),O=M.next();!O.done;O=M.next()){var V=O.value,z=V.getComponent(E);z.elapsed<z.cooldownLength?(z.elapsed+=v,z.active=!1,V.hasComponent(TextShape)&&(V.getComponent(TextShape).visible=!0,V.getComponent(TextShape).value=Math.ceil(z.cooldownLength-z.elapsed).toString()),V.hasComponent(OnPointerDown)&&(V.getComponent(OnPointerDown).hoverText=z.inactiveHoverText)):(z.active=!0,V.hasComponent(TextShape)&&(V.getComponent(TextShape).visible=!1),V.hasComponent(OnPointerDown)&&(V.getComponent(OnPointerDown).hoverText=z.originalHoverText))}}catch(v){A={error:v}}finally{try{O&&!O.done&&(R=M.return)&&R.call(M)}finally{if(A)throw A.error}}},CooldownSystem}();engine.addSystem(new R)})),define("src/lobby/menuMainFunctions",["require","exports","src/lobby/checkApi","src/lobby/menuItemEvent","src/lobby/menuItemTrending","src/lobby/menuItemClassic","src/lobby/verticalScrollMenu","src/lobby/teleports","src/lobby/resources/resources","src/lobby/resources/sounds","src/lobby/menuPlaceholders","src/lobby/simpleAnimator","src/modules/bar/panels","src/lobby/menuItemLoad","src/lobby/cooldown"],(function(v,A,E,R,M,O,V,z,W,H,X,K,Z,J,$){function updateEventsMenu(v,A,M){return __awaiter(this,void 0,void 0,(function(){var O,V,z;return __generator(this,(function(W){switch(W.label){case 0:return[4,(0,E.getEvents)(A)];case 1:if((O=W.sent()).length<=0)return[2];for(M||removeLastXItems(v,1),V=0;V<O.length;V++)V<v.items.length?v.items[V].updateItemInfo(O[V]):v.addMenuItem(new R.EventMenuItem({scale:new Vector3(2,2,2)},new Texture("images/rounded_alpha.png"),O[V]));return O.length<=v.items.length&&removeLastXItems(v,v.items.length-O.length),M&&((z=new J.loadMoreMenuItem({scale:new Vector3(1,1,1)},v)).addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(A){return z.getComponent(Transform).position.z=0,updateEventsMenu(v,30,!1),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"LOAD MORE"})),v.addMenuItem(z)),O.length>=4?(0,Z.addPanels)(new Texture(O[0].image),new Texture(O[1].image),new Texture(O[2].image),new Texture(O[3].image)):(0,Z.addPanels)(new Texture(O[0].image),new Texture(O[0].image),new Texture(O[0].image),new Texture(O[0].image)),v.resetScroll(),[2]}}))}))}function updateCrowdsMenu(v){return __awaiter(this,void 0,void 0,(function(){var A,R;return __generator(this,(function(O){switch(O.label){case 0:return[4,(0,E.getTrendingScenes)(10)];case 1:if((A=O.sent()).length<=0)return[2];for(R=0;R<A.length;R++)R<v.items.length?v.items[R].updateItemInfo(A[R]):v.addMenuItem(new M.TrendingMenuItem({scale:new Vector3(2,2,2)},new Texture("images/rounded_alpha.png"),A[R]));return A.length<=v.items.length&&removeLastXItems(v,v.items.length-A.length),v.resetScroll(),[2]}}))}))}function removeLastXItems(v,A){if(A>=1)for(var E=0;E<A;E++)v.removeMenuItem(v.items.length-1)}Object.defineProperty(A,"__esModule",{value:!0}),A.fillClassicsMenu=A.createClassicsVerticalMenu=A.fillCrowdsMenu=A.removeLastXItems=A.updateCrowdsMenu=A.createCrowdVerticalMenu=A.fillEventsMenu=A.updateEventsMenu=A.createEventsVerticalMenu=void 0,A.createEventsVerticalMenu=function(v){var A=new Entity,E=new V.VerticalScrollMenu({position:new Vector3(0,0,0),scale:new Vector3(1,1,1)},2,5,W.menuTopEventsShape,W.menuBaseShape,"Events");A.addComponent(new Transform({position:v.position,rotation:v.rotation,scale:v.scale})),E.setParent(A),engine.addEntity(A);for(var M=0;M<10;M++)E.addMenuItem(new R.EventMenuItem({scale:new Vector3(2,2,2)},new Texture("images/rounded_alpha.png"),X.eventItemPlaceholder));var O=new Entity;O.addComponent(new Transform({position:new Vector3(2.35,-1.15,-.65),rotation:Quaternion.Euler(27,0,0),scale:new Vector3(.35,.35,.35)})),O.addComponent(H.menuErrorSource),O.setParent(E);var z=new Entity;z.addComponent(new Transform({position:new Vector3(0,0,-.1)})),z.addComponent(new K.AnimatedItem({position:new Vector3(0,0,-.1),scale:new Vector3(1,1,1)},{position:new Vector3(0,0,0),scale:new Vector3(1,1,1)},2)),z.addComponent(new $.CooldownActivated(20,"REFRESH","WAIT FOR COOLDOWN")),z.addComponent(H.refreshSource);var Z=new TextShape;return Z.value="20",Z.fontSize=4,z.addComponent(Z),z.addComponent(W.refreshShape),z.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return z.getComponent($.CooldownActivated).active?(z.getComponent(Transform).position.z=0,updateEventsMenu(E,30,!1),z.getComponent($.CooldownActivated).startCooldown(),H.refreshSource.playOnce()):H.menuErrorSource.playOnce(),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"Refresh"})),z.setParent(O),E},A.updateEventsMenu=updateEventsMenu,A.fillEventsMenu=function(v){return __awaiter(this,void 0,void 0,(function(){var A,M;return __generator(this,(function(O){switch(O.label){case 0:return[4,(0,E.getEvents)(10)];case 1:if((A=O.sent()).length<=0)return[2];for(M=0;M<A.length;M++)v.addMenuItem(new R.EventMenuItem({scale:new Vector3(2,2,2)},new Texture("images/rounded_alpha.png"),A[M]));return[2]}}))}))},A.createCrowdVerticalMenu=function(v){var A=new Entity,E=new V.VerticalScrollMenu({position:new Vector3(0,0,0),scale:new Vector3(1,1,1)},2,4,W.menuTopCrowdShape,W.menuBaseShape,"Trending Scenes");A.addComponent(new Transform({position:v.position,rotation:v.rotation,scale:v.scale})),E.setParent(A),engine.addEntity(A);for(var R=0;R<10;R++)E.addMenuItem(new M.TrendingMenuItem({scale:new Vector3(2,2,2)},new Texture("images/rounded_alpha.png"),X.crowdMenuPlaceholder));var O=new Entity;O.addComponent(new Transform({position:new Vector3(2.35,-1.15,-.65),rotation:Quaternion.Euler(27,0,0),scale:new Vector3(.35,.35,.35)})),O.addComponent(H.menuErrorSource),O.setParent(E);var z=new Entity;z.addComponent(new Transform({position:new Vector3(0,0,-.1)})),z.addComponent(new K.AnimatedItem({position:new Vector3(0,0,-.1),scale:new Vector3(1,1,1)},{position:new Vector3(0,0,0),scale:new Vector3(1,1,1)},2)),z.addComponent(new $.CooldownActivated(20,"REFRESH","WAIT FOR COOLDOWN")),z.addComponent(H.refreshSource);var Z=new TextShape;return Z.value="20",Z.fontSize=4,z.addComponent(Z),z.addComponent(W.refreshShape),z.addComponent(new OnPointerDown((function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(v){return z.getComponent($.CooldownActivated).active?(z.getComponent(Transform).position.z=0,updateCrowdsMenu(E),z.getComponent($.CooldownActivated).startCooldown(),H.refreshSource.playOnce()):H.menuErrorSource.playOnce(),[2]}))}))}),{button:ActionButton.POINTER,hoverText:"Refresh"})),z.setParent(O),E},A.updateCrowdsMenu=updateCrowdsMenu,A.removeLastXItems=removeLastXItems,A.fillCrowdsMenu=function(v){return __awaiter(this,void 0,void 0,(function(){var A,R;return __generator(this,(function(O){switch(O.label){case 0:return[4,(0,E.getTrendingScenes)(10)];case 1:if((A=O.sent()).length<=0)return[2];for(R=0;R<A.length;R++)v.addMenuItem(new M.TrendingMenuItem({scale:new Vector3(2,2,2)},new Texture("images/rounded_alpha.png"),A[R]));return[2]}}))}))},A.createClassicsVerticalMenu=function(v){var A=new Entity,E=new V.VerticalScrollMenu({position:new Vector3(0,0,0),scale:new Vector3(1,1,1)},2,4,W.menuTopClassicsShape,W.menuBaseShape,"Old Classics");return A.addComponent(new Transform({position:v.position,rotation:v.rotation,scale:v.scale})),E.setParent(A),engine.addEntity(A),E},A.fillClassicsMenu=function(v){return __awaiter(this,void 0,void 0,(function(){var A,E,R,M,V;return __generator(this,(function(W){try{for(A=__values(z.teleports),E=A.next();!E.done;E=A.next())R=E.value,v.addMenuItem(new O.ClassicMenuItem(new Transform({position:new Vector3(0,-1,0),scale:new Vector3(.1,.1,.1),rotation:Quaternion.Euler(0,180,0)}),R.name,R.description,R.location,R.model))}catch(v){M={error:v}}finally{try{E&&!E.done&&(V=A.return)&&V.call(A)}finally{if(M)throw M.error}}return[2]}))}))}})),define("src/lobby/cloudLobby",["require","exports","src/lobby/portalBeam","src/lobby/menuMainFunctions","src/lobby/resources/globals","src/lobby/resources/resources"],(function(v,A,E,R,M,O){Object.defineProperty(A,"__esModule",{value:!0}),new E.TeleportController;var V=1.2,z=new Vector3(M.lobbyCenter.x,M.lobbyHeight+1.5,M.lobbyCenter.z),W=new Entity;W.addComponent(new Transform({position:new Vector3(M.lobbyCenter.x-1,M.lobbyHeight+1,M.lobbyCenter.z-13.32)})),W.addComponent(O.discordShape),W.addComponent(new OnPointerDown((function(v){openExternalURL("https://dcl.gg/discord")}),{hoverText:"Join the Discussion",button:ActionButton.POINTER})),engine.addEntity(W);var H=new Entity;H.addComponent(new Transform({position:new Vector3(M.lobbyCenter.x+1.38,M.lobbyHeight+1,M.lobbyCenter.z-13.3)})),H.addComponent(O.twitterShape),H.addComponent(new OnPointerDown((function(v){openExternalURL("https://twitter.com/decentraland")}),{hoverText:"Follow Us!",button:ActionButton.POINTER})),engine.addEntity(H);var X=new Entity;X.addComponent(new Transform({position:new Vector3(M.lobbyCenter.x-1.2,M.lobbyHeight-.5,M.lobbyCenter.z-6.4)})),X.addComponent(O.divingSignShape),engine.addEntity(X);var K=new Entity;K.addComponent(new Transform({position:new Vector3(M.lobbyCenter.x,M.lobbyHeight,M.lobbyCenter.z)})),K.addComponent(O.vortex1Shape),engine.addEntity(K);var Z=new Entity;Z.addComponent(new Transform({position:new Vector3(M.lobbyCenter.x,M.lobbyHeight,M.lobbyCenter.z)})),Z.addComponent(O.vortex2Shape),engine.addEntity(Z);var J=Quaternion.Euler(0,0,0),$=z.add(Vector3.Forward().rotate(J).multiplyByFloats(M.lobbyRadius,M.lobbyRadius,M.lobbyRadius)),ee=(0,R.createEventsVerticalMenu)({position:$,rotation:J,scale:new Vector3(V,V,V)});(0,R.updateEventsMenu)(ee,10,!0),J=Quaternion.Euler(0,45,0),$=z.add(Vector3.Forward().rotate(J).multiplyByFloats(M.lobbyRadius,M.lobbyRadius,M.lobbyRadius));var ne=(0,R.createCrowdVerticalMenu)({position:$,rotation:J,scale:new Vector3(V,V,V)});(0,R.updateCrowdsMenu)(ne),J=Quaternion.Euler(0,-45,0),$=z.add(Vector3.Forward().rotate(J).multiplyByFloats(M.lobbyRadius,M.lobbyRadius,M.lobbyRadius));var oe=(0,R.createClassicsVerticalMenu)({position:$,rotation:J,scale:new Vector3(V,V,V)});(0,R.fillClassicsMenu)(oe)})),define("src/lobby/clouds",["require","exports","src/lobby/resources/globals","src/lobby/resources/resources"],(function(v,A,E,R){Object.defineProperty(A,"__esModule",{value:!0}),A.CloudRotate=void 0;var M=function(){function CloudRotate(v,A){this.left=!1,this.speed=1,this.left=v,this.speed=A}return __decorate([Component("CloudRotate")],CloudRotate)}();A.CloudRotate=M,function(v,A,E){for(var M=0,O=Vector3.Forward(),V=1,z=0;z<16;z++){M=22.5*z;var W=20+20*Math.random();O=E.add(Vector3.Forward().rotate(Quaternion.Euler(0,M+20*Math.random(),0)).multiplyByFloats(W,W,W)),V=1+3*Math.random();var H=new Entity;H.addComponent(R.cloudPuffShape),H.addComponent(new Transform({position:new Vector3(O.x,O.y-3*Math.random(),O.z),rotation:Quaternion.Euler(360*Math.random(),360*Math.random(),360*Math.random()),scale:new Vector3(V,V,V)})),engine.addEntity(H)}}(0,0,new Vector3(E.lobbyCenter.x,E.lobbyHeight,E.lobbyCenter.z));var O=new Entity;O.addComponent(new Transform({position:new Vector3(E.lobbyCenter.x,E.lobbyHeight-.2,E.lobbyCenter.z),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(1,1,1)})),O.addComponent(R.cloudSmallShape),O.addComponent(new M(!1,2)),engine.addEntity(O);var V=new Entity;V.addComponent(new Transform({position:new Vector3(E.lobbyCenter.x,E.lobbyHeight-.2,E.lobbyCenter.z),rotation:Quaternion.Euler(0,0,0)})),V.addComponent(R.cloudSmall2Shape),V.addComponent(new M(!0,1.5)),engine.addEntity(V);var z=new Entity;z.addComponent(new Transform({position:new Vector3(E.lobbyCenter.x,E.lobbyHeight,E.lobbyCenter.z),rotation:Quaternion.Euler(0,0,0)})),z.addComponent(R.cloudBigShape),z.addComponent(new M(!0,1)),engine.addEntity(z);var W=function(){function CloudSystem(){this.groupClouds=engine.getComponentGroup(M,Transform)}return CloudSystem.prototype.update=function(v){var A,E;try{for(var R=__values(this.groupClouds.entities),O=R.next();!O.done;O=R.next()){var V=O.value,z=V.getComponent(Transform),W=V.getComponent(M);W.left?z.rotate(Vector3.Down(),W.speed*v):z.rotate(Vector3.Up(),W.speed*v)}}catch(v){A={error:v}}finally{try{O&&!O.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},CloudSystem}();engine.addSystem(new W)})),define("src/modules/arcades/gameLogic/ballTranslator",["require","exports","src/modules/arcades/gameObjects/ball","src/modules/arcades/gameObjects/sound","src/modules/arcades/gameManager"],(function(v,A,E,R,M){Object.defineProperty(A,"__esModule",{value:!0});var O=new R.Sound(new AudioClip("sounds/miss.mp3")),V=function(){function BallTranslatorSystem(){this.ballGroup=engine.getComponentGroup(E.BallFlag)}return BallTranslatorSystem.prototype.update=function(v){var A,E;try{for(var R=__values(this.ballGroup.entities),V=R.next();!V.done;V=R.next()){var z=V.value,W=z.getComponent(Transform),H=z.direction.scale(v*M.GameManager.BALL_SPEED);W.translate(H),W.position.z<=M.GameManager.OUT_OF_BOUNDS&&(M.GameManager.isBallAlive=!1,O.getComponent(AudioSource).playOnce(),engine.removeEntity(z)),(W.position.x<0||W.position.x>32||W.position.z<0||W.position.z>32)&&(M.GameManager.isBallAlive=!1,engine.removeEntity(z))}}catch(v){A={error:v}}finally{try{V&&!V.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},BallTranslatorSystem}();engine.addSystem(new V,1)}));
